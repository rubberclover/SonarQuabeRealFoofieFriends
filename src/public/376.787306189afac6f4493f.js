"use strict";(self.webpackChunkRealFoodieFriends=self.webpackChunkRealFoodieFriends||[]).push([[376],{1376:(V,m,c)=>{c.r(m),c.d(m,{ChatModule:()=>E});var h=c(8583),M=c(665),l=c(1385),f=c(7384);c(7393);var t=c(639),v=c(7709);let g=(()=>{class n{constructor(){this.mensajeReceived=new v.xQ,this.mensajeSend=new v.xQ}receiveMessage(e,o,i,s,a){this.mensajeReceived.next({text:e,sender:o,receiver:i,isNew:s,idChat:a})}getMessageReceived(){return this.mensajeReceived.asObservable()}sendMessage(e,o,i,s,a){this.mensajeSend.next({message:e,currentId:i,otherId:o,isNew:s,idChat:a})}getMessageSend(){return this.mensajeSend.asObservable()}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var b=c(3071),Z=c(2340),P=c(1841);let C=(()=>{class n{constructor(e){this.http=e,this.baseUrl=Z.N.baseUrl}getAllUserChats(e){return this.http.get(`${this.baseUrl}api/chat/getAllUserChats/${e}`).toPromise()}viewMessages(e,o){return this.http.put(`${this.baseUrl}api/chat/viewMessages/${e}`,{viewedUser:o}).toPromise()}obtainChat(e){return this.http.get(`${this.baseUrl}api/chat/obtainChat/${e}`).toPromise()}obtainChatOtherUser(e){return this.http.get(`${this.baseUrl}api/chat/obtainChatOtherUser/${e}`).toPromise()}sendMessage(e,o,i,s,a){return this.http.post(`${this.baseUrl}api/chat/sendMessage`,{viewedUser:a,id:e,text:s,sender:i,receiver:o}).toPromise()}}return n.\u0275fac=function(e){return new(e||n)(t.LFG(P.eN))},n.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var _=c(2542);const x=function(n){return["/user/profile",n]};function k(n,r){if(1&n&&t._UZ(0,"img",18),2&n){const e=t.oxw();t.Q6J("routerLink",t.VKq(2,x,e.otherUser._id)),t.uIk("src",e.otherUser.userImage,t.LSH)}}function S(n,r){if(1&n&&(t.TgZ(0,"div",19),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.Q6J("routerLink",t.VKq(2,x,e.otherUser._id)),t.xp6(1),t.hij(" ",e.otherUser.username," ")}}function U(n,r){if(1&n&&(t.TgZ(0,"div",22),t._UZ(1,"div",23),t.TgZ(2,"div",24),t._uU(3),t.qZA(),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(3),t.hij(" ",e.text," ")}}function T(n,r){if(1&n&&(t.TgZ(0,"div",25),t.TgZ(1,"div",26),t._uU(2),t.qZA(),t._UZ(3,"div",27),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.hij(" ",e.text," ")}}function A(n,r){if(1&n&&(t.TgZ(0,"div"),t.YNc(1,U,4,1,"div",20),t.YNc(2,T,4,1,"div",21),t.qZA()),2&n){const e=r.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngIf",o.otherUser._id==e.sender),t.xp6(1),t.Q6J("ngIf",o.otherUser._id==e.receiver)}}let I=(()=>{class n{constructor(e,o,i,s,a,d,p){this.location=e,this.grupalSocket=o,this.userService=i,this.activatedRoute=s,this.chatDbService=a,this.authService=d,this.router=p,this.otherUser={name:"",email:"",_id:""},this.chat={_id:"new",user1:"u1",user2:"u2",messages:[{_id:"",sender:"u1",receiver:"u2",text:"",sendAt:"",viewedUser1:!1,viewedUser2:!1}]}}ngOnInit(){this.obtainUser(),this.showLoading();let e="000000000000000000000000",o=this.activatedRoute.snapshot.params.id;"new"==o?this.chatDbService.obtainChatOtherUser(this.activatedRoute.snapshot.params.sender).then(i=>{i.ObjectReturn.forEach(s=>{s.idUser==this.activatedRoute.snapshot.params.receiver&&(e=s.idChat)}),this.chatDbService.obtainChat(e).then(s=>{if(s.ok){this.chat=s.ChatReturned;let a=localStorage.getItem("uid");this.chat.user1!=a?this.userService.getUserById(this.chat.user1).subscribe(d=>{this.otherUser=d.dbUser}):this.userService.getUserById(this.chat.user2).subscribe(d=>{this.otherUser=d.dbUser}),this.changeMessageTrue(!0)}else this.chat._id="new",this.chat.user1=this.activatedRoute.snapshot.params.sender,this.chat.user2=this.activatedRoute.snapshot.params.receiver,this.userService.getUserById(this.chat.user2).subscribe(a=>{this.otherUser=a.dbUser,console.log(this.otherUser)}),this.messages=[""],this.hideLoading()})}):this.chatDbService.obtainChat(o).then(i=>{if(i.ok){this.chat=i.ChatReturned;let s=localStorage.getItem("uid");this.chat.user1!=s?this.userService.getUserById(this.chat.user1).subscribe(a=>{this.otherUser=a.dbUser}):this.userService.getUserById(this.chat.user2).subscribe(a=>{this.otherUser=a.dbUser}),this.changeMessageTrue(!0)}}),this.subsMessageRec=this.grupalSocket.getMessageReceived().subscribe(i=>{(i.sender==this.chat.user1||i.sender==this.chat.user2)&&(this.changeMessageTrue(!1),this.messages.push(i))})}obtainUser(){this.authService.validateToken().subscribe(e=>{this.authService.user.name||this.router.navigateByUrl("/auth/login")})}sendMessage(){let e=document.getElementById("messageInput"),o=e.value;if(console.log(o),o){let i=localStorage.getItem("uid");i==this.chat.user1?this.chatDbService.sendMessage(this.chat._id,this.otherUser._id,i,o,"viewedUser1").then(s=>{this.messages.push(s.message),"new"==this.chat._id&&window.location.reload()}):this.chatDbService.sendMessage(this.chat._id,this.otherUser._id,i,o,"viewedUser2").then(s=>{this.messages.push(s.message),"new"==this.chat._id&&window.location.reload()}),"new"!=this.chat._id?this.grupalSocket.sendMessage(o,this.otherUser._id,i,!1,this.chat._id):this.grupalSocket.sendMessage(o,this.otherUser._id,i,!0),e.value=""}}ngAfterViewChecked(){let e=document.getElementById("chatContent");e.scrollTop=e.scrollHeight}changeMessageTrue(e){localStorage.getItem("uid")==this.chat.user1?this.chatDbService.viewMessages(this.chat._id,"viewedUser1").then(o=>{e&&(console.log(o.ChatReturned.messages),this.chat=o.ChatReturned,this.messages=o.ChatReturned.messages,this.hideLoading())}):localStorage.getItem("uid")&&(console.log("aslfdjalsdkfj\xf1lsdkf"+localStorage.getItem("uid")),this.chatDbService.viewMessages(this.chat._id,"viewedUser2").then(o=>{e&&(this.chat=o.ChatReturned,console.log(o.ChatReturned.messages),this.messages=o.ChatReturned.messages,this.hideLoading())}))}showLoading(){document.querySelector(".rff-spinner-loading").style.display="block",document.querySelector(".rff-chat-list").style.display="none"}hideLoading(){document.querySelector(".rff-spinner-loading").style.display="none",document.querySelector(".rff-chat-list").style.display="block"}goBack(){this.location.back()}ngOnDestroy(){this.subsMessageRec.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(h.Ye),t.Y36(g),t.Y36(b.K),t.Y36(l.gz),t.Y36(C),t.Y36(_.e),t.Y36(l.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-details"]],decls:21,vars:3,consts:[[1,"container"],[1,"row","contentChat"],[1,"col-12"],[1,"row","header"],[1,"col-2","col-sm-1","col-md-1"],[1,"bi","bi-chevron-left",3,"click"],["class","d-block rff-chat-image-d-block","alt","",3,"routerLink",4,"ngIf"],["class","col-8 col-sm-10 col-md-10","id","username",3,"routerLink",4,"ngIf"],["id","chatContent",1,"row","chat"],[1,"rff-chat-list"],[4,"ngFor","ngForOf"],["id","spinner",1,"col-12","col-sm-12","col-md-12","col-lg-12"],["role","status",1,"spinner-grow","rff-spinner-loading","mt-4"],[1,"sr-only"],[1,"row","bottom"],[1,"col-9","col-sm-10","col-md-10","message"],["type","text","placeholder","Escribe un mensaje...","id","messageInput",1,"rff-chat-message",3,"keyup.enter"],[1,"bi","bi-send",3,"click"],["alt","",1,"d-block","rff-chat-image-d-block",3,"routerLink"],["id","username",1,"col-8","col-sm-10","col-md-10",3,"routerLink"],["class","rowleft",4,"ngIf"],["class","rowright",4,"ngIf"],[1,"rowleft"],[1,"directionleft"],[1,"boxleft"],[1,"rowright"],[1,"boxright"],[1,"directionright"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"div",4),t.TgZ(5,"i",5),t.NdJ("click",function(){return o.goBack()}),t.qZA(),t.qZA(),t.TgZ(6,"div",4),t.YNc(7,k,1,4,"img",6),t.qZA(),t.YNc(8,S,2,4,"div",7),t.qZA(),t.TgZ(9,"div",8),t.TgZ(10,"div",9),t.YNc(11,A,3,2,"div",10),t.qZA(),t.TgZ(12,"div",11),t.TgZ(13,"div",12),t.TgZ(14,"span",13),t._uU(15,"Loading..."),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(16,"div",14),t.TgZ(17,"div",15),t.TgZ(18,"input",16),t.NdJ("keyup.enter",function(){return o.sendMessage()}),t.qZA(),t.qZA(),t.TgZ(19,"div",4),t.TgZ(20,"i",17),t.NdJ("click",function(){return o.sendMessage()}),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(7),t.Q6J("ngIf",o.otherUser),t.xp6(1),t.Q6J("ngIf",o.otherUser),t.xp6(3),t.Q6J("ngForOf",o.messages))},directives:[h.O5,h.sg,l.rH],styles:['.contentChat[_ngcontent-%COMP%]{height:78vh}.row.header[_ngcontent-%COMP%]{height:8vh;align-items:center;background-color:var(--main-orange-color);border-top-left-radius:2em;border-top-right-radius:2em;font-family:"Arima Madurai",sans-serif;font-size:3vh;font-weight:bold}.row.header[_ngcontent-%COMP%]   .col-8.col-sm-10.col-md-10[_ngcontent-%COMP%]{text-overflow:hidden}.row.bottom[_ngcontent-%COMP%]{height:8vh;align-items:center;background-color:var(--main-orange-color);border-bottom-left-radius:2em;border-bottom-right-radius:2em;justify-content:center}.rff-spinner-loading[_ngcontent-%COMP%]{color:var(--main-orange-color);text-align:center}#spinner[_ngcontent-%COMP%]{display:flex;justify-content:center}#chatContent[_ngcontent-%COMP%]{overflow-y:scroll;background-image:var(--url-background-chat);border-left:5px solid var(--main-orange-color);border-right:5px solid var(--main-orange-color)}.row.chat[_ngcontent-%COMP%]{display:block;padding-bottom:2vh;padding-top:2vh;height:62vh;background-color:var(--main-orange-back);font-family:var(--main-font)}.message[_ngcontent-%COMP%]{height:70%}.bi[_ngcontent-%COMP%]{cursor:pointer;font-size:5vh}.icon-demo[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%], .icon-demo-examples[_ngcontent-%COMP%]   .bi[_ngcontent-%COMP%]{width:2em;height:2em}img.d-block[_ngcontent-%COMP%]{height:6vh;object-fit:contain;cursor:pointer;border-radius:100%}.boxleft[_ngcontent-%COMP%]{background-color:var(--main-yellow-color)}.boxright[_ngcontent-%COMP%]{background-color:var(--main-chatself-color)}.boxright[_ngcontent-%COMP%], .boxleft[_ngcontent-%COMP%]{font-family:var(--main-font);max-width:90%;display:flex;padding:3vh;height:-moz-fit-content;height:fit-content;width:-moz-fit-content;width:fit-content;display:inline-block;border-radius:2em;color:#363853}.boxright[_ngcontent-%COMP%]{float:right;margin:15px 30px 15px 15px;box-shadow:5px 5px 3px #0003}.boxleft[_ngcontent-%COMP%]{box-shadow:-5px 5px 3px #0003;margin:15px 15px 15px 30px}.directionleft[_ngcontent-%COMP%]{border:20px solid var(--main-yellow-color);content:"";border-left-color:transparent;border-bottom-color:transparent;border-right-color:transparent;position:relative;width:5px;left:26px;margin-top:15px;margin-right:-26px;transform:rotate(5deg)}.directionright[_ngcontent-%COMP%]{border:20px solid var(--main-chatself-color);content:"";border-left-color:transparent;width:5px;border-bottom-color:transparent;border-right-color:transparent;position:relative;margin-top:15px;margin-left:-26px;right:26px;transform:rotate(355deg)}.rowright[_ngcontent-%COMP%]{justify-content:right;display:flex;width:100%}.rowleft[_ngcontent-%COMP%]{justify-content:left;width:100%;display:flex}.rff-chat-message[_ngcontent-%COMP%]{background-color:var(--extreme-background-color);color:var(--main-font-color);font-family:var(--main-font);border-radius:1rem;padding:.8rem 1rem;border-color:var(--main-orange-color);width:100%;height:100%}.rff-chat-message[_ngcontent-%COMP%]::placeholder{color:var(--main-font-color)}@media (max-width: 768px){.contentChat[_ngcontent-%COMP%]{position:absolute;margin:0 auto;top:9vh;left:0;bottom:9vh;height:82vh;width:100vw}.row.chat[_ngcontent-%COMP%]{height:66vh}.row.header[_ngcontent-%COMP%]{border-top-left-radius:0;border-top-right-radius:0}.row.bottom[_ngcontent-%COMP%]{border-bottom-left-radius:0;border-bottom-right-radius:0}}#username[_ngcontent-%COMP%]{color:#363853;font-family:var(--main-font);cursor:pointer;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.row.chat[_ngcontent-%COMP%]::-webkit-scrollbar{width:7px}.row.chat[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:var(--main-chat-color);border-radius:20px;margin-top:5px;margin-bottom:5px}.row.chat[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--main-orange-color);border-radius:20px;margin-top:5px;margin-bottom:5px}']}),n})();function q(n,r){1&n&&(t.TgZ(0,"span"),t._uU(1,"..."),t.qZA())}function L(n,r){if(1&n&&(t.TgZ(0,"p",15),t._uU(1),t.YNc(2,q,2,0,"span",14),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Oqu(e.otheruser.username.slice(0,15)),t.xp6(1),t.Q6J("ngIf",e.otheruser.username.length>15)}}function R(n,r){1&n&&(t.TgZ(0,"span"),t._uU(1,"..."),t.qZA())}const D=function(n){return["/chat/details",n,"u1","u2"]};function j(n,r){if(1&n&&(t.TgZ(0,"div",1),t.TgZ(1,"div",2),t._UZ(2,"div",3),t.TgZ(3,"div",4),t.TgZ(4,"div",5),t.TgZ(5,"div",6),t.TgZ(6,"div",7),t._UZ(7,"img",8),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"div",9),t.TgZ(9,"p",10),t._uU(10),t.qZA(),t.qZA(),t.TgZ(11,"div",11),t.YNc(12,L,3,2,"p",12),t._UZ(13,"p"),t.TgZ(14,"p",13),t._uU(15),t.YNc(16,R,2,0,"span",14),t.qZA(),t.qZA(),t.qZA(),t.TgZ(17,"div",9),t.TgZ(18,"p",10),t._uU(19),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&n){const e=t.oxw();t.Q6J("routerLink",t.VKq(9,D,e.chat._id)),t.xp6(7),t.uIk("src",e.otheruser.userImage,t.LSH),t.xp6(1),t.Q6J("ngClass",0==e.number?"none":"block"),t.xp6(2),t.Oqu(e.number),t.xp6(2),t.Q6J("ngIf",e.otheruser.username),t.xp6(3),t.hij(" ",e.lastMessage.slice(0,40),""),t.xp6(1),t.Q6J("ngIf",e.lastMessage.length>40),t.xp6(1),t.Q6J("ngClass",0==e.number?"col-1 none":"col-1 numberMobil"),t.xp6(2),t.Oqu(e.number)}}let Y=(()=>{class n{constructor(e,o){this.grupalSocket=e,this.userService=o,this.onMessageArrive=new t.vpe}ngOnInit(){let e=localStorage.getItem("uid"),o=0;if(this.chat.user1!=e){this.userService.getUserById(this.chat.user1).subscribe(i=>{this.otheruser=i.dbUser});for(let i=0;i<this.chat.messages.length;i++)this.chat.messages[i].viewedUser2||o++}else{this.userService.getUserById(this.chat.user2).subscribe(i=>{this.otheruser=i.dbUser});for(let i=0;i<this.chat.messages.length;i++)this.chat.messages[i].viewedUser1||o++}this.number=o,this.lastMessage=this.chat.messages[this.chat.messages.length-1].text,this.subsMessageRec=this.grupalSocket.getMessageReceived().subscribe(i=>{(i.sender==this.chat.user1||i.sender==this.chat.user2)&&(this.lastMessage=i.text,this.number++)})}ngOnDestroy(){this.subsMessageRec.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(g),t.Y36(b.K))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-card"]],inputs:{chat:"chat"},outputs:{onMessageArrive:"onMessageArrive"},decls:1,vars:1,consts:[["class","cursor-pointer rff-chat",3,"routerLink",4,"ngIf"],[1,"cursor-pointer","rff-chat",3,"routerLink"],[1,"row","rowCard"],[1,"col-sm-1","col-md-1","col-lg-1","col-1","rff-first"],[1,"col-sm-10","col-md-10","col-lg-10","col-10","col-chat"],["id","carouselExampleIndicators","data-ride","carousel",1,"carousel"],[1,"carousel-inner","inner"],[1,"carousel-item","active"],["alt","",1,"d-block","rff-chat-image-d-block","w-100"],[3,"ngClass"],[1,"number"],[1,"rff-chat-info"],["class","col-5 col-sm-12 col-md-12 rff-chat-title",4,"ngIf"],[1,"col-6","col-sm-12","col-md-12","rff-chat-description"],[4,"ngIf"],[1,"col-5","col-sm-12","col-md-12","rff-chat-title"]],template:function(e,o){1&e&&t.YNc(0,j,20,11,"div",0),2&e&&t.Q6J("ngIf",o.otheruser)},directives:[h.O5,l.rH,h.mk],styles:[".cursor-pointer[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:hover{cursor:pointer}.rff-first[_ngcontent-%COMP%]{height:100%;background-color:var(--main-orange-color)}.col-chat[_ngcontent-%COMP%]{height:100%;padding:0;display:flex;align-items:center}.rowCard[_ngcontent-%COMP%]{width:100%;height:100%;margin:0}.rff-chat[_ngcontent-%COMP%]{margin-top:15px;color:var(--main-font-color);display:flex;background-color:var(--main-card-color);height:10vh;border-top-right-radius:1rem;box-shadow:5px 5px 3px #0003}.rff-chat[_ngcontent-%COMP%]:hover{cursor:pointer;color:#363853;background-color:var(--main-yellow-color);transform:translate(-5px,-5px);box-shadow:5px 5px 25px #00000080}.inner[_ngcontent-%COMP%]{height:100%}.rff-chat-info[_ngcontent-%COMP%]{padding:1vh 2vh;display:block;width:80%;height:-moz-fit-content;height:fit-content;align-items:center}.rff-chat-title[_ngcontent-%COMP%]{font-weight:bold;font-size:1.25rem}.rff-event-description[_ngcontent-%COMP%]{font-weight:300;width:70%}#carouselExampleIndicators[_ngcontent-%COMP%]{height:10vh;width:20%}img.d-block[_ngcontent-%COMP%]{height:-moz-fit-content;height:fit-content;object-fit:contain;width:100%!important;margin:0 auto;border-radius:100%;padding:0}.block[_ngcontent-%COMP%]{display:flex;float:right;right:20px;position:relative;bottom:100px;width:4vh;height:4vh;background-color:var(--main-orange-color);align-items:center;justify-content:center;border-radius:1rem}.none[_ngcontent-%COMP%]{display:none}.number[_ngcontent-%COMP%]{margin:0;font-family:var(--main-font);font-weight:bold}.numberMobil[_ngcontent-%COMP%]{display:flex;position:absolute;right:15px;width:4vh;height:4vh;background-color:var(--main-orange-color);align-items:center;justify-content:center;border-top-right-radius:1rem}@media (max-width: 560px){.block[_ngcontent-%COMP%]{display:none}}@media (min-width: 560px){.carousel-item[_ngcontent-%COMP%]{padding-left:0!important}.rff-chat-title[_ngcontent-%COMP%], .rff-chat-description[_ngcontent-%COMP%]{white-space:inherit!important}.col-chat[_ngcontent-%COMP%]{display:block!important;align-items:center}.numberMobil[_ngcontent-%COMP%]{display:none}.container[_ngcontent-%COMP%]{padding-right:15px;padding-left:15px}.rff-chat-title[_ngcontent-%COMP%]{width:100%}.rff-chat[_ngcontent-%COMP%]{margin-top:0!important;display:block;background-color:var(--main-card-color);height:100%;border-top-right-radius:2rem}.rff-chat[_ngcontent-%COMP%]:hover{background-color:var(--main-yellow-color)}.inner[_ngcontent-%COMP%]{border-radius:2rem 2rem 0 0;height:100%}.rff-chat-info[_ngcontent-%COMP%]{padding:1vh 2vh 2vh;display:block;height:-moz-fit-content;height:fit-content;width:100%}#carouselExampleIndicators[_ngcontent-%COMP%]{height:15vh;width:100%}img.d-block[_ngcontent-%COMP%]{height:100%!important;width:-moz-fit-content!important;width:fit-content!important;object-fit:contain;padding:15px!important}}.rff-chat-title[_ngcontent-%COMP%], .rff-chat-description[_ngcontent-%COMP%]{text-align:left;font-family:var(--main-font);margin:0;max-width:100%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.carousel-item[_ngcontent-%COMP%]{height:100%;display:flex;align-items:center;justify-content:center;padding-left:10px}"]}),n})();function J(n,r){if(1&n&&(t.TgZ(0,"div"),t._UZ(1,"app-chat-card",10),t.qZA()),2&n){const e=r.$implicit;t.xp6(1),t.Q6J("chat",e)}}function B(n,r){1&n&&(t.TgZ(0,"div",11),t.TgZ(1,"h2",12),t._uU(2,"Todav\xeda no has entablado una conversaci\xf3n con alg\xfan Realfooder"),t.qZA(),t.TgZ(3,"div",13),t.TgZ(4,"h3",14),t._uU(5,"An\xedmate a buscar a alguien y escribirle"),t.qZA(),t.qZA(),t.qZA())}let F=(()=>{class n{constructor(e,o){this.chatDBService=e,this.grupalSocket=o,this.chats=[]}ngOnInit(){this.showLoading(),this.chatDBService.getAllUserChats(localStorage.getItem("uid")).then(e=>{this.chats=e.ChatsReturn,this.orderChats(),this.hideLoading()}),this.subsMessageRec=this.grupalSocket.getMessageReceived().subscribe(e=>{e.isNew?window.location.reload():(this.chats.forEach(o=>{if(o._id==e.idChat){let i=new Date(Date.now()).toISOString();o.messages.push({_id:"",sender:e.sender,receiver:e.receiver,text:e.text,sendAt:i,viewedUser1:!0,viewedUser2:!0})}}),this.orderChats())})}orderChats(){let e=[];e=this.chats.sort((o,i)=>{let s=o.messages[o.messages.length-1].sendAt,a=i.messages[i.messages.length-1].sendAt;return s>a?-1:s<a?1:0}),this.chats=[],e.forEach(o=>{this.chats.push(o)})}changeOptionEvent(e){let o;const i=e.target;i.classList.contains("option-active")||("PRIVADOS"===i.textContent?(o=document.querySelector("#btnGrupo"),null==o||o.classList.remove("option-active"),i.classList.add("option-active")):(o=document.querySelector("#btnPrivado"),null==o||o.classList.remove("option-active"),i.classList.add("option-active")))}showLoading(){document.querySelector(".rff-spinner-loading").style.display="block",document.querySelector(".rff-chat-list").style.display="none"}hideLoading(){document.querySelector(".rff-spinner-loading").style.display="none",document.querySelector(".rff-chat-list").style.display="block"}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C),t.Y36(g))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-chat-list"]],decls:12,vars:2,consts:[[1,"container"],[1,"board-section-options"],["id","btnPrivado",1,"board-section-option","option-active",2,"cursor","auto"],[1,"rff-chat-list"],[1,"rff-grid","mt-4"],[4,"ngFor","ngForOf"],["class","card text-center",4,"ngIf"],["id","spinner",1,"col-12","col-sm-12","col-md-12","col-lg-12"],["role","status",1,"spinner-grow","rff-spinner-loading","mt-4"],[1,"sr-only"],[3,"chat"],[1,"card","text-center"],[1,"card-header","no-events-card-title"],[1,"card-body"],[1,"card-text","no-events-card-body"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0),t.TgZ(1,"div",1),t.TgZ(2,"button",2),t._uU(3,"PRIVADOS"),t.qZA(),t.qZA(),t.TgZ(4,"div",3),t.TgZ(5,"div",4),t.YNc(6,J,2,1,"div",5),t.YNc(7,B,6,0,"div",6),t.qZA(),t.qZA(),t.TgZ(8,"div",7),t.TgZ(9,"div",8),t.TgZ(10,"span",9),t._uU(11,"Loading..."),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&e&&(t.xp6(6),t.Q6J("ngForOf",o.chats),t.xp6(1),t.Q6J("ngIf",o.chats&&0==o.chats.length))},directives:[h.sg,h.O5,Y],styles:[".board-section-options[_ngcontent-%COMP%]{display:flex;justify-content:center;grid-gap:2vw;gap:2vw}.board-section-option[_ngcontent-%COMP%]{font-family:var(--main-font);font-size:4vw;font-weight:300;height:6vw;border:none;background:none;color:var(--main-font-color)}.option-active[_ngcontent-%COMP%]{font-weight:bold;border-bottom:1px solid var(--main-orange-color)}.rff-chat-list[_ngcontent-%COMP%]{margin-top:35px}.rff-spinner-loading[_ngcontent-%COMP%]{color:var(--main-orange-color);text-align:center}#spinner[_ngcontent-%COMP%]{display:flex;justify-content:center}.rff-grid[_ngcontent-%COMP%]{display:block}@media (min-width: 560px){.rff-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);grid-gap:3rem;gap:3rem}.board-section-option[_ngcontent-%COMP%]{font-size:4vw;height:6vw}}@media (min-width: 768px){.rff-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);grid-gap:3rem;gap:3rem}.board-section-option[_ngcontent-%COMP%]{font-size:3vw;height:5vw}}@media (min-width: 992px){.rff-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);grid-gap:3rem;gap:3rem}.board-section-option[_ngcontent-%COMP%]{font-size:3vw;height:5vw}}@media (min-width: 1200px){.rff-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(5,1fr)}.board-section-option[_ngcontent-%COMP%]{font-size:2vw;height:3vw}}.text-center[_ngcontent-%COMP%]{position:absolute;right:50px;left:50px;border:0;border-top-right-radius:2rem}.no-events-card-title[_ngcontent-%COMP%]{margin:0;background-color:var(--main-orange-color);color:var(--main-font-color-reverse);font-family:var(--main-font);font-weight:bold;border-top-right-radius:2rem}.card-body[_ngcontent-%COMP%]{border:5px solid var(--main-orange-color);background-color:var(--main-orange-back)}.no-events-card-body[_ngcontent-%COMP%]{font-family:var(--main-font);color:var(--main-font-color)}"]}),n})();var N=c(3667);function z(n,r){1&n&&(t.TgZ(0,"div"),t._UZ(1,"router-outlet"),t.qZA())}const Q=[{path:"",component:(()=>{class n{constructor(e,o,i){this.chatService=e,this.grupalSocket=o,this.authService=i,this.user={name:"",email:"",uid:""},this.eventSendMessage="send-message",this.eventConnection="send-idConnection",this.listenMessage="text-event"}ngOnInit(){this.chatService.emit(this.eventConnection,localStorage.getItem("uid")),this.chatService.listen(this.listenMessage).subscribe(e=>{this.grupalSocket.receiveMessage(e.text,e.sender,e.receiver,e.isNew,e.idChat)}),this.subsSendMessage=this.grupalSocket.getMessageSend().subscribe(e=>{this.chatService.emit(this.eventSendMessage,e)}),this.obtainUser()}obtainUser(){this.authService.validateToken().subscribe(e=>{this.user=this.authService.user})}ngOnDestroy(){this.subsSendMessage.unsubscribe()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(N.a),t.Y36(g),t.Y36(_.e))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-main"]],decls:1,vars:1,consts:[[4,"ngIf"]],template:function(e,o){1&e&&t.YNc(0,z,2,0,"div",0),2&e&&t.Q6J("ngIf",""!=o.user.uid)},directives:[h.O5,l.lC],styles:[""]}),n})(),children:[{path:"list",component:F,canActivate:[f.f],canLoad:[f.f]},{path:"details/:id/:sender/:receiver",component:I},{path:"**",redirectTo:"list"}]}];let $=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[l.Bz.forChild(Q)],l.Bz]}),n})(),E=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[h.ez,$,M.u5]]}),n})()}}]);