(self.webpackChunkRealFoodieFriends=self.webpackChunkRealFoodieFriends||[]).push([[179],{8255:Mt=>{function at(te){return Promise.resolve().then(()=>{var D=new Error("Cannot find module '"+te+"'");throw D.code="MODULE_NOT_FOUND",D})}at.keys=()=>[],at.resolve=at,at.id=8255,Mt.exports=at},8583:(Mt,at,te)=>{"use strict";te.d(at,{mr:()=>Je,ez:()=>Ws,K0:()=>Ce,uU:()=>qs,JJ:()=>ml,Do:()=>Ge,V_:()=>ve,Ye:()=>Lt,S$:()=>lt,mk:()=>Ci,sg:()=>us,O5:()=>Ti,PC:()=>Oi,b0:()=>Me,lw:()=>ce,OU:()=>Yo,gd:()=>Ni,EM:()=>gr,JF:()=>ao,qS:()=>zs,w_:()=>Se,bD:()=>Di,q:()=>R,Mx:()=>Br,HT:()=>ge});var D=te(639);let A=null;function R(){return A}function ge(J){A||(A=J)}class Se{}const Ce=new D.OlP("DocumentToken");let ce=(()=>{class J{historyGo(ee){throw new Error("Not implemented")}}return J.\u0275fac=function(ee){return new(ee||J)},J.\u0275prov=(0,D.Yz7)({factory:ae,token:J,providedIn:"platform"}),J})();function ae(){return(0,D.LFG)(Ue)}const ve=new D.OlP("Location Initialized");let Ue=(()=>{class J extends ce{constructor(ee){super(),this._doc=ee,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return R().getBaseHref(this._doc)}onPopState(ee){const _e=R().getGlobalEventTarget(this._doc,"window");return _e.addEventListener("popstate",ee,!1),()=>_e.removeEventListener("popstate",ee)}onHashChange(ee){const _e=R().getGlobalEventTarget(this._doc,"window");return _e.addEventListener("hashchange",ee,!1),()=>_e.removeEventListener("hashchange",ee)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(ee){this.location.pathname=ee}pushState(ee,_e,Xe){Be()?this._history.pushState(ee,_e,Xe):this.location.hash=Xe}replaceState(ee,_e,Xe){Be()?this._history.replaceState(ee,_e,Xe):this.location.hash=Xe}forward(){this._history.forward()}back(){this._history.back()}historyGo(ee=0){this._history.go(ee)}getState(){return this._history.state}}return J.\u0275fac=function(ee){return new(ee||J)(D.LFG(Ce))},J.\u0275prov=(0,D.Yz7)({factory:we,token:J,providedIn:"platform"}),J})();function Be(){return!!window.history.pushState}function we(){return new Ue((0,D.LFG)(Ce))}function Oe(J,he){if(0==J.length)return he;if(0==he.length)return J;let ee=0;return J.endsWith("/")&&ee++,he.startsWith("/")&&ee++,2==ee?J+he.substring(1):1==ee?J+he:J+"/"+he}function Ne(J){const he=J.match(/#|\?|$/),ee=he&&he.index||J.length;return J.slice(0,ee-("/"===J[ee-1]?1:0))+J.slice(ee)}function ke(J){return J&&"?"!==J[0]?"?"+J:J}let lt=(()=>{class J{historyGo(ee){throw new Error("Not implemented")}}return J.\u0275fac=function(ee){return new(ee||J)},J.\u0275prov=(0,D.Yz7)({factory:Ot,token:J,providedIn:"root"}),J})();function Ot(J){const he=(0,D.LFG)(Ce).location;return new Me((0,D.LFG)(ce),he&&he.origin||"")}const Je=new D.OlP("appBaseHref");let Me=(()=>{class J extends lt{constructor(ee,_e){if(super(),this._platformLocation=ee,this._removeListenerFns=[],null==_e&&(_e=this._platformLocation.getBaseHrefFromDOM()),null==_e)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=_e}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(ee){this._removeListenerFns.push(this._platformLocation.onPopState(ee),this._platformLocation.onHashChange(ee))}getBaseHref(){return this._baseHref}prepareExternalUrl(ee){return Oe(this._baseHref,ee)}path(ee=!1){const _e=this._platformLocation.pathname+ke(this._platformLocation.search),Xe=this._platformLocation.hash;return Xe&&ee?`${_e}${Xe}`:_e}pushState(ee,_e,Xe,Dt){const jt=this.prepareExternalUrl(Xe+ke(Dt));this._platformLocation.pushState(ee,_e,jt)}replaceState(ee,_e,Xe,Dt){const jt=this.prepareExternalUrl(Xe+ke(Dt));this._platformLocation.replaceState(ee,_e,jt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(ee=0){var _e,Xe;null===(Xe=(_e=this._platformLocation).historyGo)||void 0===Xe||Xe.call(_e,ee)}}return J.\u0275fac=function(ee){return new(ee||J)(D.LFG(ce),D.LFG(Je,8))},J.\u0275prov=D.Yz7({token:J,factory:J.\u0275fac}),J})(),Ge=(()=>{class J extends lt{constructor(ee,_e){super(),this._platformLocation=ee,this._baseHref="",this._removeListenerFns=[],null!=_e&&(this._baseHref=_e)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(ee){this._removeListenerFns.push(this._platformLocation.onPopState(ee),this._platformLocation.onHashChange(ee))}getBaseHref(){return this._baseHref}path(ee=!1){let _e=this._platformLocation.hash;return null==_e&&(_e="#"),_e.length>0?_e.substring(1):_e}prepareExternalUrl(ee){const _e=Oe(this._baseHref,ee);return _e.length>0?"#"+_e:_e}pushState(ee,_e,Xe,Dt){let jt=this.prepareExternalUrl(Xe+ke(Dt));0==jt.length&&(jt=this._platformLocation.pathname),this._platformLocation.pushState(ee,_e,jt)}replaceState(ee,_e,Xe,Dt){let jt=this.prepareExternalUrl(Xe+ke(Dt));0==jt.length&&(jt=this._platformLocation.pathname),this._platformLocation.replaceState(ee,_e,jt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(ee=0){var _e,Xe;null===(Xe=(_e=this._platformLocation).historyGo)||void 0===Xe||Xe.call(_e,ee)}}return J.\u0275fac=function(ee){return new(ee||J)(D.LFG(ce),D.LFG(Je,8))},J.\u0275prov=D.Yz7({token:J,factory:J.\u0275fac}),J})(),Lt=(()=>{class J{constructor(ee,_e){this._subject=new D.vpe,this._urlChangeListeners=[],this._platformStrategy=ee;const Xe=this._platformStrategy.getBaseHref();this._platformLocation=_e,this._baseHref=Ne(gn(Xe)),this._platformStrategy.onPopState(Dt=>{this._subject.emit({url:this.path(!0),pop:!0,state:Dt.state,type:Dt.type})})}path(ee=!1){return this.normalize(this._platformStrategy.path(ee))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(ee,_e=""){return this.path()==this.normalize(ee+ke(_e))}normalize(ee){return J.stripTrailingSlash(function(J,he){return J&&he.startsWith(J)?he.substring(J.length):he}(this._baseHref,gn(ee)))}prepareExternalUrl(ee){return ee&&"/"!==ee[0]&&(ee="/"+ee),this._platformStrategy.prepareExternalUrl(ee)}go(ee,_e="",Xe=null){this._platformStrategy.pushState(Xe,"",ee,_e),this._notifyUrlChangeListeners(this.prepareExternalUrl(ee+ke(_e)),Xe)}replaceState(ee,_e="",Xe=null){this._platformStrategy.replaceState(Xe,"",ee,_e),this._notifyUrlChangeListeners(this.prepareExternalUrl(ee+ke(_e)),Xe)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(ee=0){var _e,Xe;null===(Xe=(_e=this._platformStrategy).historyGo)||void 0===Xe||Xe.call(_e,ee)}onUrlChange(ee){this._urlChangeListeners.push(ee),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(_e=>{this._notifyUrlChangeListeners(_e.url,_e.state)}))}_notifyUrlChangeListeners(ee="",_e){this._urlChangeListeners.forEach(Xe=>Xe(ee,_e))}subscribe(ee,_e,Xe){return this._subject.subscribe({next:ee,error:_e,complete:Xe})}}return J.\u0275fac=function(ee){return new(ee||J)(D.LFG(lt),D.LFG(ce))},J.normalizeQueryParams=ke,J.joinWithSlash=Oe,J.stripTrailingSlash=Ne,J.\u0275prov=(0,D.Yz7)({factory:Ht,token:J,providedIn:"root"}),J})();function Ht(){return new Lt((0,D.LFG)(lt),(0,D.LFG)(ce))}function gn(J){return J.replace(/\/index.html$/,"")}var In=(()=>((In=In||{})[In.Decimal=0]="Decimal",In[In.Percent=1]="Percent",In[In.Currency=2]="Currency",In[In.Scientific=3]="Scientific",In))(),Gn=(()=>((Gn=Gn||{})[Gn.Zero=0]="Zero",Gn[Gn.One=1]="One",Gn[Gn.Two=2]="Two",Gn[Gn.Few=3]="Few",Gn[Gn.Many=4]="Many",Gn[Gn.Other=5]="Other",Gn))(),ct=(()=>((ct=ct||{})[ct.Format=0]="Format",ct[ct.Standalone=1]="Standalone",ct))(),tt=(()=>((tt=tt||{})[tt.Narrow=0]="Narrow",tt[tt.Abbreviated=1]="Abbreviated",tt[tt.Wide=2]="Wide",tt[tt.Short=3]="Short",tt))(),mt=(()=>((mt=mt||{})[mt.Short=0]="Short",mt[mt.Medium=1]="Medium",mt[mt.Long=2]="Long",mt[mt.Full=3]="Full",mt))(),gt=(()=>((gt=gt||{})[gt.Decimal=0]="Decimal",gt[gt.Group=1]="Group",gt[gt.List=2]="List",gt[gt.PercentSign=3]="PercentSign",gt[gt.PlusSign=4]="PlusSign",gt[gt.MinusSign=5]="MinusSign",gt[gt.Exponential=6]="Exponential",gt[gt.SuperscriptingExponent=7]="SuperscriptingExponent",gt[gt.PerMille=8]="PerMille",gt[gt.Infinity=9]="Infinity",gt[gt.NaN=10]="NaN",gt[gt.TimeSeparator=11]="TimeSeparator",gt[gt.CurrencyDecimal=12]="CurrencyDecimal",gt[gt.CurrencyGroup=13]="CurrencyGroup",gt))();function Ve(J,he){return di((0,D.cg1)(J)[D.wAp.DateFormat],he)}function zt(J,he){return di((0,D.cg1)(J)[D.wAp.TimeFormat],he)}function ln(J,he){return di((0,D.cg1)(J)[D.wAp.DateTimeFormat],he)}function Rn(J,he){const ee=(0,D.cg1)(J),_e=ee[D.wAp.NumberSymbols][he];if(void 0===_e){if(he===gt.CurrencyDecimal)return ee[D.wAp.NumberSymbols][gt.Decimal];if(he===gt.CurrencyGroup)return ee[D.wAp.NumberSymbols][gt.Group]}return _e}const yr=D.kL8;function Vi(J){if(!J[D.wAp.ExtraData])throw new Error(`Missing extra locale data for the locale "${J[D.wAp.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function di(J,he){for(let ee=he;ee>-1;ee--)if(void 0!==J[ee])return J[ee];throw new Error("Locale data API: locale data undefined")}function ls(J){const[he,ee]=J.split(":");return{hours:+he,minutes:+ee}}const nt=/^(\d{4})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Wt={},_t=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;var hn=(()=>((hn=hn||{})[hn.Short=0]="Short",hn[hn.ShortGMT=1]="ShortGMT",hn[hn.Long=2]="Long",hn[hn.Extended=3]="Extended",hn))(),mn=(()=>((mn=mn||{})[mn.FullYear=0]="FullYear",mn[mn.Month=1]="Month",mn[mn.Date=2]="Date",mn[mn.Hours=3]="Hours",mn[mn.Minutes=4]="Minutes",mn[mn.Seconds=5]="Seconds",mn[mn.FractionalSeconds=6]="FractionalSeconds",mn[mn.Day=7]="Day",mn))(),_n=(()=>((_n=_n||{})[_n.DayPeriods=0]="DayPeriods",_n[_n.Days=1]="Days",_n[_n.Months=2]="Months",_n[_n.Eras=3]="Eras",_n))();function xn(J,he,ee,_e){let Xe=function(J){if(Ze(J))return J;if("number"==typeof J&&!isNaN(J))return new Date(J);if("string"==typeof J){if(J=J.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(J)){const[Xe,Dt=1,jt=1]=J.split("-").map(q=>+q);return jr(Xe,Dt-1,jt)}const ee=parseFloat(J);if(!isNaN(J-ee))return new Date(ee);let _e;if(_e=J.match(nt))return function(J){const he=new Date(0);let ee=0,_e=0;const Xe=J[8]?he.setUTCFullYear:he.setFullYear,Dt=J[8]?he.setUTCHours:he.setHours;J[9]&&(ee=Number(J[9]+J[10]),_e=Number(J[9]+J[11])),Xe.call(he,Number(J[1]),Number(J[2])-1,Number(J[3]));const jt=Number(J[4]||0)-ee,q=Number(J[5]||0)-_e,$=Number(J[6]||0),V=Math.floor(1e3*parseFloat("0."+(J[7]||0)));return Dt.call(he,jt,q,$,V),he}(_e)}const he=new Date(J);if(!Ze(he))throw new Error(`Unable to convert "${J}" into a date`);return he}(J);he=Fr(ee,he)||he;let q,jt=[];for(;he;){if(q=_t.exec(he),!q){jt.push(he);break}{jt=jt.concat(q.slice(1));const ue=jt.pop();if(!ue)break;he=ue}}let $=Xe.getTimezoneOffset();_e&&($=H(_e,$),Xe=function(J,he,ee){const Xe=J.getTimezoneOffset();return function(J,he){return(J=new Date(J.getTime())).setMinutes(J.getMinutes()+he),J}(J,-1*(H(he,Xe)-Xe))}(Xe,_e));let V="";return jt.forEach(ue=>{const yt=function(J){if(k[J])return k[J];let he;switch(J){case"G":case"GG":case"GGG":he=ar(_n.Eras,tt.Abbreviated);break;case"GGGG":he=ar(_n.Eras,tt.Wide);break;case"GGGGG":he=ar(_n.Eras,tt.Narrow);break;case"y":he=wn(mn.FullYear,1,0,!1,!0);break;case"yy":he=wn(mn.FullYear,2,0,!0,!0);break;case"yyy":he=wn(mn.FullYear,3,0,!1,!0);break;case"yyyy":he=wn(mn.FullYear,4,0,!1,!0);break;case"Y":he=K(1);break;case"YY":he=K(2,!0);break;case"YYY":he=K(3);break;case"YYYY":he=K(4);break;case"M":case"L":he=wn(mn.Month,1,1);break;case"MM":case"LL":he=wn(mn.Month,2,1);break;case"MMM":he=ar(_n.Months,tt.Abbreviated);break;case"MMMM":he=ar(_n.Months,tt.Wide);break;case"MMMMM":he=ar(_n.Months,tt.Narrow);break;case"LLL":he=ar(_n.Months,tt.Abbreviated,ct.Standalone);break;case"LLLL":he=ar(_n.Months,tt.Wide,ct.Standalone);break;case"LLLLL":he=ar(_n.Months,tt.Narrow,ct.Standalone);break;case"w":he=lr(1);break;case"ww":he=lr(2);break;case"W":he=lr(1,!0);break;case"d":he=wn(mn.Date,1);break;case"dd":he=wn(mn.Date,2);break;case"c":case"cc":he=wn(mn.Day,1);break;case"ccc":he=ar(_n.Days,tt.Abbreviated,ct.Standalone);break;case"cccc":he=ar(_n.Days,tt.Wide,ct.Standalone);break;case"ccccc":he=ar(_n.Days,tt.Narrow,ct.Standalone);break;case"cccccc":he=ar(_n.Days,tt.Short,ct.Standalone);break;case"E":case"EE":case"EEE":he=ar(_n.Days,tt.Abbreviated);break;case"EEEE":he=ar(_n.Days,tt.Wide);break;case"EEEEE":he=ar(_n.Days,tt.Narrow);break;case"EEEEEE":he=ar(_n.Days,tt.Short);break;case"a":case"aa":case"aaa":he=ar(_n.DayPeriods,tt.Abbreviated);break;case"aaaa":he=ar(_n.DayPeriods,tt.Wide);break;case"aaaaa":he=ar(_n.DayPeriods,tt.Narrow);break;case"b":case"bb":case"bbb":he=ar(_n.DayPeriods,tt.Abbreviated,ct.Standalone,!0);break;case"bbbb":he=ar(_n.DayPeriods,tt.Wide,ct.Standalone,!0);break;case"bbbbb":he=ar(_n.DayPeriods,tt.Narrow,ct.Standalone,!0);break;case"B":case"BB":case"BBB":he=ar(_n.DayPeriods,tt.Abbreviated,ct.Format,!0);break;case"BBBB":he=ar(_n.DayPeriods,tt.Wide,ct.Format,!0);break;case"BBBBB":he=ar(_n.DayPeriods,tt.Narrow,ct.Format,!0);break;case"h":he=wn(mn.Hours,1,-12);break;case"hh":he=wn(mn.Hours,2,-12);break;case"H":he=wn(mn.Hours,1);break;case"HH":he=wn(mn.Hours,2);break;case"m":he=wn(mn.Minutes,1);break;case"mm":he=wn(mn.Minutes,2);break;case"s":he=wn(mn.Seconds,1);break;case"ss":he=wn(mn.Seconds,2);break;case"S":he=wn(mn.FractionalSeconds,1);break;case"SS":he=wn(mn.FractionalSeconds,2);break;case"SSS":he=wn(mn.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":he=Gr(hn.Short);break;case"ZZZZZ":he=Gr(hn.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":he=Gr(hn.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":he=Gr(hn.Long);break;default:return null}return k[J]=he,he}(ue);V+=yt?yt(Xe,ee,$):"''"===ue?"'":ue.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),V}function jr(J,he,ee){const _e=new Date(0);return _e.setFullYear(J,he,ee),_e.setHours(0,0,0),_e}function Fr(J,he){const ee=function(J){return(0,D.cg1)(J)[D.wAp.LocaleId]}(J);if(Wt[ee]=Wt[ee]||{},Wt[ee][he])return Wt[ee][he];let _e="";switch(he){case"shortDate":_e=Ve(J,mt.Short);break;case"mediumDate":_e=Ve(J,mt.Medium);break;case"longDate":_e=Ve(J,mt.Long);break;case"fullDate":_e=Ve(J,mt.Full);break;case"shortTime":_e=zt(J,mt.Short);break;case"mediumTime":_e=zt(J,mt.Medium);break;case"longTime":_e=zt(J,mt.Long);break;case"fullTime":_e=zt(J,mt.Full);break;case"short":const Xe=Fr(J,"shortTime"),Dt=Fr(J,"shortDate");_e=ii(ln(J,mt.Short),[Xe,Dt]);break;case"medium":const jt=Fr(J,"mediumTime"),q=Fr(J,"mediumDate");_e=ii(ln(J,mt.Medium),[jt,q]);break;case"long":const $=Fr(J,"longTime"),V=Fr(J,"longDate");_e=ii(ln(J,mt.Long),[$,V]);break;case"full":const ue=Fr(J,"fullTime"),yt=Fr(J,"fullDate");_e=ii(ln(J,mt.Full),[ue,yt])}return _e&&(Wt[ee][he]=_e),_e}function ii(J,he){return he&&(J=J.replace(/\{([^}]+)}/g,function(ee,_e){return null!=he&&_e in he?he[_e]:ee})),J}function Wr(J,he,ee="-",_e,Xe){let Dt="";(J<0||Xe&&J<=0)&&(Xe?J=1-J:(J=-J,Dt=ee));let jt=String(J);for(;jt.length<he;)jt="0"+jt;return _e&&(jt=jt.substr(jt.length-he)),Dt+jt}function wn(J,he,ee=0,_e=!1,Xe=!1){return function(Dt,jt){let q=function(J,he){switch(J){case mn.FullYear:return he.getFullYear();case mn.Month:return he.getMonth();case mn.Date:return he.getDate();case mn.Hours:return he.getHours();case mn.Minutes:return he.getMinutes();case mn.Seconds:return he.getSeconds();case mn.FractionalSeconds:return he.getMilliseconds();case mn.Day:return he.getDay();default:throw new Error(`Unknown DateType value "${J}".`)}}(J,Dt);if((ee>0||q>-ee)&&(q+=ee),J===mn.Hours)0===q&&-12===ee&&(q=12);else if(J===mn.FractionalSeconds)return function(J,he){return Wr(J,3).substr(0,he)}(q,he);const $=Rn(jt,gt.MinusSign);return Wr(q,he,$,_e,Xe)}}function ar(J,he,ee=ct.Format,_e=!1){return function(Xe,Dt){return function(J,he,ee,_e,Xe,Dt){switch(ee){case _n.Months:return function(J,he,ee){const _e=(0,D.cg1)(J),Dt=di([_e[D.wAp.MonthsFormat],_e[D.wAp.MonthsStandalone]],he);return di(Dt,ee)}(he,Xe,_e)[J.getMonth()];case _n.Days:return function(J,he,ee){const _e=(0,D.cg1)(J),Dt=di([_e[D.wAp.DaysFormat],_e[D.wAp.DaysStandalone]],he);return di(Dt,ee)}(he,Xe,_e)[J.getDay()];case _n.DayPeriods:const jt=J.getHours(),q=J.getMinutes();if(Dt){const V=function(J){const he=(0,D.cg1)(J);return Vi(he),(he[D.wAp.ExtraData][2]||[]).map(_e=>"string"==typeof _e?ls(_e):[ls(_e[0]),ls(_e[1])])}(he),ue=function(J,he,ee){const _e=(0,D.cg1)(J);Vi(_e);const Dt=di([_e[D.wAp.ExtraData][0],_e[D.wAp.ExtraData][1]],he)||[];return di(Dt,ee)||[]}(he,Xe,_e),yt=V.findIndex(Qt=>{if(Array.isArray(Qt)){const[Mn,Vr]=Qt,Ai=jt>=Mn.hours&&q>=Mn.minutes,oi=jt<Vr.hours||jt===Vr.hours&&q<Vr.minutes;if(Mn.hours<Vr.hours){if(Ai&&oi)return!0}else if(Ai||oi)return!0}else if(Qt.hours===jt&&Qt.minutes===q)return!0;return!1});if(-1!==yt)return ue[yt]}return function(J,he,ee){const _e=(0,D.cg1)(J),Dt=di([_e[D.wAp.DayPeriodsFormat],_e[D.wAp.DayPeriodsStandalone]],he);return di(Dt,ee)}(he,Xe,_e)[jt<12?0:1];case _n.Eras:return function(J,he){return di((0,D.cg1)(J)[D.wAp.Eras],he)}(he,_e)[J.getFullYear()<=0?0:1];default:throw new Error(`unexpected translation type ${ee}`)}}(Xe,Dt,J,he,ee,_e)}}function Gr(J){return function(he,ee,_e){const Xe=-1*_e,Dt=Rn(ee,gt.MinusSign),jt=Xe>0?Math.floor(Xe/60):Math.ceil(Xe/60);switch(J){case hn.Short:return(Xe>=0?"+":"")+Wr(jt,2,Dt)+Wr(Math.abs(Xe%60),2,Dt);case hn.ShortGMT:return"GMT"+(Xe>=0?"+":"")+Wr(jt,1,Dt);case hn.Long:return"GMT"+(Xe>=0?"+":"")+Wr(jt,2,Dt)+":"+Wr(Math.abs(Xe%60),2,Dt);case hn.Extended:return 0===_e?"Z":(Xe>=0?"+":"")+Wr(jt,2,Dt)+":"+Wr(Math.abs(Xe%60),2,Dt);default:throw new Error(`Unknown zone width "${J}"`)}}}function qi(J){return jr(J.getFullYear(),J.getMonth(),J.getDate()+(4-J.getDay()))}function lr(J,he=!1){return function(ee,_e){let Xe;if(he){const Dt=new Date(ee.getFullYear(),ee.getMonth(),1).getDay()-1,jt=ee.getDate();Xe=1+Math.floor((jt+Dt)/7)}else{const Dt=qi(ee),jt=function(J){const he=jr(J,0,1).getDay();return jr(J,0,1+(he<=4?4:11)-he)}(Dt.getFullYear()),q=Dt.getTime()-jt.getTime();Xe=1+Math.round(q/6048e5)}return Wr(Xe,J,Rn(_e,gt.MinusSign))}}function K(J,he=!1){return function(ee,_e){return Wr(qi(ee).getFullYear(),J,Rn(_e,gt.MinusSign),he)}}const k={};function H(J,he){J=J.replace(/:/g,"");const ee=Date.parse("Jan 01, 1970 00:00:00 "+J)/6e4;return isNaN(ee)?he:ee}function Ze(J){return J instanceof Date&&!isNaN(J.valueOf())}const ft=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Tn(J){const he=parseInt(J);if(isNaN(he))throw new Error("Invalid integer literal when parsing "+J);return he}class mr{}let Zr=(()=>{class J extends mr{constructor(ee){super(),this.locale=ee}getPluralCategory(ee,_e){switch(yr(_e||this.locale)(ee)){case Gn.Zero:return"zero";case Gn.One:return"one";case Gn.Two:return"two";case Gn.Few:return"few";case Gn.Many:return"many";default:return"other"}}}return J.\u0275fac=function(ee){return new(ee||J)(D.LFG(D.soG))},J.\u0275prov=D.Yz7({token:J,factory:J.\u0275fac}),J})();function zs(J,he,ee){return(0,D.dwT)(J,he,ee)}function Br(J,he){he=encodeURIComponent(he);for(const ee of J.split(";")){const _e=ee.indexOf("="),[Xe,Dt]=-1==_e?[ee,""]:[ee.slice(0,_e),ee.slice(_e+1)];if(Xe.trim()===he)return decodeURIComponent(Dt)}return null}let Ci=(()=>{class J{constructor(ee,_e,Xe,Dt){this._iterableDiffers=ee,this._keyValueDiffers=_e,this._ngEl=Xe,this._renderer=Dt,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(ee){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof ee?ee.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(ee){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof ee?ee.split(/\s+/):ee,this._rawClass&&((0,D.sIi)(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const ee=this._iterableDiffer.diff(this._rawClass);ee&&this._applyIterableChanges(ee)}else if(this._keyValueDiffer){const ee=this._keyValueDiffer.diff(this._rawClass);ee&&this._applyKeyValueChanges(ee)}}_applyKeyValueChanges(ee){ee.forEachAddedItem(_e=>this._toggleClass(_e.key,_e.currentValue)),ee.forEachChangedItem(_e=>this._toggleClass(_e.key,_e.currentValue)),ee.forEachRemovedItem(_e=>{_e.previousValue&&this._toggleClass(_e.key,!1)})}_applyIterableChanges(ee){ee.forEachAddedItem(_e=>{if("string"!=typeof _e.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${(0,D.AaK)(_e.item)}`);this._toggleClass(_e.item,!0)}),ee.forEachRemovedItem(_e=>this._toggleClass(_e.item,!1))}_applyClasses(ee){ee&&(Array.isArray(ee)||ee instanceof Set?ee.forEach(_e=>this._toggleClass(_e,!0)):Object.keys(ee).forEach(_e=>this._toggleClass(_e,!!ee[_e])))}_removeClasses(ee){ee&&(Array.isArray(ee)||ee instanceof Set?ee.forEach(_e=>this._toggleClass(_e,!1)):Object.keys(ee).forEach(_e=>this._toggleClass(_e,!1)))}_toggleClass(ee,_e){(ee=ee.trim())&&ee.split(/\s+/g).forEach(Xe=>{_e?this._renderer.addClass(this._ngEl.nativeElement,Xe):this._renderer.removeClass(this._ngEl.nativeElement,Xe)})}}return J.\u0275fac=function(ee){return new(ee||J)(D.Y36(D.ZZ4),D.Y36(D.aQg),D.Y36(D.SBq),D.Y36(D.Qsj))},J.\u0275dir=D.lG2({type:J,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),J})();class Xn{constructor(he,ee,_e,Xe){this.$implicit=he,this.ngForOf=ee,this.index=_e,this.count=Xe}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let us=(()=>{class J{constructor(ee,_e,Xe){this._viewContainer=ee,this._template=_e,this._differs=Xe,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(ee){this._ngForOf=ee,this._ngForOfDirty=!0}set ngForTrackBy(ee){this._trackByFn=ee}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(ee){ee&&(this._template=ee)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const ee=this._ngForOf;if(!this._differ&&ee)try{this._differ=this._differs.find(ee).create(this.ngForTrackBy)}catch(_e){throw new Error(`Cannot find a differ supporting object '${ee}' of type '${function(J){return J.name||typeof J}(ee)}'. NgFor only supports binding to Iterables such as Arrays.`)}}if(this._differ){const ee=this._differ.diff(this._ngForOf);ee&&this._applyChanges(ee)}}_applyChanges(ee){const _e=[];ee.forEachOperation((Xe,Dt,jt)=>{if(null==Xe.previousIndex){const q=this._viewContainer.createEmbeddedView(this._template,new Xn(null,this._ngForOf,-1,-1),null===jt?void 0:jt),$=new Is(Xe,q);_e.push($)}else if(null==jt)this._viewContainer.remove(null===Dt?void 0:Dt);else if(null!==Dt){const q=this._viewContainer.get(Dt);this._viewContainer.move(q,jt);const $=new Is(Xe,q);_e.push($)}});for(let Xe=0;Xe<_e.length;Xe++)this._perViewChange(_e[Xe].view,_e[Xe].record);for(let Xe=0,Dt=this._viewContainer.length;Xe<Dt;Xe++){const jt=this._viewContainer.get(Xe);jt.context.index=Xe,jt.context.count=Dt,jt.context.ngForOf=this._ngForOf}ee.forEachIdentityChange(Xe=>{this._viewContainer.get(Xe.currentIndex).context.$implicit=Xe.item})}_perViewChange(ee,_e){ee.context.$implicit=_e.item}static ngTemplateContextGuard(ee,_e){return!0}}return J.\u0275fac=function(ee){return new(ee||J)(D.Y36(D.s_b),D.Y36(D.Rgc),D.Y36(D.ZZ4))},J.\u0275dir=D.lG2({type:J,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),J})();class Is{constructor(he,ee){this.record=he,this.view=ee}}let Ti=(()=>{class J{constructor(ee,_e){this._viewContainer=ee,this._context=new Si,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=_e}set ngIf(ee){this._context.$implicit=this._context.ngIf=ee,this._updateView()}set ngIfThen(ee){$n("ngIfThen",ee),this._thenTemplateRef=ee,this._thenViewRef=null,this._updateView()}set ngIfElse(ee){$n("ngIfElse",ee),this._elseTemplateRef=ee,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(ee,_e){return!0}}return J.\u0275fac=function(ee){return new(ee||J)(D.Y36(D.s_b),D.Y36(D.Rgc))},J.\u0275dir=D.lG2({type:J,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),J})();class Si{constructor(){this.$implicit=null,this.ngIf=null}}function $n(J,he){if(he&&!he.createEmbeddedView)throw new Error(`${J} must be a TemplateRef, but received '${(0,D.AaK)(he)}'.`)}let Oi=(()=>{class J{constructor(ee,_e,Xe){this._ngEl=ee,this._differs=_e,this._renderer=Xe,this._ngStyle=null,this._differ=null}set ngStyle(ee){this._ngStyle=ee,!this._differ&&ee&&(this._differ=this._differs.find(ee).create())}ngDoCheck(){if(this._differ){const ee=this._differ.diff(this._ngStyle);ee&&this._applyChanges(ee)}}_setStyle(ee,_e){const[Xe,Dt]=ee.split(".");null!=(_e=null!=_e&&Dt?`${_e}${Dt}`:_e)?this._renderer.setStyle(this._ngEl.nativeElement,Xe,_e):this._renderer.removeStyle(this._ngEl.nativeElement,Xe)}_applyChanges(ee){ee.forEachRemovedItem(_e=>this._setStyle(_e.key,null)),ee.forEachAddedItem(_e=>this._setStyle(_e.key,_e.currentValue)),ee.forEachChangedItem(_e=>this._setStyle(_e.key,_e.currentValue))}}return J.\u0275fac=function(ee){return new(ee||J)(D.Y36(D.SBq),D.Y36(D.aQg),D.Y36(D.Qsj))},J.\u0275dir=D.lG2({type:J,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),J})();function Ar(J,he){return Error(`InvalidPipeArgument: '${he}' for pipe '${(0,D.AaK)(J)}'`)}let Ni=(()=>{class J{transform(ee){if(null==ee)return null;if("string"!=typeof ee)throw Ar(J,ee);return ee.toUpperCase()}}return J.\u0275fac=function(ee){return new(ee||J)},J.\u0275pipe=D.Yjl({name:"uppercase",type:J,pure:!0}),J})(),qs=(()=>{class J{constructor(ee){this.locale=ee}transform(ee,_e="mediumDate",Xe,Dt){if(null==ee||""===ee||ee!=ee)return null;try{return xn(ee,_e,Dt||this.locale,Xe)}catch(jt){throw Ar(J,jt.message)}}}return J.\u0275fac=function(ee){return new(ee||J)(D.Y36(D.soG,16))},J.\u0275pipe=D.Yjl({name:"date",type:J,pure:!0}),J})(),ml=(()=>{class J{constructor(ee){this._locale=ee}transform(ee,_e,Xe){if(!function(J){return!(null==J||""===J||J!=J)}(ee))return null;Xe=Xe||this._locale;try{return function(J,he,ee){return function(J,he,ee,_e,Xe,Dt,jt=!1){let q="",$=!1;if(isFinite(J)){let V=function(J){let _e,Xe,Dt,jt,q,he=Math.abs(J)+"",ee=0;for((Xe=he.indexOf("."))>-1&&(he=he.replace(".","")),(Dt=he.search(/e/i))>0?(Xe<0&&(Xe=Dt),Xe+=+he.slice(Dt+1),he=he.substring(0,Dt)):Xe<0&&(Xe=he.length),Dt=0;"0"===he.charAt(Dt);Dt++);if(Dt===(q=he.length))_e=[0],Xe=1;else{for(q--;"0"===he.charAt(q);)q--;for(Xe-=Dt,_e=[],jt=0;Dt<=q;Dt++,jt++)_e[jt]=Number(he.charAt(Dt))}return Xe>22&&(_e=_e.splice(0,21),ee=Xe-1,Xe=1),{digits:_e,exponent:ee,integerLen:Xe}}(J);jt&&(V=function(J){if(0===J.digits[0])return J;const he=J.digits.length-J.integerLen;return J.exponent?J.exponent+=2:(0===he?J.digits.push(0,0):1===he&&J.digits.push(0),J.integerLen+=2),J}(V));let ue=he.minInt,yt=he.minFrac,Qt=he.maxFrac;if(Dt){const ps=Dt.match(ft);if(null===ps)throw new Error(`${Dt} is not a valid digit info`);const Mr=ps[1],Mi=ps[3],lo=ps[5];null!=Mr&&(ue=Tn(Mr)),null!=Mi&&(yt=Tn(Mi)),null!=lo?Qt=Tn(lo):null!=Mi&&yt>Qt&&(Qt=yt)}!function(J,he,ee){if(he>ee)throw new Error(`The minimum number of digits after fraction (${he}) is higher than the maximum (${ee}).`);let _e=J.digits,Xe=_e.length-J.integerLen;const Dt=Math.min(Math.max(he,Xe),ee);let jt=Dt+J.integerLen,q=_e[jt];if(jt>0){_e.splice(Math.max(J.integerLen,jt));for(let yt=jt;yt<_e.length;yt++)_e[yt]=0}else{Xe=Math.max(0,Xe),J.integerLen=1,_e.length=Math.max(1,jt=Dt+1),_e[0]=0;for(let yt=1;yt<jt;yt++)_e[yt]=0}if(q>=5)if(jt-1<0){for(let yt=0;yt>jt;yt--)_e.unshift(0),J.integerLen++;_e.unshift(1),J.integerLen++}else _e[jt-1]++;for(;Xe<Math.max(0,Dt);Xe++)_e.push(0);let $=0!==Dt;const V=he+J.integerLen,ue=_e.reduceRight(function(yt,Qt,Mn,Vr){return Vr[Mn]=(Qt+=yt)<10?Qt:Qt-10,$&&(0===Vr[Mn]&&Mn>=V?Vr.pop():$=!1),Qt>=10?1:0},0);ue&&(_e.unshift(ue),J.integerLen++)}(V,yt,Qt);let Mn=V.digits,Vr=V.integerLen;const Ai=V.exponent;let oi=[];for($=Mn.every(ps=>!ps);Vr<ue;Vr++)Mn.unshift(0);for(;Vr<0;Vr++)Mn.unshift(0);Vr>0?oi=Mn.splice(Vr,Mn.length):(oi=Mn,Mn=[0]);const fs=[];for(Mn.length>=he.lgSize&&fs.unshift(Mn.splice(-he.lgSize,Mn.length).join(""));Mn.length>he.gSize;)fs.unshift(Mn.splice(-he.gSize,Mn.length).join(""));Mn.length&&fs.unshift(Mn.join("")),q=fs.join(Rn(ee,_e)),oi.length&&(q+=Rn(ee,Xe)+oi.join("")),Ai&&(q+=Rn(ee,gt.Exponential)+"+"+Ai)}else q=Rn(ee,gt.Infinity);return q=J<0&&!$?he.negPre+q+he.negSuf:he.posPre+q+he.posSuf,q}(J,function(J,he="-"){const ee={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},_e=J.split(";"),Xe=_e[0],Dt=_e[1],jt=-1!==Xe.indexOf(".")?Xe.split("."):[Xe.substring(0,Xe.lastIndexOf("0")+1),Xe.substring(Xe.lastIndexOf("0")+1)],q=jt[0],$=jt[1]||"";ee.posPre=q.substr(0,q.indexOf("#"));for(let ue=0;ue<$.length;ue++){const yt=$.charAt(ue);"0"===yt?ee.minFrac=ee.maxFrac=ue+1:"#"===yt?ee.maxFrac=ue+1:ee.posSuf+=yt}const V=q.split(",");if(ee.gSize=V[1]?V[1].length:0,ee.lgSize=V[2]||V[1]?(V[2]||V[1]).length:0,Dt){const ue=Xe.length-ee.posPre.length-ee.posSuf.length,yt=Dt.indexOf("#");ee.negPre=Dt.substr(0,yt).replace(/'/g,""),ee.negSuf=Dt.substr(yt+ue).replace(/'/g,"")}else ee.negPre=he+ee.posPre,ee.negSuf=ee.posSuf;return ee}(function(J,he){return(0,D.cg1)(J)[D.wAp.NumberFormats][he]}(he,In.Decimal),Rn(he,gt.MinusSign)),he,gt.Group,gt.Decimal,ee)}(function(J){if("string"==typeof J&&!isNaN(Number(J)-parseFloat(J)))return Number(J);if("number"!=typeof J)throw new Error(`${J} is not a number`);return J}(ee),Xe,_e)}catch(Dt){throw Ar(J,Dt.message)}}}return J.\u0275fac=function(ee){return new(ee||J)(D.Y36(D.soG,16))},J.\u0275pipe=D.Yjl({name:"number",type:J,pure:!0}),J})();let Yo=(()=>{class J{transform(ee,_e,Xe){if(null==ee)return null;if(!this.supports(ee))throw Ar(J,ee);return ee.slice(_e,Xe)}supports(ee){return"string"==typeof ee||Array.isArray(ee)}}return J.\u0275fac=function(ee){return new(ee||J)},J.\u0275pipe=D.Yjl({name:"slice",type:J,pure:!1}),J})(),Ws=(()=>{class J{}return J.\u0275fac=function(ee){return new(ee||J)},J.\u0275mod=D.oAB({type:J}),J.\u0275inj=D.cJS({providers:[{provide:mr,useClass:Zr}]}),J})();const Di="browser";let gr=(()=>{class J{}return J.\u0275prov=(0,D.Yz7)({token:J,providedIn:"root",factory:()=>new oo((0,D.LFG)(Ce),window)}),J})();class oo{constructor(he,ee){this.document=he,this.window=ee,this.offset=()=>[0,0]}setOffset(he){this.offset=Array.isArray(he)?()=>he:he}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(he){this.supportsScrolling()&&this.window.scrollTo(he[0],he[1])}scrollToAnchor(he){if(!this.supportsScrolling())return;const ee=function(J,he){const ee=J.getElementById(he)||J.getElementsByName(he)[0];if(ee)return ee;if("function"==typeof J.createTreeWalker&&J.body&&(J.body.createShadowRoot||J.body.attachShadow)){const _e=J.createTreeWalker(J.body,NodeFilter.SHOW_ELEMENT);let Xe=_e.currentNode;for(;Xe;){const Dt=Xe.shadowRoot;if(Dt){const jt=Dt.getElementById(he)||Dt.querySelector(`[name="${he}"]`);if(jt)return jt}Xe=_e.nextNode()}}return null}(this.document,he);ee&&(this.scrollToElement(ee),this.attemptFocus(ee))}setHistoryScrollRestoration(he){if(this.supportScrollRestoration()){const ee=this.window.history;ee&&ee.scrollRestoration&&(ee.scrollRestoration=he)}}scrollToElement(he){const ee=he.getBoundingClientRect(),_e=ee.left+this.window.pageXOffset,Xe=ee.top+this.window.pageYOffset,Dt=this.offset();this.window.scrollTo(_e-Dt[0],Xe-Dt[1])}attemptFocus(he){return he.focus(),this.document.activeElement===he}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const he=Ys(this.window.history)||Ys(Object.getPrototypeOf(this.window.history));return!(!he||!he.writable&&!he.set)}catch(he){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(he){return!1}}}function Ys(J){return Object.getOwnPropertyDescriptor(J,"scrollRestoration")}class ao{}},1841:(Mt,at,te)=>{"use strict";te.d(at,{eN:()=>gt,JF:()=>di,WM:()=>ve});var D=te(8583),A=te(639),R=te(5917),u=te(7574),ge=te(4612),Se=te(5435),Ce=te(8002);class ce{}class ae{}class ve{constructor(rt){this.normalizedNames=new Map,this.lazyUpdate=null,rt?this.lazyInit="string"==typeof rt?()=>{this.headers=new Map,rt.split("\n").forEach(nt=>{const Wt=nt.indexOf(":");if(Wt>0){const _t=nt.slice(0,Wt),hn=_t.toLowerCase(),mn=nt.slice(Wt+1).trim();this.maybeSetNormalizedName(_t,hn),this.headers.has(hn)?this.headers.get(hn).push(mn):this.headers.set(hn,[mn])}})}:()=>{this.headers=new Map,Object.keys(rt).forEach(nt=>{let Wt=rt[nt];const _t=nt.toLowerCase();"string"==typeof Wt&&(Wt=[Wt]),Wt.length>0&&(this.headers.set(_t,Wt),this.maybeSetNormalizedName(nt,_t))})}:this.headers=new Map}has(rt){return this.init(),this.headers.has(rt.toLowerCase())}get(rt){this.init();const nt=this.headers.get(rt.toLowerCase());return nt&&nt.length>0?nt[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(rt){return this.init(),this.headers.get(rt.toLowerCase())||null}append(rt,nt){return this.clone({name:rt,value:nt,op:"a"})}set(rt,nt){return this.clone({name:rt,value:nt,op:"s"})}delete(rt,nt){return this.clone({name:rt,value:nt,op:"d"})}maybeSetNormalizedName(rt,nt){this.normalizedNames.has(nt)||this.normalizedNames.set(nt,rt)}init(){this.lazyInit&&(this.lazyInit instanceof ve?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(rt=>this.applyUpdate(rt)),this.lazyUpdate=null))}copyFrom(rt){rt.init(),Array.from(rt.headers.keys()).forEach(nt=>{this.headers.set(nt,rt.headers.get(nt)),this.normalizedNames.set(nt,rt.normalizedNames.get(nt))})}clone(rt){const nt=new ve;return nt.lazyInit=this.lazyInit&&this.lazyInit instanceof ve?this.lazyInit:this,nt.lazyUpdate=(this.lazyUpdate||[]).concat([rt]),nt}applyUpdate(rt){const nt=rt.name.toLowerCase();switch(rt.op){case"a":case"s":let Wt=rt.value;if("string"==typeof Wt&&(Wt=[Wt]),0===Wt.length)return;this.maybeSetNormalizedName(rt.name,nt);const _t=("a"===rt.op?this.headers.get(nt):void 0)||[];_t.push(...Wt),this.headers.set(nt,_t);break;case"d":const hn=rt.value;if(hn){let mn=this.headers.get(nt);if(!mn)return;mn=mn.filter(_n=>-1===hn.indexOf(_n)),0===mn.length?(this.headers.delete(nt),this.normalizedNames.delete(nt)):this.headers.set(nt,mn)}else this.headers.delete(nt),this.normalizedNames.delete(nt)}}forEach(rt){this.init(),Array.from(this.normalizedNames.keys()).forEach(nt=>rt(this.normalizedNames.get(nt),this.headers.get(nt)))}}class Ue{encodeKey(rt){return Ne(rt)}encodeValue(rt){return Ne(rt)}decodeKey(rt){return decodeURIComponent(rt)}decodeValue(rt){return decodeURIComponent(rt)}}const we=/%(\d[a-f0-9])/gi,Oe={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function Ne(Tt){return encodeURIComponent(Tt).replace(we,(rt,nt)=>{var Wt;return null!==(Wt=Oe[nt])&&void 0!==Wt?Wt:rt})}function ke(Tt){return`${Tt}`}class lt{constructor(rt={}){if(this.updates=null,this.cloneFrom=null,this.encoder=rt.encoder||new Ue,rt.fromString){if(rt.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function(Tt,rt){const nt=new Map;return Tt.length>0&&Tt.replace(/^\?/,"").split("&").forEach(_t=>{const hn=_t.indexOf("="),[mn,_n]=-1==hn?[rt.decodeKey(_t),""]:[rt.decodeKey(_t.slice(0,hn)),rt.decodeValue(_t.slice(hn+1))],xn=nt.get(mn)||[];xn.push(_n),nt.set(mn,xn)}),nt}(rt.fromString,this.encoder)}else rt.fromObject?(this.map=new Map,Object.keys(rt.fromObject).forEach(nt=>{const Wt=rt.fromObject[nt];this.map.set(nt,Array.isArray(Wt)?Wt:[Wt])})):this.map=null}has(rt){return this.init(),this.map.has(rt)}get(rt){this.init();const nt=this.map.get(rt);return nt?nt[0]:null}getAll(rt){return this.init(),this.map.get(rt)||null}keys(){return this.init(),Array.from(this.map.keys())}append(rt,nt){return this.clone({param:rt,value:nt,op:"a"})}appendAll(rt){const nt=[];return Object.keys(rt).forEach(Wt=>{const _t=rt[Wt];Array.isArray(_t)?_t.forEach(hn=>{nt.push({param:Wt,value:hn,op:"a"})}):nt.push({param:Wt,value:_t,op:"a"})}),this.clone(nt)}set(rt,nt){return this.clone({param:rt,value:nt,op:"s"})}delete(rt,nt){return this.clone({param:rt,value:nt,op:"d"})}toString(){return this.init(),this.keys().map(rt=>{const nt=this.encoder.encodeKey(rt);return this.map.get(rt).map(Wt=>nt+"="+this.encoder.encodeValue(Wt)).join("&")}).filter(rt=>""!==rt).join("&")}clone(rt){const nt=new lt({encoder:this.encoder});return nt.cloneFrom=this.cloneFrom||this,nt.updates=(this.updates||[]).concat(rt),nt}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(rt=>this.map.set(rt,this.cloneFrom.map.get(rt))),this.updates.forEach(rt=>{switch(rt.op){case"a":case"s":const nt=("a"===rt.op?this.map.get(rt.param):void 0)||[];nt.push(ke(rt.value)),this.map.set(rt.param,nt);break;case"d":if(void 0===rt.value){this.map.delete(rt.param);break}{let Wt=this.map.get(rt.param)||[];const _t=Wt.indexOf(ke(rt.value));-1!==_t&&Wt.splice(_t,1),Wt.length>0?this.map.set(rt.param,Wt):this.map.delete(rt.param)}}}),this.cloneFrom=this.updates=null)}}class Je{constructor(){this.map=new Map}set(rt,nt){return this.map.set(rt,nt),this}get(rt){return this.map.has(rt)||this.map.set(rt,rt.defaultValue()),this.map.get(rt)}delete(rt){return this.map.delete(rt),this}keys(){return this.map.keys()}}function Ge(Tt){return"undefined"!=typeof ArrayBuffer&&Tt instanceof ArrayBuffer}function Lt(Tt){return"undefined"!=typeof Blob&&Tt instanceof Blob}function Ht(Tt){return"undefined"!=typeof FormData&&Tt instanceof FormData}class gn{constructor(rt,nt,Wt,_t){let hn;if(this.url=nt,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=rt.toUpperCase(),function(Tt){switch(Tt){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||_t?(this.body=void 0!==Wt?Wt:null,hn=_t):hn=Wt,hn&&(this.reportProgress=!!hn.reportProgress,this.withCredentials=!!hn.withCredentials,hn.responseType&&(this.responseType=hn.responseType),hn.headers&&(this.headers=hn.headers),hn.context&&(this.context=hn.context),hn.params&&(this.params=hn.params)),this.headers||(this.headers=new ve),this.context||(this.context=new Je),this.params){const mn=this.params.toString();if(0===mn.length)this.urlWithParams=nt;else{const _n=nt.indexOf("?");this.urlWithParams=nt+(-1===_n?"?":_n<nt.length-1?"&":"")+mn}}else this.params=new lt,this.urlWithParams=nt}serializeBody(){return null===this.body?null:Ge(this.body)||Lt(this.body)||Ht(this.body)||"undefined"!=typeof URLSearchParams&&this.body instanceof URLSearchParams||"string"==typeof this.body?this.body:this.body instanceof lt?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Ht(this.body)?null:Lt(this.body)?this.body.type||null:Ge(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof lt?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(rt={}){var nt;const Wt=rt.method||this.method,_t=rt.url||this.url,hn=rt.responseType||this.responseType,mn=void 0!==rt.body?rt.body:this.body,_n=void 0!==rt.withCredentials?rt.withCredentials:this.withCredentials,xn=void 0!==rt.reportProgress?rt.reportProgress:this.reportProgress;let jr=rt.headers||this.headers,Fr=rt.params||this.params;const ii=null!==(nt=rt.context)&&void 0!==nt?nt:this.context;return void 0!==rt.setHeaders&&(jr=Object.keys(rt.setHeaders).reduce((Wr,jn)=>Wr.set(jn,rt.setHeaders[jn]),jr)),rt.setParams&&(Fr=Object.keys(rt.setParams).reduce((Wr,jn)=>Wr.set(jn,rt.setParams[jn]),Fr)),new gn(Wt,_t,mn,{params:Fr,headers:jr,context:ii,reportProgress:xn,responseType:hn,withCredentials:_n})}}var Xt=(()=>((Xt=Xt||{})[Xt.Sent=0]="Sent",Xt[Xt.UploadProgress=1]="UploadProgress",Xt[Xt.ResponseHeader=2]="ResponseHeader",Xt[Xt.DownloadProgress=3]="DownloadProgress",Xt[Xt.Response=4]="Response",Xt[Xt.User=5]="User",Xt))();class In{constructor(rt,nt=200,Wt="OK"){this.headers=rt.headers||new ve,this.status=void 0!==rt.status?rt.status:nt,this.statusText=rt.statusText||Wt,this.url=rt.url||null,this.ok=this.status>=200&&this.status<300}}class Gn extends In{constructor(rt={}){super(rt),this.type=Xt.ResponseHeader}clone(rt={}){return new Gn({headers:rt.headers||this.headers,status:void 0!==rt.status?rt.status:this.status,statusText:rt.statusText||this.statusText,url:rt.url||this.url||void 0})}}class ct extends In{constructor(rt={}){super(rt),this.type=Xt.Response,this.body=void 0!==rt.body?rt.body:null}clone(rt={}){return new ct({body:void 0!==rt.body?rt.body:this.body,headers:rt.headers||this.headers,status:void 0!==rt.status?rt.status:this.status,statusText:rt.statusText||this.statusText,url:rt.url||this.url||void 0})}}class tt extends In{constructor(rt){super(rt,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${rt.url||"(unknown url)"}`:`Http failure response for ${rt.url||"(unknown url)"}: ${rt.status} ${rt.statusText}`,this.error=rt.error||null}}function mt(Tt,rt){return{body:rt,headers:Tt.headers,context:Tt.context,observe:Tt.observe,params:Tt.params,reportProgress:Tt.reportProgress,responseType:Tt.responseType,withCredentials:Tt.withCredentials}}let gt=(()=>{class Tt{constructor(nt){this.handler=nt}request(nt,Wt,_t={}){let hn;if(nt instanceof gn)hn=nt;else{let xn,jr;xn=_t.headers instanceof ve?_t.headers:new ve(_t.headers),_t.params&&(jr=_t.params instanceof lt?_t.params:new lt({fromObject:_t.params})),hn=new gn(nt,Wt,void 0!==_t.body?_t.body:null,{headers:xn,context:_t.context,params:jr,reportProgress:_t.reportProgress,responseType:_t.responseType||"json",withCredentials:_t.withCredentials})}const mn=(0,R.of)(hn).pipe((0,ge.b)(xn=>this.handler.handle(xn)));if(nt instanceof gn||"events"===_t.observe)return mn;const _n=mn.pipe((0,Se.h)(xn=>xn instanceof ct));switch(_t.observe||"body"){case"body":switch(hn.responseType){case"arraybuffer":return _n.pipe((0,Ce.U)(xn=>{if(null!==xn.body&&!(xn.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return xn.body}));case"blob":return _n.pipe((0,Ce.U)(xn=>{if(null!==xn.body&&!(xn.body instanceof Blob))throw new Error("Response is not a Blob.");return xn.body}));case"text":return _n.pipe((0,Ce.U)(xn=>{if(null!==xn.body&&"string"!=typeof xn.body)throw new Error("Response is not a string.");return xn.body}));case"json":default:return _n.pipe((0,Ce.U)(xn=>xn.body))}case"response":return _n;default:throw new Error(`Unreachable: unhandled observe type ${_t.observe}}`)}}delete(nt,Wt={}){return this.request("DELETE",nt,Wt)}get(nt,Wt={}){return this.request("GET",nt,Wt)}head(nt,Wt={}){return this.request("HEAD",nt,Wt)}jsonp(nt,Wt){return this.request("JSONP",nt,{params:(new lt).append(Wt,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(nt,Wt={}){return this.request("OPTIONS",nt,Wt)}patch(nt,Wt,_t={}){return this.request("PATCH",nt,mt(_t,Wt))}post(nt,Wt,_t={}){return this.request("POST",nt,mt(_t,Wt))}put(nt,Wt,_t={}){return this.request("PUT",nt,mt(_t,Wt))}}return Tt.\u0275fac=function(nt){return new(nt||Tt)(A.LFG(ce))},Tt.\u0275prov=A.Yz7({token:Tt,factory:Tt.\u0275fac}),Tt})();class tn{constructor(rt,nt){this.next=rt,this.interceptor=nt}handle(rt){return this.interceptor.intercept(rt,this.next)}}const an=new A.OlP("HTTP_INTERCEPTORS");let bn=(()=>{class Tt{intercept(nt,Wt){return Wt.handle(nt)}}return Tt.\u0275fac=function(nt){return new(nt||Tt)},Tt.\u0275prov=A.Yz7({token:Tt,factory:Tt.\u0275fac}),Tt})();const ln=/^\)\]\}',?\n/;let ir=(()=>{class Tt{constructor(nt){this.xhrFactory=nt}handle(nt){if("JSONP"===nt.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new u.y(Wt=>{const _t=this.xhrFactory.build();if(_t.open(nt.method,nt.urlWithParams),nt.withCredentials&&(_t.withCredentials=!0),nt.headers.forEach((jn,wn)=>_t.setRequestHeader(jn,wn.join(","))),nt.headers.has("Accept")||_t.setRequestHeader("Accept","application/json, text/plain, */*"),!nt.headers.has("Content-Type")){const jn=nt.detectContentTypeHeader();null!==jn&&_t.setRequestHeader("Content-Type",jn)}if(nt.responseType){const jn=nt.responseType.toLowerCase();_t.responseType="json"!==jn?jn:"text"}const hn=nt.serializeBody();let mn=null;const _n=()=>{if(null!==mn)return mn;const jn=1223===_t.status?204:_t.status,wn=_t.statusText||"OK",mi=new ve(_t.getAllResponseHeaders()),ar=function(Tt){return"responseURL"in Tt&&Tt.responseURL?Tt.responseURL:/^X-Request-URL:/m.test(Tt.getAllResponseHeaders())?Tt.getResponseHeader("X-Request-URL"):null}(_t)||nt.url;return mn=new Gn({headers:mi,status:jn,statusText:wn,url:ar}),mn},xn=()=>{let{headers:jn,status:wn,statusText:mi,url:ar}=_n(),Yr=null;204!==wn&&(Yr=void 0===_t.response?_t.responseText:_t.response),0===wn&&(wn=Yr?200:0);let Gr=wn>=200&&wn<300;if("json"===nt.responseType&&"string"==typeof Yr){const vr=Yr;Yr=Yr.replace(ln,"");try{Yr=""!==Yr?JSON.parse(Yr):null}catch(cs){Yr=vr,Gr&&(Gr=!1,Yr={error:cs,text:Yr})}}Gr?(Wt.next(new ct({body:Yr,headers:jn,status:wn,statusText:mi,url:ar||void 0})),Wt.complete()):Wt.error(new tt({error:Yr,headers:jn,status:wn,statusText:mi,url:ar||void 0}))},jr=jn=>{const{url:wn}=_n(),mi=new tt({error:jn,status:_t.status||0,statusText:_t.statusText||"Unknown Error",url:wn||void 0});Wt.error(mi)};let Fr=!1;const ii=jn=>{Fr||(Wt.next(_n()),Fr=!0);let wn={type:Xt.DownloadProgress,loaded:jn.loaded};jn.lengthComputable&&(wn.total=jn.total),"text"===nt.responseType&&!!_t.responseText&&(wn.partialText=_t.responseText),Wt.next(wn)},Wr=jn=>{let wn={type:Xt.UploadProgress,loaded:jn.loaded};jn.lengthComputable&&(wn.total=jn.total),Wt.next(wn)};return _t.addEventListener("load",xn),_t.addEventListener("error",jr),_t.addEventListener("timeout",jr),_t.addEventListener("abort",jr),nt.reportProgress&&(_t.addEventListener("progress",ii),null!==hn&&_t.upload&&_t.upload.addEventListener("progress",Wr)),_t.send(hn),Wt.next({type:Xt.Sent}),()=>{_t.removeEventListener("error",jr),_t.removeEventListener("abort",jr),_t.removeEventListener("load",xn),_t.removeEventListener("timeout",jr),nt.reportProgress&&(_t.removeEventListener("progress",ii),null!==hn&&_t.upload&&_t.upload.removeEventListener("progress",Wr)),_t.readyState!==_t.DONE&&_t.abort()}})}}return Tt.\u0275fac=function(nt){return new(nt||Tt)(A.LFG(D.JF))},Tt.\u0275prov=A.Yz7({token:Tt,factory:Tt.\u0275fac}),Tt})();const Vn=new A.OlP("XSRF_COOKIE_NAME"),ri=new A.OlP("XSRF_HEADER_NAME");class Zn{}let xi=(()=>{class Tt{constructor(nt,Wt,_t){this.doc=nt,this.platform=Wt,this.cookieName=_t,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const nt=this.doc.cookie||"";return nt!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,D.Mx)(nt,this.cookieName),this.lastCookieString=nt),this.lastToken}}return Tt.\u0275fac=function(nt){return new(nt||Tt)(A.LFG(D.K0),A.LFG(A.Lbi),A.LFG(Vn))},Tt.\u0275prov=A.Yz7({token:Tt,factory:Tt.\u0275fac}),Tt})(),yr=(()=>{class Tt{constructor(nt,Wt){this.tokenService=nt,this.headerName=Wt}intercept(nt,Wt){const _t=nt.url.toLowerCase();if("GET"===nt.method||"HEAD"===nt.method||_t.startsWith("http://")||_t.startsWith("https://"))return Wt.handle(nt);const hn=this.tokenService.getToken();return null!==hn&&!nt.headers.has(this.headerName)&&(nt=nt.clone({headers:nt.headers.set(this.headerName,hn)})),Wt.handle(nt)}}return Tt.\u0275fac=function(nt){return new(nt||Tt)(A.LFG(Zn),A.LFG(ri))},Tt.\u0275prov=A.Yz7({token:Tt,factory:Tt.\u0275fac}),Tt})(),Vi=(()=>{class Tt{constructor(nt,Wt){this.backend=nt,this.injector=Wt,this.chain=null}handle(nt){if(null===this.chain){const Wt=this.injector.get(an,[]);this.chain=Wt.reduceRight((_t,hn)=>new tn(_t,hn),this.backend)}return this.chain.handle(nt)}}return Tt.\u0275fac=function(nt){return new(nt||Tt)(A.LFG(ae),A.LFG(A.zs3))},Tt.\u0275prov=A.Yz7({token:Tt,factory:Tt.\u0275fac}),Tt})(),as=(()=>{class Tt{static disable(){return{ngModule:Tt,providers:[{provide:yr,useClass:bn}]}}static withOptions(nt={}){return{ngModule:Tt,providers:[nt.cookieName?{provide:Vn,useValue:nt.cookieName}:[],nt.headerName?{provide:ri,useValue:nt.headerName}:[]]}}}return Tt.\u0275fac=function(nt){return new(nt||Tt)},Tt.\u0275mod=A.oAB({type:Tt}),Tt.\u0275inj=A.cJS({providers:[yr,{provide:an,useExisting:yr,multi:!0},{provide:Zn,useClass:xi},{provide:Vn,useValue:"XSRF-TOKEN"},{provide:ri,useValue:"X-XSRF-TOKEN"}]}),Tt})(),di=(()=>{class Tt{}return Tt.\u0275fac=function(nt){return new(nt||Tt)},Tt.\u0275mod=A.oAB({type:Tt}),Tt.\u0275inj=A.cJS({providers:[gt,{provide:ce,useClass:Vi},ir,{provide:ae,useExisting:ir}],imports:[[as.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),Tt})()},441:(Mt,at,te)=>{var D,A,R;!function(u){if("object"==typeof Mt.exports){var ge=u(0,at);void 0!==ge&&(Mt.exports=ge)}else A=[te,at],void 0!==(R="function"==typeof(D=u)?D.apply(at,A):D)&&(Mt.exports=R)}(function(u,ge){"use strict";Object.defineProperty(ge,"__esModule",{value:!0});var Se=void 0;ge.default=["es",[["a.\xa0m.","p.\xa0m."],Se,Se],Se,[["D","L","M","X","J","V","S"],["dom.","lun.","mar.","mi\xe9.","jue.","vie.","s\xe1b."],["domingo","lunes","martes","mi\xe9rcoles","jueves","viernes","s\xe1bado"],["DO","LU","MA","MI","JU","VI","SA"]],Se,[["E","F","M","A","M","J","J","A","S","O","N","D"],["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","sept.","oct.","nov.","dic."],["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]],Se,[["a. C.","d. C."],Se,["antes de Cristo","despu\xe9s de Cristo"]],1,[6,0],["d/M/yy","d MMM y","d 'de' MMMM 'de' y","EEEE, d 'de' MMMM 'de' y"],["H:mm","H:mm:ss","H:mm:ss z","H:mm:ss (zzzz)"],["{1} {0}",Se,"{1}, {0}",Se],[",",".",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0\xa0%","#,##0.00\xa0\xa4","#E0"],"EUR","\u20ac","euro",{AUD:[Se,"$"],BRL:[Se,"R$"],CNY:[Se,"\xa5"],EGP:[],ESP:["\u20a7"],GBP:[Se,"\xa3"],HKD:[Se,"$"],ILS:[Se,"\u20aa"],INR:[Se,"\u20b9"],JPY:[Se,"\xa5"],KRW:[Se,"\u20a9"],MXN:[Se,"$"],NZD:[Se,"$"],RON:[Se,"L"],THB:["\u0e3f"],TWD:[Se,"NT$"],USD:["US$","$"],XAF:[],XCD:[Se,"$"],XOF:[]},"ltr",function(ce){return 1===ce?1:5}]})},639:(Mt,at,te)=>{"use strict";te.d(at,{deG:()=>bo,tb:()=>Yx,AFp:()=>Hx,ip1:()=>J_,CZH:()=>hd,hGG:()=>PS,z2F:()=>Zf,sBO:()=>bE,Sil:()=>Gf,_Vd:()=>rd,EJc:()=>Xx,SBq:()=>eu,qLn:()=>Ll,vpe:()=>tu,gxx:()=>Au,tBr:()=>cr,XFs:()=>_t,OlP:()=>Lr,zs3:()=>ut,IIB:()=>ET,ZZ4:()=>Tm,aQg:()=>Sm,soG:()=>Nm,YKP:()=>O0,v3s:()=>uS,h0i:()=>Ju,PXZ:()=>iS,R0b:()=>jl,FiY:()=>Cr,r_U:()=>CT,Lbi:()=>Wx,g9A:()=>qx,Qsj:()=>oE,FYo:()=>Cm,JOm:()=>sc,Tiy:()=>D_,q3G:()=>Zi,tp0:()=>vi,EAV:()=>pS,Rgc:()=>Rf,dDg:()=>tb,DyG:()=>pe,GfV:()=>S0,s_b:()=>Mm,ifc:()=>wn,eFA:()=>ab,G48:()=>XT,Gpc:()=>Je,_c5:()=>CS,VLi:()=>KT,c2e:()=>Kx,zSh:()=>Ku,wAp:()=>pr,vHH:()=>Ht,EiD:()=>Td,mCW:()=>su,qzn:()=>Ms,JVY:()=>_d,pB0:()=>sh,eBb:()=>ru,L6k:()=>Qf,LAX:()=>iu,cg1:()=>y_,Tjo:()=>wS,kL8:()=>Wv,yhl:()=>ti,dqk:()=>vr,sIi:()=>Ul,CqO:()=>c_,QGY:()=>l_,F4k:()=>rv,dwT:()=>nw,RDi:()=>Dt,AaK:()=>ke,z3N:()=>wc,qOj:()=>Tc,TTD:()=>fa,_Bn:()=>b0,xp6:()=>Up,uIk:()=>Xg,ekj:()=>f_,Suo:()=>Cx,Xpm:()=>Ze,lG2:()=>Bn,Yz7:()=>yr,cJS:()=>zr,oAB:()=>sn,Yjl:()=>Hn,Y36:()=>Tf,_UZ:()=>ev,GkF:()=>tv,BQk:()=>a_,ynx:()=>o_,qZA:()=>s_,TgZ:()=>i_,EpF:()=>nv,n5z:()=>S,Ikx:()=>__,LFG:()=>Te,$8M:()=>ne,NdJ:()=>u_,CRH:()=>Tx,oxw:()=>av,ALo:()=>gx,lcZ:()=>_x,xi3:()=>yx,Dn7:()=>vx,Q6J:()=>n_,s9C:()=>d_,MGl:()=>mm,DdM:()=>lx,VKq:()=>cx,WLB:()=>ux,iGM:()=>wx,MAs:()=>jy,CHM:()=>Ma,LSH:()=>Sd,kYT:()=>He,YNc:()=>Uy,_uU:()=>Iv,Oqu:()=>m_,hij:()=>_m,AsE:()=>g_,Gf:()=>Ex});var D=te(7574),A=te(4869),R=te(3282),u=te(6693),Se=te(7709),Ce=te(5319),ce=te(2441);var Ue=te(1307);function Be(){return new Se.xQ}function Oe(t){for(let n in t)if(t[n]===Oe)return n;throw Error("Could not find renamed property on target object.")}function Ne(t,n){for(const i in n)n.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=n[i])}function ke(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(ke).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const n=t.toString();if(null==n)return""+n;const i=n.indexOf("\n");return-1===i?n:n.substring(0,i)}function lt(t,n){return null==t||""===t?null===n?"":n:null==n||""===n?t:t+" "+n}const Ot=Oe({__forward_ref__:Oe});function Je(t){return t.__forward_ref__=Je,t.toString=function(){return ke(this())},t}function Me(t){return Ge(t)?t():t}function Ge(t){return"function"==typeof t&&t.hasOwnProperty(Ot)&&t.__forward_ref__===Je}class Ht extends Error{constructor(n,i){super(function(t,n){return`${t?`NG0${t}: `:""}${n}`}(n,i)),this.code=n}}function Xt(t){return"string"==typeof t?t:null==t?"":String(t)}function In(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():Xt(t)}function mt(t,n){const i=n?` in ${n}`:"";throw new Ht("201",`No provider for ${In(t)} found${i}`)}function ir(t,n){null==t&&function(t,n,i,a){throw new Error(`ASSERTION ERROR: ${t}`+(null==a?"":` [Expected=> ${i} ${a} ${n} <=Actual]`))}(n,t,null,"!=")}function yr(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function zr(t){return{providers:t.providers||[],imports:t.imports||[]}}function $r(t){return as(t,Tt)||as(t,nt)}function as(t,n){return t.hasOwnProperty(n)?t[n]:null}function Ui(t){return t&&(t.hasOwnProperty(rt)||t.hasOwnProperty(Wt))?t[rt]:null}const Tt=Oe({\u0275prov:Oe}),rt=Oe({\u0275inj:Oe}),nt=Oe({ngInjectableDef:Oe}),Wt=Oe({ngInjectorDef:Oe});var _t=(()=>((_t=_t||{})[_t.Default=0]="Default",_t[_t.Host=1]="Host",_t[_t.Self=2]="Self",_t[_t.SkipSelf=4]="SkipSelf",_t[_t.Optional=8]="Optional",_t))();let hn;function _n(t){const n=hn;return hn=t,n}function xn(t,n,i){const a=$r(t);return a&&"root"==a.providedIn?void 0===a.value?a.value=a.factory():a.value:i&_t.Optional?null:void 0!==n?n:void mt(ke(t),"Injector")}function Fr(t){return{toString:t}.toString()}var ii=(()=>((ii=ii||{})[ii.OnPush=0]="OnPush",ii[ii.Default=1]="Default",ii))(),wn=(()=>((wn=wn||{})[wn.Emulated=0]="Emulated",wn[wn.None=2]="None",wn[wn.ShadowDom=3]="ShadowDom",wn))();const mi="undefined"!=typeof globalThis&&globalThis,ar="undefined"!=typeof window&&window,Yr="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Gr="undefined"!=typeof global&&global,vr=mi||Gr||ar||Yr,qi={},lr=[],K=Oe({\u0275cmp:Oe}),k=Oe({\u0275dir:Oe}),N=Oe({\u0275pipe:Oe}),H=Oe({\u0275mod:Oe}),de=Oe({\u0275loc:Oe}),Pe=Oe({\u0275fac:Oe}),Qe=Oe({__NG_ELEMENT_ID__:Oe});let st=0;function Ze(t){return Fr(()=>{const i={},a={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===ii.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||lr,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||wn.Emulated,id:"c",styles:t.styles||lr,_:null,setInput:null,schemas:t.schemas||null,tView:null},h=t.directives,g=t.features,w=t.pipes;return a.id+=st++,a.inputs=Ct(t.inputs,i),a.outputs=Ct(t.outputs),g&&g.forEach(C=>C(a)),a.directiveDefs=h?()=>("function"==typeof h?h():h).map(St):null,a.pipeDefs=w?()=>("function"==typeof w?w():w).map(Gt):null,a})}function St(t){return An(t)||function(t){return t[k]||null}(t)}function Gt(t){return function(t){return t[N]||null}(t)}const Pt={};function sn(t){return Fr(()=>{const n={type:t.type,bootstrap:t.bootstrap||lr,declarations:t.declarations||lr,imports:t.imports||lr,exports:t.exports||lr,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(Pt[t.id]=t.type),n})}function He(t,n){return Fr(()=>{const i=tr(t,!0);i.declarations=n.declarations||lr,i.imports=n.imports||lr,i.exports=n.exports||lr})}function Ct(t,n){if(null==t)return qi;const i={};for(const a in t)if(t.hasOwnProperty(a)){let h=t[a],g=h;Array.isArray(h)&&(g=h[1],h=h[0]),i[h]=a,n&&(n[h]=g)}return i}const Bn=Ze;function Hn(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,onDestroy:t.type.prototype.ngOnDestroy||null}}function An(t){return t[K]||null}function tr(t,n){const i=t[H]||null;if(!i&&!0===n)throw new Error(`Type ${ke(t)} does not have '\u0275mod' property.`);return i}function Hr(t){return Array.isArray(t)&&"object"==typeof t[1]}function Fi(t){return Array.isArray(t)&&!0===t[1]}function Ki(t){return 0!=(8&t.flags)}function Li(t){return 2==(2&t.flags)}function Hs(t){return 1==(1&t.flags)}function qr(t){return null!==t.template}function ts(t){return 0!=(512&t[2])}function Cs(t,n){return t.hasOwnProperty(Pe)?t[Pe]:null}class Aa{constructor(n,i,a){this.previousValue=n,this.currentValue=i,this.firstChange=a}isFirstChange(){return this.firstChange}}function fa(){return Rs}function Rs(t){return t.type.prototype.ngOnChanges&&(t.setInput=oo),gr}function gr(){const t=Ts(this),n=null==t?void 0:t.current;if(n){const i=t.previous;if(i===qi)t.previous=n;else for(let a in n)i[a]=n[a];t.current=null,this.ngOnChanges(n)}}function oo(t,n,i,a){const h=Ts(t)||function(t,n){return t[Ys]=n}(t,{previous:qi,current:null}),g=h.current||(h.current={}),w=h.previous,C=this.declaredInputs[i],F=w[C];g[C]=new Aa(F&&F.currentValue,n,w===qi),t[a]=n}fa.ngInherit=!0;const Ys="__ngSimpleChanges__";function Ts(t){return t[Ys]||null}let Xe;function Dt(t){Xe=t}function $(t){return!!t.listen}const ue={createRenderer:(t,n)=>void 0!==Xe?Xe:"undefined"!=typeof document?document:void 0};function Qt(t){for(;Array.isArray(t);)t=t[0];return t}function Ai(t,n){return Qt(n[t])}function oi(t,n){return Qt(n[t.index])}function ps(t,n){return t.data[n]}function Mr(t,n){return t[n]}function Mi(t,n){const i=n[t];return Hr(i)?i:i[0]}function lo(t){return 4==(4&t[2])}function Po(t){return 128==(128&t[2])}function Ro(t,n){return null==n?null:t[n]}function ko(t){t[18]=0}function Qa(t,n){t[5]+=n;let i=t,a=t[3];for(;null!==a&&(1===n&&1===i[5]||-1===n&&0===i[5]);)a[5]+=n,i=a,a=a[3]}const nr={lFrame:Lo(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function yl(){return nr.bindingsEnabled}function Jt(){return nr.lFrame.lView}function Rr(){return nr.lFrame.tView}function Ma(t){return nr.lFrame.contextLView=t,t[8]}function gi(){let t=Oo();for(;null!==t&&64===t.type;)t=t.parent;return t}function Oo(){return nr.lFrame.currentTNode}function ns(t,n){const i=nr.lFrame;i.currentTNode=t,i.isParent=n}function Fo(){return nr.lFrame.isParent}function ga(){nr.lFrame.isParent=!1}function Ia(){return nr.isInCheckNoChangesMode}function vl(t){nr.isInCheckNoChangesMode=t}function _i(){const t=nr.lFrame;let n=t.bindingRootIndex;return-1===n&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function yo(){return nr.lFrame.bindingIndex}function Ss(){return nr.lFrame.bindingIndex++}function co(t){const n=nr.lFrame,i=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,i}function vo(t,n){const i=nr.lFrame;i.bindingIndex=i.bindingRootIndex=t,uo(n)}function uo(t){nr.lFrame.currentDirectiveIndex=t}function xl(){return nr.lFrame.currentQueryIndex}function Pa(t){nr.lFrame.currentQueryIndex=t}function Ds(t){const n=t[1];return 2===n.type?n.declTNode:1===n.type?t[6]:null}function ql(t,n,i){if(i&_t.SkipSelf){let h=n,g=t;for(;!(h=h.parent,null!==h||i&_t.Host||(h=Ds(g),null===h||(g=g[15],10&h.type))););if(null===h)return!1;n=h,t=g}const a=nr.lFrame=nl();return a.currentTNode=n,a.lView=t,!0}function _a(t){const n=nl(),i=t[1];nr.lFrame=n,n.currentTNode=i.firstChild,n.lView=t,n.tView=i,n.contextLView=t,n.bindingIndex=i.bindingStartIndex,n.inI18n=!1}function nl(){const t=nr.lFrame,n=null===t?null:t.child;return null===n?Lo(t):n}function Lo(t){const n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=n),n}function Ra(){const t=nr.lFrame;return nr.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const rl=Ra;function bl(){const t=Ra();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function rs(){return nr.lFrame.selectedIndex}function Os(t){nr.lFrame.selectedIndex=t}function bi(){const t=nr.lFrame;return ps(t.tView,t.selectedIndex)}function ms(t,n){for(let i=n.directiveStart,a=n.directiveEnd;i<a;i++){const g=t.data[i].type.prototype,{ngAfterContentInit:w,ngAfterContentChecked:C,ngAfterViewInit:F,ngAfterViewChecked:Z,ngOnDestroy:se}=g;w&&(t.contentHooks||(t.contentHooks=[])).push(-i,w),C&&((t.contentHooks||(t.contentHooks=[])).push(i,C),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(i,C)),F&&(t.viewHooks||(t.viewHooks=[])).push(-i,F),Z&&((t.viewHooks||(t.viewHooks=[])).push(i,Z),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(i,Z)),null!=se&&(t.destroyHooks||(t.destroyHooks=[])).push(i,se)}}function Xo(t,n,i){Cl(t,n,3,i)}function Fa(t,n,i,a){(3&t[2])===i&&Cl(t,n,i,a)}function $i(t,n){let i=t[2];(3&i)===n&&(i&=2047,i+=1,t[2]=i)}function Cl(t,n,i,a){const g=null!=a?a:-1,w=n.length-1;let C=0;for(let F=void 0!==a?65535&t[18]:0;F<w;F++)if("number"==typeof n[F+1]){if(C=n[F],null!=a&&C>=a)break}else n[F]<0&&(t[18]+=65536),(C<g||-1==g)&&(xo(t,i,n,F),t[18]=(4294901760&t[18])+F+2),F++}function xo(t,n,i,a){const h=i[a]<0,g=i[a+1],C=t[h?-i[a]:i[a]];if(h){if(t[2]>>11<t[18]>>16&&(3&t[2])===n){t[2]+=2048;try{g.call(C)}finally{}}}else try{g.call(C)}finally{}}class il{constructor(n,i,a){this.factory=n,this.resolving=!1,this.canSeeViewProviders=i,this.injectImpl=a}}function No(t,n,i){const a=$(t);let h=0;for(;h<i.length;){const g=i[h];if("number"==typeof g){if(0!==g)break;h++;const w=i[h++],C=i[h++],F=i[h++];a?t.setAttribute(n,C,F,w):n.setAttributeNS(w,C,F)}else{const w=g,C=i[++h];ya(w)?a&&t.setProperty(n,w,C):a?t.setAttribute(n,w,C):n.setAttribute(w,C),h++}}return h}function zo(t){return 3===t||4===t||6===t}function ya(t){return 64===t.charCodeAt(0)}function Fs(t,n){if(null!==n&&0!==n.length)if(null===t||0===t.length)t=n.slice();else{let i=-1;for(let a=0;a<n.length;a++){const h=n[a];"number"==typeof h?i=h:0===i||ea(t,i,h,null,-1===i||2===i?n[++a]:null)}}return t}function ea(t,n,i,a,h){let g=0,w=t.length;if(-1===n)w=-1;else for(;g<t.length;){const C=t[g++];if("number"==typeof C){if(C===n){w=-1;break}if(C>n){w=g-1;break}}}for(;g<t.length;){const C=t[g];if("number"==typeof C)break;if(C===i){if(null===a)return void(null!==h&&(t[g+1]=h));if(a===t[g+1])return void(t[g+2]=h)}g++,null!==a&&g++,null!==h&&g++}-1!==w&&(t.splice(w,0,n),g=w+1),t.splice(g++,0,i),null!==a&&t.splice(g++,0,a),null!==h&&t.splice(g++,0,h)}function va(t){return-1!==t}function _s(t){return 32767&t}function La(t,n){let i=function(t){return t>>16}(t),a=n;for(;i>0;)a=a[15],i--;return a}let ta=!0;function yn(t){const n=ta;return ta=t,n}let sl=0;function Na(t,n){const i=Ql(t,n);if(-1!==i)return i;const a=n[1];a.firstCreatePass&&(t.injectorIndex=n.length,Dl(a.data,t),Dl(n,null),Dl(a.blueprint,null));const h=xa(t,n),g=t.injectorIndex;if(va(h)){const w=_s(h),C=La(h,n),F=C[1].data;for(let Z=0;Z<8;Z++)n[g+Z]=C[w+Z]|F[w+Z]}return n[g+8]=h,g}function Dl(t,n){t.push(0,0,0,0,0,0,0,0,n)}function Ql(t,n){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===n[t.injectorIndex+8]?-1:t.injectorIndex}function xa(t,n){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let i=0,a=null,h=n;for(;null!==h;){const g=h[1],w=g.type;if(a=2===w?g.declTNode:1===w?h[6]:null,null===a)return-1;if(i++,h=h[15],-1!==a.injectorIndex)return a.injectorIndex|i<<16}return-1}function ol(t,n,i){!function(t,n,i){let a;"string"==typeof i?a=i.charCodeAt(0)||0:i.hasOwnProperty(Qe)&&(a=i[Qe]),null==a&&(a=i[Qe]=sl++);const h=255&a;n.data[t+(h>>5)]|=1<<h}(t,n,i)}function na(t,n,i){if(i&_t.Optional)return t;mt(n,"NodeInjector")}function Al(t,n,i,a){if(i&_t.Optional&&void 0===a&&(a=null),0==(i&(_t.Self|_t.Host))){const h=t[9],g=_n(void 0);try{return h?h.get(n,a,i&_t.Optional):xn(n,a,i&_t.Optional)}finally{_n(g)}}return na(a,n,i)}function za(t,n,i,a=_t.Default,h){if(null!==t){const g=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const n=t.hasOwnProperty(Qe)?t[Qe]:void 0;return"number"==typeof n?n>=0?255&n:ba:n}(i);if("function"==typeof g){if(!ql(n,t,a))return a&_t.Host?na(h,i,a):Al(n,i,a,h);try{const w=g(a);if(null!=w||a&_t.Optional)return w;mt(i)}finally{rl()}}else if("number"==typeof g){let w=null,C=Ql(t,n),F=-1,Z=a&_t.Host?n[16][6]:null;for((-1===C||a&_t.SkipSelf)&&(F=-1===C?xa(t,n):n[C+8],-1!==F&&B(a,!1)?(w=n[1],C=_s(F),n=La(F,n)):C=-1);-1!==C;){const se=n[1];if(bc(g,C,se.data)){const xe=Il(C,n,i,w,a,Z);if(xe!==Ml)return xe}F=n[C+8],-1!==F&&B(a,n[1].data[C+8]===Z)&&bc(g,C,n)?(w=se,C=_s(F),n=La(F,n)):C=-1}}}return Al(n,i,a,h)}const Ml={};function ba(){return new P(gi(),Jt())}function Il(t,n,i,a,h,g){const w=n[1],C=w.data[t+8],se=al(C,w,i,null==a?Li(C)&&ta:a!=w&&0!=(3&C.type),h&_t.Host&&g===C);return null!==se?ra(n,w,se,C):Ml}function al(t,n,i,a,h){const g=t.providerIndexes,w=n.data,C=1048575&g,F=t.directiveStart,se=g>>20,De=h?C+se:t.directiveEnd;for(let Ye=a?C:C+se;Ye<De;Ye++){const ht=w[Ye];if(Ye<F&&i===ht||Ye>=F&&ht.type===i)return Ye}if(h){const Ye=w[F];if(Ye&&qr(Ye)&&Ye.type===i)return F}return null}function ra(t,n,i,a){let h=t[i];const g=n.data;if(function(t){return t instanceof il}(h)){const w=h;w.resolving&&function(t,n){throw new Ht("200",`Circular dependency in DI detected for ${t}`)}(In(g[i]));const C=yn(w.canSeeViewProviders);w.resolving=!0;const F=w.injectImpl?_n(w.injectImpl):null;ql(t,a,_t.Default);try{h=t[i]=w.factory(void 0,g,t,a),n.firstCreatePass&&i>=a.directiveStart&&function(t,n,i){const{ngOnChanges:a,ngOnInit:h,ngDoCheck:g}=n.type.prototype;if(a){const w=Rs(n);(i.preOrderHooks||(i.preOrderHooks=[])).push(t,w),(i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(t,w)}h&&(i.preOrderHooks||(i.preOrderHooks=[])).push(0-t,h),g&&((i.preOrderHooks||(i.preOrderHooks=[])).push(t,g),(i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(t,g))}(i,g[i],n)}finally{null!==F&&_n(F),yn(C),w.resolving=!1,rl()}}return h}function bc(t,n,i){return!!(i[n+(t>>5)]&1<<t)}function B(t,n){return!(t&_t.Self||t&_t.Host&&n)}class P{constructor(n,i){this._tNode=n,this._lView=i}get(n,i){return za(this._tNode,this._lView,n,void 0,i)}}function S(t){return Fr(()=>{const n=t.prototype.constructor,i=n[Pe]||G(n),a=Object.prototype;let h=Object.getPrototypeOf(t.prototype).constructor;for(;h&&h!==a;){const g=h[Pe]||G(h);if(g&&g!==i)return g;h=Object.getPrototypeOf(h)}return g=>new g})}function G(t){return Ge(t)?()=>{const n=G(Me(t));return n&&n()}:Cs(t)}function ne(t){return function(t,n){if("class"===n)return t.classes;if("style"===n)return t.styles;const i=t.attrs;if(i){const a=i.length;let h=0;for(;h<a;){const g=i[h];if(zo(g))break;if(0===g)h+=2;else if("number"==typeof g)for(h++;h<a&&"string"==typeof i[h];)h++;else{if(g===n)return i[h+1];h+=2}}}return null}(gi(),t)}const ze="__parameters__",et="__prop__metadata__";function En(t){return function(...i){if(t){const a=t(...i);for(const h in a)this[h]=a[h]}}}function dr(t,n,i){return Fr(()=>{const a=En(n);function h(...g){if(this instanceof h)return a.apply(this,g),this;const w=new h(...g);return C.annotation=w,C;function C(F,Z,se){const xe=F.hasOwnProperty(ze)?F[ze]:Object.defineProperty(F,ze,{value:[]})[ze];for(;xe.length<=se;)xe.push(null);return(xe[se]=xe[se]||[]).push(w),F}}return i&&(h.prototype=Object.create(i.prototype)),h.prototype.ngMetadataName=t,h.annotationCls=h,h})}function Un(t,n,i,a){return Fr(()=>{const h=En(n);function g(...w){if(this instanceof g)return h.apply(this,w),this;const C=new g(...w);return function(Z,se){const xe=Z.constructor,De=xe.hasOwnProperty(et)?xe[et]:Object.defineProperty(xe,et,{value:{}})[et];De[se]=De.hasOwnProperty(se)&&De[se]||[],De[se].unshift(C),a&&a(Z,se,...w)}}return i&&(g.prototype=Object.create(i.prototype)),g.prototype.ngMetadataName=t,g.annotationCls=g,g})}class Lr{constructor(n,i){this._desc=n,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof i?this.__NG_ELEMENT_ID__=i:void 0!==i&&(this.\u0275prov=yr({token:this,providedIn:i.providedIn||"root",factory:i.factory}))}toString(){return`InjectionToken ${this._desc}`}}const bo=new Lr("AnalyzeForEntryComponents"),pe=Function;function be(t,n){void 0===n&&(n=t);for(let i=0;i<t.length;i++){let a=t[i];Array.isArray(a)?(n===t&&(n=t.slice(0,i)),be(a,n)):n!==t&&n.push(a)}return n}function Re(t,n){t.forEach(i=>Array.isArray(i)?Re(i,n):n(i))}function $e(t,n,i){n>=t.length?t.push(i):t.splice(n,0,i)}function We(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function on(t,n,i){let a=vn(t,n);return a>=0?t[1|a]=i:(a=~a,function(t,n,i,a){let h=t.length;if(h==n)t.push(i,a);else if(1===h)t.push(a,t[0]),t[0]=i;else{for(h--,t.push(t[h-1],t[h]);h>n;)t[h]=t[h-2],h--;t[n]=i,t[n+1]=a}}(t,a,n,i)),a}function Cn(t,n){const i=vn(t,n);if(i>=0)return t[1|i]}function vn(t,n){return function(t,n,i){let a=0,h=t.length>>i;for(;h!==a;){const g=a+(h-a>>1),w=t[g<<i];if(n===w)return g<<i;w>n?h=g:a=g+1}return~(h<<i)}(t,n,1)}const is={},Vs="__NG_DI_FLAG__",Js="ngTempTokenPath",ai=/\n/gm,L="__source",v=Oe({provide:String,useValue:Oe});let I;function X(t){const n=I;return I=t,n}function fe(t,n=_t.Default){if(void 0===I)throw new Error("inject() must be called from an injection context");return null===I?xn(t,void 0,n):I.get(t,n&_t.Optional?null:void 0,n)}function Te(t,n=_t.Default){return(hn||fe)(Me(t),n)}function Ft(t){const n=[];for(let i=0;i<t.length;i++){const a=Me(t[i]);if(Array.isArray(a)){if(0===a.length)throw new Error("Arguments array must have arguments.");let h,g=_t.Default;for(let w=0;w<a.length;w++){const C=a[w],F=Fn(C);"number"==typeof F?-1===F?h=C.token:g|=F:h=C}n.push(Te(h,g))}else n.push(Te(a))}return n}function un(t,n){return t[Vs]=n,t.prototype[Vs]=n,t}function Fn(t){return t[Vs]}function or(t,n,i,a){const h=t[Js];throw n[L]&&h.unshift(n[L]),t.message=function(t,n,i,a=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let h=ke(n);if(Array.isArray(n))h=n.map(ke).join(" -> ");else if("object"==typeof n){let g=[];for(let w in n)if(n.hasOwnProperty(w)){let C=n[w];g.push(w+":"+("string"==typeof C?JSON.stringify(C):ke(C)))}h=`{${g.join(", ")}}`}return`${i}${a?"("+a+")":""}[${h}]: ${t.replace(ai,"\n  ")}`}("\n"+t.message,h,i,a),t.ngTokenPath=h,t[Js]=null,t}const cr=un(dr("Inject",t=>({token:t})),-1),Cr=un(dr("Optional"),8),vi=un(dr("SkipSelf"),4);let ys;function ss(t){var n;return(null===(n=function(){if(void 0===ys&&(ys=null,vr.trustedTypes))try{ys=vr.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch(t){}return ys}())||void 0===n?void 0:n.createHTML(t))||t}class nu{constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Wm extends nu{getTypeName(){return"HTML"}}class Xf extends nu{getTypeName(){return"Style"}}class ih extends nu{getTypeName(){return"Script"}}class Ol extends nu{getTypeName(){return"URL"}}class Ym extends nu{getTypeName(){return"ResourceURL"}}function wc(t){return t instanceof nu?t.changingThisBreaksApplicationSecurity:t}function Ms(t,n){const i=ti(t);if(null!=i&&i!==n){if("ResourceURL"===i&&"URL"===n)return!0;throw new Error(`Required a safe ${n}, got a ${i} (see https://g.co/ng/security#xss)`)}return i===n}function ti(t){return t instanceof nu&&t.getTypeName()||null}function _d(t){return new Wm(t)}function Qf(t){return new Xf(t)}function ru(t){return new ih(t)}function iu(t){return new Ol(t)}function sh(t){return new Ym(t)}class Jf{constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{const i=(new window.DOMParser).parseFromString(ss(n),"text/html").body;return null===i?this.inertDocumentHelper.getInertBodyElement(n):(i.removeChild(i.firstChild),i)}catch(i){return null}}}class Km{constructor(n){if(this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const i=this.inertDocument.createElement("html");this.inertDocument.appendChild(i);const a=this.inertDocument.createElement("body");i.appendChild(a)}}getInertBodyElement(n){const i=this.inertDocument.createElement("template");if("content"in i)return i.innerHTML=ss(n),i;const a=this.inertDocument.createElement("body");return a.innerHTML=ss(n),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(a),a}stripCustomNsAttrs(n){const i=n.attributes;for(let h=i.length-1;0<h;h--){const w=i.item(h).name;("xmlns:ns1"===w||0===w.indexOf("ns1:"))&&n.removeAttribute(w)}let a=n.firstChild;for(;a;)a.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(a),a=a.nextSibling}}const Xm=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Qm=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function su(t){return(t=String(t)).match(Xm)||t.match(Qm)?t:"unsafe:"+t}function Fl(t){const n={};for(const i of t.split(","))n[i]=!0;return n}function rc(...t){const n={};for(const i of t)for(const a in i)i.hasOwnProperty(a)&&(n[a]=!0);return n}const vd=Fl("area,br,col,hr,img,wbr"),np=Fl("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),ou=Fl("rp,rt"),bd=rc(vd,rc(np,Fl("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),rc(ou,Fl("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),rc(ou,np)),wd=Fl("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),jo=Fl("srcset"),Ed=rc(wd,jo,Fl("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Fl("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ng=Fl("script,style,template");class ah{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(n){let i=n.firstChild,a=!0;for(;i;)if(i.nodeType===Node.ELEMENT_NODE?a=this.startElement(i):i.nodeType===Node.TEXT_NODE?this.chars(i.nodeValue):this.sanitizedSomething=!0,a&&i.firstChild)i=i.firstChild;else for(;i;){i.nodeType===Node.ELEMENT_NODE&&this.endElement(i);let h=this.checkClobberedElement(i,i.nextSibling);if(h){i=h;break}i=this.checkClobberedElement(i,i.parentNode)}return this.buf.join("")}startElement(n){const i=n.nodeName.toLowerCase();if(!bd.hasOwnProperty(i))return this.sanitizedSomething=!0,!ng.hasOwnProperty(i);this.buf.push("<"),this.buf.push(i);const a=n.attributes;for(let h=0;h<a.length;h++){const g=a.item(h),w=g.name,C=w.toLowerCase();if(!Ed.hasOwnProperty(C)){this.sanitizedSomething=!0;continue}let F=g.value;wd[C]&&(F=su(F)),jo[C]&&(t=F,F=(t=String(t)).split(",").map(n=>su(n.trim())).join(", ")),this.buf.push(" ",w,'="',Cd(F),'"')}var t;return this.buf.push(">"),!0}endElement(n){const i=n.nodeName.toLowerCase();bd.hasOwnProperty(i)&&!vd.hasOwnProperty(i)&&(this.buf.push("</"),this.buf.push(i),this.buf.push(">"))}chars(n){this.buf.push(Cd(n))}checkClobberedElement(n,i){if(i&&(n.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${n.outerHTML}`);return i}}const ip=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,_u=/([^\#-~ |!])/g;function Cd(t){return t.replace(/&/g,"&amp;").replace(ip,function(n){return"&#"+(1024*(n.charCodeAt(0)-55296)+(n.charCodeAt(1)-56320)+65536)+";"}).replace(_u,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let Pu;function Td(t,n){let i=null;try{Pu=Pu||function(t){const n=new Km(t);return function(){try{return!!(new window.DOMParser).parseFromString(ss(""),"text/html")}catch(t){return!1}}()?new Jf(n):n}(t);let a=n?String(n):"";i=Pu.getInertBodyElement(a);let h=5,g=a;do{if(0===h)throw new Error("Failed to sanitize html because the input is unstable");h--,a=g,g=i.innerHTML,i=Pu.getInertBodyElement(a)}while(a!==g);return ss((new ah).sanitizeChildren(lh(i)||i))}finally{if(i){const a=lh(i)||i;for(;a.firstChild;)a.removeChild(a.firstChild)}}}function lh(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var Zi=(()=>((Zi=Zi||{})[Zi.NONE=0]="NONE",Zi[Zi.HTML=1]="HTML",Zi[Zi.STYLE=2]="STYLE",Zi[Zi.SCRIPT=3]="SCRIPT",Zi[Zi.URL=4]="URL",Zi[Zi.RESOURCE_URL=5]="RESOURCE_URL",Zi))();function Sd(t){const n=function(){const t=Jt();return t&&t[12]}();return n?n.sanitize(Zi.URL,t)||"":Ms(t,"URL")?wc(t):su(Xt(t))}const ch="__ngContext__";function vs(t,n){t[ch]=n}function Md(t){const n=function(t){return t[ch]||null}(t);return n?Array.isArray(n)?n:n.lView:null}function hh(t){return t.ngOriginalError}function hg(t,...n){t.error(...n)}class Ll{constructor(){this._console=console}handleError(n){const i=this._findOriginalError(n),a=this._findContext(n),h=(t=n)&&t.ngErrorLogger||hg;var t;h(this._console,"ERROR",n),i&&h(this._console,"ORIGINAL ERROR",i),a&&h(this._console,"ERROR CONTEXT",a)}_findContext(n){return n?n.ngDebugContext||this._findContext(hh(n)):null}_findOriginalError(n){let i=n&&hh(n);for(;i&&hh(i);)i=hh(i);return i||null}}const _p=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(vr))();function ic(t){return t instanceof Function?t():t}var sc=(()=>((sc=sc||{})[sc.Important=1]="Important",sc[sc.DashCase=2]="DashCase",sc))();function Fd(t,n){return undefined(t,n)}function oc(t){const n=t[3];return Fi(n)?n[3]:n}function gh(t){return Ep(t[13])}function _h(t){return Ep(t[4])}function Ep(t){for(;null!==t&&!Fi(t);)t=t[4];return t}function cl(t,n,i,a,h){if(null!=a){let g,w=!1;Fi(a)?g=a:Hr(a)&&(w=!0,a=a[0]);const C=Qt(a);0===t&&null!==i?null==h?Ud(n,i,C):lu(n,i,C,h||null,!0):1===t&&null!==i?lu(n,i,C,h||null,!0):2===t?function(t,n,i){const a=xh(t,n);a&&function(t,n,i,a){$(t)?t.removeChild(n,i,a):n.removeChild(i)}(t,a,n,i)}(n,C,w):3===t&&n.destroyNode(C),null!=g&&function(t,n,i,a,h){const g=i[7];g!==Qt(i)&&cl(n,t,a,g,h);for(let C=10;C<i.length;C++){const F=i[C];Ec(F[1],F,t,n,a,g)}}(n,t,g,i,h)}}function yh(t,n,i){return $(t)?t.createElement(n,i):null===i?t.createElement(n):t.createElementNS(i,n)}function Dp(t,n){const i=t[9],a=i.indexOf(n),h=n[3];1024&n[2]&&(n[2]&=-1025,Qa(h,-1)),i.splice(a,1)}function Bd(t,n){if(t.length<=10)return;const i=10+n,a=t[i];if(a){const h=a[17];null!==h&&h!==t&&Dp(h,a),n>0&&(t[i-1][4]=a[4]);const g=We(t,10+n);!function(t,n){Ec(t,n,n[11],2,null,null),n[0]=null,n[6]=null}(a[1],a);const w=g[19];null!==w&&w.detachView(g[1]),a[3]=null,a[4]=null,a[2]&=-129}return a}function Ap(t,n){if(!(256&n[2])){const i=n[11];$(i)&&i.destroyNode&&Ec(t,n,i,3,null,null),function(t){let n=t[13];if(!n)return Vd(t[1],t);for(;n;){let i=null;if(Hr(n))i=n[13];else{const a=n[10];a&&(i=a)}if(!i){for(;n&&!n[4]&&n!==t;)Hr(n)&&Vd(n[1],n),n=n[3];null===n&&(n=t),Hr(n)&&Vd(n[1],n),i=n&&n[4]}n=i}}(n)}}function Vd(t,n){if(!(256&n[2])){n[2]&=-129,n[2]|=256,function(t,n){let i;if(null!=t&&null!=(i=t.destroyHooks))for(let a=0;a<i.length;a+=2){const h=n[i[a]];if(!(h instanceof il)){const g=i[a+1];if(Array.isArray(g))for(let w=0;w<g.length;w+=2){const C=h[g[w]],F=g[w+1];try{F.call(C)}finally{}}else try{g.call(h)}finally{}}}}(t,n),function(t,n){const i=t.cleanup,a=n[7];let h=-1;if(null!==i)for(let g=0;g<i.length-1;g+=2)if("string"==typeof i[g]){const w=i[g+1],C="function"==typeof w?w(n):Qt(n[w]),F=a[h=i[g+2]],Z=i[g+3];"boolean"==typeof Z?C.removeEventListener(i[g],F,Z):Z>=0?a[h=Z]():a[h=-Z].unsubscribe(),g+=2}else{const w=a[h=i[g+1]];i[g].call(w)}if(null!==a){for(let g=h+1;g<a.length;g++)a[g]();n[7]=null}}(t,n),1===n[1].type&&$(n[11])&&n[11].destroy();const i=n[17];if(null!==i&&Fi(n[3])){i!==n[3]&&Dp(i,n);const a=n[19];null!==a&&a.detachView(t)}}}function Mp(t,n,i){return function(t,n,i){let a=n;for(;null!==a&&40&a.type;)a=(n=a).parent;if(null===a)return i[0];if(2&a.flags){const h=t.data[a.directiveStart].encapsulation;if(h===wn.None||h===wn.Emulated)return null}return oi(a,i)}(t,n.parent,i)}function lu(t,n,i,a,h){$(t)?t.insertBefore(n,i,a,h):n.insertBefore(i,a,h)}function Ud(t,n,i){$(t)?t.appendChild(n,i):n.appendChild(i)}function jd(t,n,i,a,h){null!==a?lu(t,n,i,a,h):Ud(t,n,i)}function xh(t,n){return $(t)?t.parentNode(n):n.parentNode}let $d=function(t,n,i){return 40&t.type?oi(t,i):null};function ja(t,n,i,a){const h=Mp(t,a,n),g=n[11],C=function(t,n,i){return $d(t,n,i)}(a.parent||n[6],a,n);if(null!=h)if(Array.isArray(i))for(let F=0;F<i.length;F++)jd(g,h,i[F],C,!1);else jd(g,h,i,C,!1)}function vu(t,n){if(null!==n){const i=n.type;if(3&i)return oi(n,t);if(4&i)return jc(-1,t[n.index]);if(8&i){const a=n.child;if(null!==a)return vu(t,a);{const h=t[n.index];return Fi(h)?jc(-1,h):Qt(h)}}if(32&i)return Fd(n,t)()||Qt(t[n.index]);{const a=Vu(t,n);return null!==a?Array.isArray(a)?a[0]:vu(oc(t[16]),a):vu(t,n.next)}}return null}function Vu(t,n){return null!==n?t[16][6].projection[n.projection]:null}function jc(t,n){const i=10+t+1;if(i<n.length){const a=n[i],h=a[1].firstChild;if(null!==h)return vu(a,h)}return n[7]}function Zd(t,n,i,a,h,g,w){for(;null!=i;){const C=a[i.index],F=i.type;if(w&&0===n&&(C&&vs(Qt(C),a),i.flags|=4),64!=(64&i.flags))if(8&F)Zd(t,n,i.child,a,h,g,!1),cl(n,t,h,C,g);else if(32&F){const Z=Fd(i,a);let se;for(;se=Z();)cl(n,t,h,se,g);cl(n,t,h,C,g)}else 16&F?Op(t,n,a,i,h,g):cl(n,t,h,C,g);i=w?i.projectionNext:i.next}}function Ec(t,n,i,a,h,g){Zd(i,a,t.firstChild,n,h,g,!1)}function Op(t,n,i,a,h,g){const w=i[16],F=w[6].projection[a.projection];if(Array.isArray(F))for(let Z=0;Z<F.length;Z++)cl(n,t,h,F[Z],g);else Zd(t,n,F,w[3],h,g,!0)}function xu(t,n,i){$(t)?t.setAttribute(n,"style",i):n.style.cssText=i}function li(t,n,i){$(t)?""===i?t.removeAttribute(n,"class"):t.setAttribute(n,"class",i):n.className=i}function bh(t,n,i){let a=t.length;for(;;){const h=t.indexOf(n,i);if(-1===h)return h;if(0===h||t.charCodeAt(h-1)<=32){const g=n.length;if(h+g===a||t.charCodeAt(h+g)<=32)return h}i=h+1}}const Hd="ng-template";function Cc(t,n,i){let a=0;for(;a<t.length;){let h=t[a++];if(i&&"class"===h){if(h=t[a],-1!==bh(h.toLowerCase(),n,0))return!0}else if(1===h){for(;a<t.length&&"string"==typeof(h=t[a++]);)if(h.toLowerCase()===n)return!0;return!1}}return!1}function cu(t){return 4===t.type&&t.value!==Hd}function Np(t,n,i){return n===(4!==t.type||i?t.value:Hd)}function wg(t,n,i){let a=4;const h=t.attrs||[],g=function(t){for(let n=0;n<t.length;n++)if(zo(t[n]))return n;return t.length}(h);let w=!1;for(let C=0;C<n.length;C++){const F=n[C];if("number"!=typeof F){if(!w)if(4&a){if(a=2|1&a,""!==F&&!Np(t,F,i)||""===F&&1===n.length){if(Nl(a))return!1;w=!0}}else{const Z=8&a?F:n[++C];if(8&a&&null!==t.attrs){if(!Cc(t.attrs,Z,i)){if(Nl(a))return!1;w=!0}continue}const xe=Eg(8&a?"class":F,h,cu(t),i);if(-1===xe){if(Nl(a))return!1;w=!0;continue}if(""!==Z){let De;De=xe>g?"":h[xe+1].toLowerCase();const Ye=8&a?De:null;if(Ye&&-1!==bh(Ye,Z,0)||2&a&&Z!==De){if(Nl(a))return!1;w=!0}}}}else{if(!w&&!Nl(a)&&!Nl(F))return!1;if(w&&Nl(F))continue;w=!1,a=F|1&a}}return Nl(a)||w}function Nl(t){return 0==(1&t)}function Eg(t,n,i,a){if(null===n)return-1;let h=0;if(a||!i){let g=!1;for(;h<n.length;){const w=n[h];if(w===t)return h;if(3===w||6===w)g=!0;else{if(1===w||2===w){let C=n[++h];for(;"string"==typeof C;)C=n[++h];continue}if(4===w)break;if(0===w){h+=4;continue}}h+=g?1:2}return-1}return function(t,n){let i=t.indexOf(4);if(i>-1)for(i++;i<t.length;){const a=t[i];if("number"==typeof a)return-1;if(a===n)return i;i++}return-1}(n,t)}function zp(t,n,i=!1){for(let a=0;a<n.length;a++)if(wg(t,n[a],i))return!0;return!1}function Bp(t,n){return t?":not("+n.trim()+")":n}function wh(t){let n=t[0],i=1,a=2,h="",g=!1;for(;i<t.length;){let w=t[i];if("string"==typeof w)if(2&a){const C=t[++i];h+="["+w+(C.length>0?'="'+C+'"':"")+"]"}else 8&a?h+="."+w:4&a&&(h+=" "+w);else""!==h&&!Nl(w)&&(n+=Bp(g,h),h=""),a=w,g=g||!Nl(a);i++}return""!==h&&(n+=Bp(g,h)),n}const Tr={};function Up(t){jp(Rr(),Jt(),rs()+t,Ia())}function jp(t,n,i,a){if(!a)if(3==(3&n[2])){const g=t.preOrderCheckHooks;null!==g&&Xo(n,g,i)}else{const g=t.preOrderHooks;null!==g&&Fa(n,g,0,i)}Os(i)}function wu(t,n){return t<<17|n<<2}function $a(t){return t>>17&32767}function uu(t){return 2|t}function wa(t){return(131068&t)>>2}function Uu(t,n){return-131069&t|n<<2}function Wd(t){return 1|t}function lf(t,n){const i=t.contentQueries;if(null!==i)for(let a=0;a<i.length;a+=2){const h=i[a],g=i[a+1];if(-1!==g){const w=t.data[g];Pa(h),w.contentQueries(2,n[g],g)}}}function du(t,n,i,a,h,g,w,C,F,Z){const se=n.blueprint.slice();return se[0]=h,se[2]=140|a,ko(se),se[3]=se[15]=t,se[8]=i,se[10]=w||t&&t[10],se[11]=C||t&&t[11],se[12]=F||t&&t[12]||null,se[9]=Z||t&&t[9]||null,se[6]=g,se[16]=2==n.type?t[16]:se,se}function Cu(t,n,i,a,h){let g=t.data[n];if(null===g)g=function(t,n,i,a,h){const g=Oo(),w=Fo(),F=t.data[n]=function(t,n,i,a,h,g){return{type:i,index:a,insertBeforeIndex:null,injectorIndex:n?n.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:h,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,w?g:g&&g.parent,i,n,a,h);return null===t.firstChild&&(t.firstChild=F),null!==g&&(w?null==g.child&&null!==F.parent&&(g.child=F):null===g.next&&(g.next=F)),F}(t,n,i,a,h),nr.lFrame.inI18n&&(g.flags|=64);else if(64&g.type){g.type=i,g.value=a,g.attrs=h;const w=function(){const t=nr.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}();g.injectorIndex=null===w?-1:w.injectorIndex}return ns(g,!0),g}function Tu(t,n,i,a){if(0===i)return-1;const h=n.length;for(let g=0;g<i;g++)n.push(a),t.blueprint.push(a),t.data.push(null);return h}function Hc(t,n,i){_a(n);try{const a=t.viewQuery;null!==a&&Wc(1,a,i);const h=t.template;null!==h&&Th(t,n,h,1,i),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&lf(t,n),t.staticViewQueries&&Wc(2,t.viewQuery,i);const g=t.components;null!==g&&function(t,n){for(let i=0;i<n.length;i++)am(t,n[i])}(n,g)}catch(a){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),a}finally{n[2]&=-5,bl()}}function qc(t,n,i,a){const h=n[2];if(256==(256&h))return;_a(n);const g=Ia();try{ko(n),function(t){nr.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==i&&Th(t,n,i,2,a);const w=3==(3&h);if(!g)if(w){const Z=t.preOrderCheckHooks;null!==Z&&Xo(n,Z,null)}else{const Z=t.preOrderHooks;null!==Z&&Fa(n,Z,0,null),$i(n,0)}if(function(t){for(let n=gh(t);null!==n;n=_h(n)){if(!n[2])continue;const i=n[9];for(let a=0;a<i.length;a++){const h=i[a],g=h[3];0==(1024&h[2])&&Qa(g,1),h[2]|=1024}}}(n),function(t){for(let n=gh(t);null!==n;n=_h(n))for(let i=10;i<n.length;i++){const a=n[i],h=a[1];Po(a)&&qc(h,a,h.template,a[8])}}(n),null!==t.contentQueries&&lf(t,n),!g)if(w){const Z=t.contentCheckHooks;null!==Z&&Xo(n,Z)}else{const Z=t.contentHooks;null!==Z&&Fa(n,Z,1),$i(n,1)}!function(t,n){const i=t.hostBindingOpCodes;if(null!==i)try{for(let a=0;a<i.length;a++){const h=i[a];if(h<0)Os(~h);else{const g=h,w=i[++a],C=i[++a];vo(w,g),C(2,n[g])}}}finally{Os(-1)}}(t,n);const C=t.components;null!==C&&function(t,n){for(let i=0;i<n.length;i++)Hg(t,n[i])}(n,C);const F=t.viewQuery;if(null!==F&&Wc(2,F,a),!g)if(w){const Z=t.viewCheckHooks;null!==Z&&Xo(n,Z)}else{const Z=t.viewHooks;null!==Z&&Fa(n,Z,2),$i(n,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),g||(n[2]&=-73),1024&n[2]&&(n[2]&=-1025,Qa(n[3],-1))}finally{bl()}}function Ug(t,n,i,a){const h=n[10],g=!Ia(),w=lo(n);try{g&&!w&&h.begin&&h.begin(),w&&Hc(t,n,a),qc(t,n,i,a)}finally{g&&!w&&h.end&&h.end()}}function Th(t,n,i,a,h){const g=rs(),w=2&a;try{Os(-1),w&&n.length>20&&jp(t,n,20,Ia()),i(a,h)}finally{Os(g)}}function Sh(t,n,i){if(Ki(n)){const h=n.directiveEnd;for(let g=n.directiveStart;g<h;g++){const w=t.data[g];w.contentQueries&&w.contentQueries(1,i[g],g)}}}function lc(t,n,i){!yl()||(function(t,n,i,a){const h=i.directiveStart,g=i.directiveEnd;t.firstCreatePass||Na(i,n),vs(a,n);const w=i.initialInputs;for(let C=h;C<g;C++){const F=t.data[C],Z=qr(F);Z&&sm(n,i,F);const se=ra(n,t,C,i);vs(se,n),null!==w&&aa(0,C-h,se,F,0,w),Z&&(Mi(i.index,n)[8]=se)}}(t,n,i,oi(i,n)),128==(128&i.flags)&&function(t,n,i){const a=i.directiveStart,h=i.directiveEnd,w=i.index,C=nr.lFrame.currentDirectiveIndex;try{Os(w);for(let F=a;F<h;F++){const Z=t.data[F],se=n[F];uo(F),(null!==Z.hostBindings||0!==Z.hostVars||null!==Z.hostAttrs)&&Rh(Z,se)}}finally{Os(-1),uo(C)}}(t,n,i))}function uf(t,n,i=oi){const a=n.localNames;if(null!==a){let h=n.index+1;for(let g=0;g<a.length;g+=2){const w=a[g+1],C=-1===w?i(n,t):t[w];t[h++]=C}}}function Dh(t){const n=t.tView;return null===n||n.incompleteFirstPass?t.tView=Hu(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):n}function Hu(t,n,i,a,h,g,w,C,F,Z){const se=20+a,xe=se+h,De=function(t,n){const i=[];for(let a=0;a<n;a++)i.push(a<t?null:Tr);return i}(se,xe),Ye="function"==typeof Z?Z():Z;return De[1]={type:t,blueprint:De,template:i,queries:null,viewQuery:C,declTNode:n,data:De.slice().fill(null,se),bindingStartIndex:se,expandoStartIndex:xe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof g?g():g,pipeRegistry:"function"==typeof w?w():w,firstChild:null,schemas:F,consts:Ye,incompleteFirstPass:!1}}function Xp(t,n,i,a){const h=Bl(n);null===i?h.push(a):(h.push(i),t.firstCreatePass&&Bh(t).push(a,h.length-1))}function Qp(t,n,i){for(let a in t)if(t.hasOwnProperty(a)){const h=t[a];(i=null===i?{}:i).hasOwnProperty(a)?i[a].push(n,h):i[a]=[n,h]}return i}function Ea(t,n,i,a,h,g,w,C){const F=oi(n,i);let se,Z=n.inputs;!C&&null!=Z&&(se=Z[a])?(Yc(t,i,se,a,h),Li(n)&&function(t,n){const i=Mi(n,t);16&i[2]||(i[2]|=64)}(i,n.index)):3&n.type&&(a=function(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(a),h=null!=w?w(h,n.value||"",a):h,$(g)?g.setProperty(F,a,h):ya(a)||(F.setProperty?F.setProperty(a,h):F[a]=h))}function Ih(t,n,i,a){let h=!1;if(yl()){const g=function(t,n,i){const a=t.directiveRegistry;let h=null;if(a)for(let g=0;g<a.length;g++){const w=a[g];zp(i,w.selectors,!1)&&(h||(h=[]),ol(Na(i,n),t,w.type),qr(w)?(kh(t,i),h.unshift(w)):h.push(w))}return h}(t,n,i),w=null===a?null:{"":-1};if(null!==g){h=!0,gf(i,t.data.length,g.length);for(let se=0;se<g.length;se++){const xe=g[se];xe.providersResolver&&xe.providersResolver(xe)}let C=!1,F=!1,Z=Tu(t,n,g.length,null);for(let se=0;se<g.length;se++){const xe=g[se];i.mergedAttrs=Fs(i.mergedAttrs,xe.hostAttrs),im(t,i,n,Z,xe),$g(Z,xe,w),null!==xe.contentQueries&&(i.flags|=8),(null!==xe.hostBindings||null!==xe.hostAttrs||0!==xe.hostVars)&&(i.flags|=128);const De=xe.type.prototype;!C&&(De.ngOnChanges||De.ngOnInit||De.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(i.index),C=!0),!F&&(De.ngOnChanges||De.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(i.index),F=!0),Z++}!function(t,n){const a=n.directiveEnd,h=t.data,g=n.attrs,w=[];let C=null,F=null;for(let Z=n.directiveStart;Z<a;Z++){const se=h[Z],xe=se.inputs,De=null===g||cu(n)?null:qu(xe,g);w.push(De),C=Qp(xe,Z,C),F=Qp(se.outputs,Z,F)}null!==C&&(C.hasOwnProperty("class")&&(n.flags|=16),C.hasOwnProperty("style")&&(n.flags|=32)),n.initialInputs=w,n.inputs=C,n.outputs=F}(t,i)}w&&function(t,n,i){if(n){const a=t.localNames=[];for(let h=0;h<n.length;h+=2){const g=i[n[h+1]];if(null==g)throw new Ht("301",`Export of name '${n[h+1]}' not found!`);a.push(n[h],g)}}}(i,a,w)}return i.mergedAttrs=Fs(i.mergedAttrs,i.attrs),h}function pf(t,n,i,a,h,g){const w=g.hostBindings;if(w){let C=t.hostBindingOpCodes;null===C&&(C=t.hostBindingOpCodes=[]);const F=~n.index;(function(t){let n=t.length;for(;n>0;){const i=t[--n];if("number"==typeof i&&i<0)return i}return 0})(C)!=F&&C.push(F),C.push(a,h,w)}}function Rh(t,n){null!==t.hostBindings&&t.hostBindings(1,n)}function kh(t,n){n.flags|=2,(t.components||(t.components=[])).push(n.index)}function $g(t,n,i){if(i){if(n.exportAs)for(let a=0;a<n.exportAs.length;a++)i[n.exportAs[a]]=t;qr(n)&&(i[""]=t)}}function gf(t,n,i){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+i,t.providerIndexes=n}function im(t,n,i,a,h){t.data[a]=h;const g=h.factory||(h.factory=Cs(h.type)),w=new il(g,qr(h),null);t.blueprint[a]=w,i[a]=w,pf(t,n,0,a,Tu(t,i,h.hostVars,Tr),h)}function sm(t,n,i){const a=oi(n,t),h=Dh(i),g=t[10],w=Wu(t,du(t,h,null,i.onPush?64:16,a,n,g,g.createRenderer(a,i),null,null));t[n.index]=w}function ul(t,n,i,a,h,g){const w=oi(t,n);!function(t,n,i,a,h,g,w){if(null==g)$(t)?t.removeAttribute(n,h,i):n.removeAttribute(h);else{const C=null==w?Xt(g):w(g,a||"",h);$(t)?t.setAttribute(n,h,C,i):i?n.setAttributeNS(i,h,C):n.setAttribute(h,C)}}(n[11],w,g,t.value,i,a,h)}function aa(t,n,i,a,h,g){const w=g[n];if(null!==w){const C=a.setInput;for(let F=0;F<w.length;){const Z=w[F++],se=w[F++],xe=w[F++];null!==C?a.setInput(i,xe,Z,se):i[se]=xe}}}function qu(t,n){let i=null,a=0;for(;a<n.length;){const h=n[a];if(0!==h)if(5!==h){if("number"==typeof h)break;t.hasOwnProperty(h)&&(null===i&&(i=[]),i.push(h,t[h],n[a+1])),a+=2}else a+=2;else a+=4}return i}function _f(t,n,i,a){return new Array(t,!0,!1,n,null,0,a,i,null,null)}function Hg(t,n){const i=Mi(n,t);if(Po(i)){const a=i[1];80&i[2]?qc(a,i,a.template,i[8]):i[5]>0&&Fh(i)}}function Fh(t){for(let a=gh(t);null!==a;a=_h(a))for(let h=10;h<a.length;h++){const g=a[h];if(1024&g[2]){const w=g[1];qc(w,g,w.template,g[8])}else g[5]>0&&Fh(g)}const i=t[1].components;if(null!==i)for(let a=0;a<i.length;a++){const h=Mi(i[a],t);Po(h)&&h[5]>0&&Fh(h)}}function am(t,n){const i=Mi(n,t),a=i[1];(function(t,n){for(let i=n.length;i<t.blueprint.length;i++)n.push(t.blueprint[i])})(a,i),Hc(a,i,i[8])}function Wu(t,n){return t[13]?t[14][4]=n:t[13]=n,t[14]=n,n}function Lh(t){for(;t;){t[2]|=64;const n=oc(t);if(ts(t)&&!n)return t;t=n}return null}function cc(t,n,i){const a=n[10];a.begin&&a.begin();try{qc(t,n,t.template,i)}catch(h){throw hl(n,h),h}finally{a.end&&a.end()}}function yf(t){!function(t){for(let n=0;n<t.components.length;n++){const i=t.components[n],a=Md(i),h=a[1];Ug(h,a,h.template,i)}}(t[8])}function Wc(t,n,i){Pa(0),n(t,i)}const vf=(()=>Promise.resolve(null))();function Bl(t){return t[7]||(t[7]=[])}function Bh(t){return t.cleanup||(t.cleanup=[])}function hl(t,n){const i=t[9],a=i?i.get(Ll,null):null;a&&a.handleError(n)}function Yc(t,n,i,a,h){for(let g=0;g<i.length;){const w=i[g++],C=i[g++],F=n[w],Z=t.data[w];null!==Z.setInput?Z.setInput(F,h,a,C):F[C]=h}}function uc(t,n,i){const a=Ai(n,t);!function(t,n,i){$(t)?t.setValue(n,i):n.textContent=i}(t[11],a,i)}function Yu(t,n,i){let a=i?t.styles:null,h=i?t.classes:null,g=0;if(null!==n)for(let w=0;w<n.length;w++){const C=n[w];"number"==typeof C?g=C:1==g?h=lt(h,C):2==g&&(a=lt(a,C+": "+n[++w]+";"))}i?t.styles=a:t.stylesWithoutHost=a,i?t.classes=h:t.classesWithoutHost=h}const Au=new Lr("INJECTOR",-1);class xf{get(n,i=is){if(i===is){const a=new Error(`NullInjectorError: No provider for ${ke(n)}!`);throw a.name="NullInjectorError",a}return i}}const Ku=new Lr("Set Injector scope."),fu={},dm={};let jh;function s(){return void 0===jh&&(jh=new xf),jh}function o(t,n=null,i=null,a){return new l(t,i,n||s(),a)}class l{constructor(n,i,a,h=null){this.parent=a,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const g=[];i&&Re(i,C=>this.processProvider(C,n,i)),Re([n],C=>this.processInjectorType(C,[],g)),this.records.set(Au,T(void 0,this));const w=this.records.get(Ku);this.scope=null!=w?w.value:null,this.source=h||("object"==typeof n?null:ke(n))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(n=>n.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(n,i=is,a=_t.Default){this.assertNotDestroyed();const h=X(this),g=_n(void 0);try{if(!(a&_t.SkipSelf)){let C=this.records.get(n);if(void 0===C){const F=("function"==typeof(t=n)||"object"==typeof t&&t instanceof Lr)&&$r(n);C=F&&this.injectableDefInScope(F)?T(d(n),fu):null,this.records.set(n,C)}if(null!=C)return this.hydrate(n,C)}return(a&_t.Self?s():this.parent).get(n,i=a&_t.Optional&&i===is?null:i)}catch(w){if("NullInjectorError"===w.name){if((w[Js]=w[Js]||[]).unshift(ke(n)),h)throw w;return or(w,n,"R3InjectorError",this.source)}throw w}finally{_n(g),X(h)}var t}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(n=>this.get(n))}toString(){const n=[];return this.records.forEach((a,h)=>n.push(ke(h))),`R3Injector[${n.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(n,i,a){if(!(n=Me(n)))return!1;let h=Ui(n);const g=null==h&&n.ngModule||void 0,w=void 0===g?n:g,C=-1!==a.indexOf(w);if(void 0!==g&&(h=Ui(g)),null==h)return!1;if(null!=h.imports&&!C){let se;a.push(w);try{Re(h.imports,xe=>{this.processInjectorType(xe,i,a)&&(void 0===se&&(se=[]),se.push(xe))})}finally{}if(void 0!==se)for(let xe=0;xe<se.length;xe++){const{ngModule:De,providers:Ye}=se[xe];Re(Ye,ht=>this.processProvider(ht,De,Ye||lr))}}this.injectorDefTypes.add(w);const F=Cs(w)||(()=>new w);this.records.set(w,T(F,fu));const Z=h.providers;if(null!=Z&&!C){const se=n;Re(Z,xe=>this.processProvider(xe,se,Z))}return void 0!==g&&void 0!==n.providers}processProvider(n,i,a){let h=Y(n=Me(n))?n:Me(n&&n.provide);const g=O(t=n)?T(void 0,t.useValue):T(E(t),fu);var t;if(Y(n)||!0!==n.multi)this.records.get(h);else{let w=this.records.get(h);w||(w=T(void 0,fu,!0),w.factory=()=>Ft(w.multi),this.records.set(h,w)),h=n,w.multi.push(n)}this.records.set(h,g)}hydrate(n,i){return i.value===fu&&(i.value=dm,i.value=i.factory()),"object"==typeof i.value&&i.value&&null!==(t=i.value)&&"object"==typeof t&&"function"==typeof t.ngOnDestroy&&this.onDestroy.add(i.value),i.value;var t}injectableDefInScope(n){if(!n.providedIn)return!1;const i=Me(n.providedIn);return"string"==typeof i?"any"===i||i===this.scope:this.injectorDefTypes.has(i)}}function d(t){const n=$r(t),i=null!==n?n.factory:Cs(t);if(null!==i)return i;if(t instanceof Lr)throw new Error(`Token ${ke(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const n=t.length;if(n>0){const a=function(t,n){const i=[];for(let a=0;a<t;a++)i.push(n);return i}(n,"?");throw new Error(`Can't resolve all parameters for ${ke(t)}: (${a.join(", ")}).`)}const i=function(t){const n=t&&(t[Tt]||t[nt]);if(n){const i=function(t){if(t.hasOwnProperty("name"))return t.name;const n=(""+t).match(/^function\s*([^\s(]+)/);return null===n?"":n[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${i}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${i}" class.`),n}return null}(t);return null!==i?()=>i.factory(t):()=>new t}(t);throw new Error("unreachable")}function E(t,n,i){let a;if(Y(t)){const h=Me(t);return Cs(h)||d(h)}if(O(t))a=()=>Me(t.useValue);else if(function(t){return!(!t||!t.useFactory)}(t))a=()=>t.useFactory(...Ft(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))a=()=>Te(Me(t.useExisting));else{const h=Me(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return Cs(h)||d(h);a=()=>new h(...Ft(t.deps))}return a}function T(t,n,i=!1){return{factory:t,value:n,multi:i?[]:void 0}}function O(t){return null!==t&&"object"==typeof t&&v in t}function Y(t){return"function"==typeof t}const xt=function(t,n,i){return function(t,n=null,i=null,a){const h=o(t,n,i,a);return h._resolveInjectorDefTypes(),h}({name:i},n,t,i)};let ut=(()=>{class t{static create(i,a){return Array.isArray(i)?xt(i,a,""):xt(i.providers,i.parent,i.name||"")}}return t.THROW_IF_NOT_FOUND=is,t.NULL=new xf,t.\u0275prov=yr({token:t,providedIn:"any",factory:()=>Te(Au)}),t.__NG_ELEMENT_ID__=-1,t})();function hc(t,n){ms(Md(t)[1],gi())}function Tc(t){let n=function(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),i=!0;const a=[t];for(;n;){let h;if(qr(t))h=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Error("Directives cannot inherit Components");h=n.\u0275dir}if(h){if(i){a.push(h);const w=t;w.inputs=pu(t.inputs),w.declaredInputs=pu(t.declaredInputs),w.outputs=pu(t.outputs);const C=h.hostBindings;C&&Kc(t,C);const F=h.viewQuery,Z=h.contentQueries;if(F&&bf(t,F),Z&&wf(t,Z),Ne(t.inputs,h.inputs),Ne(t.declaredInputs,h.declaredInputs),Ne(t.outputs,h.outputs),qr(h)&&h.data.animation){const se=t.data;se.animation=(se.animation||[]).concat(h.data.animation)}}const g=h.features;if(g)for(let w=0;w<g.length;w++){const C=g[w];C&&C.ngInherit&&C(t),C===Tc&&(i=!1)}}n=Object.getPrototypeOf(n)}!function(t){let n=0,i=null;for(let a=t.length-1;a>=0;a--){const h=t[a];h.hostVars=n+=h.hostVars,h.hostAttrs=Fs(h.hostAttrs,i=Fs(i,h.hostAttrs))}}(a)}function pu(t){return t===qi?{}:t===lr?[]:t}function bf(t,n){const i=t.viewQuery;t.viewQuery=i?(a,h)=>{n(a,h),i(a,h)}:n}function wf(t,n){const i=t.contentQueries;t.contentQueries=i?(a,h,g)=>{n(a,h,g),i(a,h,g)}:n}function Kc(t,n){const i=t.hostBindings;t.hostBindings=i?(a,h)=>{n(a,h),i(a,h)}:n}let To=null;function dc(){if(!To){const t=vr.Symbol;if(t&&t.iterator)To=t.iterator;else{const n=Object.getOwnPropertyNames(Map.prototype);for(let i=0;i<n.length;++i){const a=n[i];"entries"!==a&&"size"!==a&&Map.prototype[a]===Map.prototype.entries&&(To=a)}}}return To}class pl{constructor(n){this.wrapped=n}static wrap(n){return new pl(n)}static unwrap(n){return pl.isWrapped(n)?n.wrapped:n}static isWrapped(n){return n instanceof pl}}function Ul(t){return!!Kg(t)&&(Array.isArray(t)||!(t instanceof Map)&&dc()in t)}function Kg(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Xc(t,n,i){return t[n]=i}function Ta(t,n,i){return!Object.is(t[n],i)&&(t[n]=i,!0)}function Xu(t,n,i,a){const h=Ta(t,n,i);return Ta(t,n+1,a)||h}function Xg(t,n,i,a){const h=Jt();return Ta(h,Ss(),n)&&(Rr(),ul(bi(),h,t,n,i,a)),Xg}function Zh(t,n,i,a){return Ta(t,Ss(),i)?n+Xt(i)+a:Tr}function Uy(t,n,i,a,h,g,w,C){const F=Jt(),Z=Rr(),se=t+20,xe=Z.firstCreatePass?function(t,n,i,a,h,g,w,C,F){const Z=n.consts,se=Cu(n,t,4,w||null,Ro(Z,C));Ih(n,i,se,Ro(Z,F)),ms(n,se);const xe=se.tViews=Hu(2,se,a,h,g,n.directiveRegistry,n.pipeRegistry,null,n.schemas,Z);return null!==n.queries&&(n.queries.template(n,se),xe.queries=n.queries.embeddedTView(se)),se}(se,Z,F,n,i,a,h,g,w):Z.data[se];ns(xe,!1);const De=F[11].createComment("");ja(Z,F,De,xe),vs(De,F),Wu(F,F[se]=_f(De,F,De,xe)),Hs(xe)&&lc(Z,F,xe),null!=w&&uf(F,xe,C)}function jy(t){return Mr(nr.lFrame.contextLView,20+t)}function Tf(t,n=_t.Default){const i=Jt();return null===i?Te(t,n):za(gi(),i,Me(t),n)}function n_(t,n,i){const a=Jt();return Ta(a,Ss(),n)&&Ea(Rr(),bi(),a,t,n,a[11],i,!1),n_}function r_(t,n,i,a,h){const w=h?"class":"style";Yc(t,i,n.inputs[w],w,a)}function i_(t,n,i,a){const h=Jt(),g=Rr(),w=20+t,C=h[11],F=h[w]=yh(C,n,nr.lFrame.currentNamespace),Z=g.firstCreatePass?function(t,n,i,a,h,g,w){const C=n.consts,Z=Cu(n,t,2,h,Ro(C,g));return Ih(n,i,Z,Ro(C,w)),null!==Z.attrs&&Yu(Z,Z.attrs,!1),null!==Z.mergedAttrs&&Yu(Z,Z.mergedAttrs,!0),null!==n.queries&&n.queries.elementStart(n,Z),Z}(w,g,h,0,n,i,a):g.data[w];ns(Z,!0);const se=Z.mergedAttrs;null!==se&&No(C,F,se);const xe=Z.classes;null!==xe&&li(C,F,xe);const De=Z.styles;null!==De&&xu(C,F,De),64!=(64&Z.flags)&&ja(g,h,F,Z),0===nr.lFrame.elementDepthCount&&vs(F,h),nr.lFrame.elementDepthCount++,Hs(Z)&&(lc(g,h,Z),Sh(g,Z,h)),null!==a&&uf(h,Z)}function s_(){let t=gi();Fo()?ga():(t=t.parent,ns(t,!1));const n=t;nr.lFrame.elementDepthCount--;const i=Rr();i.firstCreatePass&&(ms(i,t),Ki(t)&&i.queries.elementEnd(t)),null!=n.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(n)&&r_(i,n,Jt(),n.classesWithoutHost,!0),null!=n.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(n)&&r_(i,n,Jt(),n.stylesWithoutHost,!1)}function ev(t,n,i,a){i_(t,n,i,a),s_()}function o_(t,n,i){const a=Jt(),h=Rr(),g=t+20,w=h.firstCreatePass?function(t,n,i,a,h){const g=n.consts,w=Ro(g,a),C=Cu(n,t,8,"ng-container",w);return null!==w&&Yu(C,w,!0),Ih(n,i,C,Ro(g,h)),null!==n.queries&&n.queries.elementStart(n,C),C}(g,h,a,n,i):h.data[g];ns(w,!0);const C=a[g]=a[11].createComment("");ja(h,a,C,w),vs(C,a),Hs(w)&&(lc(h,a,w),Sh(h,w,a)),null!=i&&uf(a,w)}function a_(){let t=gi();const n=Rr();Fo()?ga():(t=t.parent,ns(t,!1)),n.firstCreatePass&&(ms(n,t),Ki(t)&&n.queries.elementEnd(t))}function tv(t,n,i){o_(t,n,i),a_()}function nv(){return Jt()}function l_(t){return!!t&&"function"==typeof t.then}function rv(t){return!!t&&"function"==typeof t.subscribe}const c_=rv;function u_(t,n,i,a){const h=Jt(),g=Rr(),w=gi();return function(t,n,i,a,h,g,w,C){const F=Hs(a),se=t.firstCreatePass&&Bh(t),xe=n[8],De=Bl(n);let Ye=!0;if(3&a.type||C){const wt=oi(a,n),pn=C?C(wt):wt,Zt=De.length,Wn=C?wr=>C(Qt(wr[a.index])):a.index;if($(i)){let wr=null;if(!C&&F&&(wr=function(t,n,i,a){const h=t.cleanup;if(null!=h)for(let g=0;g<h.length-1;g+=2){const w=h[g];if(w===i&&h[g+1]===a){const C=n[7],F=h[g+2];return C.length>F?C[F]:null}"string"==typeof w&&(g+=2)}return null}(t,n,h,a.index)),null!==wr)(wr.__ngLastListenerFn__||wr).__ngNextListenerFn__=g,wr.__ngLastListenerFn__=g,Ye=!1;else{g=h_(a,n,xe,g,!1);const Qr=i.listen(pn,h,g);De.push(g,Qr),se&&se.push(h,Wn,Zt,Zt+1)}}else g=h_(a,n,xe,g,!0),pn.addEventListener(h,g,w),De.push(g),se&&se.push(h,Wn,Zt,w)}else g=h_(a,n,xe,g,!1);const ht=a.outputs;let It;if(Ye&&null!==ht&&(It=ht[h])){const wt=It.length;if(wt)for(let pn=0;pn<wt;pn+=2){const Do=n[It[pn]][It[pn+1]].subscribe(g),gc=De.length;De.push(g,Do),se&&se.push(h,a.index,gc,-(gc+1))}}}(g,h,h[11],w,t,n,!!i,a),u_}function ov(t,n,i,a){try{return!1!==i(a)}catch(h){return hl(t,h),!1}}function h_(t,n,i,a,h){return function g(w){if(w===Function)return a;const C=2&t.flags?Mi(t.index,n):n;0==(32&n[2])&&Lh(C);let F=ov(n,0,a,w),Z=g.__ngNextListenerFn__;for(;Z;)F=ov(n,0,Z,w)&&F,Z=Z.__ngNextListenerFn__;return h&&!1===F&&(w.preventDefault(),w.returnValue=!1),F}}function av(t=1){return function(t){return(nr.lFrame.contextLView=function(t,n){for(;t>0;)n=n[15],t--;return n}(t,nr.lFrame.contextLView))[8]}(t)}function d_(t,n,i){return mm(t,"",n,"",i),d_}function mm(t,n,i,a,h){const g=Jt(),w=Zh(g,n,i,a);return w!==Tr&&Ea(Rr(),bi(),g,t,w,g[11],h,!1),mm}function gv(t,n,i,a,h){const g=t[i+1],w=null===n;let C=a?$a(g):wa(g),F=!1;for(;0!==C&&(!1===F||w);){const se=t[C+1];x1(t[C],n)&&(F=!0,t[C+1]=a?Wd(se):uu(se)),C=a?$a(se):wa(se)}F&&(t[i+1]=a?uu(g):Wd(g))}function x1(t,n){return null===t||null==n||(Array.isArray(t)?t[1]:t)===n||!(!Array.isArray(t)||"string"!=typeof n)&&vn(t,n)>=0}function f_(t,n){return function(t,n,i,a){const h=Jt(),g=Rr(),w=co(2);g.firstUpdatePass&&function(t,n,i,a){const h=t.data;if(null===h[i+1]){const g=h[rs()],w=function(t,n){return n>=t.expandoStartIndex}(t,i);(function(t,n){return 0!=(t.flags&(n?16:32))})(g,a)&&null===n&&!w&&(n=!1),n=function(t,n,i,a){const h=function(t){const n=nr.lFrame.currentDirectiveIndex;return-1===n?null:t[n]}(t);let g=a?n.residualClasses:n.residualStyles;if(null===h)0===(a?n.classBindings:n.styleBindings)&&(i=Sf(i=p_(null,t,n,i,a),n.attrs,a),g=null);else{const w=n.directiveStylingLast;if(-1===w||t[w]!==h)if(i=p_(h,t,n,i,a),null===g){let F=function(t,n,i){const a=i?n.classBindings:n.styleBindings;if(0!==wa(a))return t[$a(a)]}(t,n,a);void 0!==F&&Array.isArray(F)&&(F=p_(null,t,n,F[1],a),F=Sf(F,n.attrs,a),function(t,n,i,a){t[$a(i?n.classBindings:n.styleBindings)]=a}(t,n,a,F))}else g=function(t,n,i){let a;const h=n.directiveEnd;for(let g=1+n.directiveStylingLast;g<h;g++)a=Sf(a,t[g].hostAttrs,i);return Sf(a,n.attrs,i)}(t,n,a)}return void 0!==g&&(a?n.residualClasses=g:n.residualStyles=g),i}(h,g,n,a),function(t,n,i,a,h,g){let w=g?n.classBindings:n.styleBindings,C=$a(w),F=wa(w);t[a]=i;let se,Z=!1;if(Array.isArray(i)){const xe=i;se=xe[1],(null===se||vn(xe,se)>0)&&(Z=!0)}else se=i;if(h)if(0!==F){const De=$a(t[C+1]);t[a+1]=wu(De,C),0!==De&&(t[De+1]=Uu(t[De+1],a)),t[C+1]=function(t,n){return 131071&t|n<<17}(t[C+1],a)}else t[a+1]=wu(C,0),0!==C&&(t[C+1]=Uu(t[C+1],a)),C=a;else t[a+1]=wu(F,0),0===C?C=a:t[F+1]=Uu(t[F+1],a),F=a;Z&&(t[a+1]=uu(t[a+1])),gv(t,se,a,!0),gv(t,se,a,!1),function(t,n,i,a,h){const g=h?t.residualClasses:t.residualStyles;null!=g&&"string"==typeof n&&vn(g,n)>=0&&(i[a+1]=Wd(i[a+1]))}(n,se,t,a,g),w=wu(C,F),g?n.classBindings=w:n.styleBindings=w}(h,g,n,i,w,a)}}(g,t,w,a),n!==Tr&&Ta(h,w,n)&&function(t,n,i,a,h,g,w,C){if(!(3&n.type))return;const F=t.data,Z=F[C+1];gm(function(t){return 1==(1&t)}(Z)?Av(F,n,i,h,wa(Z),w):void 0)||(gm(g)||function(t){return 2==(2&t)}(Z)&&(g=Av(F,null,i,h,C,w)),function(t,n,i,a,h){const g=$(t);if(n)h?g?t.addClass(i,a):i.classList.add(a):g?t.removeClass(i,a):i.classList.remove(a);else{let w=-1===a.indexOf("-")?void 0:sc.DashCase;if(null==h)g?t.removeStyle(i,a,w):i.style.removeProperty(a);else{const C="string"==typeof h&&h.endsWith("!important");C&&(h=h.slice(0,-10),w|=sc.Important),g?t.setStyle(i,a,h,w):i.style.setProperty(a,h,C?"important":"")}}}(a,w,Ai(rs(),i),h,g))}(g,g.data[rs()],h,h[11],t,h[w+1]=function(t,n){return null==t||("string"==typeof n?t+=n:"object"==typeof t&&(t=ke(wc(t)))),t}(n,i),a,w)}(t,n,null,!0),f_}function p_(t,n,i,a,h){let g=null;const w=i.directiveEnd;let C=i.directiveStylingLast;for(-1===C?C=i.directiveStart:C++;C<w&&(g=n[C],a=Sf(a,g.hostAttrs,h),g!==t);)C++;return null!==t&&(i.directiveStylingLast=C),a}function Sf(t,n,i){const a=i?1:2;let h=-1;if(null!==n)for(let g=0;g<n.length;g++){const w=n[g];"number"==typeof w?h=w:h===a&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),on(t,w,!!i||n[++g]))}return void 0===t?null:t}function Av(t,n,i,a,h,g){const w=null===n;let C;for(;h>0;){const F=t[h],Z=Array.isArray(F),se=Z?F[1]:F,xe=null===se;let De=i[h+1];De===Tr&&(De=xe?lr:void 0);let Ye=xe?Cn(De,a):se===a?De:void 0;if(Z&&!gm(Ye)&&(Ye=Cn(F,a)),gm(Ye)&&(C=Ye,w))return C;const ht=t[h+1];h=w?$a(ht):wa(ht)}if(null!==n){let F=g?n.residualClasses:n.residualStyles;null!=F&&(C=Cn(F,a))}return C}function gm(t){return void 0!==t}function Iv(t,n=""){const i=Jt(),a=Rr(),h=t+20,g=a.firstCreatePass?Cu(a,h,1,n,null):a.data[h],w=i[h]=function(t,n){return $(t)?t.createText(n):t.createTextNode(n)}(i[11],n);ja(a,i,w,g),ns(g,!1)}function m_(t){return _m("",t,""),m_}function _m(t,n,i){const a=Jt(),h=Zh(a,t,n,i);return h!==Tr&&uc(a,rs(),h),_m}function g_(t,n,i,a,h){const g=Jt(),w=function(t,n,i,a,h,g){const C=Xu(t,yo(),i,h);return co(2),C?n+Xt(i)+a+Xt(h)+g:Tr}(g,t,n,i,a,h);return w!==Tr&&uc(g,rs(),w),g_}function __(t,n,i){const a=Jt();return Ta(a,Ss(),n)&&Ea(Rr(),bi(),a,t,n,a[11],i,!0),__}const Qu=void 0;var tw=["en",[["a","p"],["AM","PM"],Qu],[["AM","PM"],Qu,Qu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Qu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Qu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Qu,"{1} 'at' {0}",Qu],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){const n=Math.floor(Math.abs(t)),i=t.toString().replace(/^[^.]*\.?/,"").length;return 1===n&&0===i?1:5}];let td={};function nw(t,n,i){"string"!=typeof n&&(i=n,n=t[pr.LocaleId]),n=n.toLowerCase().replace(/_/g,"-"),td[n]=t,i&&(td[n][pr.ExtraData]=i)}function y_(t){const n=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let i=Yv(n);if(i)return i;const a=n.split("-")[0];if(i=Yv(a),i)return i;if("en"===a)return tw;throw new Error(`Missing locale data for the locale "${t}".`)}function Wv(t){return y_(t)[pr.PluralCase]}function Yv(t){return t in td||(td[t]=vr.ng&&vr.ng.common&&vr.ng.common.locales&&vr.ng.common.locales[t]),td[t]}var pr=(()=>((pr=pr||{})[pr.LocaleId=0]="LocaleId",pr[pr.DayPeriodsFormat=1]="DayPeriodsFormat",pr[pr.DayPeriodsStandalone=2]="DayPeriodsStandalone",pr[pr.DaysFormat=3]="DaysFormat",pr[pr.DaysStandalone=4]="DaysStandalone",pr[pr.MonthsFormat=5]="MonthsFormat",pr[pr.MonthsStandalone=6]="MonthsStandalone",pr[pr.Eras=7]="Eras",pr[pr.FirstDayOfWeek=8]="FirstDayOfWeek",pr[pr.WeekendRange=9]="WeekendRange",pr[pr.DateFormat=10]="DateFormat",pr[pr.TimeFormat=11]="TimeFormat",pr[pr.DateTimeFormat=12]="DateTimeFormat",pr[pr.NumberSymbols=13]="NumberSymbols",pr[pr.NumberFormats=14]="NumberFormats",pr[pr.CurrencyCode=15]="CurrencyCode",pr[pr.CurrencySymbol=16]="CurrencySymbol",pr[pr.CurrencyName=17]="CurrencyName",pr[pr.Currencies=18]="Currencies",pr[pr.Directionality=19]="Directionality",pr[pr.PluralCase=20]="PluralCase",pr[pr.ExtraData=21]="ExtraData",pr))();const ym="en-US";let Kv=ym;function v_(t){ir(t,"Expected localeId to be defined"),"string"==typeof t&&(Kv=t.toLowerCase().replace(/_/g,"-"))}function w_(t,n,i,a,h){if(t=Me(t),Array.isArray(t))for(let g=0;g<t.length;g++)w_(t[g],n,i,a,h);else{const g=Rr(),w=Jt();let C=Y(t)?t:Me(t.provide),F=E(t);const Z=gi(),se=1048575&Z.providerIndexes,xe=Z.directiveStart,De=Z.providerIndexes>>20;if(Y(t)||!t.multi){const Ye=new il(F,h,Tf),ht=C_(C,n,h?se:se+De,xe);-1===ht?(ol(Na(Z,w),g,C),E_(g,t,n.length),n.push(C),Z.directiveStart++,Z.directiveEnd++,h&&(Z.providerIndexes+=1048576),i.push(Ye),w.push(Ye)):(i[ht]=Ye,w[ht]=Ye)}else{const Ye=C_(C,n,se+De,xe),ht=C_(C,n,se,se+De),It=Ye>=0&&i[Ye],wt=ht>=0&&i[ht];if(h&&!wt||!h&&!It){ol(Na(Z,w),g,C);const pn=function(t,n,i,a,h){const g=new il(t,i,Tf);return g.multi=[],g.index=n,g.componentProviders=0,x0(g,h,a&&!i),g}(h?Jw:Qw,i.length,h,a,F);!h&&wt&&(i[ht].providerFactory=pn),E_(g,t,n.length,0),n.push(C),Z.directiveStart++,Z.directiveEnd++,h&&(Z.providerIndexes+=1048576),i.push(pn),w.push(pn)}else E_(g,t,Ye>-1?Ye:ht,x0(i[h?ht:Ye],F,!h&&a));!h&&a&&wt&&i[ht].componentProviders++}}}function E_(t,n,i,a){const h=Y(n);if(h||function(t){return!!t.useClass}(n)){const w=(n.useClass||n).prototype.ngOnDestroy;if(w){const C=t.destroyHooks||(t.destroyHooks=[]);if(!h&&n.multi){const F=C.indexOf(i);-1===F?C.push(i,[a,w]):C[F+1].push(a,w)}else C.push(i,w)}}}function x0(t,n,i){return i&&t.componentProviders++,t.multi.push(n)-1}function C_(t,n,i,a){for(let h=i;h<a;h++)if(n[h]===t)return h;return-1}function Qw(t,n,i,a){return T_(this.multi,[])}function Jw(t,n,i,a){const h=this.multi;let g;if(this.providerFactory){const w=this.providerFactory.componentProviders,C=ra(i,i[1],this.providerFactory.index,a);g=C.slice(0,w),T_(h,g);for(let F=w;F<C.length;F++)g.push(C[F])}else g=[],T_(h,g);return g}function T_(t,n){for(let i=0;i<t.length;i++)n.push((0,t[i])());return n}function b0(t,n=[]){return i=>{i.providersResolver=(a,h)=>function(t,n,i){const a=Rr();if(a.firstCreatePass){const h=qr(t);w_(i,a.data,a.blueprint,h,!0),w_(n,a.data,a.blueprint,h,!1)}}(a,h?h(t):t,n)}}class w0{}const C0="ngComponent";class nE{resolveComponentFactory(n){throw function(t){const n=Error(`No component factory found for ${ke(t)}. Did you add it to @NgModule.entryComponents?`);return n[C0]=t,n}(n)}}let rd=(()=>{class t{}return t.NULL=new nE,t})();function Em(...t){}function id(t,n){return new eu(oi(t,n))}const sE=function(){return id(gi(),Jt())};let eu=(()=>{class t{constructor(i){this.nativeElement=i}}return t.__NG_ELEMENT_ID__=sE,t})();function T0(t){return t instanceof eu?t.nativeElement:t}class Cm{}let oE=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>lE(),t})();const lE=function(){const t=Jt(),i=Mi(gi().index,t);return function(t){return t[11]}(Hr(i)?i:t)};let D_=(()=>{class t{}return t.\u0275prov=yr({token:t,providedIn:"root",factory:()=>null}),t})();class S0{constructor(n){this.full=n,this.major=n.split(".")[0],this.minor=n.split(".")[1],this.patch=n.split(".").slice(2).join(".")}}const D0=new S0("12.2.7");class A0{constructor(){}supports(n){return Ul(n)}create(n){return new dE(n)}}const hE=(t,n)=>n;class dE{constructor(n){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=n||hE}forEachItem(n){let i;for(i=this._itHead;null!==i;i=i._next)n(i)}forEachOperation(n){let i=this._itHead,a=this._removalsHead,h=0,g=null;for(;i||a;){const w=!a||i&&i.currentIndex<I0(a,h,g)?i:a,C=I0(w,h,g),F=w.currentIndex;if(w===a)h--,a=a._nextRemoved;else if(i=i._next,null==w.previousIndex)h++;else{g||(g=[]);const Z=C-h,se=F-h;if(Z!=se){for(let De=0;De<Z;De++){const Ye=De<g.length?g[De]:g[De]=0,ht=Ye+De;se<=ht&&ht<Z&&(g[De]=Ye+1)}g[w.previousIndex]=se-Z}}C!==F&&n(w,C,F)}}forEachPreviousItem(n){let i;for(i=this._previousItHead;null!==i;i=i._nextPrevious)n(i)}forEachAddedItem(n){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)n(i)}forEachMovedItem(n){let i;for(i=this._movesHead;null!==i;i=i._nextMoved)n(i)}forEachRemovedItem(n){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)n(i)}forEachIdentityChange(n){let i;for(i=this._identityChangesHead;null!==i;i=i._nextIdentityChange)n(i)}diff(n){if(null==n&&(n=[]),!Ul(n))throw new Error(`Error trying to diff '${ke(n)}'. Only arrays and iterables are allowed`);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let h,g,w,i=this._itHead,a=!1;if(Array.isArray(n)){this.length=n.length;for(let C=0;C<this.length;C++)g=n[C],w=this._trackByFn(C,g),null!==i&&Object.is(i.trackById,w)?(a&&(i=this._verifyReinsertion(i,g,w,C)),Object.is(i.item,g)||this._addIdentityChange(i,g)):(i=this._mismatch(i,g,w,C),a=!0),i=i._next}else h=0,function(t,n){if(Array.isArray(t))for(let i=0;i<t.length;i++)n(t[i]);else{const i=t[dc()]();let a;for(;!(a=i.next()).done;)n(a.value)}}(n,C=>{w=this._trackByFn(h,C),null!==i&&Object.is(i.trackById,w)?(a&&(i=this._verifyReinsertion(i,C,w,h)),Object.is(i.item,C)||this._addIdentityChange(i,C)):(i=this._mismatch(i,C,w,h),a=!0),i=i._next,h++}),this.length=h;return this._truncate(i),this.collection=n,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;null!==n;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;null!==n;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,i,a,h){let g;return null===n?g=this._itTail:(g=n._prev,this._remove(n)),null!==(n=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null))?(Object.is(n.item,i)||this._addIdentityChange(n,i),this._reinsertAfter(n,g,h)):null!==(n=null===this._linkedRecords?null:this._linkedRecords.get(a,h))?(Object.is(n.item,i)||this._addIdentityChange(n,i),this._moveAfter(n,g,h)):n=this._addAfter(new fE(i,a),g,h),n}_verifyReinsertion(n,i,a,h){let g=null===this._unlinkedRecords?null:this._unlinkedRecords.get(a,null);return null!==g?n=this._reinsertAfter(g,n._prev,h):n.currentIndex!=h&&(n.currentIndex=h,this._addToMoves(n,h)),n}_truncate(n){for(;null!==n;){const i=n._next;this._addToRemovals(this._unlink(n)),n=i}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,i,a){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(n);const h=n._prevRemoved,g=n._nextRemoved;return null===h?this._removalsHead=g:h._nextRemoved=g,null===g?this._removalsTail=h:g._prevRemoved=h,this._insertAfter(n,i,a),this._addToMoves(n,a),n}_moveAfter(n,i,a){return this._unlink(n),this._insertAfter(n,i,a),this._addToMoves(n,a),n}_addAfter(n,i,a){return this._insertAfter(n,i,a),this._additionsTail=null===this._additionsTail?this._additionsHead=n:this._additionsTail._nextAdded=n,n}_insertAfter(n,i,a){const h=null===i?this._itHead:i._next;return n._next=h,n._prev=i,null===h?this._itTail=n:h._prev=n,null===i?this._itHead=n:i._next=n,null===this._linkedRecords&&(this._linkedRecords=new M0),this._linkedRecords.put(n),n.currentIndex=a,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){null!==this._linkedRecords&&this._linkedRecords.remove(n);const i=n._prev,a=n._next;return null===i?this._itHead=a:i._next=a,null===a?this._itTail=i:a._prev=i,n}_addToMoves(n,i){return n.previousIndex===i||(this._movesTail=null===this._movesTail?this._movesHead=n:this._movesTail._nextMoved=n),n}_addToRemovals(n){return null===this._unlinkedRecords&&(this._unlinkedRecords=new M0),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,i){return n.item=i,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=n:this._identityChangesTail._nextIdentityChange=n,n}}class fE{constructor(n,i){this.item=n,this.trackById=i,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class pE{constructor(){this._head=null,this._tail=null}add(n){null===this._head?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,i){let a;for(a=this._head;null!==a;a=a._nextDup)if((null===i||i<=a.currentIndex)&&Object.is(a.trackById,n))return a;return null}remove(n){const i=n._prevDup,a=n._nextDup;return null===i?this._head=a:i._nextDup=a,null===a?this._tail=i:a._prevDup=i,null===this._head}}class M0{constructor(){this.map=new Map}put(n){const i=n.trackById;let a=this.map.get(i);a||(a=new pE,this.map.set(i,a)),a.add(n)}get(n,i){const h=this.map.get(n);return h?h.get(n,i):null}remove(n){const i=n.trackById;return this.map.get(i).remove(n)&&this.map.delete(i),n}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function I0(t,n,i){const a=t.previousIndex;if(null===a)return a;let h=0;return i&&a<i.length&&(h=i[a]),a+n+h}class P0{constructor(){}supports(n){return n instanceof Map||Kg(n)}create(){return new mE}}class mE{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(n){let i;for(i=this._mapHead;null!==i;i=i._next)n(i)}forEachPreviousItem(n){let i;for(i=this._previousMapHead;null!==i;i=i._nextPrevious)n(i)}forEachChangedItem(n){let i;for(i=this._changesHead;null!==i;i=i._nextChanged)n(i)}forEachAddedItem(n){let i;for(i=this._additionsHead;null!==i;i=i._nextAdded)n(i)}forEachRemovedItem(n){let i;for(i=this._removalsHead;null!==i;i=i._nextRemoved)n(i)}diff(n){if(n){if(!(n instanceof Map||Kg(n)))throw new Error(`Error trying to diff '${ke(n)}'. Only maps and objects are allowed`)}else n=new Map;return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let i=this._mapHead;if(this._appendAfter=null,this._forEach(n,(a,h)=>{if(i&&i.key===h)this._maybeAddToChanges(i,a),this._appendAfter=i,i=i._next;else{const g=this._getOrCreateRecordForKey(h,a);i=this._insertBeforeOrAppend(i,g)}}),i){i._prev&&(i._prev._next=null),this._removalsHead=i;for(let a=i;null!==a;a=a._nextRemoved)a===this._mapHead&&(this._mapHead=null),this._records.delete(a.key),a._nextRemoved=a._next,a.previousValue=a.currentValue,a.currentValue=null,a._prev=null,a._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(n,i){if(n){const a=n._prev;return i._next=n,i._prev=a,n._prev=i,a&&(a._next=i),n===this._mapHead&&(this._mapHead=i),this._appendAfter=n,n}return this._appendAfter?(this._appendAfter._next=i,i._prev=this._appendAfter):this._mapHead=i,this._appendAfter=i,null}_getOrCreateRecordForKey(n,i){if(this._records.has(n)){const h=this._records.get(n);this._maybeAddToChanges(h,i);const g=h._prev,w=h._next;return g&&(g._next=w),w&&(w._prev=g),h._next=null,h._prev=null,h}const a=new gE(n);return this._records.set(n,a),a.currentValue=i,this._addToAdditions(a),a}_reset(){if(this.isDirty){let n;for(this._previousMapHead=this._mapHead,n=this._previousMapHead;null!==n;n=n._next)n._nextPrevious=n._next;for(n=this._changesHead;null!==n;n=n._nextChanged)n.previousValue=n.currentValue;for(n=this._additionsHead;null!=n;n=n._nextAdded)n.previousValue=n.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(n,i){Object.is(i,n.currentValue)||(n.previousValue=n.currentValue,n.currentValue=i,this._addToChanges(n))}_addToAdditions(n){null===this._additionsHead?this._additionsHead=this._additionsTail=n:(this._additionsTail._nextAdded=n,this._additionsTail=n)}_addToChanges(n){null===this._changesHead?this._changesHead=this._changesTail=n:(this._changesTail._nextChanged=n,this._changesTail=n)}_forEach(n,i){n instanceof Map?n.forEach(i):Object.keys(n).forEach(a=>i(n[a],a))}}class gE{constructor(n){this.key=n,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function R0(){return new Tm([new A0])}let Tm=(()=>{class t{constructor(i){this.factories=i}static create(i,a){if(null!=a){const h=a.factories.slice();i=i.concat(h)}return new t(i)}static extend(i){return{provide:t,useFactory:a=>t.create(i,a||R0()),deps:[[t,new vi,new Cr]]}}find(i){const a=this.factories.find(h=>h.supports(i));if(null!=a)return a;throw new Error(`Cannot find a differ supporting object '${i}' of type '${function(t){return t.name||typeof t}(i)}'`)}}return t.\u0275prov=yr({token:t,providedIn:"root",factory:R0}),t})();function k0(){return new Sm([new P0])}let Sm=(()=>{class t{constructor(i){this.factories=i}static create(i,a){if(a){const h=a.factories.slice();i=i.concat(h)}return new t(i)}static extend(i){return{provide:t,useFactory:a=>t.create(i,a||k0()),deps:[[t,new vi,new Cr]]}}find(i){const a=this.factories.find(h=>h.supports(i));if(a)return a;throw new Error(`Cannot find a differ supporting object '${i}'`)}}return t.\u0275prov=yr({token:t,providedIn:"root",factory:k0}),t})();function Dm(t,n,i,a,h=!1){for(;null!==i;){const g=n[i.index];if(null!==g&&a.push(Qt(g)),Fi(g))for(let C=10;C<g.length;C++){const F=g[C],Z=F[1].firstChild;null!==Z&&Dm(F[1],F,Z,a)}const w=i.type;if(8&w)Dm(t,n,i.child,a);else if(32&w){const C=Fd(i,n);let F;for(;F=C();)a.push(F)}else if(16&w){const C=Vu(n,i);if(Array.isArray(C))a.push(...C);else{const F=oc(n[16]);Dm(F[1],F,C,a,!0)}}i=h?i.projectionNext:i.next}return a}class Pf{constructor(n,i){this._lView=n,this._cdRefInjectingView=i,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const n=this._lView,i=n[1];return Dm(i,n,i.firstChild,[])}get context(){return this._lView[8]}set context(n){this._lView[8]=n}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const n=this._lView[3];if(Fi(n)){const i=n[8],a=i?i.indexOf(this):-1;a>-1&&(Bd(n,a),We(i,a))}this._attachedToViewContainer=!1}Ap(this._lView[1],this._lView)}onDestroy(n){Xp(this._lView[1],this._lView,null,n)}markForCheck(){Lh(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){cc(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,n,i){vl(!0);try{cc(t,n,i)}finally{vl(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var n;this._appRef=null,Ec(this._lView[1],n=this._lView,n[11],2,null,null)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=n}}class yE extends Pf{constructor(n){super(n),this._view=n}detectChanges(){yf(this._view)}checkNoChanges(){!function(t){vl(!0);try{yf(t)}finally{vl(!1)}}(this._view)}get context(){return null}}const xE=function(t){return function(t,n,i){if(Li(t)&&!i){const a=Mi(t.index,n);return new Pf(a,a)}return 47&t.type?new Pf(n[16],n):null}(gi(),Jt(),16==(16&t))};let bE=(()=>{class t{}return t.__NG_ELEMENT_ID__=xE,t})();const CE=[new P0],SE=new Tm([new A0]),DE=new Sm(CE),ME=function(){return Am(gi(),Jt())};let Rf=(()=>{class t{}return t.__NG_ELEMENT_ID__=ME,t})();const IE=Rf,PE=class extends IE{constructor(n,i,a){super(),this._declarationLView=n,this._declarationTContainer=i,this.elementRef=a}createEmbeddedView(n){const i=this._declarationTContainer.tViews,a=du(this._declarationLView,i,n,16,null,i.declTNode,null,null,null,null);a[17]=this._declarationLView[this._declarationTContainer.index];const g=this._declarationLView[19];return null!==g&&(a[19]=g.createEmbeddedView(i)),Hc(i,a,n),new Pf(a)}};function Am(t,n){return 4&t.type?new PE(n,t,id(t,n)):null}class Ju{}class O0{}const OE=function(){return N0(gi(),Jt())};let Mm=(()=>{class t{}return t.__NG_ELEMENT_ID__=OE,t})();const LE=Mm,F0=class extends LE{constructor(n,i,a){super(),this._lContainer=n,this._hostTNode=i,this._hostLView=a}get element(){return id(this._hostTNode,this._hostLView)}get injector(){return new P(this._hostTNode,this._hostLView)}get parentInjector(){const n=xa(this._hostTNode,this._hostLView);if(va(n)){const i=La(n,this._hostLView),a=_s(n);return new P(i[1].data[a+8],i)}return new P(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){const i=L0(this._lContainer);return null!==i&&i[n]||null}get length(){return this._lContainer.length-10}createEmbeddedView(n,i,a){const h=n.createEmbeddedView(i||{});return this.insert(h,a),h}createComponent(n,i,a,h,g){const w=a||this.parentInjector;if(!g&&null==n.ngModule&&w){const F=w.get(Ju,null);F&&(g=F)}const C=n.create(w,h,void 0,g);return this.insert(C.hostView,i),C}insert(n,i){const a=n._lView,h=a[1];if(Fi(a[3])){const se=this.indexOf(n);if(-1!==se)this.detach(se);else{const xe=a[3],De=new F0(xe,xe[6],xe[3]);De.detach(De.indexOf(n))}}const g=this._adjustIndex(i),w=this._lContainer;!function(t,n,i,a){const h=10+a,g=i.length;a>0&&(i[h-1][4]=n),a<g-10?(n[4]=i[h],$e(i,10+a,n)):(i.push(n),n[4]=null),n[3]=i;const w=n[17];null!==w&&i!==w&&function(t,n){const i=t[9];n[16]!==n[3][3][16]&&(t[2]=!0),null===i?t[9]=[n]:i.push(n)}(w,n);const C=n[19];null!==C&&C.insertView(t),n[2]|=128}(h,a,w,g);const C=jc(g,w),F=a[11],Z=xh(F,w[7]);return null!==Z&&function(t,n,i,a,h,g){a[0]=h,a[6]=n,Ec(t,a,i,1,h,g)}(h,w[6],F,a,Z,C),n.attachToViewContainerRef(),$e(A_(w),g,n),n}move(n,i){return this.insert(n,i)}indexOf(n){const i=L0(this._lContainer);return null!==i?i.indexOf(n):-1}remove(n){const i=this._adjustIndex(n,-1),a=Bd(this._lContainer,i);a&&(We(A_(this._lContainer),i),Ap(a[1],a))}detach(n){const i=this._adjustIndex(n,-1),a=Bd(this._lContainer,i);return a&&null!=We(A_(this._lContainer),i)?new Pf(a):null}_adjustIndex(n,i=0){return null==n?this.length+i:n}};function L0(t){return t[8]}function A_(t){return t[8]||(t[8]=[])}function N0(t,n){let i;const a=n[t.index];if(Fi(a))i=a;else{let h;if(8&t.type)h=Qt(a);else{const g=n[11];h=g.createComment("");const w=oi(t,n);lu(g,xh(g,w),h,function(t,n){return $(t)?t.nextSibling(n):n.nextSibling}(g,w),!1)}n[t.index]=i=_f(a,n,h,t),Wu(n,i)}return new F0(i,t,n)}const ld={};class rx extends rd{constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){const i=An(n);return new sx(i,this.ngModule)}}function ix(t){const n=[];for(let i in t)t.hasOwnProperty(i)&&n.push({propName:t[i],templateName:i});return n}const RC=new Lr("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>_p});class sx extends w0{constructor(n,i){super(),this.componentDef=n,this.ngModule=i,this.componentType=n.type,this.selector=n.selectors.map(wh).join(","),this.ngContentSelectors=n.ngContentSelectors?n.ngContentSelectors:[],this.isBoundToModule=!!i}get inputs(){return ix(this.componentDef.inputs)}get outputs(){return ix(this.componentDef.outputs)}create(n,i,a,h){const g=(h=h||this.ngModule)?function(t,n){return{get:(i,a,h)=>{const g=t.get(i,ld,h);return g!==ld||a===ld?g:n.get(i,a,h)}}}(n,h.injector):n,w=g.get(Cm,ue),C=g.get(D_,null),F=w.createRenderer(null,this.componentDef),Z=this.componentDef.selectors[0][0]||"div",se=a?function(t,n,i){if($(t))return t.selectRootElement(n,i===wn.ShadowDom);let a="string"==typeof n?t.querySelector(n):n;return a.textContent="",a}(F,a,this.componentDef.encapsulation):yh(w.createRenderer(null,this.componentDef),Z,function(t){const n=t.toLowerCase();return"svg"===n?"http://www.w3.org/2000/svg":"math"===n?"http://www.w3.org/1998/MathML/":null}(Z)),xe=this.componentDef.onPush?576:528,De=function(t,n){return{components:[],scheduler:t||_p,clean:vf,playerHandler:n||null,flags:0}}(),Ye=Hu(0,null,null,1,0,null,null,null,null,null),ht=du(null,Ye,De,xe,null,null,w,F,C,g);let It,wt;_a(ht);try{const pn=function(t,n,i,a,h,g){const w=i[1];i[20]=t;const F=Cu(w,20,2,"#host",null),Z=F.mergedAttrs=n.hostAttrs;null!==Z&&(Yu(F,Z,!0),null!==t&&(No(h,t,Z),null!==F.classes&&li(h,t,F.classes),null!==F.styles&&xu(h,t,F.styles)));const se=a.createRenderer(t,n),xe=du(i,Dh(n),null,n.onPush?64:16,i[20],F,a,se,g||null,null);return w.firstCreatePass&&(ol(Na(F,i),w,n.type),kh(w,F),gf(F,i.length,1)),Wu(i,xe),i[20]=xe}(se,this.componentDef,ht,w,F);if(se)if(a)No(F,se,["ng-version",D0.full]);else{const{attrs:Zt,classes:Wn}=function(t){const n=[],i=[];let a=1,h=2;for(;a<t.length;){let g=t[a];if("string"==typeof g)2===h?""!==g&&n.push(g,t[++a]):8===h&&i.push(g);else{if(!Nl(h))break;h=g}a++}return{attrs:n,classes:i}}(this.componentDef.selectors[0]);Zt&&No(F,se,Zt),Wn&&Wn.length>0&&li(F,se,Wn.join(" "))}if(wt=ps(Ye,20),void 0!==i){const Zt=wt.projection=[];for(let Wn=0;Wn<this.ngContentSelectors.length;Wn++){const wr=i[Wn];Zt.push(null!=wr?Array.from(wr):null)}}It=function(t,n,i,a,h){const g=i[1],w=function(t,n,i){const a=gi();t.firstCreatePass&&(i.providersResolver&&i.providersResolver(i),im(t,a,n,Tu(t,n,1,null),i));const h=ra(n,t,a.directiveStart,a);vs(h,n);const g=oi(a,n);return g&&vs(g,n),h}(g,i,n);if(a.components.push(w),t[8]=w,h&&h.forEach(F=>F(w,n)),n.contentQueries){const F=gi();n.contentQueries(1,w,F.directiveStart)}const C=gi();return!g.firstCreatePass||null===n.hostBindings&&null===n.hostAttrs||(Os(C.index),pf(i[1],C,0,C.directiveStart,C.directiveEnd,n),Rh(n,w)),w}(pn,this.componentDef,ht,De,[hc]),Hc(Ye,ht,null)}finally{bl()}return new FC(this.componentType,It,id(wt,ht),ht,wt)}}class FC extends class{}{constructor(n,i,a,h,g){super(),this.location=a,this._rootLView=h,this._tNode=g,this.instance=i,this.hostView=this.changeDetectorRef=new yE(h),this.componentType=n}get injector(){return new P(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}}const cd=new Map;class zC extends Ju{constructor(n,i){super(),this._parent=i,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new rx(this);const a=tr(n),h=n[de]||null;h&&v_(h),this._bootstrapComponents=ic(a.bootstrap),this._r3Injector=o(n,i,[{provide:Ju,useValue:this},{provide:rd,useValue:this.componentFactoryResolver}],ke(n)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(n)}get(n,i=ut.THROW_IF_NOT_FOUND,a=_t.Default){return n===ut||n===Ju||n===Au?this:this._r3Injector.get(n,i,a)}destroy(){const n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(i=>i()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}}class U_ extends O0{constructor(n){super(),this.moduleType=n,null!==tr(n)&&function(t){const n=new Set;!function i(a){const h=tr(a,!0),g=h.id;null!==g&&(function(t,n,i){if(n&&n!==i)throw new Error(`Duplicate module registered for ${t} - ${ke(n)} vs ${ke(n.name)}`)}(g,cd.get(g),a),cd.set(g,a));const w=ic(h.imports);for(const C of w)n.has(C)||(n.add(C),i(C))}(t)}(n)}create(n){return new zC(this.moduleType,n)}}function lx(t,n,i){const a=_i()+t,h=Jt();return h[a]===Tr?Xc(h,a,i?n.call(i):n()):function(t,n){return t[n]}(h,a)}function cx(t,n,i,a){return hx(Jt(),_i(),t,n,i,a)}function ux(t,n,i,a,h){return dx(Jt(),_i(),t,n,i,a,h)}function Vf(t,n){const i=t[n];return i===Tr?void 0:i}function hx(t,n,i,a,h,g){const w=n+i;return Ta(t,w,h)?Xc(t,w+1,g?a.call(g,h):a(h)):Vf(t,w+1)}function dx(t,n,i,a,h,g,w){const C=n+i;return Xu(t,C,h,g)?Xc(t,C+2,w?a.call(w,h,g):a(h,g)):Vf(t,C+2)}function fx(t,n,i,a,h,g,w,C){const F=n+i;return function(t,n,i,a,h){const g=Xu(t,n,i,a);return Ta(t,n+2,h)||g}(t,F,h,g,w)?Xc(t,F+3,C?a.call(C,h,g,w):a(h,g,w)):Vf(t,F+3)}function gx(t,n){const i=Rr();let a;const h=t+20;i.firstCreatePass?(a=function(t,n){if(n)for(let i=n.length-1;i>=0;i--){const a=n[i];if(t===a.name)return a}throw new Ht("302",`The pipe '${t}' could not be found!`)}(n,i.pipeRegistry),i.data[h]=a,a.onDestroy&&(i.destroyHooks||(i.destroyHooks=[])).push(h,a.onDestroy)):a=i.data[h];const g=a.factory||(a.factory=Cs(a.type)),w=_n(Tf);try{const C=yn(!1),F=g();return yn(C),function(t,n,i,a){i>=t.data.length&&(t.data[i]=null,t.blueprint[i]=null),n[i]=a}(i,Jt(),h,F),F}finally{_n(w)}}function _x(t,n,i){const a=t+20,h=Jt(),g=Mr(h,a);return jf(h,Uf(h,a)?hx(h,_i(),n,g.transform,i,g):g.transform(i))}function yx(t,n,i,a){const h=t+20,g=Jt(),w=Mr(g,h);return jf(g,Uf(g,h)?dx(g,_i(),n,w.transform,i,a,w):w.transform(i,a))}function vx(t,n,i,a,h){const g=t+20,w=Jt(),C=Mr(w,g);return jf(w,Uf(w,g)?fx(w,_i(),n,C.transform,i,a,h,C):C.transform(i,a,h))}function Uf(t,n){return t[1].data[n].pure}function jf(t,n){return pl.isWrapped(n)&&(n=pl.unwrap(n),t[yo()]=Tr),n}function j_(t){return n=>{setTimeout(t,void 0,n)}}const tu=class extends Se.xQ{constructor(n=!1){super(),this.__isAsync=n}emit(n){super.next(n)}subscribe(n,i,a){var h,g,w;let C=n,F=i||(()=>null),Z=a;if(n&&"object"==typeof n){const xe=n;C=null===(h=xe.next)||void 0===h?void 0:h.bind(xe),F=null===(g=xe.error)||void 0===g?void 0:g.bind(xe),Z=null===(w=xe.complete)||void 0===w?void 0:w.bind(xe)}this.__isAsync&&(F=j_(F),C&&(C=j_(C)),Z&&(Z=j_(Z)));const se=super.subscribe({next:C,error:F,complete:Z});return n instanceof Ce.w&&n.add(se),se}};function KC(){return this._results[dc()]()}class Om{constructor(n=!1){this._emitDistinctChangesOnly=n,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const i=dc(),a=Om.prototype;a[i]||(a[i]=KC)}get changes(){return this._changes||(this._changes=new tu)}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,i){return this._results.reduce(n,i)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,i){const a=this;a.dirty=!1;const h=be(n);(this._changesDetected=!function(t,n,i){if(t.length!==n.length)return!1;for(let a=0;a<t.length;a++){let h=t[a],g=n[a];if(i&&(h=i(h),g=i(g)),g!==h)return!1}return!0}(a._results,h,i))&&(a._results=h,a.length=h.length,a.last=h[this.length-1],a.first=h[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;class $_{constructor(n){this.queryList=n,this.matches=null}clone(){return new $_(this.queryList)}setDirty(){this.queryList.setDirty()}}class G_{constructor(n=[]){this.queries=n}createEmbeddedView(n){const i=n.queries;if(null!==i){const a=null!==n.contentQueries?n.contentQueries[0]:i.length,h=[];for(let g=0;g<a;g++){const w=i.getByIndex(g);h.push(this.queries[w.indexInDeclarationView].clone())}return new G_(h)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let i=0;i<this.queries.length;i++)null!==Ax(n,i).matches&&this.queries[i].setDirty()}}class xx{constructor(n,i,a=null){this.predicate=n,this.flags=i,this.read=a}}class Z_{constructor(n=[]){this.queries=n}elementStart(n,i){for(let a=0;a<this.queries.length;a++)this.queries[a].elementStart(n,i)}elementEnd(n){for(let i=0;i<this.queries.length;i++)this.queries[i].elementEnd(n)}embeddedTView(n){let i=null;for(let a=0;a<this.length;a++){const h=null!==i?i.length:0,g=this.getByIndex(a).embeddedTView(n,h);g&&(g.indexInDeclarationView=a,null!==i?i.push(g):i=[g])}return null!==i?new Z_(i):null}template(n,i){for(let a=0;a<this.queries.length;a++)this.queries[a].template(n,i)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}}class H_{constructor(n,i=-1){this.metadata=n,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=i}elementStart(n,i){this.isApplyingToNode(i)&&this.matchTNode(n,i)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,i){this.elementStart(n,i)}embeddedTView(n,i){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,i),new H_(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const i=this._declarationNodeIndex;let a=n.parent;for(;null!==a&&8&a.type&&a.index!==i;)a=a.parent;return i===(null!==a?a.index:-1)}return this._appliesToNextNode}matchTNode(n,i){const a=this.metadata.predicate;if(Array.isArray(a))for(let h=0;h<a.length;h++){const g=a[h];this.matchTNodeWithReadOption(n,i,JC(i,g)),this.matchTNodeWithReadOption(n,i,al(i,n,g,!1,!1))}else a===Rf?4&i.type&&this.matchTNodeWithReadOption(n,i,-1):this.matchTNodeWithReadOption(n,i,al(i,n,a,!1,!1))}matchTNodeWithReadOption(n,i,a){if(null!==a){const h=this.metadata.read;if(null!==h)if(h===eu||h===Mm||h===Rf&&4&i.type)this.addMatch(i.index,-2);else{const g=al(i,n,h,!1,!1);null!==g&&this.addMatch(i.index,g)}else this.addMatch(i.index,a)}}addMatch(n,i){null===this.matches?this.matches=[n,i]:this.matches.push(n,i)}}function JC(t,n){const i=t.localNames;if(null!==i)for(let a=0;a<i.length;a+=2)if(i[a]===n)return i[a+1];return null}function tT(t,n,i,a){return-1===i?function(t,n){return 11&t.type?id(t,n):4&t.type?Am(t,n):null}(n,t):-2===i?function(t,n,i){return i===eu?id(n,t):i===Rf?Am(n,t):i===Mm?N0(n,t):void 0}(t,n,a):ra(t,t[1],i,n)}function bx(t,n,i,a){const h=n[19].queries[a];if(null===h.matches){const g=t.data,w=i.matches,C=[];for(let F=0;F<w.length;F+=2){const Z=w[F];C.push(Z<0?null:tT(n,g[Z],w[F+1],i.metadata.read))}h.matches=C}return h.matches}function q_(t,n,i,a){const h=t.queries.getByIndex(i),g=h.matches;if(null!==g){const w=bx(t,n,h,i);for(let C=0;C<g.length;C+=2){const F=g[C];if(F>0)a.push(w[C/2]);else{const Z=g[C+1],se=n[-F];for(let xe=10;xe<se.length;xe++){const De=se[xe];De[17]===De[3]&&q_(De[1],De,Z,a)}if(null!==se[9]){const xe=se[9];for(let De=0;De<xe.length;De++){const Ye=xe[De];q_(Ye[1],Ye,Z,a)}}}}}return a}function wx(t){const n=Jt(),i=Rr(),a=xl();Pa(a+1);const h=Ax(i,a);if(t.dirty&&lo(n)===(2==(2&h.metadata.flags))){if(null===h.matches)t.reset([]);else{const g=h.crossesNgTemplate?q_(i,n,a,[]):bx(i,n,h,a);t.reset(g,T0),t.notifyOnChanges()}return!0}return!1}function Ex(t,n,i){const a=Rr();a.firstCreatePass&&(Dx(a,new xx(t,n,i),-1),2==(2&n)&&(a.staticViewQueries=!0)),Sx(a,Jt(),n)}function Cx(t,n,i,a){const h=Rr();if(h.firstCreatePass){const g=gi();Dx(h,new xx(n,i,a),g.index),function(t,n){const i=t.contentQueries||(t.contentQueries=[]);n!==(i.length?i[i.length-1]:-1)&&i.push(t.queries.length-1,n)}(h,t),2==(2&i)&&(h.staticContentQueries=!0)}Sx(h,Jt(),i)}function Tx(){return t=Jt(),n=xl(),t[19].queries[n].queryList;var t,n}function Sx(t,n,i){const a=new Om(4==(4&i));Xp(t,n,a,a.destroy),null===n[19]&&(n[19]=new G_),n[19].queries.push(new $_(a))}function Dx(t,n,i){null===t.queries&&(t.queries=new Z_),t.queries.track(new H_(n,i))}function Ax(t,n){return t.queries.getByIndex(n)}const ET=Un("Input",t=>({bindingPropertyName:t})),CT=Un("Output",t=>({bindingPropertyName:t})),J_=new Lr("Application Initializer");let hd=(()=>{class t{constructor(i){this.appInits=i,this.resolve=Em,this.reject=Em,this.initialized=!1,this.done=!1,this.donePromise=new Promise((a,h)=>{this.resolve=a,this.reject=h})}runInitializers(){if(this.initialized)return;const i=[],a=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let h=0;h<this.appInits.length;h++){const g=this.appInits[h]();if(l_(g))i.push(g);else if(c_(g)){const w=new Promise((C,F)=>{g.subscribe({complete:C,error:F})});i.push(w)}}Promise.all(i).then(()=>{a()}).catch(h=>{this.reject(h)}),0===i.length&&a(),this.initialized=!0}}return t.\u0275fac=function(i){return new(i||t)(Te(J_,8))},t.\u0275prov=yr({token:t,factory:t.\u0275fac}),t})();const Hx=new Lr("AppId"),OT={provide:Hx,useFactory:function(){return`${ey()}${ey()}${ey()}`},deps:[]};function ey(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const qx=new Lr("Platform Initializer"),Wx=new Lr("Platform ID"),Yx=new Lr("appBootstrapListener");let Kx=(()=>{class t{log(i){console.log(i)}warn(i){console.warn(i)}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=yr({token:t,factory:t.\u0275fac}),t})();const Nm=new Lr("LocaleId"),Xx=new Lr("DefaultCurrencyCode");class LT{constructor(n,i){this.ngModuleFactory=n,this.componentFactories=i}}const ty=function(t){return new U_(t)},NT=ty,zT=function(t){return Promise.resolve(ty(t))},Qx=function(t){const n=ty(t),a=ic(tr(t).declarations).reduce((h,g)=>{const w=An(g);return w&&h.push(new sx(w)),h},[]);return new LT(n,a)},BT=Qx,VT=function(t){return Promise.resolve(Qx(t))};let Gf=(()=>{class t{constructor(){this.compileModuleSync=NT,this.compileModuleAsync=zT,this.compileModuleAndAllComponentsSync=BT,this.compileModuleAndAllComponentsAsync=VT}clearCache(){}clearCacheFor(i){}getModuleId(i){}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=yr({token:t,factory:t.\u0275fac}),t})();const $T=(()=>Promise.resolve(0))();function ny(t){"undefined"==typeof Zone?$T.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class jl{constructor({enableLongStackTrace:n=!1,shouldCoalesceEventChangeDetection:i=!1,shouldCoalesceRunChangeDetection:a=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tu(!1),this.onMicrotaskEmpty=new tu(!1),this.onStable=new tu(!1),this.onError=new tu(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const h=this;h._nesting=0,h._outer=h._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(h._inner=h._inner.fork(new Zone.TaskTrackingZoneSpec)),n&&Zone.longStackTraceZoneSpec&&(h._inner=h._inner.fork(Zone.longStackTraceZoneSpec)),h.shouldCoalesceEventChangeDetection=!a&&i,h.shouldCoalesceRunChangeDetection=a,h.lastRequestAnimationFrameId=-1,h.nativeRequestAnimationFrame=function(){let t=vr.requestAnimationFrame,n=vr.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&n){const i=t[Zone.__symbol__("OriginalDelegate")];i&&(t=i);const a=n[Zone.__symbol__("OriginalDelegate")];a&&(n=a)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function(t){const n=()=>{!function(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(vr,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,iy(t),t.isCheckStableRunning=!0,ry(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),iy(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(i,a,h,g,w,C)=>{try{return Jx(t),i.invokeTask(h,g,w,C)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===g.type||t.shouldCoalesceRunChangeDetection)&&n(),eb(t)}},onInvoke:(i,a,h,g,w,C,F)=>{try{return Jx(t),i.invoke(h,g,w,C,F)}finally{t.shouldCoalesceRunChangeDetection&&n(),eb(t)}},onHasTask:(i,a,h,g)=>{i.hasTask(h,g),a===h&&("microTask"==g.change?(t._hasPendingMicrotasks=g.microTask,iy(t),ry(t)):"macroTask"==g.change&&(t.hasPendingMacrotasks=g.macroTask))},onHandleError:(i,a,h,g)=>(i.handleError(h,g),t.runOutsideAngular(()=>t.onError.emit(g)),!1)})}(h)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!jl.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(jl.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(n,i,a){return this._inner.run(n,i,a)}runTask(n,i,a,h){const g=this._inner,w=g.scheduleEventTask("NgZoneEvent: "+h,n,ZT,Em,Em);try{return g.runTask(w,i,a)}finally{g.cancelTask(w)}}runGuarded(n,i,a){return this._inner.runGuarded(n,i,a)}runOutsideAngular(n){return this._outer.run(n)}}const ZT={};function ry(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function iy(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function Jx(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function eb(t){t._nesting--,ry(t)}class WT{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tu,this.onMicrotaskEmpty=new tu,this.onStable=new tu,this.onError=new tu}run(n,i,a){return n.apply(i,a)}runGuarded(n,i,a){return n.apply(i,a)}runOutsideAngular(n){return n()}runTask(n,i,a,h){return n.apply(i,a)}}let tb=(()=>{class t{constructor(i){this._ngZone=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),i.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{jl.assertNotInAngularZone(),ny(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())ny(()=>{for(;0!==this._callbacks.length;){let i=this._callbacks.pop();clearTimeout(i.timeoutId),i.doneCb(this._didWork)}this._didWork=!1});else{let i=this.getPendingTasks();this._callbacks=this._callbacks.filter(a=>!a.updateCb||!a.updateCb(i)||(clearTimeout(a.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(i=>({source:i.source,creationLocation:i.creationLocation,data:i.data})):[]}addCallback(i,a,h){let g=-1;a&&a>0&&(g=setTimeout(()=>{this._callbacks=this._callbacks.filter(w=>w.timeoutId!==g),i(this._didWork,this.getPendingTasks())},a)),this._callbacks.push({doneCb:i,timeoutId:g,updateCb:h})}whenStable(i,a,h){if(h&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(i,a,h),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(i,a,h){return[]}}return t.\u0275fac=function(i){return new(i||t)(Te(jl))},t.\u0275prov=yr({token:t,factory:t.\u0275fac}),t})(),nb=(()=>{class t{constructor(){this._applications=new Map,sy.addToWindow(this)}registerApplication(i,a){this._applications.set(i,a)}unregisterApplication(i){this._applications.delete(i)}unregisterAllApplications(){this._applications.clear()}getTestability(i){return this._applications.get(i)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(i,a=!0){return sy.findTestabilityInTree(this,i,a)}}return t.\u0275fac=function(i){return new(i||t)},t.\u0275prov=yr({token:t,factory:t.\u0275fac}),t})();class YT{addToWindow(n){}findTestabilityInTree(n,i,a){return null}}function KT(t){sy=t}let sy=new YT,rb=!0,ib=!1;function XT(){if(ib)throw new Error("Cannot enable prod mode after platform setup.");rb=!1}let Ic;const ob=new Lr("AllowMultipleToken");class iS{constructor(n,i){this.name=n,this.token=i}}function ab(t,n,i=[]){const a=`Platform: ${n}`,h=new Lr(a);return(g=[])=>{let w=lb();if(!w||w.injector.get(ob,!1))if(t)t(i.concat(g).concat({provide:h,useValue:!0}));else{const C=i.concat(g).concat({provide:h,useValue:!0},{provide:Ku,useValue:"platform"});!function(t){if(Ic&&!Ic.destroyed&&!Ic.injector.get(ob,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");Ic=t.get(cb);const n=t.get(qx,null);n&&n.forEach(i=>i())}(ut.create({providers:C,name:a}))}return function(t){const n=lb();if(!n)throw new Error("No platform exists!");if(!n.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return n}(h)}}function lb(){return Ic&&!Ic.destroyed?Ic:null}let cb=(()=>{class t{constructor(i){this._injector=i,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(i,a){const C=function(t,n){let i;return i="noop"===t?new WT:("zone.js"===t?void 0:t)||new jl({enableLongStackTrace:(ib=!0,rb),shouldCoalesceEventChangeDetection:!!(null==n?void 0:n.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==n?void 0:n.ngZoneRunCoalescing)}),i}(a?a.ngZone:void 0,{ngZoneEventCoalescing:a&&a.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:a&&a.ngZoneRunCoalescing||!1}),F=[{provide:jl,useValue:C}];return C.run(()=>{const Z=ut.create({providers:F,parent:this.injector,name:i.moduleType.name}),se=i.create(Z),xe=se.injector.get(Ll,null);if(!xe)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return C.runOutsideAngular(()=>{const De=C.onError.subscribe({next:Ye=>{xe.handleError(Ye)}});se.onDestroy(()=>{oy(this._modules,se),De.unsubscribe()})}),function(t,n,i){try{const a=i();return l_(a)?a.catch(h=>{throw n.runOutsideAngular(()=>t.handleError(h)),h}):a}catch(a){throw n.runOutsideAngular(()=>t.handleError(a)),a}}(xe,C,()=>{const De=se.injector.get(hd);return De.runInitializers(),De.donePromise.then(()=>(v_(se.injector.get(Nm,ym)||ym),this._moduleDoBootstrap(se),se))})})}bootstrapModule(i,a=[]){const h=ub({},a);return function(t,n,i){const a=new U_(i);return Promise.resolve(a)}(0,0,i).then(g=>this.bootstrapModuleFactory(g,h))}_moduleDoBootstrap(i){const a=i.injector.get(Zf);if(i._bootstrapComponents.length>0)i._bootstrapComponents.forEach(h=>a.bootstrap(h));else{if(!i.instance.ngDoBootstrap)throw new Error(`The module ${ke(i.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);i.instance.ngDoBootstrap(a)}this._modules.push(i)}onDestroy(i){this._destroyListeners.push(i)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(i){return new(i||t)(Te(ut))},t.\u0275prov=yr({token:t,factory:t.\u0275fac}),t})();function ub(t,n){return Array.isArray(n)?n.reduce(ub,t):Object.assign(Object.assign({},t),n)}let Zf=(()=>{class t{constructor(i,a,h,g,w){this._zone=i,this._injector=a,this._exceptionHandler=h,this._componentFactoryResolver=g,this._initStatus=w,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const C=new D.y(Z=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{Z.next(this._stable),Z.complete()})}),F=new D.y(Z=>{let se;this._zone.runOutsideAngular(()=>{se=this._zone.onStable.subscribe(()=>{jl.assertNotInAngularZone(),ny(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,Z.next(!0))})})});const xe=this._zone.onUnstable.subscribe(()=>{jl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{Z.next(!1)}))});return()=>{se.unsubscribe(),xe.unsubscribe()}});this.isStable=function(...t){let n=Number.POSITIVE_INFINITY,i=null,a=t[t.length-1];return(0,A.K)(a)?(i=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof a&&(n=t.pop()),null===i&&1===t.length&&t[0]instanceof D.y?t[0]:(0,R.J)(n)((0,u.n)(t,i))}(C,F.pipe(t=>(0,Ue.x)()(function(t,n){return function(a){let h;h="function"==typeof t?t:function(){return t};const g=Object.create(a,ce.N);return g.source=a,g.subjectFactory=h,g}}(Be)(t))))}bootstrap(i,a){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let h;h=i instanceof w0?i:this._componentFactoryResolver.resolveComponentFactory(i),this.componentTypes.push(h.componentType);const g=function(t){return t.isBoundToModule}(h)?void 0:this._injector.get(Ju),C=h.create(ut.NULL,[],a||h.selector,g),F=C.location.nativeElement,Z=C.injector.get(tb,null),se=Z&&C.injector.get(nb);return Z&&se&&se.registerApplication(F,Z),C.onDestroy(()=>{this.detachView(C.hostView),oy(this.components,C),se&&se.unregisterApplication(F)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let i of this._views)i.detectChanges()}catch(i){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(i))}finally{this._runningTick=!1}}attachView(i){const a=i;this._views.push(a),a.attachToAppRef(this)}detachView(i){const a=i;oy(this._views,a),a.detachFromAppRef()}_loadComponent(i){this.attachView(i.hostView),this.tick(),this.components.push(i),this._injector.get(Yx,[]).concat(this._bootstrapListeners).forEach(h=>h(i))}ngOnDestroy(){this._views.slice().forEach(i=>i.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(i){return new(i||t)(Te(jl),Te(ut),Te(Ll),Te(rd),Te(hd))},t.\u0275prov=yr({token:t,factory:t.\u0275fac}),t})();function oy(t,n){const i=t.indexOf(n);i>-1&&t.splice(i,1)}class uS{}class dS{}const fS={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let pS=(()=>{class t{constructor(i,a){this._compiler=i,this._config=a||fS}load(i){return this.loadAndCompile(i)}loadAndCompile(i){let[a,h]=i.split("#");return void 0===h&&(h="default"),te(8255)(a).then(g=>g[h]).then(g=>pb(g,a,h)).then(g=>this._compiler.compileModuleAsync(g))}loadFactory(i){let[a,h]=i.split("#"),g="NgFactory";return void 0===h&&(h="default",g=""),te(8255)(this._config.factoryPathPrefix+a+this._config.factoryPathSuffix).then(w=>w[h+g]).then(w=>pb(w,a,h))}}return t.\u0275fac=function(i){return new(i||t)(Te(Gf),Te(dS,8))},t.\u0275prov=yr({token:t,factory:t.\u0275fac}),t})();function pb(t,n,i){if(!t)throw new Error(`Cannot find '${i}' in '${n}'`);return t}const wS=function(t){return null},CS=ab(null,"core",[{provide:Wx,useValue:"unknown"},{provide:cb,deps:[ut]},{provide:nb,deps:[]},{provide:Kx,deps:[]}]),MS=[{provide:Zf,useClass:Zf,deps:[jl,ut,Ll,rd,hd]},{provide:RC,deps:[jl],useFactory:function(t){let n=[];return t.onStable.subscribe(()=>{for(;n.length;)n.pop()()}),function(i){n.push(i)}}},{provide:hd,useClass:hd,deps:[[new Cr,J_]]},{provide:Gf,useClass:Gf,deps:[]},OT,{provide:Tm,useFactory:function(){return SE},deps:[]},{provide:Sm,useFactory:function(){return DE},deps:[]},{provide:Nm,useFactory:function(t){return v_(t=t||"undefined"!=typeof $localize&&$localize.locale||ym),t},deps:[[new cr(Nm),new Cr,new vi]]},{provide:Xx,useValue:"USD"}];let PS=(()=>{class t{constructor(i){}}return t.\u0275fac=function(i){return new(i||t)(Te(Zf))},t.\u0275mod=sn({type:t}),t.\u0275inj=zr({providers:MS}),t})()},665:(Mt,at,te)=>{"use strict";te.d(at,{Fj:()=>Ot,qu:()=>Dt,u:()=>Ni,sg:()=>Hr,u5:()=>ee,nD:()=>oo,JJ:()=>Ui,JL:()=>Tt,F:()=>mr,On:()=>Ti,YN:()=>Ka,_:()=>Es,UX:()=>_e,Q7:()=>Io,kI:()=>zn,_Y:()=>Si,Kr:()=>Xa});var D=te(639),A=te(8583),R=te(7574),u=te(9796),ge=te(8002),Se=te(1555),Ce=te(4402);function ae(q,$){return new R.y(V=>{const ue=q.length;if(0===ue)return void V.complete();const yt=new Array(ue);let Qt=0,Mn=0;for(let Vr=0;Vr<ue;Vr++){const Ai=(0,Ce.D)(q[Vr]);let oi=!1;V.add(Ai.subscribe({next:fs=>{oi||(oi=!0,Mn++),yt[Vr]=fs},error:fs=>V.error(fs),complete:()=>{Qt++,(Qt===ue||!oi)&&(Mn===ue&&V.next($?$.reduce((fs,ps,Mr)=>(fs[ps]=yt[Mr],fs),{}):yt),V.complete())}}))}})}let ve=(()=>{class q{constructor(V,ue){this._renderer=V,this._elementRef=ue,this.onChange=yt=>{},this.onTouched=()=>{}}setProperty(V,ue){this._renderer.setProperty(this._elementRef.nativeElement,V,ue)}registerOnTouched(V){this.onTouched=V}registerOnChange(V){this.onChange=V}setDisabledState(V){this.setProperty("disabled",V)}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(D.Qsj),D.Y36(D.SBq))},q.\u0275dir=D.lG2({type:q}),q})(),Ue=(()=>{class q extends ve{}return q.\u0275fac=function(){let $;return function(ue){return($||($=D.n5z(q)))(ue||q)}}(),q.\u0275dir=D.lG2({type:q,features:[D.qOj]}),q})();const Be=new D.OlP("NgValueAccessor"),Ne={provide:Be,useExisting:(0,D.Gpc)(()=>Ot),multi:!0},lt=new D.OlP("CompositionEventMode");let Ot=(()=>{class q extends ve{constructor(V,ue,yt){super(V,ue),this._compositionMode=yt,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const q=(0,A.q)()?(0,A.q)().getUserAgent():"";return/android (\d+)/.test(q.toLowerCase())}())}writeValue(V){this.setProperty("value",null==V?"":V)}_handleInput(V){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(V)}_compositionStart(){this._composing=!0}_compositionEnd(V){this._composing=!1,this._compositionMode&&this.onChange(V)}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(D.Qsj),D.Y36(D.SBq),D.Y36(lt,8))},q.\u0275dir=D.lG2({type:q,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(V,ue){1&V&&D.NdJ("input",function(Qt){return ue._handleInput(Qt.target.value)})("blur",function(){return ue.onTouched()})("compositionstart",function(){return ue._compositionStart()})("compositionend",function(Qt){return ue._compositionEnd(Qt.target.value)})},features:[D._Bn([Ne]),D.qOj]}),q})();function Je(q){return null==q||0===q.length}function Me(q){return null!=q&&"number"==typeof q.length}const Ge=new D.OlP("NgValidators"),Lt=new D.OlP("NgAsyncValidators"),Ht=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class zn{static min($){return q=$,$=>{if(Je($.value)||Je(q))return null;const V=parseFloat($.value);return!isNaN(V)&&V<q?{min:{min:q,actual:$.value}}:null};var q}static max($){return q=$,$=>{if(Je($.value)||Je(q))return null;const V=parseFloat($.value);return!isNaN(V)&&V>q?{max:{max:q,actual:$.value}}:null};var q}static required($){return In($)}static requiredTrue($){return!0===$.value?null:{required:!0}}static email($){return Je((q=$).value)||Ht.test(q.value)?null:{email:!0};var q}static minLength($){return q=$,$=>Je($.value)||!Me($.value)?null:$.value.length<q?{minlength:{requiredLength:q,actualLength:$.value.length}}:null;var q}static maxLength($){return mt($)}static pattern($){return function(q){if(!q)return tn;let $,V;return"string"==typeof q?(V="","^"!==q.charAt(0)&&(V+="^"),V+=q,"$"!==q.charAt(q.length-1)&&(V+="$"),$=new RegExp(V)):(V=q.toString(),$=q),ue=>{if(Je(ue.value))return null;const yt=ue.value;return $.test(yt)?null:{pattern:{requiredPattern:V,actualValue:yt}}}}($)}static nullValidator($){return null}static compose($){return kn($)}static composeAsync($){return zt($)}}function In(q){return Je(q.value)?{required:!0}:null}function mt(q){return $=>Me($.value)&&$.value.length>q?{maxlength:{requiredLength:q,actualLength:$.value.length}}:null}function tn(q){return null}function an(q){return null!=q}function bn(q){const $=(0,D.QGY)(q)?(0,Ce.D)(q):q;return(0,D.CqO)($),$}function Pn(q){let $={};return q.forEach(V=>{$=null!=V?Object.assign(Object.assign({},$),V):$}),0===Object.keys($).length?null:$}function Or(q,$){return $.map(V=>V(q))}function qt(q){return q.map($=>function(q){return!q.validate}($)?$:V=>$.validate(V))}function kn(q){if(!q)return null;const $=q.filter(an);return 0==$.length?null:function(V){return Pn(Or(V,$))}}function Ve(q){return null!=q?kn(qt(q)):null}function zt(q){if(!q)return null;const $=q.filter(an);return 0==$.length?null:function(V){return function(...q){if(1===q.length){const $=q[0];if((0,u.k)($))return ae($,null);if((0,Se.K)($)&&Object.getPrototypeOf($)===Object.prototype){const V=Object.keys($);return ae(V.map(ue=>$[ue]),V)}}if("function"==typeof q[q.length-1]){const $=q.pop();return ae(q=1===q.length&&(0,u.k)(q[0])?q[0]:q,null).pipe((0,ge.U)(V=>$(...V)))}return ae(q,null)}(Or(V,$).map(bn)).pipe((0,ge.U)(Pn))}}function ln(q){return null!=q?zt(qt(q)):null}function Rn(q,$){return null===q?[$]:Array.isArray(q)?[...q,$]:[q,$]}function ir(q){return q._rawValidators}function Vn(q){return q._rawAsyncValidators}function ri(q){return q?Array.isArray(q)?q:[q]:[]}function Zn(q,$){return Array.isArray(q)?q.includes($):q===$}function xi(q,$){const V=ri($);return ri(q).forEach(yt=>{Zn(V,yt)||V.push(yt)}),V}function yr(q,$){return ri($).filter(V=>!Zn(q,V))}let Vi=(()=>{class q{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(V){this._rawValidators=V||[],this._composedValidatorFn=Ve(this._rawValidators)}_setAsyncValidators(V){this._rawAsyncValidators=V||[],this._composedAsyncValidatorFn=ln(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(V){this._onDestroyCallbacks.push(V)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(V=>V()),this._onDestroyCallbacks=[]}reset(V){this.control&&this.control.reset(V)}hasError(V,ue){return!!this.control&&this.control.hasError(V,ue)}getError(V,ue){return this.control?this.control.getError(V,ue):null}}return q.\u0275fac=function(V){return new(V||q)},q.\u0275dir=D.lG2({type:q}),q})(),zr=(()=>{class q extends Vi{get formDirective(){return null}get path(){return null}}return q.\u0275fac=function(){let $;return function(ue){return($||($=D.n5z(q)))(ue||q)}}(),q.\u0275dir=D.lG2({type:q,features:[D.qOj]}),q})();class $r extends Vi{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class as{constructor($){this._cd=$}is($){var V,ue,yt;return"submitted"===$?!!(null===(V=this._cd)||void 0===V?void 0:V.submitted):!!(null===(yt=null===(ue=this._cd)||void 0===ue?void 0:ue.control)||void 0===yt?void 0:yt[$])}}let Ui=(()=>{class q extends as{constructor(V){super(V)}}return q.\u0275fac=function(V){return new(V||q)(D.Y36($r,2))},q.\u0275dir=D.lG2({type:q,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(V,ue){2&V&&D.ekj("ng-untouched",ue.is("untouched"))("ng-touched",ue.is("touched"))("ng-pristine",ue.is("pristine"))("ng-dirty",ue.is("dirty"))("ng-valid",ue.is("valid"))("ng-invalid",ue.is("invalid"))("ng-pending",ue.is("pending"))},features:[D.qOj]}),q})(),Tt=(()=>{class q extends as{constructor(V){super(V)}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(zr,10))},q.\u0275dir=D.lG2({type:q,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(V,ue){2&V&&D.ekj("ng-untouched",ue.is("untouched"))("ng-touched",ue.is("touched"))("ng-pristine",ue.is("pristine"))("ng-dirty",ue.is("dirty"))("ng-valid",ue.is("valid"))("ng-invalid",ue.is("invalid"))("ng-pending",ue.is("pending"))("ng-submitted",ue.is("submitted"))},features:[D.qOj]}),q})();function jn(q,$){return[...$.path,q]}function wn(q,$){Gr(q,$),$.valueAccessor.writeValue(q.value),function(q,$){$.valueAccessor.registerOnChange(V=>{q._pendingValue=V,q._pendingChange=!0,q._pendingDirty=!0,"change"===q.updateOn&&qi(q,$)})}(q,$),function(q,$){const V=(ue,yt)=>{$.valueAccessor.writeValue(ue),yt&&$.viewToModelUpdate(ue)};q.registerOnChange(V),$._registerOnDestroy(()=>{q._unregisterOnChange(V)})}(q,$),function(q,$){$.valueAccessor.registerOnTouched(()=>{q._pendingTouched=!0,"blur"===q.updateOn&&q._pendingChange&&qi(q,$),"submit"!==q.updateOn&&q.markAsTouched()})}(q,$),function(q,$){if($.valueAccessor.setDisabledState){const V=ue=>{$.valueAccessor.setDisabledState(ue)};q.registerOnDisabledChange(V),$._registerOnDestroy(()=>{q._unregisterOnDisabledChange(V)})}}(q,$)}function mi(q,$,V=!0){const ue=()=>{};$.valueAccessor&&($.valueAccessor.registerOnChange(ue),$.valueAccessor.registerOnTouched(ue)),vr(q,$),q&&($._invokeOnDestroyCallbacks(),q._registerOnCollectionChange(()=>{}))}function ar(q,$){q.forEach(V=>{V.registerOnValidatorChange&&V.registerOnValidatorChange($)})}function Gr(q,$){const V=ir(q);null!==$.validator?q.setValidators(Rn(V,$.validator)):"function"==typeof V&&q.setValidators([V]);const ue=Vn(q);null!==$.asyncValidator?q.setAsyncValidators(Rn(ue,$.asyncValidator)):"function"==typeof ue&&q.setAsyncValidators([ue]);const yt=()=>q.updateValueAndValidity();ar($._rawValidators,yt),ar($._rawAsyncValidators,yt)}function vr(q,$){let V=!1;if(null!==q){if(null!==$.validator){const yt=ir(q);if(Array.isArray(yt)&&yt.length>0){const Qt=yt.filter(Mn=>Mn!==$.validator);Qt.length!==yt.length&&(V=!0,q.setValidators(Qt))}}if(null!==$.asyncValidator){const yt=Vn(q);if(Array.isArray(yt)&&yt.length>0){const Qt=yt.filter(Mn=>Mn!==$.asyncValidator);Qt.length!==yt.length&&(V=!0,q.setAsyncValidators(Qt))}}}const ue=()=>{};return ar($._rawValidators,ue),ar($._rawAsyncValidators,ue),V}function qi(q,$){q._pendingDirty&&q.markAsDirty(),q.setValue(q._pendingValue,{emitModelToViewChange:!1}),$.viewToModelUpdate(q._pendingValue),q._pendingChange=!1}function K(q,$){Gr(q,$)}function de(q,$){if(!q.hasOwnProperty("model"))return!1;const V=q.model;return!!V.isFirstChange()||!Object.is($,V.currentValue)}function Qe(q,$){q._syncPendingControls(),$.forEach(V=>{const ue=V.control;"submit"===ue.updateOn&&ue._pendingChange&&(V.viewToModelUpdate(ue._pendingValue),ue._pendingChange=!1)})}function st(q,$){if(!$)return null;let V,ue,yt;return Array.isArray($),$.forEach(Qt=>{Qt.constructor===Ot?V=Qt:function(q){return Object.getPrototypeOf(q.constructor)===Ue}(Qt)?ue=Qt:yt=Qt}),yt||ue||V||null}function Ze(q,$){const V=q.indexOf($);V>-1&&q.splice(V,1)}const St="VALID",Gt="INVALID",Pt="PENDING",sn="DISABLED";function Ct(q){return(sr(q)?q.validators:q)||null}function Bn(q){return Array.isArray(q)?Ve(q):q||null}function Hn(q,$){return(sr($)?$.asyncValidators:q)||null}function An(q){return Array.isArray(q)?ln(q):q||null}function sr(q){return null!=q&&!Array.isArray(q)&&"object"==typeof q}class Yn{constructor($,V){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=$,this._rawAsyncValidators=V,this._composedValidatorFn=Bn(this._rawValidators),this._composedAsyncValidatorFn=An(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator($){this._rawValidators=this._composedValidatorFn=$}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator($){this._rawAsyncValidators=this._composedAsyncValidatorFn=$}get parent(){return this._parent}get valid(){return this.status===St}get invalid(){return this.status===Gt}get pending(){return this.status==Pt}get disabled(){return this.status===sn}get enabled(){return this.status!==sn}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators($){this._rawValidators=$,this._composedValidatorFn=Bn($)}setAsyncValidators($){this._rawAsyncValidators=$,this._composedAsyncValidatorFn=An($)}addValidators($){this.setValidators(xi($,this._rawValidators))}addAsyncValidators($){this.setAsyncValidators(xi($,this._rawAsyncValidators))}removeValidators($){this.setValidators(yr($,this._rawValidators))}removeAsyncValidators($){this.setAsyncValidators(yr($,this._rawAsyncValidators))}hasValidator($){return Zn(this._rawValidators,$)}hasAsyncValidator($){return Zn(this._rawAsyncValidators,$)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched($={}){this.touched=!0,this._parent&&!$.onlySelf&&this._parent.markAsTouched($)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild($=>$.markAllAsTouched())}markAsUntouched($={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(V=>{V.markAsUntouched({onlySelf:!0})}),this._parent&&!$.onlySelf&&this._parent._updateTouched($)}markAsDirty($={}){this.pristine=!1,this._parent&&!$.onlySelf&&this._parent.markAsDirty($)}markAsPristine($={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(V=>{V.markAsPristine({onlySelf:!0})}),this._parent&&!$.onlySelf&&this._parent._updatePristine($)}markAsPending($={}){this.status=Pt,!1!==$.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!$.onlySelf&&this._parent.markAsPending($)}disable($={}){const V=this._parentMarkedDirty($.onlySelf);this.status=sn,this.errors=null,this._forEachChild(ue=>{ue.disable(Object.assign(Object.assign({},$),{onlySelf:!0}))}),this._updateValue(),!1!==$.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},$),{skipPristineCheck:V})),this._onDisabledChange.forEach(ue=>ue(!0))}enable($={}){const V=this._parentMarkedDirty($.onlySelf);this.status=St,this._forEachChild(ue=>{ue.enable(Object.assign(Object.assign({},$),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:$.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},$),{skipPristineCheck:V})),this._onDisabledChange.forEach(ue=>ue(!1))}_updateAncestors($){this._parent&&!$.onlySelf&&(this._parent.updateValueAndValidity($),$.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent($){this._parent=$}updateValueAndValidity($={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===St||this.status===Pt)&&this._runAsyncValidator($.emitEvent)),!1!==$.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!$.onlySelf&&this._parent.updateValueAndValidity($)}_updateTreeValidity($={emitEvent:!0}){this._forEachChild(V=>V._updateTreeValidity($)),this.updateValueAndValidity({onlySelf:!0,emitEvent:$.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?sn:St}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator($){if(this.asyncValidator){this.status=Pt,this._hasOwnPendingAsyncValidator=!0;const V=bn(this.asyncValidator(this));this._asyncValidationSubscription=V.subscribe(ue=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(ue,{emitEvent:$})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors($,V={}){this.errors=$,this._updateControlsErrors(!1!==V.emitEvent)}get($){return function(q,$,V){if(null==$||(Array.isArray($)||($=$.split(".")),Array.isArray($)&&0===$.length))return null;let ue=q;return $.forEach(yt=>{ue=ue instanceof Wi?ue.controls.hasOwnProperty(yt)?ue.controls[yt]:null:ue instanceof en&&ue.at(yt)||null}),ue}(this,$)}getError($,V){const ue=V?this.get(V):this;return ue&&ue.errors?ue.errors[$]:null}hasError($,V){return!!this.getError($,V)}get root(){let $=this;for(;$._parent;)$=$._parent;return $}_updateControlsErrors($){this.status=this._calculateStatus(),$&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors($)}_initObservables(){this.valueChanges=new D.vpe,this.statusChanges=new D.vpe}_calculateStatus(){return this._allControlsDisabled()?sn:this.errors?Gt:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Pt)?Pt:this._anyControlsHaveStatus(Gt)?Gt:St}_anyControlsHaveStatus($){return this._anyControls(V=>V.status===$)}_anyControlsDirty(){return this._anyControls($=>$.dirty)}_anyControlsTouched(){return this._anyControls($=>$.touched)}_updatePristine($={}){this.pristine=!this._anyControlsDirty(),this._parent&&!$.onlySelf&&this._parent._updatePristine($)}_updateTouched($={}){this.touched=this._anyControlsTouched(),this._parent&&!$.onlySelf&&this._parent._updateTouched($)}_isBoxedValue($){return"object"==typeof $&&null!==$&&2===Object.keys($).length&&"value"in $&&"disabled"in $}_registerOnCollectionChange($){this._onCollectionChange=$}_setUpdateStrategy($){sr($)&&null!=$.updateOn&&(this._updateOn=$.updateOn)}_parentMarkedDirty($){return!$&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class tr extends Yn{constructor($=null,V,ue){super(Ct(V),Hn(ue,V)),this._onChange=[],this._applyFormState($),this._setUpdateStrategy(V),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}setValue($,V={}){this.value=this._pendingValue=$,this._onChange.length&&!1!==V.emitModelToViewChange&&this._onChange.forEach(ue=>ue(this.value,!1!==V.emitViewToModelChange)),this.updateValueAndValidity(V)}patchValue($,V={}){this.setValue($,V)}reset($=null,V={}){this._applyFormState($),this.markAsPristine(V),this.markAsUntouched(V),this.setValue(this.value,V),this._pendingChange=!1}_updateValue(){}_anyControls($){return!1}_allControlsDisabled(){return this.disabled}registerOnChange($){this._onChange.push($)}_unregisterOnChange($){Ze(this._onChange,$)}registerOnDisabledChange($){this._onDisabledChange.push($)}_unregisterOnDisabledChange($){Ze(this._onDisabledChange,$)}_forEachChild($){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState($){this._isBoxedValue($)?(this.value=this._pendingValue=$.value,$.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=$}}class Wi extends Yn{constructor($,V,ue){super(Ct(V),Hn(ue,V)),this.controls=$,this._initObservables(),this._setUpdateStrategy(V),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl($,V){return this.controls[$]?this.controls[$]:(this.controls[$]=V,V.setParent(this),V._registerOnCollectionChange(this._onCollectionChange),V)}addControl($,V,ue={}){this.registerControl($,V),this.updateValueAndValidity({emitEvent:ue.emitEvent}),this._onCollectionChange()}removeControl($,V={}){this.controls[$]&&this.controls[$]._registerOnCollectionChange(()=>{}),delete this.controls[$],this.updateValueAndValidity({emitEvent:V.emitEvent}),this._onCollectionChange()}setControl($,V,ue={}){this.controls[$]&&this.controls[$]._registerOnCollectionChange(()=>{}),delete this.controls[$],V&&this.registerControl($,V),this.updateValueAndValidity({emitEvent:ue.emitEvent}),this._onCollectionChange()}contains($){return this.controls.hasOwnProperty($)&&this.controls[$].enabled}setValue($,V={}){this._checkAllValuesPresent($),Object.keys($).forEach(ue=>{this._throwIfControlMissing(ue),this.controls[ue].setValue($[ue],{onlySelf:!0,emitEvent:V.emitEvent})}),this.updateValueAndValidity(V)}patchValue($,V={}){null!=$&&(Object.keys($).forEach(ue=>{this.controls[ue]&&this.controls[ue].patchValue($[ue],{onlySelf:!0,emitEvent:V.emitEvent})}),this.updateValueAndValidity(V))}reset($={},V={}){this._forEachChild((ue,yt)=>{ue.reset($[yt],{onlySelf:!0,emitEvent:V.emitEvent})}),this._updatePristine(V),this._updateTouched(V),this.updateValueAndValidity(V)}getRawValue(){return this._reduceChildren({},($,V,ue)=>($[ue]=V instanceof tr?V.value:V.getRawValue(),$))}_syncPendingControls(){let $=this._reduceChildren(!1,(V,ue)=>!!ue._syncPendingControls()||V);return $&&this.updateValueAndValidity({onlySelf:!0}),$}_throwIfControlMissing($){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[$])throw new Error(`Cannot find form control with name: ${$}.`)}_forEachChild($){Object.keys(this.controls).forEach(V=>{const ue=this.controls[V];ue&&$(ue,V)})}_setUpControls(){this._forEachChild($=>{$.setParent(this),$._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls($){for(const V of Object.keys(this.controls)){const ue=this.controls[V];if(this.contains(V)&&$(ue))return!0}return!1}_reduceValue(){return this._reduceChildren({},($,V,ue)=>((V.enabled||this.disabled)&&($[ue]=V.value),$))}_reduceChildren($,V){let ue=$;return this._forEachChild((yt,Qt)=>{ue=V(ue,yt,Qt)}),ue}_allControlsDisabled(){for(const $ of Object.keys(this.controls))if(this.controls[$].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent($){this._forEachChild((V,ue)=>{if(void 0===$[ue])throw new Error(`Must supply a value for form control with name: '${ue}'.`)})}}class en extends Yn{constructor($,V,ue){super(Ct(V),Hn(ue,V)),this.controls=$,this._initObservables(),this._setUpdateStrategy(V),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at($){return this.controls[$]}push($,V={}){this.controls.push($),this._registerControl($),this.updateValueAndValidity({emitEvent:V.emitEvent}),this._onCollectionChange()}insert($,V,ue={}){this.controls.splice($,0,V),this._registerControl(V),this.updateValueAndValidity({emitEvent:ue.emitEvent})}removeAt($,V={}){this.controls[$]&&this.controls[$]._registerOnCollectionChange(()=>{}),this.controls.splice($,1),this.updateValueAndValidity({emitEvent:V.emitEvent})}setControl($,V,ue={}){this.controls[$]&&this.controls[$]._registerOnCollectionChange(()=>{}),this.controls.splice($,1),V&&(this.controls.splice($,0,V),this._registerControl(V)),this.updateValueAndValidity({emitEvent:ue.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue($,V={}){this._checkAllValuesPresent($),$.forEach((ue,yt)=>{this._throwIfControlMissing(yt),this.at(yt).setValue(ue,{onlySelf:!0,emitEvent:V.emitEvent})}),this.updateValueAndValidity(V)}patchValue($,V={}){null!=$&&($.forEach((ue,yt)=>{this.at(yt)&&this.at(yt).patchValue(ue,{onlySelf:!0,emitEvent:V.emitEvent})}),this.updateValueAndValidity(V))}reset($=[],V={}){this._forEachChild((ue,yt)=>{ue.reset($[yt],{onlySelf:!0,emitEvent:V.emitEvent})}),this._updatePristine(V),this._updateTouched(V),this.updateValueAndValidity(V)}getRawValue(){return this.controls.map($=>$ instanceof tr?$.value:$.getRawValue())}clear($={}){this.controls.length<1||(this._forEachChild(V=>V._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:$.emitEvent}))}_syncPendingControls(){let $=this.controls.reduce((V,ue)=>!!ue._syncPendingControls()||V,!1);return $&&this.updateValueAndValidity({onlySelf:!0}),$}_throwIfControlMissing($){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at($))throw new Error(`Cannot find form control at index ${$}`)}_forEachChild($){this.controls.forEach((V,ue)=>{$(V,ue)})}_updateValue(){this.value=this.controls.filter($=>$.enabled||this.disabled).map($=>$.value)}_anyControls($){return this.controls.some(V=>V.enabled&&$(V))}_setUpControls(){this._forEachChild($=>this._registerControl($))}_checkAllValuesPresent($){this._forEachChild((V,ue)=>{if(void 0===$[ue])throw new Error(`Must supply a value for form control at index: ${ue}.`)})}_allControlsDisabled(){for(const $ of this.controls)if($.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl($){$.setParent(this),$._registerOnCollectionChange(this._onCollectionChange)}}const Bt={provide:zr,useExisting:(0,D.Gpc)(()=>mr)},Tn=(()=>Promise.resolve(null))();let mr=(()=>{class q extends zr{constructor(V,ue){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new D.vpe,this.form=new Wi({},Ve(V),ln(ue))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(V){Tn.then(()=>{const ue=this._findContainer(V.path);V.control=ue.registerControl(V.name,V.control),wn(V.control,V),V.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(V)})}getControl(V){return this.form.get(V.path)}removeControl(V){Tn.then(()=>{const ue=this._findContainer(V.path);ue&&ue.removeControl(V.name),Ze(this._directives,V)})}addFormGroup(V){Tn.then(()=>{const ue=this._findContainer(V.path),yt=new Wi({});K(yt,V),ue.registerControl(V.name,yt),yt.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(V){Tn.then(()=>{const ue=this._findContainer(V.path);ue&&ue.removeControl(V.name)})}getFormGroup(V){return this.form.get(V.path)}updateModel(V,ue){Tn.then(()=>{this.form.get(V.path).setValue(ue)})}setValue(V){this.control.setValue(V)}onSubmit(V){return this.submitted=!0,Qe(this.form,this._directives),this.ngSubmit.emit(V),!1}onReset(){this.resetForm()}resetForm(V){this.form.reset(V),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(V){return V.pop(),V.length?this.form.get(V):this.form}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(Ge,10),D.Y36(Lt,10))},q.\u0275dir=D.lG2({type:q,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(V,ue){1&V&&D.NdJ("submit",function(Qt){return ue.onSubmit(Qt)})("reset",function(){return ue.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[D._Bn([Bt]),D.qOj]}),q})();const us={provide:$r,useExisting:(0,D.Gpc)(()=>Ti)},ws=(()=>Promise.resolve(null))();let Ti=(()=>{class q extends $r{constructor(V,ue,yt,Qt){super(),this.control=new tr,this._registered=!1,this.update=new D.vpe,this._parent=V,this._setValidators(ue),this._setAsyncValidators(yt),this.valueAccessor=st(0,Qt)}ngOnChanges(V){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in V&&this._updateDisabled(V),de(V,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?jn(this.name,this._parent):[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(V){this.viewModel=V,this.update.emit(V)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){wn(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(V){ws.then(()=>{this.control.setValue(V,{emitViewToModelChange:!1})})}_updateDisabled(V){const ue=V.isDisabled.currentValue,yt=""===ue||ue&&"false"!==ue;ws.then(()=>{yt&&!this.control.disabled?this.control.disable():!yt&&this.control.disabled&&this.control.enable()})}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(zr,9),D.Y36(Ge,10),D.Y36(Lt,10),D.Y36(Be,10))},q.\u0275dir=D.lG2({type:q,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[D._Bn([us]),D.qOj,D.TTD]}),q})(),Si=(()=>{class q{}return q.\u0275fac=function(V){return new(V||q)},q.\u0275dir=D.lG2({type:q,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),q})();const ji={provide:Be,useExisting:(0,D.Gpc)(()=>Es),multi:!0};let hs=(()=>{class q{}return q.\u0275fac=function(V){return new(V||q)},q.\u0275mod=D.oAB({type:q}),q.\u0275inj=D.cJS({}),q})(),$l=(()=>{class q{constructor(){this._accessors=[]}add(V,ue){this._accessors.push([V,ue])}remove(V){for(let ue=this._accessors.length-1;ue>=0;--ue)if(this._accessors[ue][1]===V)return void this._accessors.splice(ue,1)}select(V){this._accessors.forEach(ue=>{this._isSameGroup(ue,V)&&ue[1]!==V&&ue[1].fireUncheck(V.value)})}_isSameGroup(V,ue){return!!V[0].control&&V[0]._parent===ue._control._parent&&V[1].name===ue.name}}return q.\u0275fac=function(V){return new(V||q)},q.\u0275prov=(0,D.Yz7)({factory:function(){return new q},token:q,providedIn:hs}),q})(),Es=(()=>{class q extends Ue{constructor(V,ue,yt,Qt){super(V,ue),this._registry=yt,this._injector=Qt,this.onChange=()=>{}}ngOnInit(){this._control=this._injector.get($r),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(V){this._state=V===this.value,this.setProperty("checked",this._state)}registerOnChange(V){this._fn=V,this.onChange=()=>{V(this.value),this._registry.select(this)}}fireUncheck(V){this.writeValue(V)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(D.Qsj),D.Y36(D.SBq),D.Y36($l),D.Y36(D.zs3))},q.\u0275dir=D.lG2({type:q,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(V,ue){1&V&&D.NdJ("change",function(){return ue.onChange()})("blur",function(){return ue.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[D._Bn([ji]),D.qOj]}),q})();const Yi=new D.OlP("NgModelWithFormControlWarning"),es={provide:zr,useExisting:(0,D.Gpc)(()=>Hr)};let Hr=(()=>{class q extends zr{constructor(V,ue){super(),this.validators=V,this.asyncValidators=ue,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new D.vpe,this._setValidators(V),this._setAsyncValidators(ue)}ngOnChanges(V){this._checkFormPresent(),V.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(vr(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(V){const ue=this.form.get(V.path);return wn(ue,V),ue.updateValueAndValidity({emitEvent:!1}),this.directives.push(V),ue}getControl(V){return this.form.get(V.path)}removeControl(V){mi(V.control||null,V,!1),Ze(this.directives,V)}addFormGroup(V){this._setUpFormContainer(V)}removeFormGroup(V){this._cleanUpFormContainer(V)}getFormGroup(V){return this.form.get(V.path)}addFormArray(V){this._setUpFormContainer(V)}removeFormArray(V){this._cleanUpFormContainer(V)}getFormArray(V){return this.form.get(V.path)}updateModel(V,ue){this.form.get(V.path).setValue(ue)}onSubmit(V){return this.submitted=!0,Qe(this.form,this.directives),this.ngSubmit.emit(V),!1}onReset(){this.resetForm()}resetForm(V){this.form.reset(V),this.submitted=!1}_updateDomValue(){this.directives.forEach(V=>{const ue=V.control,yt=this.form.get(V.path);ue!==yt&&(mi(ue||null,V),yt instanceof tr&&(wn(yt,V),V.control=yt))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(V){const ue=this.form.get(V.path);K(ue,V),ue.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(V){if(this.form){const ue=this.form.get(V.path);ue&&function(q,$){return vr(q,$)}(ue,V)&&ue.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Gr(this.form,this),this._oldForm&&vr(this._oldForm,this)}_checkFormPresent(){}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(Ge,10),D.Y36(Lt,10))},q.\u0275dir=D.lG2({type:q,selectors:[["","formGroup",""]],hostBindings:function(V,ue){1&V&&D.NdJ("submit",function(Qt){return ue.onSubmit(Qt)})("reset",function(){return ue.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[D._Bn([es]),D.qOj,D.TTD]}),q})();const ts={provide:$r,useExisting:(0,D.Gpc)(()=>Ni)};let Ni=(()=>{class q extends $r{constructor(V,ue,yt,Qt,Mn){super(),this._ngModelWarningConfig=Mn,this._added=!1,this.update=new D.vpe,this._ngModelWarningSent=!1,this._parent=V,this._setValidators(ue),this._setAsyncValidators(yt),this.valueAccessor=st(0,Qt)}set isDisabled(V){}ngOnChanges(V){this._added||this._setUpControl(),de(V,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(V){this.viewModel=V,this.update.emit(V)}get path(){return jn(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(zr,13),D.Y36(Ge,10),D.Y36(Lt,10),D.Y36(Be,10),D.Y36(Yi,8))},q.\u0275dir=D.lG2({type:q,selectors:[["","formControlName",""]],inputs:{isDisabled:["disabled","isDisabled"],name:["formControlName","name"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[D._Bn([ts]),D.qOj,D.TTD]}),q._ngModelWarningSentOnce=!1,q})();const qs={provide:Be,useExisting:(0,D.Gpc)(()=>ua),multi:!0};function Ao(q,$){return null==q?`${$}`:($&&"object"==typeof $&&($="Object"),`${q}: ${$}`.slice(0,50))}let ua=(()=>{class q extends Ue{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(V){this._compareWith=V}writeValue(V){this.value=V;const ue=this._getOptionId(V);null==ue&&this.setProperty("selectedIndex",-1);const yt=Ao(ue,V);this.setProperty("value",yt)}registerOnChange(V){this.onChange=ue=>{this.value=this._getOptionValue(ue),V(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(V){for(const ue of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(ue),V))return ue;return null}_getOptionValue(V){const ue=function(q){return q.split(":")[0]}(V);return this._optionMap.has(ue)?this._optionMap.get(ue):V}}return q.\u0275fac=function(){let $;return function(ue){return($||($=D.n5z(q)))(ue||q)}}(),q.\u0275dir=D.lG2({type:q,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(V,ue){1&V&&D.NdJ("change",function(Qt){return ue.onChange(Qt.target.value)})("blur",function(){return ue.onTouched()})},inputs:{compareWith:"compareWith"},features:[D._Bn([qs]),D.qOj]}),q})(),Ka=(()=>{class q{constructor(V,ue,yt){this._element=V,this._renderer=ue,this._select=yt,this._select&&(this.id=this._select._registerOption())}set ngValue(V){null!=this._select&&(this._select._optionMap.set(this.id,V),this._setElementValue(Ao(this.id,V)),this._select.writeValue(this._select.value))}set value(V){this._setElementValue(V),this._select&&this._select.writeValue(this._select.value)}_setElementValue(V){this._renderer.setProperty(this._element.nativeElement,"value",V)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(D.SBq),D.Y36(D.Qsj),D.Y36(ua,9))},q.\u0275dir=D.lG2({type:q,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),q})();const ha={provide:Be,useExisting:(0,D.Gpc)(()=>io),multi:!0};function da(q,$){return null==q?`${$}`:("string"==typeof $&&($=`'${$}'`),$&&"object"==typeof $&&($="Object"),`${q}: ${$}`.slice(0,50))}let io=(()=>{class q extends Ue{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(V){this._compareWith=V}writeValue(V){let ue;if(this.value=V,Array.isArray(V)){const yt=V.map(Qt=>this._getOptionId(Qt));ue=(Qt,Mn)=>{Qt._setSelected(yt.indexOf(Mn.toString())>-1)}}else ue=(yt,Qt)=>{yt._setSelected(!1)};this._optionMap.forEach(ue)}registerOnChange(V){this.onChange=ue=>{const yt=[];if(void 0!==ue.selectedOptions){const Qt=ue.selectedOptions;for(let Mn=0;Mn<Qt.length;Mn++){const Vr=Qt.item(Mn),Ai=this._getOptionValue(Vr.value);yt.push(Ai)}}else{const Qt=ue.options;for(let Mn=0;Mn<Qt.length;Mn++){const Vr=Qt.item(Mn);if(Vr.selected){const Ai=this._getOptionValue(Vr.value);yt.push(Ai)}}}this.value=yt,V(yt)}}_registerOption(V){const ue=(this._idCounter++).toString();return this._optionMap.set(ue,V),ue}_getOptionId(V){for(const ue of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(ue)._value,V))return ue;return null}_getOptionValue(V){const ue=function(q){return q.split(":")[0]}(V);return this._optionMap.has(ue)?this._optionMap.get(ue)._value:V}}return q.\u0275fac=function(){let $;return function(ue){return($||($=D.n5z(q)))(ue||q)}}(),q.\u0275dir=D.lG2({type:q,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(V,ue){1&V&&D.NdJ("change",function(Qt){return ue.onChange(Qt.target)})("blur",function(){return ue.onTouched()})},inputs:{compareWith:"compareWith"},features:[D._Bn([ha]),D.qOj]}),q})(),Xa=(()=>{class q{constructor(V,ue,yt){this._element=V,this._renderer=ue,this._select=yt,this._select&&(this.id=this._select._registerOption(this))}set ngValue(V){null!=this._select&&(this._value=V,this._setElementValue(da(this.id,V)),this._select.writeValue(this._select.value))}set value(V){this._select?(this._value=V,this._setElementValue(da(this.id,V)),this._select.writeValue(this._select.value)):this._setElementValue(V)}_setElementValue(V){this._renderer.setProperty(this._element.nativeElement,"value",V)}_setSelected(V){this._renderer.setProperty(this._element.nativeElement,"selected",V)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return q.\u0275fac=function(V){return new(V||q)(D.Y36(D.SBq),D.Y36(D.Qsj),D.Y36(io,9))},q.\u0275dir=D.lG2({type:q,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),q})();const so={provide:Ge,useExisting:(0,D.Gpc)(()=>Io),multi:!0};let Io=(()=>{class q{constructor(){this._required=!1}get required(){return this._required}set required(V){this._required=null!=V&&!1!==V&&"false"!=`${V}`,this._onChange&&this._onChange()}validate(V){return this.required?In(V):null}registerOnValidatorChange(V){this._onChange=V}}return q.\u0275fac=function(V){return new(V||q)},q.\u0275dir=D.lG2({type:q,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(V,ue){2&V&&D.uIk("required",ue.required?"":null)},inputs:{required:"required"},features:[D._Bn([so])]}),q})();const gr={provide:Ge,useExisting:(0,D.Gpc)(()=>oo),multi:!0};let oo=(()=>{class q{constructor(){this._validator=tn}ngOnChanges(V){"maxlength"in V&&(this._createValidator(),this._onChange&&this._onChange())}validate(V){return this.enabled()?this._validator(V):null}registerOnValidatorChange(V){this._onChange=V}_createValidator(){this._validator=this.enabled()?mt(function(q){return"number"==typeof q?q:parseInt(q,10)}(this.maxlength)):tn}enabled(){return null!=this.maxlength}}return q.\u0275fac=function(V){return new(V||q)},q.\u0275dir=D.lG2({type:q,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(V,ue){2&V&&D.uIk("maxlength",ue.enabled()?ue.maxlength:null)},inputs:{maxlength:"maxlength"},features:[D._Bn([gr]),D.TTD]}),q})(),he=(()=>{class q{}return q.\u0275fac=function(V){return new(V||q)},q.\u0275mod=D.oAB({type:q}),q.\u0275inj=D.cJS({imports:[[hs]]}),q})(),ee=(()=>{class q{}return q.\u0275fac=function(V){return new(V||q)},q.\u0275mod=D.oAB({type:q}),q.\u0275inj=D.cJS({imports:[he]}),q})(),_e=(()=>{class q{static withConfig(V){return{ngModule:q,providers:[{provide:Yi,useValue:V.warnOnNgModelWithFormControl}]}}}return q.\u0275fac=function(V){return new(V||q)},q.\u0275mod=D.oAB({type:q}),q.\u0275inj=D.cJS({imports:[he]}),q})(),Dt=(()=>{class q{group(V,ue=null){const yt=this._reduceControls(V);let Vr,Qt=null,Mn=null;return null!=ue&&(function(q){return void 0!==q.asyncValidators||void 0!==q.validators||void 0!==q.updateOn}(ue)?(Qt=null!=ue.validators?ue.validators:null,Mn=null!=ue.asyncValidators?ue.asyncValidators:null,Vr=null!=ue.updateOn?ue.updateOn:void 0):(Qt=null!=ue.validator?ue.validator:null,Mn=null!=ue.asyncValidator?ue.asyncValidator:null)),new Wi(yt,{asyncValidators:Mn,updateOn:Vr,validators:Qt})}control(V,ue,yt){return new tr(V,ue,yt)}array(V,ue,yt){const Qt=V.map(Mn=>this._createControl(Mn));return new en(Qt,ue,yt)}_reduceControls(V){const ue={};return Object.keys(V).forEach(yt=>{ue[yt]=this._createControl(V[yt])}),ue}_createControl(V){return V instanceof tr||V instanceof Wi||V instanceof en?V:Array.isArray(V)?this.control(V[0],V.length>1?V[1]:null,V.length>2?V[2]:null):this.control(V)}}return q.\u0275fac=function(V){return new(V||q)},q.\u0275prov=(0,D.Yz7)({factory:function(){return new q},token:q,providedIn:_e}),q})()},1385:(Mt,at,te)=>{"use strict";te.d(at,{gz:()=>Ni,Av:()=>ar,F0:()=>gs,rH:()=>No,Bz:()=>Ql,lC:()=>va});var D=te(8583),A=te(639),R=te(7709),u=te(7971);class ge extends R.xQ{constructor(P){super(),this._value=P}get value(){return this.getValue()}_subscribe(P){const S=super._subscribe(P);return S&&!S.closed&&P.next(this._value),S}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new u.N;return this._value}next(P){super.next(this._value=P)}}var Se=te(4869),Ce=te(9796),ce=te(7393);class ae extends ce.L{notifyNext(P,S,G,ne,me){this.destination.next(S)}notifyError(P,S){this.destination.error(P)}notifyComplete(P){this.destination.complete()}}class ve extends ce.L{constructor(P,S,G){super(),this.parent=P,this.outerValue=S,this.outerIndex=G,this.index=0}_next(P){this.parent.notifyNext(this.outerValue,P,this.outerIndex,this.index++,this)}_error(P){this.parent.notifyError(P,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var Ue=te(7444),Be=te(7574);function we(B,P,S,G,ne=new ve(B,S,G)){if(!ne.closed)return P instanceof Be.y?P.subscribe(ne):(0,Ue.s)(P)(ne)}var Oe=te(6693);const Ne={};class lt{constructor(P){this.resultSelector=P}call(P,S){return S.subscribe(new Ot(P,this.resultSelector))}}class Ot extends ae{constructor(P,S){super(P),this.resultSelector=S,this.active=0,this.values=[],this.observables=[]}_next(P){this.values.push(Ne),this.observables.push(P)}_complete(){const P=this.observables,S=P.length;if(0===S)this.destination.complete();else{this.active=S,this.toRespond=S;for(let G=0;G<S;G++)this.add(we(this,P[G],void 0,G))}}notifyComplete(P){0==(this.active-=1)&&this.destination.complete()}notifyNext(P,S,G){const ne=this.values,ze=this.toRespond?ne[G]===Ne?--this.toRespond:this.toRespond:0;ne[G]=S,0===ze&&(this.resultSelector?this._tryResultSelector(ne):this.destination.next(ne.slice()))}_tryResultSelector(P){let S;try{S=this.resultSelector.apply(this,P)}catch(G){return void this.destination.error(G)}this.destination.next(S)}}const Me=(()=>{function B(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return B.prototype=Object.create(Error.prototype),B})();var Ge=te(5917),Lt=te(3282);function zn(...B){return(0,Lt.J)(1)((0,Ge.of)(...B))}var gn=te(4402);const Xt=new Be.y(B=>B.complete());function In(B){return B?function(B){return new Be.y(P=>B.schedule(()=>P.complete()))}(B):Xt}function ct(B){return new Be.y(P=>{let S;try{S=B()}catch(ne){return void P.error(ne)}return(S?(0,gn.D)(S):In()).subscribe(P)})}var tt=te(2441);const gt=(()=>{function B(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return B.prototype=Object.create(Error.prototype),B})();function tn(B){return P=>0===B?In():P.lift(new an(B))}class an{constructor(P){if(this.total=P,this.total<0)throw new gt}call(P,S){return S.subscribe(new bn(P,this.total))}}class bn extends ce.L{constructor(P,S){super(P),this.total=S,this.count=0}_next(P){const S=this.total,G=++this.count;G<=S&&(this.destination.next(P),G===S&&(this.destination.complete(),this.unsubscribe()))}}function Or(B,P){let S=!1;return arguments.length>=2&&(S=!0),function(ne){return ne.lift(new Jr(B,P,S))}}class Jr{constructor(P,S,G=!1){this.accumulator=P,this.seed=S,this.hasSeed=G}call(P,S){return S.subscribe(new qt(P,this.accumulator,this.seed,this.hasSeed))}}class qt extends ce.L{constructor(P,S,G,ne){super(P),this.accumulator=S,this._seed=G,this.hasSeed=ne,this.index=0}get seed(){return this._seed}set seed(P){this.hasSeed=!0,this._seed=P}_next(P){if(this.hasSeed)return this._tryNext(P);this.seed=P,this.destination.next(P)}_tryNext(P){const S=this.index++;let G;try{G=this.accumulator(this.seed,P,S)}catch(ne){this.destination.error(ne)}this.seed=G,this.destination.next(G)}}var kn=te(5435);function Ve(B){return function(S){return 0===B?In():S.lift(new zt(B))}}class zt{constructor(P){if(this.total=P,this.total<0)throw new gt}call(P,S){return S.subscribe(new ln(P,this.total))}}class ln extends ce.L{constructor(P,S){super(P),this.total=S,this.ring=new Array,this.count=0}_next(P){const S=this.ring,G=this.total,ne=this.count++;S.length<G?S.push(P):S[ne%G]=P}_complete(){const P=this.destination;let S=this.count;if(S>0){const G=this.count>=this.total?this.total:this.count,ne=this.ring;for(let me=0;me<G;me++){const ze=S++%G;P.next(ne[ze])}}P.complete()}}function Rn(B=ri){return P=>P.lift(new ir(B))}class ir{constructor(P){this.errorFactory=P}call(P,S){return S.subscribe(new Vn(P,this.errorFactory))}}class Vn extends ce.L{constructor(P,S){super(P),this.errorFactory=S,this.hasValue=!1}_next(P){this.hasValue=!0,this.destination.next(P)}_complete(){if(this.hasValue)return this.destination.complete();{let P;try{P=this.errorFactory()}catch(S){P=S}this.destination.error(P)}}}function ri(){return new Me}function Zn(B=null){return P=>P.lift(new xi(B))}class xi{constructor(P){this.defaultValue=P}call(P,S){return S.subscribe(new yr(P,this.defaultValue))}}class yr extends ce.L{constructor(P,S){super(P),this.defaultValue=S,this.isEmpty=!0}_next(P){this.isEmpty=!1,this.destination.next(P)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}var Vi=te(4487);function $r(B,P){const S=arguments.length>=2;return G=>G.pipe(B?(0,kn.h)((ne,me)=>B(ne,me,G)):Vi.y,tn(1),S?Zn(P):Rn(()=>new Me))}var as=te(5319);class ls{constructor(P){this.callback=P}call(P,S){return S.subscribe(new Ui(P,this.callback))}}class Ui extends ce.L{constructor(P,S){super(P),this.add(new as.w(S))}}var Tt=te(8002),rt=te(3190),nt=te(5304),Wt=te(4612),_t=te(9773),hn=te(3342),mn=te(1307);class _n{constructor(P,S){this.id=P,this.url=S}}class xn extends _n{constructor(P,S,G="imperative",ne=null){super(P,S),this.navigationTrigger=G,this.restoredState=ne}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class jr extends _n{constructor(P,S,G){super(P,S),this.urlAfterRedirects=G}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Fr extends _n{constructor(P,S,G){super(P,S),this.reason=G}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class ii extends _n{constructor(P,S,G){super(P,S),this.error=G}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Wr extends _n{constructor(P,S,G,ne){super(P,S),this.urlAfterRedirects=G,this.state=ne}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class jn extends _n{constructor(P,S,G,ne){super(P,S),this.urlAfterRedirects=G,this.state=ne}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wn extends _n{constructor(P,S,G,ne,me){super(P,S),this.urlAfterRedirects=G,this.state=ne,this.shouldActivate=me}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class mi extends _n{constructor(P,S,G,ne){super(P,S),this.urlAfterRedirects=G,this.state=ne}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ar extends _n{constructor(P,S,G,ne){super(P,S),this.urlAfterRedirects=G,this.state=ne}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Yr{constructor(P){this.route=P}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Gr{constructor(P){this.route=P}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class vr{constructor(P){this.snapshot=P}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class cs{constructor(P){this.snapshot=P}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ro{constructor(P){this.snapshot=P}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class qi{constructor(P){this.snapshot=P}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class lr{constructor(P,S,G){this.routerEvent=P,this.position=S,this.anchor=G}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const K="primary";class k{constructor(P){this.params=P||{}}has(P){return Object.prototype.hasOwnProperty.call(this.params,P)}get(P){if(this.has(P)){const S=this.params[P];return Array.isArray(S)?S[0]:S}return null}getAll(P){if(this.has(P)){const S=this.params[P];return Array.isArray(S)?S:[S]}return[]}get keys(){return Object.keys(this.params)}}function N(B){return new k(B)}const H="ngNavigationCancelingError";function de(B){const P=Error("NavigationCancelingError: "+B);return P[H]=!0,P}function Qe(B,P,S){const G=S.path.split("/");if(G.length>B.length||"full"===S.pathMatch&&(P.hasChildren()||G.length<B.length))return null;const ne={};for(let me=0;me<G.length;me++){const ze=G[me],et=B[me];if(ze.startsWith(":"))ne[ze.substring(1)]=et;else if(ze!==et.path)return null}return{consumed:B.slice(0,G.length),posParams:ne}}function Ze(B,P){const S=B?Object.keys(B):void 0,G=P?Object.keys(P):void 0;if(!S||!G||S.length!=G.length)return!1;let ne;for(let me=0;me<S.length;me++)if(ne=S[me],!ft(B[ne],P[ne]))return!1;return!0}function ft(B,P){if(Array.isArray(B)&&Array.isArray(P)){if(B.length!==P.length)return!1;const S=[...B].sort(),G=[...P].sort();return S.every((ne,me)=>G[me]===ne)}return B===P}function St(B){return Array.prototype.concat.apply([],B)}function Gt(B){return B.length>0?B[B.length-1]:null}function sn(B,P){for(const S in B)B.hasOwnProperty(S)&&P(B[S],S)}function He(B){return(0,A.CqO)(B)?B:(0,A.QGY)(B)?(0,gn.D)(Promise.resolve(B)):(0,Ge.of)(B)}const Bn={exact:function Yn(B,P,S){if(!Zr(B.segments,P.segments)||!Bt(B.segments,P.segments,S)||B.numberOfChildren!==P.numberOfChildren)return!1;for(const G in P.children)if(!B.children[G]||!Yn(B.children[G],P.children[G],S))return!1;return!0},subset:Wi},Hn={exact:function(B,P){return Ze(B,P)},subset:function(B,P){return Object.keys(P).length<=Object.keys(B).length&&Object.keys(P).every(S=>ft(B[S],P[S]))},ignored:()=>!0};function An(B,P,S){return Bn[S.paths](B.root,P.root,S.matrixParams)&&Hn[S.queryParams](B.queryParams,P.queryParams)&&!("exact"===S.fragment&&B.fragment!==P.fragment)}function Wi(B,P,S){return en(B,P,P.segments,S)}function en(B,P,S,G){if(B.segments.length>S.length){const ne=B.segments.slice(0,S.length);return!(!Zr(ne,S)||P.hasChildren()||!Bt(ne,S,G))}if(B.segments.length===S.length){if(!Zr(B.segments,S)||!Bt(B.segments,S,G))return!1;for(const ne in P.children)if(!B.children[ne]||!Wi(B.children[ne],P.children[ne],G))return!1;return!0}{const ne=S.slice(0,B.segments.length),me=S.slice(B.segments.length);return!!(Zr(B.segments,ne)&&Bt(B.segments,ne,G)&&B.children[K])&&en(B.children[K],P,me,G)}}function Bt(B,P,S){return P.every((G,ne)=>Hn[S](B[ne].parameters,G.parameters))}class cn{constructor(P,S,G){this.root=P,this.queryParams=S,this.fragment=G}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=N(this.queryParams)),this._queryParamMap}toString(){return xr.serialize(this)}}class Tn{constructor(P,S){this.segments=P,this.children=S,this.parent=null,sn(S,(G,ne)=>G.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Xn(this)}}class mr{constructor(P,S){this.path=P,this.parameters=S}get parameterMap(){return this._parameterMap||(this._parameterMap=N(this.parameters)),this._parameterMap}toString(){return ji(this)}}function Zr(B,P){return B.length===P.length&&B.every((S,G)=>S.path===P[G].path)}class Br{}class Ci{parse(P){const S=new Ar(P);return new cn(S.parseRootSegment(),S.parseQueryParams(),S.parseFragment())}serialize(P){var B;return`${`/${us(P.root,!0)}`}${function(B){const P=Object.keys(B).map(S=>{const G=B[S];return Array.isArray(G)?G.map(ne=>`${ws(S)}=${ws(ne)}`).join("&"):`${ws(S)}=${ws(G)}`}).filter(S=>!!S);return P.length?`?${P.join("&")}`:""}(P.queryParams)}${"string"==typeof P.fragment?`#${B=P.fragment,encodeURI(B)}`:""}`}}const xr=new Ci;function Xn(B){return B.segments.map(P=>ji(P)).join("/")}function us(B,P){if(!B.hasChildren())return Xn(B);if(P){const S=B.children[K]?us(B.children[K],!1):"",G=[];return sn(B.children,(ne,me)=>{me!==K&&G.push(`${me}:${us(ne,!1)}`)}),G.length>0?`${S}(${G.join("//")})`:S}{const S=function(B,P){let S=[];return sn(B.children,(G,ne)=>{ne===K&&(S=S.concat(P(G,ne)))}),sn(B.children,(G,ne)=>{ne!==K&&(S=S.concat(P(G,ne)))}),S}(B,(G,ne)=>ne===K?[us(B.children[K],!1)]:[`${ne}:${us(G,!1)}`]);return 1===Object.keys(B.children).length&&null!=B.children[K]?`${Xn(B)}/${S[0]}`:`${Xn(B)}/(${S.join("//")})`}}function Is(B){return encodeURIComponent(B).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ws(B){return Is(B).replace(/%3B/gi,";")}function Si(B){return Is(B).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function $n(B){return decodeURIComponent(B)}function Ps(B){return $n(B.replace(/\+/g,"%20"))}function ji(B){return`${Si(B.path)}${function(B){return Object.keys(B).map(P=>`;${Si(P)}=${Si(B[P])}`).join("")}(B.parameters)}`}const $l=/^[^\/()?;=#]+/;function Es(B){const P=B.match($l);return P?P[0]:""}const si=/^[^=?&#]+/,Yi=/^[^?&#]+/;class Ar{constructor(P){this.url=P,this.remaining=P}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Tn([],{}):new Tn([],this.parseChildren())}parseQueryParams(){const P={};if(this.consumeOptional("?"))do{this.parseQueryParam(P)}while(this.consumeOptional("&"));return P}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const P=[];for(this.peekStartsWith("(")||P.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),P.push(this.parseSegment());let S={};this.peekStartsWith("/(")&&(this.capture("/"),S=this.parseParens(!0));let G={};return this.peekStartsWith("(")&&(G=this.parseParens(!1)),(P.length>0||Object.keys(S).length>0)&&(G[K]=new Tn(P,S)),G}parseSegment(){const P=Es(this.remaining);if(""===P&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(P),new mr($n(P),this.parseMatrixParams())}parseMatrixParams(){const P={};for(;this.consumeOptional(";");)this.parseParam(P);return P}parseParam(P){const S=Es(this.remaining);if(!S)return;this.capture(S);let G="";if(this.consumeOptional("=")){const ne=Es(this.remaining);ne&&(G=ne,this.capture(G))}P[$n(S)]=$n(G)}parseQueryParam(P){const S=function(B){const P=B.match(si);return P?P[0]:""}(this.remaining);if(!S)return;this.capture(S);let G="";if(this.consumeOptional("=")){const ze=function(B){const P=B.match(Yi);return P?P[0]:""}(this.remaining);ze&&(G=ze,this.capture(G))}const ne=Ps(S),me=Ps(G);if(P.hasOwnProperty(ne)){let ze=P[ne];Array.isArray(ze)||(ze=[ze],P[ne]=ze),ze.push(me)}else P[ne]=me}parseParens(P){const S={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const G=Es(this.remaining),ne=this.remaining[G.length];if("/"!==ne&&")"!==ne&&";"!==ne)throw new Error(`Cannot parse url '${this.url}'`);let me;G.indexOf(":")>-1?(me=G.substr(0,G.indexOf(":")),this.capture(me),this.capture(":")):P&&(me=K);const ze=this.parseChildren();S[me]=1===Object.keys(ze).length?ze[K]:new Tn([],ze),this.consumeOptional("//")}return S}peekStartsWith(P){return this.remaining.startsWith(P)}consumeOptional(P){return!!this.peekStartsWith(P)&&(this.remaining=this.remaining.substring(P.length),!0)}capture(P){if(!this.consumeOptional(P))throw new Error(`Expected "${P}".`)}}class es{constructor(P){this._root=P}get root(){return this._root.value}parent(P){const S=this.pathFromRoot(P);return S.length>1?S[S.length-2]:null}children(P){const S=Hr(P,this._root);return S?S.children.map(G=>G.value):[]}firstChild(P){const S=Hr(P,this._root);return S&&S.children.length>0?S.children[0].value:null}siblings(P){const S=Fi(P,this._root);return S.length<2?[]:S[S.length-2].children.map(ne=>ne.value).filter(ne=>ne!==P)}pathFromRoot(P){return Fi(P,this._root).map(S=>S.value)}}function Hr(B,P){if(B===P.value)return P;for(const S of P.children){const G=Hr(B,S);if(G)return G}return null}function Fi(B,P){if(B===P.value)return[P];for(const S of P.children){const G=Fi(B,S);if(G.length)return G.unshift(P),G}return[]}class Ki{constructor(P,S){this.value=P,this.children=S}toString(){return`TreeNode(${this.value})`}}function Li(B){const P={};return B&&B.children.forEach(S=>P[S.value.outlet]=S),P}class Hs extends es{constructor(P,S){super(P),this.snapshot=S,Ka(this,P)}toString(){return this.snapshot.toString()}}function qr(B,P){const S=function(B,P){const ze=new Wo([],{},{},"",{},K,P,null,B.root,-1,{});return new ua("",new Ki(ze,[]))}(B,P),G=new ge([new mr("",{})]),ne=new ge({}),me=new ge({}),ze=new ge({}),et=new ge(""),Nt=new Ni(G,ne,ze,et,me,K,P,S.root);return Nt.snapshot=S.root,new Hs(new Ki(Nt,[]),S)}class Ni{constructor(P,S,G,ne,me,ze,et,Nt){this.url=P,this.params=S,this.queryParams=G,this.fragment=ne,this.data=me,this.outlet=ze,this.component=et,this._futureSnapshot=Nt}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Tt.U)(P=>N(P)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Tt.U)(P=>N(P)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function qs(B,P="emptyOnly"){const S=B.pathFromRoot;let G=0;if("always"!==P)for(G=S.length-1;G>=1;){const ne=S[G],me=S[G-1];if(ne.routeConfig&&""===ne.routeConfig.path)G--;else{if(me.component)break;G--}}return function(B){return B.reduce((P,S)=>({params:Object.assign(Object.assign({},P.params),S.params),data:Object.assign(Object.assign({},P.data),S.data),resolve:Object.assign(Object.assign({},P.resolve),S._resolvedData)}),{params:{},data:{},resolve:{}})}(S.slice(G))}class Wo{constructor(P,S,G,ne,me,ze,et,Nt,En,dr,Un){this.url=P,this.params=S,this.queryParams=G,this.fragment=ne,this.data=me,this.outlet=ze,this.component=et,this.routeConfig=Nt,this._urlSegment=En,this._lastPathIndex=dr,this._resolve=Un}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=N(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=N(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(G=>G.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ua extends es{constructor(P,S){super(S),this.url=P,Ka(this,S)}toString(){return ha(this._root)}}function Ka(B,P){P.value._routerState=B,P.children.forEach(S=>Ka(B,S))}function ha(B){const P=B.children.length>0?` { ${B.children.map(ha).join(", ")} } `:"";return`${B.value}${P}`}function da(B){if(B.snapshot){const P=B.snapshot,S=B._futureSnapshot;B.snapshot=S,Ze(P.queryParams,S.queryParams)||B.queryParams.next(S.queryParams),P.fragment!==S.fragment&&B.fragment.next(S.fragment),Ze(P.params,S.params)||B.params.next(S.params),function(B,P){if(B.length!==P.length)return!1;for(let S=0;S<B.length;++S)if(!Ze(B[S],P[S]))return!1;return!0}(P.url,S.url)||B.url.next(S.url),Ze(P.data,S.data)||B.data.next(S.data)}else B.snapshot=B._futureSnapshot,B.data.next(B._futureSnapshot.data)}function ds(B,P){return Ze(B.params,P.params)&&function(B,P){return Zr(B,P)&&B.every((S,G)=>Ze(S.parameters,P[G].parameters))}(B.url,P.url)&&!(!B.parent!=!P.parent)&&(!B.parent||ds(B.parent,P.parent))}function io(B,P,S){if(S&&B.shouldReuseRoute(P.value,S.value.snapshot)){const G=S.value;G._futureSnapshot=P.value;const ne=function(B,P,S){return P.children.map(G=>{for(const ne of S.children)if(B.shouldReuseRoute(G.value,ne.value.snapshot))return io(B,G,ne);return io(B,G)})}(B,P,S);return new Ki(G,ne)}{if(B.shouldAttach(P.value)){const me=B.retrieve(P.value);if(null!==me){const ze=me.route;return Xa(P,ze),ze}}const G=function(B){return new Ni(new ge(B.url),new ge(B.params),new ge(B.queryParams),new ge(B.fragment),new ge(B.data),B.outlet,B.component,B)}(P.value),ne=P.children.map(me=>io(B,me));return new Ki(G,ne)}}function Xa(B,P){if(B.value.routeConfig!==P.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(B.children.length!==P.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");P.value._futureSnapshot=B.value;for(let S=0;S<B.children.length;++S)Xa(B.children[S],P.children[S])}function Mo(B){return"object"==typeof B&&null!=B&&!B.outlets&&!B.segmentPath}function Ws(B){return"object"==typeof B&&null!=B&&B.outlets}function Di(B,P,S,G,ne){let me={};return G&&sn(G,(ze,et)=>{me[et]=Array.isArray(ze)?ze.map(Nt=>`${Nt}`):`${ze}`}),new cn(S.root===B?P:so(S.root,B,P),me,ne)}function so(B,P,S){const G={};return sn(B.children,(ne,me)=>{G[me]=ne===P?S:so(ne,P,S)}),new Tn(B.segments,G)}class _o{constructor(P,S,G){if(this.isAbsolute=P,this.numberOfDoubleDots=S,this.commands=G,P&&G.length>0&&Mo(G[0]))throw new Error("Root segment cannot have matrix parameters");const ne=G.find(Ws);if(ne&&ne!==Gt(G))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class hr{constructor(P,S,G){this.segmentGroup=P,this.processChildren=S,this.index=G}}function Rs(B,P,S){if(B||(B=new Tn([],{})),0===B.segments.length&&B.hasChildren())return gr(B,P,S);const G=function(B,P,S){let G=0,ne=P;const me={match:!1,pathIndex:0,commandIndex:0};for(;ne<B.segments.length;){if(G>=S.length)return me;const ze=B.segments[ne],et=S[G];if(Ws(et))break;const Nt=`${et}`,En=G<S.length-1?S[G+1]:null;if(ne>0&&void 0===Nt)break;if(Nt&&En&&"object"==typeof En&&void 0===En.outlets){if(!ao(Nt,En,ze))return me;G+=2}else{if(!ao(Nt,{},ze))return me;G++}ne++}return{match:!0,pathIndex:ne,commandIndex:G}}(B,P,S),ne=S.slice(G.commandIndex);if(G.match&&G.pathIndex<B.segments.length){const me=new Tn(B.segments.slice(0,G.pathIndex),{});return me.children[K]=new Tn(B.segments.slice(G.pathIndex),B.children),gr(me,0,ne)}return G.match&&0===ne.length?new Tn(B.segments,{}):G.match&&!B.hasChildren()?Ys(B,P,S):G.match?gr(B,0,ne):Ys(B,P,S)}function gr(B,P,S){if(0===S.length)return new Tn(B.segments,{});{const G=function(B){return Ws(B[0])?B[0].outlets:{[K]:B}}(S),ne={};return sn(G,(me,ze)=>{"string"==typeof me&&(me=[me]),null!==me&&(ne[ze]=Rs(B.children[ze],P,me))}),sn(B.children,(me,ze)=>{void 0===G[ze]&&(ne[ze]=me)}),new Tn(B.segments,ne)}}function Ys(B,P,S){const G=B.segments.slice(0,P);let ne=0;for(;ne<S.length;){const me=S[ne];if(Ws(me)){const Nt=Ts(me.outlets);return new Tn(G,Nt)}if(0===ne&&Mo(S[0])){G.push(new mr(B.segments[P].path,pa(S[0]))),ne++;continue}const ze=Ws(me)?me.outlets[K]:`${me}`,et=ne<S.length-1?S[ne+1]:null;ze&&et&&Mo(et)?(G.push(new mr(ze,pa(et))),ne+=2):(G.push(new mr(ze,{})),ne++)}return new Tn(G,{})}function Ts(B){const P={};return sn(B,(S,G)=>{"string"==typeof S&&(S=[S]),null!==S&&(P[G]=Ys(new Tn([],{}),0,S))}),P}function pa(B){const P={};return sn(B,(S,G)=>P[G]=`${S}`),P}function ao(B,P,S){return B==S.path&&Ze(P,S.parameters)}class he{constructor(P,S,G,ne){this.routeReuseStrategy=P,this.futureState=S,this.currState=G,this.forwardEvent=ne}activate(P){const S=this.futureState._root,G=this.currState?this.currState._root:null;this.deactivateChildRoutes(S,G,P),da(this.futureState.root),this.activateChildRoutes(S,G,P)}deactivateChildRoutes(P,S,G){const ne=Li(S);P.children.forEach(me=>{const ze=me.value.outlet;this.deactivateRoutes(me,ne[ze],G),delete ne[ze]}),sn(ne,(me,ze)=>{this.deactivateRouteAndItsChildren(me,G)})}deactivateRoutes(P,S,G){const ne=P.value,me=S?S.value:null;if(ne===me)if(ne.component){const ze=G.getContext(ne.outlet);ze&&this.deactivateChildRoutes(P,S,ze.children)}else this.deactivateChildRoutes(P,S,G);else me&&this.deactivateRouteAndItsChildren(S,G)}deactivateRouteAndItsChildren(P,S){this.routeReuseStrategy.shouldDetach(P.value.snapshot)?this.detachAndStoreRouteSubtree(P,S):this.deactivateRouteAndOutlet(P,S)}detachAndStoreRouteSubtree(P,S){const G=S.getContext(P.value.outlet);if(G&&G.outlet){const ne=G.outlet.detach(),me=G.children.onOutletDeactivated();this.routeReuseStrategy.store(P.value.snapshot,{componentRef:ne,route:P,contexts:me})}}deactivateRouteAndOutlet(P,S){const G=S.getContext(P.value.outlet),ne=G&&P.value.component?G.children:S,me=Li(P);for(const ze of Object.keys(me))this.deactivateRouteAndItsChildren(me[ze],ne);G&&G.outlet&&(G.outlet.deactivate(),G.children.onOutletDeactivated(),G.attachRef=null,G.resolver=null,G.route=null)}activateChildRoutes(P,S,G){const ne=Li(S);P.children.forEach(me=>{this.activateRoutes(me,ne[me.value.outlet],G),this.forwardEvent(new qi(me.value.snapshot))}),P.children.length&&this.forwardEvent(new cs(P.value.snapshot))}activateRoutes(P,S,G){const ne=P.value,me=S?S.value:null;if(da(ne),ne===me)if(ne.component){const ze=G.getOrCreateContext(ne.outlet);this.activateChildRoutes(P,S,ze.children)}else this.activateChildRoutes(P,S,G);else if(ne.component){const ze=G.getOrCreateContext(ne.outlet);if(this.routeReuseStrategy.shouldAttach(ne.snapshot)){const et=this.routeReuseStrategy.retrieve(ne.snapshot);this.routeReuseStrategy.store(ne.snapshot,null),ze.children.onOutletReAttached(et.contexts),ze.attachRef=et.componentRef,ze.route=et.route.value,ze.outlet&&ze.outlet.attach(et.componentRef,et.route.value),ee(et.route)}else{const et=function(B){for(let P=B.parent;P;P=P.parent){const S=P.routeConfig;if(S&&S._loadedConfig)return S._loadedConfig;if(S&&S.component)return null}return null}(ne.snapshot),Nt=et?et.module.componentFactoryResolver:null;ze.attachRef=null,ze.route=ne,ze.resolver=Nt,ze.outlet&&ze.outlet.activateWith(ne,Nt),this.activateChildRoutes(P,null,ze.children)}}else this.activateChildRoutes(P,null,G)}}function ee(B){da(B.value),B.children.forEach(ee)}class Xe{constructor(P,S){this.routes=P,this.module=S}}function Dt(B){return"function"==typeof B}function q(B){return B instanceof cn}const Qt=Symbol("INITIAL_VALUE");function Mn(){return(0,rt.w)(B=>function(...B){let P,S;return(0,Se.K)(B[B.length-1])&&(S=B.pop()),"function"==typeof B[B.length-1]&&(P=B.pop()),1===B.length&&(0,Ce.k)(B[0])&&(B=B[0]),(0,Oe.n)(B,S).lift(new lt(P))}(B.map(P=>P.pipe(tn(1),function(...B){const P=B[B.length-1];return(0,Se.K)(P)?(B.pop(),S=>zn(B,S,P)):S=>zn(B,S)}(Qt)))).pipe(Or((P,S)=>{let G=!1;return S.reduce((ne,me,ze)=>ne!==Qt?ne:(me===Qt&&(G=!0),G||!1!==me&&ze!==S.length-1&&!q(me)?ne:me),P)},Qt),(0,kn.h)(P=>P!==Qt),(0,Tt.U)(P=>q(P)?P:!0===P),tn(1)))}let Vr=(()=>{class B{}return B.\u0275fac=function(S){return new(S||B)},B.\u0275cmp=A.Xpm({type:B,selectors:[["ng-component"]],decls:1,vars:0,template:function(S,G){1&S&&A._UZ(0,"router-outlet")},directives:function(){return[va]},encapsulation:2}),B})();function Ai(B,P=""){for(let S=0;S<B.length;S++){const G=B[S];oi(G,fs(P,G))}}function oi(B,P){B.children&&Ai(B.children,P)}function fs(B,P){return P?B||P.path?B&&!P.path?`${B}/`:!B&&P.path?P.path:`${B}/${P.path}`:"":B}function ps(B){const P=B.children&&B.children.map(ps),S=P?Object.assign(Object.assign({},B),{children:P}):Object.assign({},B);return!S.component&&(P||S.loadChildren)&&S.outlet&&S.outlet!==K&&(S.component=Vr),S}function Mr(B){return B.outlet||K}function Mi(B,P){const S=B.filter(G=>Mr(G)===P);return S.push(...B.filter(G=>Mr(G)!==P)),S}const lo={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function Po(B,P,S){var G;if(""===P.path)return"full"===P.pathMatch&&(B.hasChildren()||S.length>0)?Object.assign({},lo):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const me=(P.matcher||Qe)(S,B,P);if(!me)return Object.assign({},lo);const ze={};sn(me.posParams,(Nt,En)=>{ze[En]=Nt.path});const et=me.consumed.length>0?Object.assign(Object.assign({},ze),me.consumed[me.consumed.length-1].parameters):ze;return{matched:!0,consumedSegments:me.consumed,lastChild:me.consumed.length,parameters:et,positionalParamSegments:null!==(G=me.posParams)&&void 0!==G?G:{}}}function gl(B,P,S,G,ne="corrected"){if(S.length>0&&function(B,P,S){return S.some(G=>_l(B,P,G)&&Mr(G)!==K)}(B,S,G)){const ze=new Tn(P,function(B,P,S,G){const ne={};ne[K]=G,G._sourceSegment=B,G._segmentIndexShift=P.length;for(const me of S)if(""===me.path&&Mr(me)!==K){const ze=new Tn([],{});ze._sourceSegment=B,ze._segmentIndexShift=P.length,ne[Mr(me)]=ze}return ne}(B,P,G,new Tn(S,B.children)));return ze._sourceSegment=B,ze._segmentIndexShift=P.length,{segmentGroup:ze,slicedSegments:[]}}if(0===S.length&&function(B,P,S){return S.some(G=>_l(B,P,G))}(B,S,G)){const ze=new Tn(B.segments,function(B,P,S,G,ne,me){const ze={};for(const et of G)if(_l(B,S,et)&&!ne[Mr(et)]){const Nt=new Tn([],{});Nt._sourceSegment=B,Nt._segmentIndexShift="legacy"===me?B.segments.length:P.length,ze[Mr(et)]=Nt}return Object.assign(Object.assign({},ne),ze)}(B,P,S,G,B.children,ne));return ze._sourceSegment=B,ze._segmentIndexShift=P.length,{segmentGroup:ze,slicedSegments:S}}const me=new Tn(B.segments,B.children);return me._sourceSegment=B,me._segmentIndexShift=P.length,{segmentGroup:me,slicedSegments:S}}function _l(B,P,S){return(!(B.hasChildren()||P.length>0)||"full"!==S.pathMatch)&&""===S.path}function kc(B,P,S,G){return!!(Mr(B)===G||G!==K&&_l(P,S,B))&&("**"===B.path||Po(P,B,S).matched)}function Gl(B,P,S){return 0===P.length&&!B.children[S]}class Ja{constructor(P){this.segmentGroup=P||null}}class yl{constructor(P){this.urlTree=P}}function Ko(B){return new Be.y(P=>P.error(new Ja(B)))}function ma(B){return new Be.y(P=>P.error(new yl(B)))}function Jt(B){return new Be.y(P=>P.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${B}'`)))}class gi{constructor(P,S,G,ne,me){this.configLoader=S,this.urlSerializer=G,this.urlTree=ne,this.config=me,this.allowRedirects=!0,this.ngModule=P.get(A.h0i)}apply(){const P=gl(this.urlTree.root,[],[],this.config).segmentGroup,S=new Tn(P.segments,P.children);return this.expandSegmentGroup(this.ngModule,this.config,S,K).pipe((0,Tt.U)(me=>this.createUrlTree(ks(me),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,nt.K)(me=>{if(me instanceof yl)return this.allowRedirects=!1,this.match(me.urlTree);throw me instanceof Ja?this.noMatchError(me):me}))}match(P){return this.expandSegmentGroup(this.ngModule,this.config,P.root,K).pipe((0,Tt.U)(ne=>this.createUrlTree(ks(ne),P.queryParams,P.fragment))).pipe((0,nt.K)(ne=>{throw ne instanceof Ja?this.noMatchError(ne):ne}))}noMatchError(P){return new Error(`Cannot match any routes. URL Segment: '${P.segmentGroup}'`)}createUrlTree(P,S,G){const ne=P.segments.length>0?new Tn([],{[K]:P}):P;return new cn(ne,S,G)}expandSegmentGroup(P,S,G,ne){return 0===G.segments.length&&G.hasChildren()?this.expandChildren(P,S,G).pipe((0,Tt.U)(me=>new Tn([],me))):this.expandSegment(P,G,S,G.segments,ne,!0)}expandChildren(P,S,G){const ne=[];for(const me of Object.keys(G.children))"primary"===me?ne.unshift(me):ne.push(me);return(0,gn.D)(ne).pipe((0,Wt.b)(me=>{const ze=G.children[me],et=Mi(S,me);return this.expandSegmentGroup(P,et,ze,me).pipe((0,Tt.U)(Nt=>({segment:Nt,outlet:me})))}),Or((me,ze)=>(me[ze.outlet]=ze.segment,me),{}),function(B,P){const S=arguments.length>=2;return G=>G.pipe(B?(0,kn.h)((ne,me)=>B(ne,me,G)):Vi.y,Ve(1),S?Zn(P):Rn(()=>new Me))}())}expandSegment(P,S,G,ne,me,ze){return(0,gn.D)(G).pipe((0,Wt.b)(et=>this.expandSegmentAgainstRoute(P,S,G,et,ne,me,ze).pipe((0,nt.K)(En=>{if(En instanceof Ja)return(0,Ge.of)(null);throw En}))),$r(et=>!!et),(0,nt.K)((et,Nt)=>{if(et instanceof Me||"EmptyError"===et.name){if(Gl(S,ne,me))return(0,Ge.of)(new Tn([],{}));throw new Ja(S)}throw et}))}expandSegmentAgainstRoute(P,S,G,ne,me,ze,et){return kc(ne,S,me,ze)?void 0===ne.redirectTo?this.matchSegmentAgainstRoute(P,S,ne,me,ze):et&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(P,S,G,ne,me,ze):Ko(S):Ko(S)}expandSegmentAgainstRouteUsingRedirect(P,S,G,ne,me,ze){return"**"===ne.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(P,G,ne,ze):this.expandRegularSegmentAgainstRouteUsingRedirect(P,S,G,ne,me,ze)}expandWildCardWithParamsAgainstRouteUsingRedirect(P,S,G,ne){const me=this.applyRedirectCommands([],G.redirectTo,{});return G.redirectTo.startsWith("/")?ma(me):this.lineralizeSegments(G,me).pipe((0,_t.zg)(ze=>{const et=new Tn(ze,{});return this.expandSegment(P,et,S,ze,ne,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(P,S,G,ne,me,ze){const{matched:et,consumedSegments:Nt,lastChild:En,positionalParamSegments:dr}=Po(S,ne,me);if(!et)return Ko(S);const Un=this.applyRedirectCommands(Nt,ne.redirectTo,dr);return ne.redirectTo.startsWith("/")?ma(Un):this.lineralizeSegments(ne,Un).pipe((0,_t.zg)(fi=>this.expandSegment(P,S,G,fi.concat(me.slice(En)),ze,!1)))}matchSegmentAgainstRoute(P,S,G,ne,me){if("**"===G.path)return G.loadChildren?(G._loadedConfig?(0,Ge.of)(G._loadedConfig):this.configLoader.load(P.injector,G)).pipe((0,Tt.U)(fi=>(G._loadedConfig=fi,new Tn(ne,{})))):(0,Ge.of)(new Tn(ne,{}));const{matched:ze,consumedSegments:et,lastChild:Nt}=Po(S,G,ne);if(!ze)return Ko(S);const En=ne.slice(Nt);return this.getChildConfig(P,G,ne).pipe((0,_t.zg)(Un=>{const fi=Un.module,kr=Un.routes,{segmentGroup:Xs,slicedSegments:Bo}=gl(S,et,En,kr),Lr=new Tn(Xs.segments,Xs.children);if(0===Bo.length&&Lr.hasChildren())return this.expandChildren(fi,kr,Lr).pipe((0,Tt.U)(c=>new Tn(et,c)));if(0===kr.length&&0===Bo.length)return(0,Ge.of)(new Tn(et,{}));const bo=Mr(G)===me;return this.expandSegment(fi,Lr,kr,Bo,bo?K:me,!0).pipe((0,Tt.U)(r=>new Tn(et.concat(r.segments),r.children)))}))}getChildConfig(P,S,G){return S.children?(0,Ge.of)(new Xe(S.children,P)):S.loadChildren?void 0!==S._loadedConfig?(0,Ge.of)(S._loadedConfig):this.runCanLoadGuards(P.injector,S,G).pipe((0,_t.zg)(ne=>{return ne?this.configLoader.load(P.injector,S).pipe((0,Tt.U)(me=>(S._loadedConfig=me,me))):(B=S,new Be.y(P=>P.error(de(`Cannot load children because the guard of the route "path: '${B.path}'" returned false`))));var B})):(0,Ge.of)(new Xe([],P))}runCanLoadGuards(P,S,G){const ne=S.canLoad;if(!ne||0===ne.length)return(0,Ge.of)(!0);const me=ne.map(ze=>{const et=P.get(ze);let Nt;if((B=et)&&Dt(B.canLoad))Nt=et.canLoad(S,G);else{if(!Dt(et))throw new Error("Invalid CanLoad guard");Nt=et(S,G)}var B;return He(Nt)});return(0,Ge.of)(me).pipe(Mn(),(0,hn.b)(ze=>{if(!q(ze))return;const et=de(`Redirecting to "${this.urlSerializer.serialize(ze)}"`);throw et.url=ze,et}),(0,Tt.U)(ze=>!0===ze))}lineralizeSegments(P,S){let G=[],ne=S.root;for(;;){if(G=G.concat(ne.segments),0===ne.numberOfChildren)return(0,Ge.of)(G);if(ne.numberOfChildren>1||!ne.children[K])return Jt(P.redirectTo);ne=ne.children[K]}}applyRedirectCommands(P,S,G){return this.applyRedirectCreatreUrlTree(S,this.urlSerializer.parse(S),P,G)}applyRedirectCreatreUrlTree(P,S,G,ne){const me=this.createSegmentGroup(P,S.root,G,ne);return new cn(me,this.createQueryParams(S.queryParams,this.urlTree.queryParams),S.fragment)}createQueryParams(P,S){const G={};return sn(P,(ne,me)=>{if("string"==typeof ne&&ne.startsWith(":")){const et=ne.substring(1);G[me]=S[et]}else G[me]=ne}),G}createSegmentGroup(P,S,G,ne){const me=this.createSegments(P,S.segments,G,ne);let ze={};return sn(S.children,(et,Nt)=>{ze[Nt]=this.createSegmentGroup(P,et,G,ne)}),new Tn(me,ze)}createSegments(P,S,G,ne){return S.map(me=>me.path.startsWith(":")?this.findPosParam(P,me,ne):this.findOrReturn(me,G))}findPosParam(P,S,G){const ne=G[S.path.substring(1)];if(!ne)throw new Error(`Cannot redirect to '${P}'. Cannot find '${S.path}'.`);return ne}findOrReturn(P,S){let G=0;for(const ne of S){if(ne.path===P.path)return S.splice(G),ne;G++}return P}}function ks(B){const P={};for(const G of Object.keys(B.children)){const me=ks(B.children[G]);(me.segments.length>0||me.hasChildren())&&(P[G]=me)}return function(B){if(1===B.numberOfChildren&&B.children[K]){const P=B.children[K];return new Tn(B.segments.concat(P.segments),P.children)}return B}(new Tn(B.segments,P))}class Fo{constructor(P){this.path=P,this.route=this.path[this.path.length-1]}}class ga{constructor(P,S){this.component=P,this.route=S}}function Ur(B,P,S){const G=B._root;return _i(G,P?P._root:null,S,[G.value])}function Ia(B,P,S){const G=function(B){if(!B)return null;for(let P=B.parent;P;P=P.parent){const S=P.routeConfig;if(S&&S._loadedConfig)return S._loadedConfig}return null}(P);return(G?G.module.injector:S).get(B)}function _i(B,P,S,G,ne={canDeactivateChecks:[],canActivateChecks:[]}){const me=Li(P);return B.children.forEach(ze=>{(function(B,P,S,G,ne={canDeactivateChecks:[],canActivateChecks:[]}){const me=B.value,ze=P?P.value:null,et=S?S.getContext(B.value.outlet):null;if(ze&&me.routeConfig===ze.routeConfig){const Nt=function(B,P,S){if("function"==typeof S)return S(B,P);switch(S){case"pathParamsChange":return!Zr(B.url,P.url);case"pathParamsOrQueryParamsChange":return!Zr(B.url,P.url)||!Ze(B.queryParams,P.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ds(B,P)||!Ze(B.queryParams,P.queryParams);case"paramsChange":default:return!ds(B,P)}}(ze,me,me.routeConfig.runGuardsAndResolvers);Nt?ne.canActivateChecks.push(new Fo(G)):(me.data=ze.data,me._resolvedData=ze._resolvedData),_i(B,P,me.component?et?et.children:null:S,G,ne),Nt&&et&&et.outlet&&et.outlet.isActivated&&ne.canDeactivateChecks.push(new ga(et.outlet.component,ze))}else ze&&Ss(P,et,ne),ne.canActivateChecks.push(new Fo(G)),_i(B,null,me.component?et?et.children:null:S,G,ne)})(ze,me[ze.value.outlet],S,G.concat([ze.value]),ne),delete me[ze.value.outlet]}),sn(me,(ze,et)=>Ss(ze,S.getContext(et),ne)),ne}function Ss(B,P,S){const G=Li(B),ne=B.value;sn(G,(me,ze)=>{Ss(me,ne.component?P?P.children.getContext(ze):null:P,S)}),S.canDeactivateChecks.push(new ga(ne.component&&P&&P.outlet&&P.outlet.isActivated?P.outlet.component:null,ne))}class Pa{}function Ds(B){return new Be.y(P=>P.error(B))}class _a{constructor(P,S,G,ne,me,ze){this.rootComponentType=P,this.config=S,this.urlTree=G,this.url=ne,this.paramsInheritanceStrategy=me,this.relativeLinkResolution=ze}recognize(){const P=gl(this.urlTree.root,[],[],this.config.filter(ze=>void 0===ze.redirectTo),this.relativeLinkResolution).segmentGroup,S=this.processSegmentGroup(this.config,P,K);if(null===S)return null;const G=new Wo([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},K,this.rootComponentType,null,this.urlTree.root,-1,{}),ne=new Ki(G,S),me=new ua(this.url,ne);return this.inheritParamsAndData(me._root),me}inheritParamsAndData(P){const S=P.value,G=qs(S,this.paramsInheritanceStrategy);S.params=Object.freeze(G.params),S.data=Object.freeze(G.data),P.children.forEach(ne=>this.inheritParamsAndData(ne))}processSegmentGroup(P,S,G){return 0===S.segments.length&&S.hasChildren()?this.processChildren(P,S):this.processSegment(P,S,S.segments,G)}processChildren(P,S){const G=[];for(const me of Object.keys(S.children)){const ze=S.children[me],et=Mi(P,me),Nt=this.processSegmentGroup(et,ze,me);if(null===Nt)return null;G.push(...Nt)}const ne=rl(G);return ne.sort((P,S)=>P.value.outlet===K?-1:S.value.outlet===K?1:P.value.outlet.localeCompare(S.value.outlet)),ne}processSegment(P,S,G,ne){for(const me of P){const ze=this.processSegmentAgainstRoute(me,S,G,ne);if(null!==ze)return ze}return Gl(S,G,ne)?[]:null}processSegmentAgainstRoute(P,S,G,ne){if(P.redirectTo||!kc(P,S,G,ne))return null;let me,ze=[],et=[];if("**"===P.path){const kr=G.length>0?Gt(G).parameters:{};me=new Wo(G,kr,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,rs(P),Mr(P),P.component,P,ka(S),vc(S)+G.length,Os(P))}else{const kr=Po(S,P,G);if(!kr.matched)return null;ze=kr.consumedSegments,et=G.slice(kr.lastChild),me=new Wo(ze,kr.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,rs(P),Mr(P),P.component,P,ka(S),vc(S)+ze.length,Os(P))}const Nt=(B=P).children?B.children:B.loadChildren?B._loadedConfig.routes:[],{segmentGroup:En,slicedSegments:dr}=gl(S,ze,et,Nt.filter(kr=>void 0===kr.redirectTo),this.relativeLinkResolution);var B;if(0===dr.length&&En.hasChildren()){const kr=this.processChildren(Nt,En);return null===kr?null:[new Ki(me,kr)]}if(0===Nt.length&&0===dr.length)return[new Ki(me,[])];const Un=Mr(P)===ne,fi=this.processSegment(Nt,En,dr,Un?K:ne);return null===fi?null:[new Ki(me,fi)]}}function Ra(B){const P=B.value.routeConfig;return P&&""===P.path&&void 0===P.redirectTo}function rl(B){const P=[],S=new Set;for(const G of B){if(!Ra(G)){P.push(G);continue}const ne=P.find(me=>G.value.routeConfig===me.value.routeConfig);void 0!==ne?(ne.children.push(...G.children),S.add(ne)):P.push(G)}for(const G of S){const ne=rl(G.children);P.push(new Ki(G.value,ne))}return P.filter(G=>!S.has(G))}function ka(B){let P=B;for(;P._sourceSegment;)P=P._sourceSegment;return P}function vc(B){let P=B,S=P._segmentIndexShift?P._segmentIndexShift:0;for(;P._sourceSegment;)P=P._sourceSegment,S+=P._segmentIndexShift?P._segmentIndexShift:0;return S-1}function rs(B){return B.data||{}}function Os(B){return B.resolve||{}}function Oa(B){return(0,rt.w)(P=>{const S=B(P);return S?(0,gn.D)(S).pipe((0,Tt.U)(()=>P)):(0,Ge.of)(P)})}class Xo extends class{shouldDetach(P){return!1}store(P,S){}shouldAttach(P){return!1}retrieve(P){return null}shouldReuseRoute(P,S){return P.routeConfig===S.routeConfig}}{}const Fa=new A.OlP("ROUTES");class $i{constructor(P,S,G,ne){this.loader=P,this.compiler=S,this.onLoadStartListener=G,this.onLoadEndListener=ne}load(P,S){if(S._loader$)return S._loader$;this.onLoadStartListener&&this.onLoadStartListener(S);const ne=this.loadModuleFactory(S.loadChildren).pipe((0,Tt.U)(me=>{this.onLoadEndListener&&this.onLoadEndListener(S);const ze=me.create(P);return new Xe(St(ze.injector.get(Fa,void 0,A.XFs.Self|A.XFs.Optional)).map(ps),ze)}),(0,nt.K)(me=>{throw S._loader$=void 0,me}));return S._loader$=new tt.c(ne,()=>new R.xQ).pipe((0,mn.x)()),S._loader$}loadModuleFactory(P){return"string"==typeof P?(0,gn.D)(this.loader.load(P)):He(P()).pipe((0,_t.zg)(S=>S instanceof A.YKP?(0,Ge.of)(S):(0,gn.D)(this.compiler.compileModuleAsync(S))))}}class Cl{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new xo,this.attachRef=null}}class xo{constructor(){this.contexts=new Map}onChildOutletCreated(P,S){const G=this.getOrCreateContext(P);G.outlet=S,this.contexts.set(P,G)}onChildOutletDestroyed(P){const S=this.getContext(P);S&&(S.outlet=null)}onOutletDeactivated(){const P=this.contexts;return this.contexts=new Map,P}onOutletReAttached(P){this.contexts=P}getOrCreateContext(P){let S=this.getContext(P);return S||(S=new Cl,this.contexts.set(P,S)),S}getContext(P){return this.contexts.get(P)||null}}class il{shouldProcessUrl(P){return!0}extract(P){return P}merge(P,S){return P}}function Yl(B){throw B}function Kl(B,P,S){return P.parse("/")}function Gi(B,P){return(0,Ge.of)(null)}const Tl={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ho={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let gs=(()=>{class B{constructor(S,G,ne,me,ze,et,Nt,En){this.rootComponentType=S,this.urlSerializer=G,this.rootContexts=ne,this.location=me,this.config=En,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.lastLocationChangeInfo=null,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new R.xQ,this.errorHandler=Yl,this.malformedUriErrorHandler=Kl,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:Gi,afterPreactivation:Gi},this.urlHandlingStrategy=new il,this.routeReuseStrategy=new Xo,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=ze.get(A.h0i),this.console=ze.get(A.c2e);const fi=ze.get(A.R0b);this.isNgZoneEnabled=fi instanceof A.R0b&&A.R0b.isInAngularZone(),this.resetConfig(En),this.currentUrlTree=new cn(new Tn([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new $i(et,Nt,kr=>this.triggerEvent(new Yr(kr)),kr=>this.triggerEvent(new Gr(kr))),this.routerState=qr(this.currentUrlTree,this.rootComponentType),this.transitions=new ge({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var S;return null===(S=this.location.getState())||void 0===S?void 0:S.\u0275routerPageId}setupNavigations(S){const G=this.events;return S.pipe((0,kn.h)(ne=>0!==ne.id),(0,Tt.U)(ne=>Object.assign(Object.assign({},ne),{extractedUrl:this.urlHandlingStrategy.extract(ne.rawUrl)})),(0,rt.w)(ne=>{let me=!1,ze=!1;return(0,Ge.of)(ne).pipe((0,hn.b)(et=>{this.currentNavigation={id:et.id,initialUrl:et.currentRawUrl,extractedUrl:et.extractedUrl,trigger:et.source,extras:et.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),(0,rt.w)(et=>{const Nt=this.browserUrlTree.toString(),En=!this.navigated||et.extractedUrl.toString()!==Nt||Nt!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||En)&&this.urlHandlingStrategy.shouldProcessUrl(et.rawUrl))return Jo(et.source)&&(this.browserUrlTree=et.extractedUrl),(0,Ge.of)(et).pipe((0,rt.w)(Un=>{const fi=this.transitions.getValue();return G.next(new xn(Un.id,this.serializeUrl(Un.extractedUrl),Un.source,Un.restoredState)),fi!==this.transitions.getValue()?Xt:Promise.resolve(Un)}),function(B,P,S,G){return(0,rt.w)(ne=>function(B,P,S,G,ne){return new gi(B,P,S,G,ne).apply()}(B,P,S,ne.extractedUrl,G).pipe((0,Tt.U)(me=>Object.assign(Object.assign({},ne),{urlAfterRedirects:me}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),(0,hn.b)(Un=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:Un.urlAfterRedirects})}),function(B,P,S,G,ne){return(0,_t.zg)(me=>function(B,P,S,G,ne="emptyOnly",me="legacy"){try{const ze=new _a(B,P,S,G,ne,me).recognize();return null===ze?Ds(new Pa):(0,Ge.of)(ze)}catch(ze){return Ds(ze)}}(B,P,me.urlAfterRedirects,S(me.urlAfterRedirects),G,ne).pipe((0,Tt.U)(ze=>Object.assign(Object.assign({},me),{targetSnapshot:ze}))))}(this.rootComponentType,this.config,Un=>this.serializeUrl(Un),this.paramsInheritanceStrategy,this.relativeLinkResolution),(0,hn.b)(Un=>{"eager"===this.urlUpdateStrategy&&(Un.extras.skipLocationChange||this.setBrowserUrl(Un.urlAfterRedirects,Un),this.browserUrlTree=Un.urlAfterRedirects);const fi=new Wr(Un.id,this.serializeUrl(Un.extractedUrl),this.serializeUrl(Un.urlAfterRedirects),Un.targetSnapshot);G.next(fi)}));if(En&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:fi,extractedUrl:kr,source:Xs,restoredState:Bo,extras:Lr}=et,bo=new xn(fi,this.serializeUrl(kr),Xs,Bo);G.next(bo);const f=qr(kr,this.rootComponentType).snapshot;return(0,Ge.of)(Object.assign(Object.assign({},et),{targetSnapshot:f,urlAfterRedirects:kr,extras:Object.assign(Object.assign({},Lr),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=et.rawUrl,this.browserUrlTree=et.urlAfterRedirects,et.resolve(null),Xt}),Oa(et=>{const{targetSnapshot:Nt,id:En,extractedUrl:dr,rawUrl:Un,extras:{skipLocationChange:fi,replaceUrl:kr}}=et;return this.hooks.beforePreactivation(Nt,{navigationId:En,appliedUrlTree:dr,rawUrlTree:Un,skipLocationChange:!!fi,replaceUrl:!!kr})}),(0,hn.b)(et=>{const Nt=new jn(et.id,this.serializeUrl(et.extractedUrl),this.serializeUrl(et.urlAfterRedirects),et.targetSnapshot);this.triggerEvent(Nt)}),(0,Tt.U)(et=>Object.assign(Object.assign({},et),{guards:Ur(et.targetSnapshot,et.currentSnapshot,this.rootContexts)})),function(B,P){return(0,_t.zg)(S=>{const{targetSnapshot:G,currentSnapshot:ne,guards:{canActivateChecks:me,canDeactivateChecks:ze}}=S;return 0===ze.length&&0===me.length?(0,Ge.of)(Object.assign(Object.assign({},S),{guardsResult:!0})):function(B,P,S,G){return(0,gn.D)(B).pipe((0,_t.zg)(ne=>function(B,P,S,G,ne){const me=P&&P.routeConfig?P.routeConfig.canDeactivate:null;if(!me||0===me.length)return(0,Ge.of)(!0);const ze=me.map(et=>{const Nt=Ia(et,P,ne);let En;if(function(B){return B&&Dt(B.canDeactivate)}(Nt))En=He(Nt.canDeactivate(B,P,S,G));else{if(!Dt(Nt))throw new Error("Invalid CanDeactivate guard");En=He(Nt(B,P,S,G))}return En.pipe($r())});return(0,Ge.of)(ze).pipe(Mn())}(ne.component,ne.route,S,P,G)),$r(ne=>!0!==ne,!0))}(ze,G,ne,B).pipe((0,_t.zg)(et=>et&&function(B){return"boolean"==typeof B}(et)?function(B,P,S,G){return(0,gn.D)(P).pipe((0,Wt.b)(ne=>zn(function(B,P){return null!==B&&P&&P(new vr(B)),(0,Ge.of)(!0)}(ne.route.parent,G),function(B,P){return null!==B&&P&&P(new ro(B)),(0,Ge.of)(!0)}(ne.route,G),function(B,P,S){const G=P[P.length-1],me=P.slice(0,P.length-1).reverse().map(ze=>function(B){const P=B.routeConfig?B.routeConfig.canActivateChild:null;return P&&0!==P.length?{node:B,guards:P}:null}(ze)).filter(ze=>null!==ze).map(ze=>ct(()=>{const et=ze.guards.map(Nt=>{const En=Ia(Nt,ze.node,S);let dr;if(function(B){return B&&Dt(B.canActivateChild)}(En))dr=He(En.canActivateChild(G,B));else{if(!Dt(En))throw new Error("Invalid CanActivateChild guard");dr=He(En(G,B))}return dr.pipe($r())});return(0,Ge.of)(et).pipe(Mn())}));return(0,Ge.of)(me).pipe(Mn())}(B,ne.path,S),function(B,P,S){const G=P.routeConfig?P.routeConfig.canActivate:null;if(!G||0===G.length)return(0,Ge.of)(!0);const ne=G.map(me=>ct(()=>{const ze=Ia(me,P,S);let et;if(function(B){return B&&Dt(B.canActivate)}(ze))et=He(ze.canActivate(P,B));else{if(!Dt(ze))throw new Error("Invalid CanActivate guard");et=He(ze(P,B))}return et.pipe($r())}));return(0,Ge.of)(ne).pipe(Mn())}(B,ne.route,S))),$r(ne=>!0!==ne,!0))}(G,me,B,P):(0,Ge.of)(et)),(0,Tt.U)(et=>Object.assign(Object.assign({},S),{guardsResult:et})))})}(this.ngModule.injector,et=>this.triggerEvent(et)),(0,hn.b)(et=>{if(q(et.guardsResult)){const En=de(`Redirecting to "${this.serializeUrl(et.guardsResult)}"`);throw En.url=et.guardsResult,En}const Nt=new wn(et.id,this.serializeUrl(et.extractedUrl),this.serializeUrl(et.urlAfterRedirects),et.targetSnapshot,!!et.guardsResult);this.triggerEvent(Nt)}),(0,kn.h)(et=>!!et.guardsResult||(this.restoreHistory(et),this.cancelNavigationTransition(et,""),!1)),Oa(et=>{if(et.guards.canActivateChecks.length)return(0,Ge.of)(et).pipe((0,hn.b)(Nt=>{const En=new mi(Nt.id,this.serializeUrl(Nt.extractedUrl),this.serializeUrl(Nt.urlAfterRedirects),Nt.targetSnapshot);this.triggerEvent(En)}),(0,rt.w)(Nt=>{let En=!1;return(0,Ge.of)(Nt).pipe(function(B,P){return(0,_t.zg)(S=>{const{targetSnapshot:G,guards:{canActivateChecks:ne}}=S;if(!ne.length)return(0,Ge.of)(S);let me=0;return(0,gn.D)(ne).pipe((0,Wt.b)(ze=>function(B,P,S,G){return function(B,P,S,G){const ne=Object.keys(B);if(0===ne.length)return(0,Ge.of)({});const me={};return(0,gn.D)(ne).pipe((0,_t.zg)(ze=>function(B,P,S,G){const ne=Ia(B,P,G);return He(ne.resolve?ne.resolve(P,S):ne(P,S))}(B[ze],P,S,G).pipe((0,hn.b)(et=>{me[ze]=et}))),Ve(1),(0,_t.zg)(()=>Object.keys(me).length===ne.length?(0,Ge.of)(me):Xt))}(B._resolve,B,P,G).pipe((0,Tt.U)(me=>(B._resolvedData=me,B.data=Object.assign(Object.assign({},B.data),qs(B,S).resolve),null)))}(ze.route,G,B,P)),(0,hn.b)(()=>me++),Ve(1),(0,_t.zg)(ze=>me===ne.length?(0,Ge.of)(S):Xt))})}(this.paramsInheritanceStrategy,this.ngModule.injector),(0,hn.b)({next:()=>En=!0,complete:()=>{En||(this.restoreHistory(Nt),this.cancelNavigationTransition(Nt,"At least one route resolver didn't emit any value."))}}))}),(0,hn.b)(Nt=>{const En=new ar(Nt.id,this.serializeUrl(Nt.extractedUrl),this.serializeUrl(Nt.urlAfterRedirects),Nt.targetSnapshot);this.triggerEvent(En)}))}),Oa(et=>{const{targetSnapshot:Nt,id:En,extractedUrl:dr,rawUrl:Un,extras:{skipLocationChange:fi,replaceUrl:kr}}=et;return this.hooks.afterPreactivation(Nt,{navigationId:En,appliedUrlTree:dr,rawUrlTree:Un,skipLocationChange:!!fi,replaceUrl:!!kr})}),(0,Tt.U)(et=>{const Nt=function(B,P,S){const G=io(B,P._root,S?S._root:void 0);return new Hs(G,P)}(this.routeReuseStrategy,et.targetSnapshot,et.currentRouterState);return Object.assign(Object.assign({},et),{targetRouterState:Nt})}),(0,hn.b)(et=>{this.currentUrlTree=et.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(et.urlAfterRedirects,et.rawUrl),this.routerState=et.targetRouterState,"deferred"===this.urlUpdateStrategy&&(et.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,et),this.browserUrlTree=et.urlAfterRedirects)}),((B,P,S)=>(0,Tt.U)(G=>(new he(P,G.targetRouterState,G.currentRouterState,S).activate(B),G)))(this.rootContexts,this.routeReuseStrategy,et=>this.triggerEvent(et)),(0,hn.b)({next(){me=!0},complete(){me=!0}}),function(B){return P=>P.lift(new ls(B))}(()=>{if(!me&&!ze){const et=`Navigation ID ${ne.id} is not equal to the current navigation id ${this.navigationId}`;"replace"===this.canceledNavigationResolution?(this.restoreHistory(ne),this.cancelNavigationTransition(ne,et)):this.cancelNavigationTransition(ne,et)}this.currentNavigation=null}),(0,nt.K)(et=>{if(ze=!0,function(B){return B&&B[H]}(et)){const Nt=q(et.url);Nt||(this.navigated=!0,this.restoreHistory(ne,!0));const En=new Fr(ne.id,this.serializeUrl(ne.extractedUrl),et.message);G.next(En),Nt?setTimeout(()=>{const dr=this.urlHandlingStrategy.merge(et.url,this.rawUrlTree),Un={skipLocationChange:ne.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Jo(ne.source)};this.scheduleNavigation(dr,"imperative",null,Un,{resolve:ne.resolve,reject:ne.reject,promise:ne.promise})},0):ne.resolve(!1)}else{this.restoreHistory(ne,!0);const Nt=new ii(ne.id,this.serializeUrl(ne.extractedUrl),et);G.next(Nt);try{ne.resolve(this.errorHandler(et))}catch(En){ne.reject(En)}}return Xt}))}))}resetRootComponentType(S){this.rootComponentType=S,this.routerState.root.component=this.rootComponentType}getTransition(){const S=this.transitions.value;return S.urlAfterRedirects=this.browserUrlTree,S}setTransition(S){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),S))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(S=>{const G=this.extractLocationChangeInfoFromEvent(S);this.shouldScheduleNavigation(this.lastLocationChangeInfo,G)&&setTimeout(()=>{const{source:ne,state:me,urlTree:ze}=G,et={replaceUrl:!0};if(me){const Nt=Object.assign({},me);delete Nt.navigationId,delete Nt.\u0275routerPageId,0!==Object.keys(Nt).length&&(et.state=Nt)}this.scheduleNavigation(ze,ne,me,et)},0),this.lastLocationChangeInfo=G}))}extractLocationChangeInfoFromEvent(S){var G;return{source:"popstate"===S.type?"popstate":"hashchange",urlTree:this.parseUrl(S.url),state:(null===(G=S.state)||void 0===G?void 0:G.navigationId)?S.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(S,G){if(!S)return!0;const ne=G.urlTree.toString()===S.urlTree.toString();return G.transitionId!==S.transitionId||!ne||!("hashchange"===G.source&&"popstate"===S.source||"popstate"===G.source&&"hashchange"===S.source)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(S){this.events.next(S)}resetConfig(S){Ai(S),this.config=S.map(ps),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(S,G={}){const{relativeTo:ne,queryParams:me,fragment:ze,queryParamsHandling:et,preserveFragment:Nt}=G,En=ne||this.routerState.root,dr=Nt?this.currentUrlTree.fragment:ze;let Un=null;switch(et){case"merge":Un=Object.assign(Object.assign({},this.currentUrlTree.queryParams),me);break;case"preserve":Un=this.currentUrlTree.queryParams;break;default:Un=me||null}return null!==Un&&(Un=this.removeEmptyProps(Un)),function(B,P,S,G,ne){if(0===S.length)return Di(P.root,P.root,P,G,ne);const me=function(B){if("string"==typeof B[0]&&1===B.length&&"/"===B[0])return new _o(!0,0,B);let P=0,S=!1;const G=B.reduce((ne,me,ze)=>{if("object"==typeof me&&null!=me){if(me.outlets){const et={};return sn(me.outlets,(Nt,En)=>{et[En]="string"==typeof Nt?Nt.split("/"):Nt}),[...ne,{outlets:et}]}if(me.segmentPath)return[...ne,me.segmentPath]}return"string"!=typeof me?[...ne,me]:0===ze?(me.split("/").forEach((et,Nt)=>{0==Nt&&"."===et||(0==Nt&&""===et?S=!0:".."===et?P++:""!=et&&ne.push(et))}),ne):[...ne,me]},[]);return new _o(S,P,G)}(S);if(me.toRoot())return Di(P.root,new Tn([],{}),P,G,ne);const ze=function(B,P,S){if(B.isAbsolute)return new hr(P.root,!0,0);if(-1===S.snapshot._lastPathIndex){const me=S.snapshot._urlSegment;return new hr(me,me===P.root,0)}const G=Mo(B.commands[0])?0:1;return function(B,P,S){let G=B,ne=P,me=S;for(;me>ne;){if(me-=ne,G=G.parent,!G)throw new Error("Invalid number of '../'");ne=G.segments.length}return new hr(G,!1,ne-me)}(S.snapshot._urlSegment,S.snapshot._lastPathIndex+G,B.numberOfDoubleDots)}(me,P,B),et=ze.processChildren?gr(ze.segmentGroup,ze.index,me.commands):Rs(ze.segmentGroup,ze.index,me.commands);return Di(ze.segmentGroup,et,P,G,ne)}(En,this.currentUrlTree,S,Un,null!=dr?dr:null)}navigateByUrl(S,G={skipLocationChange:!1}){const ne=q(S)?S:this.parseUrl(S),me=this.urlHandlingStrategy.merge(ne,this.rawUrlTree);return this.scheduleNavigation(me,"imperative",null,G)}navigate(S,G={skipLocationChange:!1}){return function(B){for(let P=0;P<B.length;P++){const S=B[P];if(null==S)throw new Error(`The requested path contains ${S} segment at index ${P}`)}}(S),this.navigateByUrl(this.createUrlTree(S,G),G)}serializeUrl(S){return this.urlSerializer.serialize(S)}parseUrl(S){let G;try{G=this.urlSerializer.parse(S)}catch(ne){G=this.malformedUriErrorHandler(ne,this.urlSerializer,S)}return G}isActive(S,G){let ne;if(ne=!0===G?Object.assign({},Tl):!1===G?Object.assign({},ho):G,q(S))return An(this.currentUrlTree,S,ne);const me=this.parseUrl(S);return An(this.currentUrlTree,me,ne)}removeEmptyProps(S){return Object.keys(S).reduce((G,ne)=>{const me=S[ne];return null!=me&&(G[ne]=me),G},{})}processNavigations(){this.navigations.subscribe(S=>{this.navigated=!0,this.lastSuccessfulId=S.id,this.currentPageId=S.targetPageId,this.events.next(new jr(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,S.resolve(!0)},S=>{this.console.warn(`Unhandled Navigation Error: ${S}`)})}scheduleNavigation(S,G,ne,me,ze){var et,Nt;if(this.disposed)return Promise.resolve(!1);const En=this.getTransition(),dr=Jo(G)&&En&&!Jo(En.source),kr=(this.lastSuccessfulId===En.id||this.currentNavigation?En.rawUrl:En.urlAfterRedirects).toString()===S.toString();if(dr&&kr)return Promise.resolve(!0);let Xs,Bo,Lr;ze?(Xs=ze.resolve,Bo=ze.reject,Lr=ze.promise):Lr=new Promise((r,c)=>{Xs=r,Bo=c});const bo=++this.navigationId;let f;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(ne=this.location.getState()),f=ne&&ne.\u0275routerPageId?ne.\u0275routerPageId:me.replaceUrl||me.skipLocationChange?null!==(et=this.browserPageId)&&void 0!==et?et:0:(null!==(Nt=this.browserPageId)&&void 0!==Nt?Nt:0)+1):f=0,this.setTransition({id:bo,targetPageId:f,source:G,restoredState:ne,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:S,extras:me,resolve:Xs,reject:Bo,promise:Lr,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Lr.catch(r=>Promise.reject(r))}setBrowserUrl(S,G){const ne=this.urlSerializer.serialize(S),me=Object.assign(Object.assign({},G.extras.state),this.generateNgRouterState(G.id,G.targetPageId));this.location.isCurrentPathEqualTo(ne)||G.extras.replaceUrl?this.location.replaceState(ne,"",me):this.location.go(ne,"",me)}restoreHistory(S,G=!1){var ne,me;if("computed"===this.canceledNavigationResolution){const ze=this.currentPageId-S.targetPageId;"popstate"!==S.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(ne=this.currentNavigation)||void 0===ne?void 0:ne.finalUrl)||0===ze?this.currentUrlTree===(null===(me=this.currentNavigation)||void 0===me?void 0:me.finalUrl)&&0===ze&&(this.resetState(S),this.browserUrlTree=S.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(ze)}else"replace"===this.canceledNavigationResolution&&(G&&this.resetState(S),this.resetUrlToCurrentUrlTree())}resetState(S){this.routerState=S.currentRouterState,this.currentUrlTree=S.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,S.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(S,G){const ne=new Fr(S.id,this.serializeUrl(S.extractedUrl),G);this.triggerEvent(ne),S.resolve(!1)}generateNgRouterState(S,G){return"computed"===this.canceledNavigationResolution?{navigationId:S,\u0275routerPageId:G}:{navigationId:S}}}return B.\u0275fac=function(S){return new(S||B)(A.LFG(A.DyG),A.LFG(Br),A.LFG(xo),A.LFG(D.Ye),A.LFG(A.zs3),A.LFG(A.v3s),A.LFG(A.Sil),A.LFG(void 0))},B.\u0275prov=A.Yz7({token:B,factory:B.\u0275fac}),B})();function Jo(B){return"imperative"!==B}let No=(()=>{class B{constructor(S,G,ne,me,ze){this.router=S,this.route=G,this.commands=[],this.onChanges=new R.xQ,null==ne&&me.setAttribute(ze.nativeElement,"tabindex","0")}ngOnChanges(S){this.onChanges.next(this)}set routerLink(S){this.commands=null!=S?Array.isArray(S)?S:[S]:[]}onClick(){const S={skipLocationChange:ya(this.skipLocationChange),replaceUrl:ya(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,S),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:ya(this.preserveFragment)})}}return B.\u0275fac=function(S){return new(S||B)(A.Y36(gs),A.Y36(Ni),A.$8M("tabindex"),A.Y36(A.Qsj),A.Y36(A.SBq))},B.\u0275dir=A.lG2({type:B,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(S,G){1&S&&A.NdJ("click",function(){return G.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[A.TTD]}),B})();function ya(B){return""===B||!!B}let va=(()=>{class B{constructor(S,G,ne,me,ze){this.parentContexts=S,this.location=G,this.resolver=ne,this.changeDetector=ze,this.activated=null,this._activatedRoute=null,this.activateEvents=new A.vpe,this.deactivateEvents=new A.vpe,this.name=me||K,S.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const S=this.parentContexts.getContext(this.name);S&&S.route&&(S.attachRef?this.attach(S.attachRef,S.route):this.activateWith(S.route,S.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const S=this.activated;return this.activated=null,this._activatedRoute=null,S}attach(S,G){this.activated=S,this._activatedRoute=G,this.location.insert(S.hostView)}deactivate(){if(this.activated){const S=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(S)}}activateWith(S,G){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=S;const ze=(G=G||this.resolver).resolveComponentFactory(S._futureSnapshot.routeConfig.component),et=this.parentContexts.getOrCreateContext(this.name).children,Nt=new _s(S,et,this.location.injector);this.activated=this.location.createComponent(ze,this.location.length,Nt),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return B.\u0275fac=function(S){return new(S||B)(A.Y36(xo),A.Y36(A.s_b),A.Y36(A._Vd),A.$8M("name"),A.Y36(A.sBO))},B.\u0275dir=A.lG2({type:B,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),B})();class _s{constructor(P,S,G){this.route=P,this.childContexts=S,this.parent=G}get(P,S){return P===Ni?this.route:P===xo?this.childContexts:this.parent.get(P,S)}}class Xl{}class ta{preload(P,S){return(0,Ge.of)(null)}}let yn=(()=>{class B{constructor(S,G,ne,me,ze){this.router=S,this.injector=me,this.preloadingStrategy=ze,this.loader=new $i(G,ne,En=>S.triggerEvent(new Yr(En)),En=>S.triggerEvent(new Gr(En)))}setUpPreloading(){this.subscription=this.router.events.pipe((0,kn.h)(S=>S instanceof jr),(0,Wt.b)(()=>this.preload())).subscribe(()=>{})}preload(){const S=this.injector.get(A.h0i);return this.processRoutes(S,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(S,G){const ne=[];for(const me of G)if(me.loadChildren&&!me.canLoad&&me._loadedConfig){const ze=me._loadedConfig;ne.push(this.processRoutes(ze.module,ze.routes))}else me.loadChildren&&!me.canLoad?ne.push(this.preloadConfig(S,me)):me.children&&ne.push(this.processRoutes(S,me.children));return(0,gn.D)(ne).pipe((0,Lt.J)(),(0,Tt.U)(me=>{}))}preloadConfig(S,G){return this.preloadingStrategy.preload(G,()=>(G._loadedConfig?(0,Ge.of)(G._loadedConfig):this.loader.load(S.injector,G)).pipe((0,_t.zg)(me=>(G._loadedConfig=me,this.processRoutes(me.module,me.routes)))))}}return B.\u0275fac=function(S){return new(S||B)(A.LFG(gs),A.LFG(A.v3s),A.LFG(A.Sil),A.LFG(A.zs3),A.LFG(Xl))},B.\u0275prov=A.Yz7({token:B,factory:B.\u0275fac}),B})(),Sl=(()=>{class B{constructor(S,G,ne={}){this.router=S,this.viewportScroller=G,this.options=ne,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},ne.scrollPositionRestoration=ne.scrollPositionRestoration||"disabled",ne.anchorScrolling=ne.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(S=>{S instanceof xn?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=S.navigationTrigger,this.restoredId=S.restoredState?S.restoredState.navigationId:0):S instanceof jr&&(this.lastId=S.id,this.scheduleScrollEvent(S,this.router.parseUrl(S.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(S=>{S instanceof lr&&(S.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(S.position):S.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(S.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(S,G){this.router.triggerEvent(new lr(S,"popstate"===this.lastSource?this.store[this.restoredId]:null,G))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return B.\u0275fac=function(S){return new(S||B)(A.LFG(gs),A.LFG(D.EM),A.LFG(void 0))},B.\u0275prov=A.Yz7({token:B,factory:B.\u0275fac}),B})();const Bs=new A.OlP("ROUTER_CONFIGURATION"),sl=new A.OlP("ROUTER_FORROOT_GUARD"),Na=[D.Ye,{provide:Br,useClass:Ci},{provide:gs,useFactory:function(B,P,S,G,ne,me,ze,et={},Nt,En){const dr=new gs(null,B,P,S,G,ne,me,St(ze));return Nt&&(dr.urlHandlingStrategy=Nt),En&&(dr.routeReuseStrategy=En),function(B,P){B.errorHandler&&(P.errorHandler=B.errorHandler),B.malformedUriErrorHandler&&(P.malformedUriErrorHandler=B.malformedUriErrorHandler),B.onSameUrlNavigation&&(P.onSameUrlNavigation=B.onSameUrlNavigation),B.paramsInheritanceStrategy&&(P.paramsInheritanceStrategy=B.paramsInheritanceStrategy),B.relativeLinkResolution&&(P.relativeLinkResolution=B.relativeLinkResolution),B.urlUpdateStrategy&&(P.urlUpdateStrategy=B.urlUpdateStrategy)}(et,dr),et.enableTracing&&dr.events.subscribe(Un=>{var fi,kr;null===(fi=console.group)||void 0===fi||fi.call(console,`Router Event: ${Un.constructor.name}`),console.log(Un.toString()),console.log(Un),null===(kr=console.groupEnd)||void 0===kr||kr.call(console)}),dr},deps:[Br,xo,D.Ye,A.zs3,A.v3s,A.Sil,Fa,Bs,[class{},new A.FiY],[class{},new A.FiY]]},xo,{provide:Ni,useFactory:function(B){return B.routerState.root},deps:[gs]},{provide:A.v3s,useClass:A.EAV},yn,ta,class{preload(P,S){return S().pipe((0,nt.K)(()=>(0,Ge.of)(null)))}},{provide:Bs,useValue:{enableTracing:!1}}];function Dl(){return new A.PXZ("Router",gs)}let Ql=(()=>{class B{constructor(S,G){}static forRoot(S,G){return{ngModule:B,providers:[Na,na(S),{provide:sl,useFactory:Nc,deps:[[gs,new A.FiY,new A.tp0]]},{provide:Bs,useValue:G||{}},{provide:D.S$,useFactory:ol,deps:[D.lw,[new A.tBr(D.mr),new A.FiY],Bs]},{provide:Sl,useFactory:xa,deps:[gs,D.EM,Bs]},{provide:Xl,useExisting:G&&G.preloadingStrategy?G.preloadingStrategy:ta},{provide:A.PXZ,multi:!0,useFactory:Dl},[ba,{provide:A.ip1,multi:!0,useFactory:Il,deps:[ba]},{provide:ra,useFactory:al,deps:[ba]},{provide:A.tb,multi:!0,useExisting:ra}]]}}static forChild(S){return{ngModule:B,providers:[na(S)]}}}return B.\u0275fac=function(S){return new(S||B)(A.LFG(sl,8),A.LFG(gs,8))},B.\u0275mod=A.oAB({type:B}),B.\u0275inj=A.cJS({}),B})();function xa(B,P,S){return S.scrollOffset&&P.setOffset(S.scrollOffset),new Sl(B,P,S)}function ol(B,P,S={}){return S.useHash?new D.Do(B,P):new D.b0(B,P)}function Nc(B){return"guarded"}function na(B){return[{provide:A.deG,multi:!0,useValue:B},{provide:Fa,multi:!0,useValue:B}]}let ba=(()=>{class B{constructor(S){this.injector=S,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new R.xQ}appInitializer(){return this.injector.get(D.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let G=null;const ne=new Promise(et=>G=et),me=this.injector.get(gs),ze=this.injector.get(Bs);return"disabled"===ze.initialNavigation?(me.setUpLocationChangeListener(),G(!0)):"enabled"===ze.initialNavigation||"enabledBlocking"===ze.initialNavigation?(me.hooks.afterPreactivation=()=>this.initNavigation?(0,Ge.of)(null):(this.initNavigation=!0,G(!0),this.resultOfPreactivationDone),me.initialNavigation()):G(!0),ne})}bootstrapListener(S){const G=this.injector.get(Bs),ne=this.injector.get(yn),me=this.injector.get(Sl),ze=this.injector.get(gs),et=this.injector.get(A.z2F);S===et.components[0]&&(("enabledNonBlocking"===G.initialNavigation||void 0===G.initialNavigation)&&ze.initialNavigation(),ne.setUpPreloading(),me.init(),ze.resetRootComponentType(et.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return B.\u0275fac=function(S){return new(S||B)(A.LFG(A.zs3))},B.\u0275prov=A.Yz7({token:B,factory:B.\u0275fac}),B})();function Il(B){return B.appInitializer.bind(B)}function al(B){return B.bootstrapListener.bind(B)}const ra=new A.OlP("Router Initializer")},1650:(Mt,at,te)=>{"use strict";var D=te(4536),A=te(166),R="value",u="\n  ",ge={};function Se(Ne){var ke=Array.isArray(Ne);return function(Je){var Me=Ce(ge.plainArray,Je);if(Me)return Me;if(ke&&Je.length!==Ne.length)return"an array with "+Ne.length+" items";for(var Ge=0;Ge<Je.length;Ge++)if(Me=Ce(ke?Ne[Ge]:Ne,Je[Ge]))return[Ge].concat(Me)}}function Ce(Ne,ke){if(null!=ke||Ne.hasOwnProperty("__required")){var lt=Ne(ke);if(lt)return Array.isArray(lt)?lt:[lt]}}function ce(Ne,ke){var lt=Ne.length,Ot=Ne[lt-1],Je=Ne.slice(0,lt-1);return 0===Je.length&&(Je=[R]),ke=A(ke,{path:Je}),"function"==typeof Ot?Ot(ke):Be(ke,function(Ne){return"must be "+function(Ne){return/^an? /.test(Ne)?Ne:/^[aeiou]/i.test(Ne)?"an "+Ne:/^[a-z]/i.test(Ne)?"a "+Ne:Ne}(Ne)+"."}(Ot))}function ae(Ne){return Ne.length<2?Ne[0]:2===Ne.length?Ne.join(" or "):Ne.slice(0,-1).join(", ")+", or "+Ne.slice(-1)}function Be(Ne,ke){return(we(Ne.path)?"Item at position ":"")+Ne.path.join(".")+" "+ke}function we(Ne){return"number"==typeof Ne[Ne.length-1]||"number"==typeof Ne[0]}ge.assert=function(Ne,ke){return ke=ke||{},function(lt){var Ot=Ce(Ne,lt);if(Ot){var Je=ce(Ot,ke);throw ke.apiName&&(Je=ke.apiName+": "+Je),new Error(Je)}}},ge.shape=function(ke){var Ne,lt=(Ne=ke,Object.keys(Ne||{}).map(function(ke){return{key:ke,value:Ne[ke]}}));return function(Je){var Me=Ce(ge.plainObject,Je);if(Me)return Me;for(var Ge,Ht=[],zn=0;zn<lt.length;zn++)(Me=Ce(lt[zn].value,Je[Ge=lt[zn].key]))&&Ht.push([Ge].concat(Me));return Ht.length<2?Ht[0]:function(gn){Ht=Ht.map(function(Gn){return"- "+Gn[0]+": "+ce(Gn,gn).split("\n").join(u)});var Xt=gn.path.join(".");return"The following properties"+(Xt===R?"":" of "+Xt)+" have invalid values:"+u+Ht.join(u)}}},ge.strictShape=function(ke){var lt=ge.shape(ke);return function(Je){var Me=lt(Je);if(Me)return Me;var Ge=Object.keys(Je).reduce(function(Lt,Ht){return void 0===ke[Ht]&&Lt.push(Ht),Lt},[]);return 0!==Ge.length?function(){return"The following keys are invalid: "+Ge.join(", ")}:void 0}},ge.arrayOf=function(ke){return Se(ke)},ge.tuple=function(){var ke=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Se(ke)},ge.required=function(ke){function lt(Ot){return null==Ot?function(Je){return Be(Je,we(Je.path)?"cannot be undefined/null.":"is required.")}:ke.apply(this,arguments)}return lt.__required=!0,lt},ge.oneOfType=function(){var ke=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(Ot){var Je=ke.map(function(Me){return Ce(Me,Ot)}).filter(Boolean);if(Je.length===ke.length)return Je.every(function(Me){return 1===Me.length&&"string"==typeof Me[0]})?ae(Je.map(function(Me){return Me[0]})):Je.reduce(function(Me,Ge){return Ge.length>Me.length?Ge:Me})}},ge.equal=function(ke){return function(Ot){if(Ot!==ke)return JSON.stringify(ke)}},ge.oneOf=function(){var ke=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),lt=ke.map(function(Ot){return ge.equal(Ot)});return ge.oneOfType.apply(this,lt)},ge.range=function(ke){var lt=ke[0],Ot=ke[1];return function(Me){if(Ce(ge.number,Me)||Me<lt||Me>Ot)return"number between "+lt+" & "+Ot+" (inclusive)"}},ge.any=function(){},ge.boolean=function(ke){if("boolean"!=typeof ke)return"boolean"},ge.number=function(ke){if("number"!=typeof ke)return"number"},ge.plainArray=function(ke){if(!Array.isArray(ke))return"array"},ge.plainObject=function(ke){if(!D(ke))return"object"},ge.string=function(ke){if("string"!=typeof ke)return"string"},ge.func=function(ke){if("function"!=typeof ke)return"function"},ge.validate=Ce,ge.processMessage=ce,Mt.exports=ge},239:(Mt,at,te)=>{"use strict";var D=te(4196);function A(R){this.origin=R.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=R.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=R,this.send=this.send.bind(this),this.countries=R.countries?R.countries.split(","):null,this.types=R.types?R.types.split(","):null,this.bbox=R.bbox?R.bbox:null,this.language=R.language?R.language.split(","):null,this.limit=R.limit?+R.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(R),this.eventQueue=new Array,this.flushInterval=R.flushInterval||1e3,this.maxQueueSize=R.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}A.prototype={select:function(R,u){var ge=this.getSelectedIndex(R,u),Se=this.getEventPayload("search.select",u);if(Se.resultIndex=ge,Se.resultPlaceName=R.place_name,Se.resultId=R.id,(ge!==this.lastSentIndex||Se.queryString!==this.lastSentInput)&&-1!=ge&&(this.lastSentIndex=ge,this.lastSentInput=Se.queryString,Se.queryString))return this.push(Se)},start:function(R){var u=this.getEventPayload("search.start",R);if(u.queryString)return this.push(u)},keyevent:function(R,u){if(R.key&&!R.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(R.keyCode)){var ge=this.getEventPayload("search.keystroke",u);if(ge.lastAction=R.key,ge.queryString)return this.push(ge)}},send:function(R,u){if(!this.enableEventLogging)return u?u():void 0;var ge=this.getRequestOptions(R);this.request(ge,function(Se){return Se?this.handleError(Se,u):u?u():void 0}.bind(this))},getRequestOptions:function(R){return Array.isArray(R)||(R=[R]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(R)}},getEventPayload:function(R,u){var ge;ge=u.options.proximity?[u.options.proximity.longitude,u.options.proximity.latitude]:null;var Se=u._map?u._map.getZoom():void 0,Ce={event:R,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:u.options.autocomplete,fuzzyMatch:u.options.fuzzyMatch,proximity:ge,limit:u.options.limit,routing:u.options.routing,worldview:u.options.worldview,mapZoom:Se,keyboardLocale:this.locale};return Ce.queryString="search.select"===R?u.inputString:"search.select"!=R&&u._inputEl?u._inputEl.value:u.inputString,Ce},request:function(R,u){var ge=new XMLHttpRequest;for(var Se in ge.onreadystatechange=function(){if(4==this.readyState)return u(204==this.status?null:this.statusText)},ge.open(R.method,R.host+"/"+R.path,!0),R.headers)ge.setRequestHeader(Se,R.headers[Se]);ge.send(R.body)},handleError:function(R,u){if(u)return u(R)},generateSessionID:function(){return D()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(R,u){if(u._typeahead){var Se=R.id;return u._typeahead.data.map(function(ae){return ae.id}).indexOf(Se)}},shouldEnableLogging:function(R){return!(!1===R.enableEventLogging||R.origin&&-1==R.origin.indexOf("api.mapbox.com")||R.localGeocoder||R.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(R,u){this.eventQueue.push(R),(this.eventQueue.length>=this.maxQueueSize||u)&&this.flush()},remove:function(){this.flush()}},Mt.exports=A},2410:Mt=>{Mt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},2763:(Mt,at,te)=>{"use strict";var D=te(2462),A=te(6906),R=te(166),u=te(3105).EventEmitter,ge=te(2410),Se=te(2642),Ce=te(274),ce=te(239),ae=te(364),ve=te(561);function Be(we){this._eventEmitter=new u,this.options=R({},this.options,we),this.inputString="",this.fresh=!0,this.lastSelected=null}Be.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,getItemValue:function(we){return we.place_name},render:function(we){var Oe=we.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+Oe[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+Oe.splice(1,Oe.length).join(",")+"</div></div>"}},addTo:function(we){function Oe(Ne,ke){if(!document.body.contains(ke))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const lt=Ne.onAdd();ke.appendChild(lt)}if(we._controlContainer)we.addControl(this);else if(we instanceof HTMLElement)Oe(this,we);else{if("string"!=typeof we)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const Ne=document.querySelectorAll(we);if(0===Ne.length)throw new Error("Element ",we,"not found.");if(Ne.length>1)throw new Error("Geocoder can only be added to a single html element");Oe(this,Ne[0])}}},onAdd:function(we){if(we&&"string"!=typeof we&&(this._map=we),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Ce(Se({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new ce(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this);var Oe=this.container=document.createElement("div");Oe.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var Ne=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",A(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(Ot){this.eventManager.keyevent(Ot,this)}.bind(this));var ke=document.createElement("div");ke.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var lt=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');return this._clearEl.appendChild(lt),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),ke.appendChild(this._clearEl),ke.appendChild(this._loadingEl),Oe.appendChild(Ne),Oe.appendChild(this._inputEl),Oe.appendChild(ke),this._typeahead=new D(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit}),this.setRenderFunction(this.options.render),this._typeahead.getItemValue=this.options.getItemValue,this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),Oe},createIcon:function(we,Oe){var Ne=document.createElementNS("http://www.w3.org/2000/svg","svg");if(Ne.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+we),Ne.setAttribute("viewBox","0 0 18 18"),Ne.setAttribute("xml:space","preserve"),Ne.setAttribute("width",18),Ne.setAttribute("height",18),"innerHTML"in Ne)Ne.innerHTML=Oe;else{var ke=document.createElement("div");ke.innerHTML="<svg>"+Oe.valueOf().toString()+"</svg>",Ne.appendChild(ke.firstChild.firstChild)}return Ne},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_onPaste:function(we){var Oe=(we.clipboardData||window.clipboardData).getData("text");Oe.length>=this.options.minLength&&this._geocode(Oe)},_onKeyDown:function(we){var Oe=27,Ne=9;if(we.keyCode===Oe&&this.options.clearAndBlurOnEsc)return this._clear(we),this._inputEl.blur();var ke=we.target&&we.target.shadowRoot?we.target.shadowRoot.activeElement:we.target;if(!ke||!ke.value)return this.fresh=!0,we.keyCode!==Ne&&this.clear(we),this._clearEl.style.display="none";we.metaKey||-1!==[Ne,Oe,37,39,13,38,40].indexOf(we.keyCode)||ke.value.length>=this.options.minLength&&this._geocode(ke.value)},_showButton:function(){this._typeahead.selected&&(this._clearEl.style.display="block")},_hideButton:function(){this._typeahead.selected&&(this._clearEl.style.display="none")},_onBlur:function(we){this.options.clearOnBlur&&this._clearOnBlur(we),this.options.collapsed&&this._collapse()},_onChange:function(){var we=this._typeahead.selected;if(we&&JSON.stringify(we)!==this.lastSelected){var Oe;if(this._clearEl.style.display="none",this.options.flyTo)if(we.properties&&ge[we.properties.short_code])Oe=R({},this.options.flyTo),this._map&&this._map.fitBounds(ge[we.properties.short_code].bbox,Oe);else if(we.bbox){var Ne=we.bbox;Oe=R({},this.options.flyTo),this._map&&this._map.fitBounds([[Ne[0],Ne[1]],[Ne[2],Ne[3]]],Oe)}else Oe=R({},{zoom:this.options.zoom},this.options.flyTo),we.center?Oe.center=we.center:we.geometry&&we.geometry.type&&"Point"===we.geometry.type&&we.geometry.coordinates&&(Oe.center=we.geometry.coordinates),this._map&&this._map.flyTo(Oe);this.options.marker&&this._mapboxgl&&this._handleMarker(we),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(we),this._eventEmitter.emit("result",{result:we}),this.eventManager.select(we,this)}},_requestType:function(we,Oe){return we.localGeocoderOnly?1:we.reverseGeocode&&/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)[ ]*$/.test(Oe)?2:0},_setupConfig:function(we,Oe){const ke=/[\s,]+/;var lt=this,Ot=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(Me,Ge){return null==lt.options[Ge]||(Me[Ge]=["countries","types","language"].indexOf(Ge)>-1?lt.options[Ge].split(ke):lt.options[Ge],"proximity"===Ge&&"number"==typeof lt.options[Ge].longitude&&"number"==typeof lt.options[Ge].latitude&&(Me[Ge]=[lt.options[Ge].longitude,lt.options[Ge].latitude])),Me},{});switch(we){case 2:var Je=Oe.split(ke).map(function(Me){return parseFloat(Me,10)}).reverse();Ot=R(Ot,{query:Je,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(Me){Me in Ot&&delete Ot[Me]});break;case 0:/^[ ]*(-?\d+\.?\d*)[, ]+(-?\d+\.?\d*)*[ ]*$/.test(Oe)&&(Oe=Oe.replace(/,/g," ")),Ot=R(Ot,{query:Oe})}return Ot},_geocode:function(we){this.inputString=we,this._loadingEl.style.display="block",this._eventEmitter.emit("loading",{query:we});const Oe=this._requestType(this.options,we),Ne=this._setupConfig(Oe,we);var ke;switch(Oe){case 1:ke=Promise.resolve();break;case 0:ke=this.geocoderService.forwardGeocode(Ne).send();break;case 2:ke=this.geocoderService.reverseGeocode(Ne).send()}var lt=this.options.localGeocoder&&this.options.localGeocoder(we)||[],Ot=[],Je=null;return ke.catch(function(Me){Je=Me}.bind(this)).then(function(Me){this._loadingEl.style.display="none";var Ge={};return Me?"200"==Me.statusCode&&((Ge=Me.body).request=Me.request,Ge.headers=Me.headers):Ge={type:"FeatureCollection",features:[]},Ge.config=Ne,this.fresh&&(this.eventManager.start(this),this.fresh=!1),Ge.features=Ge.features?lt.concat(Ge.features):lt,this.options.externalGeocoder?(Ot=this.options.externalGeocoder(we,Ge.features)||[]).then(function(Lt){return Ge.features=Ge.features?Lt.concat(Ge.features):Lt,Ge},function(){return Ge}):Ge}.bind(this)).then(function(Me){if(Je)throw Je;this.options.filter&&Me.features.length&&(Me.features=Me.features.filter(this.options.filter)),Me.features.length?(this._clearEl.style.display="block",this._eventEmitter.emit("results",Me),this._typeahead.update(Me.features)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",Me))}.bind(this)).catch(function(Me){this._loadingEl.style.display="none",lt.length&&this.options.localGeocoder||Ot.length&&this.options.externalGeocoder?(this._clearEl.style.display="block",this._typeahead.update(lt)):(this._clearEl.style.display="none",this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:lt}),this._eventEmitter.emit("error",{error:Me})}.bind(this)),ke},_clear:function(we){we&&we.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._clearEl.style.display="none",this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(we){this._clear(we),this._inputEl.focus()},_clearOnBlur:function(we){we.relatedTarget&&this._clear(we)},_onQueryResult:function(we){var Oe=we.body;if(Oe.features.length){var Ne=Oe.features[0];this._typeahead.selected=Ne,this._inputEl.value=Ne.place_name,this._onChange()}},_updateProximity:function(){if(this._map)if(this._map.getZoom()>9){var we=this._map.getCenter().wrap();this.setProximity({longitude:we.lng,latitude:we.lat})}else this.setProximity(null)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(we){return this._geocode(we).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderMessage:function(we){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(we)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var we=this.options.language.split(",")[0],Oe=ve.language(we),Ne=ae.placeholder[Oe];if(Ne)return Ne}return"Search"},setInput:function(we){return this._inputEl.value=we,this._typeahead.selected=null,this._typeahead.clear(),we.length>=this.options.minLength&&this._geocode(we),this},setProximity:function(we){return this.options.proximity=we,this},getProximity:function(){return this.options.proximity},setRenderFunction:function(we){return we&&"function"==typeof we&&(this._typeahead.render=we),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(we){var Oe=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=we||this.options.language||Oe,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(we){return this.options.zoom=we,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(we){return this.options.flyTo=we,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(we){return this.placeholder=we||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(we){return this.options.bbox=we,this},getCountries:function(){return this.options.countries},setCountries:function(we){return this.options.countries=we,this},getTypes:function(){return this.options.types},setTypes:function(we){return this.options.types=we,this},getMinLength:function(){return this.options.minLength},setMinLength:function(we){return this.options.minLength=we,this._typeahead&&(this._typeahead.options.minLength=we),this},getLimit:function(){return this.options.limit},setLimit:function(we){return this.options.limit=we,this._typeahead&&(this._typeahead.options.limit=we),this},getFilter:function(){return this.options.filter},setFilter:function(we){return this.options.filter=we,this},setOrigin:function(we){return this.options.origin=we,this.geocoderService=Ce(Se({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAutocomplete:function(we){return this.options.autocomplete=we,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(we){return this.options.fuzzyMatch=we,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(we){return this.options.routing=we,this},getRouting:function(){return this.options.routing},setWorldview:function(we){return this.options.worldview=we,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(we){if(this._map){this._removeMarker();var Ne=R({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(Ne),we.center?this.mapMarker.setLngLat(we.center).addTo(this._map):we.geometry&&we.geometry.type&&"Point"===we.geometry.type&&we.geometry.coordinates&&this.mapMarker.setLngLat(we.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(we,Oe){return this._eventEmitter.on(we,Oe),this},off:function(we,Oe){return this._eventEmitter.removeListener(we,Oe),this.eventManager.remove(),this}},Mt.exports=Be},364:Mt=>{"use strict";Mt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},4196:Mt=>{for(var at=self.crypto||self.msCrypto,te="-_",D=36;D--;)te+=D.toString(36);for(D=36;D---10;)te+=D.toString(36).toUpperCase();Mt.exports=function(A){var R="",u=at.getRandomValues(new Uint8Array(A||21));for(D=A||21;D--;)R+=te[63&u[D]];return R}},2642:(Mt,at,te)=>{"use strict";var D=te(4418);Mt.exports=D},4418:(Mt,at,te)=>{"use strict";var D=te(8055),A=te(7864);function R(ge){A.call(this,ge)}(R.prototype=Object.create(A.prototype)).constructor=R,R.prototype.sendRequest=D.browserSend,R.prototype.abortRequest=D.browserAbort,Mt.exports=function(ge){return new R(ge)}},8055:(Mt,at,te)=>{"use strict";var D=te(3223),A=te(712),R=te(6849),u=te(9032),ge={};function ce(Be){var we=Be.total,Oe=Be.loaded;return{total:we,transferred:Oe,percent:100*Oe/we}}function ae(Be,we){return new Promise(function(Oe,Ne){we.onprogress=function(Ot){Be.emitter.emit(R.EVENT_PROGRESS_DOWNLOAD,ce(Ot))};var ke=Be.file;ke&&(we.upload.onprogress=function(Ot){Be.emitter.emit(R.EVENT_PROGRESS_UPLOAD,ce(Ot))}),we.onerror=function(Ot){Ne(Ot)},we.onabort=function(){var Ot=new A({request:Be,type:R.ERROR_REQUEST_ABORTED});Ne(Ot)},we.onload=function(){if(delete ge[Be.id],we.status<200||we.status>=400){var Ot=new A({request:Be,body:we.response,statusCode:we.status});Ne(Ot)}else Oe(we)};var lt=Be.body;"string"==typeof lt?we.send(lt):lt?we.send(JSON.stringify(lt)):ke?we.send(ke):we.send(),ge[Be.id]=we}).then(function(Oe){return function(Be,we){return new D(Be,{body:we.response,headers:u(we.getAllResponseHeaders()),statusCode:we.status})}(Be,Oe)})}function ve(Be,we){var Oe=Be.url(we),Ne=new window.XMLHttpRequest;return Ne.open(Be.method,Oe),Object.keys(Be.headers).forEach(function(ke){Ne.setRequestHeader(ke,Be.headers[ke])}),Ne}Mt.exports={browserAbort:function(Be){var we=ge[Be.id];!we||(we.abort(),delete ge[Be.id])},sendRequestXhr:ae,browserSend:function(Be){return Promise.resolve().then(function(){var we=ve(Be,Be.client.accessToken);return ae(Be,we)})},createRequestXhr:ve}},7864:(Mt,at,te)=>{"use strict";var D=te(2218),A=te(8495),R=te(6849);function u(ge){if(!ge||!ge.accessToken)throw new Error("Cannot create a client without an access token");D(ge.accessToken),this.accessToken=ge.accessToken,this.origin=ge.origin||R.API_ORIGIN}u.prototype.createRequest=function(Se){return new A(this,Se)},Mt.exports=u},712:(Mt,at,te)=>{"use strict";var D=te(6849);Mt.exports=function(R){var ge,u=R.type||D.ERROR_HTTP;if(R.body)try{ge=JSON.parse(R.body)}catch(Ce){ge=R.body}else ge=null;var Se=R.message||null;Se||("string"==typeof ge?Se=ge:ge&&"string"==typeof ge.message?Se=ge.message:u===D.ERROR_REQUEST_ABORTED&&(Se="Request aborted")),this.message=Se,this.type=u,this.statusCode=R.statusCode||null,this.request=R.request,this.body=ge}},8495:(Mt,at,te)=>{"use strict";var D=te(2218),A=te(166),R=te(3563),u=te(6824),ge=te(6849),Se=1;function Ce(ce,ae){if(!ce)throw new Error("MapiRequest requires a client");if(!ae||!ae.path||!ae.method)throw new Error("MapiRequest requires an options object with path and method properties");var ve={};ae.body&&(ve["content-type"]="application/json");var Ue=A(ve,ae.headers),Be=Object.keys(Ue).reduce(function(we,Oe){return we[Oe.toLowerCase()]=Ue[Oe],we},{});this.id=Se++,this._options=ae,this.emitter=new R,this.client=ce,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=ae.path,this.method=ae.method,this.origin=ae.origin||ce.origin,this.query=ae.query||{},this.params=ae.params||{},this.body=ae.body||null,this.file=ae.file||null,this.encoding=ae.encoding||"utf8",this.sendFileAs=ae.sendFileAs||null,this.headers=Be}Ce.prototype.url=function(ae){var ve=u.prependOrigin(this.path,this.origin);ve=u.appendQueryObject(ve,this.query);var Ue=this.params,Be=null==ae?this.client.accessToken:ae;if(Be){ve=u.appendQueryParam(ve,"access_token",Be);var we=D(Be).user;Ue=A({ownerId:we},Ue)}return u.interpolateRouteParams(ve,Ue)},Ce.prototype.send=function(){var ae=this;if(ae.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return ae.sent=!0,ae.client.sendRequest(ae).then(function(ve){return ae.response=ve,ae.emitter.emit(ge.EVENT_RESPONSE,ve),ve},function(ve){throw ae.error=ve,ae.emitter.emit(ge.EVENT_ERROR,ve),ve})},Ce.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},Ce.prototype.eachPage=function(ae){var ve=this;function Ue(Oe){ae(null,Oe,function(){delete ve._nextPageRequest;var ke=Oe.nextPage();ke&&(ve._nextPageRequest=ke,we(ke))})}function Be(Oe){ae(Oe,null,function(){})}function we(Oe){Oe.send().then(Ue,Be)}we(this)},Ce.prototype.clone=function(){return this._extend()},Ce.prototype._extend=function(ae){var ve=A(this._options,ae);return new Ce(this.client,ve)},Mt.exports=Ce},3223:(Mt,at,te)=>{"use strict";var D=te(7986);function A(R,u){this.request=R,this.headers=u.headers,this.rawBody=u.body,this.statusCode=u.statusCode;try{this.body=JSON.parse(u.body||"{}")}catch(ge){this.body=u.body}this.links=D(this.headers.link)}A.prototype.hasNextPage=function(){return!!this.links.next},A.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Mt.exports=A},6849:Mt=>{"use strict";Mt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},9032:Mt=>{"use strict";Mt.exports=function(D){var A={};return D&&D.trim().split(/[\r|\n]+/).forEach(function(R){var u=function(D){var A=D.indexOf(":");return{name:D.substring(0,A).trim().toLowerCase(),value:D.substring(A+1).trim()}}(R);A[u.name]=u.value}),A}},7986:Mt=>{"use strict";Mt.exports=function(A){return A?A.split(/,\s*</).reduce(function(R,u){var ge=function(A){var R=A.match(/<?([^>]*)>(.*)/);if(!R)return null;var u=R[1],ge=R[2].split(";"),Se=null,Ce=ge.reduce(function(ce,ae){var ve=function(A){var R=A.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return R?{key:R[1],value:R[2]}:null}(ae);return ve?"rel"===ve.key?(Se||(Se=ve.value),ce):(ce[ve.key]=ve.value,ce):ce},{});return Se?{url:u,rel:Se,params:Ce}:null}(u);return ge?(ge.rel.split(/\s+/).forEach(function(Ce){R[Ce]||(R[Ce]={url:ge.url,params:ge.params})}),R):R},{}):{}}},6824:Mt=>{"use strict";function te(ge){return Array.isArray(ge)?function(ge){return ge.map(encodeURIComponent).join(",")}(ge):encodeURIComponent(String(ge))}function D(ge,Se,Ce){if(!1===Ce||null===Ce)return ge;var ce=/\?/.test(ge)?"&":"?",ae=encodeURIComponent(Se);return void 0!==Ce&&""!==Ce&&!0!==Ce&&(ae+="="+te(Ce)),""+ge+ce+ae}Mt.exports={appendQueryObject:function(ge,Se){if(!Se)return ge;var Ce=ge;return Object.keys(Se).forEach(function(ce){var ae=Se[ce];void 0!==ae&&(Array.isArray(ae)&&(ae=ae.filter(function(ve){return null!=ve}).join(",")),Ce=D(Ce,ce,ae))}),Ce},appendQueryParam:D,prependOrigin:function(ge,Se){if(!Se||"http"===ge.slice(0,4))return ge;var Ce="/"===ge[0]?"":"/";return""+Se.replace(/\/$/,"")+Ce+ge},interpolateRouteParams:function(ge,Se){return Se?ge.replace(/\/:([a-zA-Z0-9]+)/g,function(Ce,ce){var ae=Se[ce];if(void 0===ae)throw new Error("Unspecified route parameter "+ce);return"/"+te(ae)}):ge}}},3563:Mt=>{"use strict";var at=Object.prototype.hasOwnProperty,te="~";function D(){}function A(Se,Ce,ce){this.fn=Se,this.context=Ce,this.once=ce||!1}function R(Se,Ce,ce,ae,ve){if("function"!=typeof ce)throw new TypeError("The listener must be a function");var Ue=new A(ce,ae||Se,ve),Be=te?te+Ce:Ce;return Se._events[Be]?Se._events[Be].fn?Se._events[Be]=[Se._events[Be],Ue]:Se._events[Be].push(Ue):(Se._events[Be]=Ue,Se._eventsCount++),Se}function u(Se,Ce){0==--Se._eventsCount?Se._events=new D:delete Se._events[Ce]}function ge(){this._events=new D,this._eventsCount=0}Object.create&&(D.prototype=Object.create(null),(new D).__proto__||(te=!1)),ge.prototype.eventNames=function(){var ce,ae,Ce=[];if(0===this._eventsCount)return Ce;for(ae in ce=this._events)at.call(ce,ae)&&Ce.push(te?ae.slice(1):ae);return Object.getOwnPropertySymbols?Ce.concat(Object.getOwnPropertySymbols(ce)):Ce},ge.prototype.listeners=function(Ce){var ae=this._events[te?te+Ce:Ce];if(!ae)return[];if(ae.fn)return[ae.fn];for(var ve=0,Ue=ae.length,Be=new Array(Ue);ve<Ue;ve++)Be[ve]=ae[ve].fn;return Be},ge.prototype.listenerCount=function(Ce){var ae=this._events[te?te+Ce:Ce];return ae?ae.fn?1:ae.length:0},ge.prototype.emit=function(Ce,ce,ae,ve,Ue,Be){var we=te?te+Ce:Ce;if(!this._events[we])return!1;var ke,lt,Oe=this._events[we],Ne=arguments.length;if(Oe.fn){switch(Oe.once&&this.removeListener(Ce,Oe.fn,void 0,!0),Ne){case 1:return Oe.fn.call(Oe.context),!0;case 2:return Oe.fn.call(Oe.context,ce),!0;case 3:return Oe.fn.call(Oe.context,ce,ae),!0;case 4:return Oe.fn.call(Oe.context,ce,ae,ve),!0;case 5:return Oe.fn.call(Oe.context,ce,ae,ve,Ue),!0;case 6:return Oe.fn.call(Oe.context,ce,ae,ve,Ue,Be),!0}for(lt=1,ke=new Array(Ne-1);lt<Ne;lt++)ke[lt-1]=arguments[lt];Oe.fn.apply(Oe.context,ke)}else{var Je,Ot=Oe.length;for(lt=0;lt<Ot;lt++)switch(Oe[lt].once&&this.removeListener(Ce,Oe[lt].fn,void 0,!0),Ne){case 1:Oe[lt].fn.call(Oe[lt].context);break;case 2:Oe[lt].fn.call(Oe[lt].context,ce);break;case 3:Oe[lt].fn.call(Oe[lt].context,ce,ae);break;case 4:Oe[lt].fn.call(Oe[lt].context,ce,ae,ve);break;default:if(!ke)for(Je=1,ke=new Array(Ne-1);Je<Ne;Je++)ke[Je-1]=arguments[Je];Oe[lt].fn.apply(Oe[lt].context,ke)}}return!0},ge.prototype.on=function(Ce,ce,ae){return R(this,Ce,ce,ae,!1)},ge.prototype.once=function(Ce,ce,ae){return R(this,Ce,ce,ae,!0)},ge.prototype.removeListener=function(Ce,ce,ae,ve){var Ue=te?te+Ce:Ce;if(!this._events[Ue])return this;if(!ce)return u(this,Ue),this;var Be=this._events[Ue];if(Be.fn)Be.fn===ce&&(!ve||Be.once)&&(!ae||Be.context===ae)&&u(this,Ue);else{for(var we=0,Oe=[],Ne=Be.length;we<Ne;we++)(Be[we].fn!==ce||ve&&!Be[we].once||ae&&Be[we].context!==ae)&&Oe.push(Be[we]);Oe.length?this._events[Ue]=1===Oe.length?Oe[0]:Oe:u(this,Ue)}return this},ge.prototype.removeAllListeners=function(Ce){var ce;return Ce?this._events[ce=te?te+Ce:Ce]&&u(this,ce):(this._events=new D,this._eventsCount=0),this},ge.prototype.off=ge.prototype.removeListener,ge.prototype.addListener=ge.prototype.on,ge.prefixed=te,ge.EventEmitter=ge,Mt.exports=ge},274:(Mt,at,te)=>{"use strict";var D=te(166),A=te(9748),R=te(8851),u=te(7661),ge=te(2081),Se={},Ce=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Se.forwardGeocode=function(ce){A.assertShape({query:A.required(A.string),mode:A.oneOf("mapbox.places","mapbox.places-permanent"),countries:A.arrayOf(A.string),proximity:A.coordinates,types:A.arrayOf(A.oneOf(Ce)),autocomplete:A.boolean,bbox:A.arrayOf(A.number),limit:A.number,language:A.arrayOf(A.string),routing:A.boolean,fuzzyMatch:A.boolean,worldview:A.string})(ce),ce.mode=ce.mode||"mapbox.places";var ae=u(D({country:ce.countries},R(ce,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:R(ce,["mode","query"]),query:ae})},Se.reverseGeocode=function(ce){A.assertShape({query:A.required(A.coordinates),mode:A.oneOf("mapbox.places","mapbox.places-permanent"),countries:A.arrayOf(A.string),types:A.arrayOf(A.oneOf(Ce)),bbox:A.arrayOf(A.number),limit:A.number,language:A.arrayOf(A.string),reverseMode:A.oneOf("distance","score"),routing:A.boolean,worldview:A.string})(ce),ce.mode=ce.mode||"mapbox.places";var ae=u(D({country:ce.countries},R(ce,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:R(ce,["mode","query"]),query:ae})},Mt.exports=ge(Se)},2081:(Mt,at,te)=>{"use strict";var D=te(7864),A=te(4418);Mt.exports=function(u){return function(ge){var Se;Se=D.prototype.isPrototypeOf(ge)?ge:A(ge);var Ce=Object.create(u);return Ce.client=Se,Ce}}},1145:Mt=>{"use strict";Mt.exports=function(te,D){return Object.keys(te).reduce(function(A,R){return A[R]=D(R,te[R]),A},{})}},8851:Mt=>{"use strict";Mt.exports=function(te,D){var A=function(R,u){return-1!==D.indexOf(R)&&void 0!==u};return"function"==typeof D&&(A=D),Object.keys(te).filter(function(R){return A(R,te[R])}).reduce(function(R,u){return R[u]=te[u],R},{})}},7661:(Mt,at,te)=>{"use strict";var D=te(1145);Mt.exports=function(R){return D(R,function(u,ge){return"boolean"==typeof ge?JSON.stringify(ge):ge})}},9748:(Mt,at,te)=>{"use strict";var D=te(166),A=te(1650);Mt.exports=D(A,{file:function(Ce){return"undefined"!=typeof window?Ce instanceof global.Blob||Ce instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof Ce&&void 0===Ce.pipe?"Filename or Readable stream":void 0},date:function(Ce){var ce="date";if("boolean"==typeof Ce)return ce;try{var ae=new Date(Ce);if(ae.getTime&&isNaN(ae.getTime()))return ce}catch(ve){return ce}},coordinates:function(Ce){return A.tuple(A.number,A.number)(Ce)},assertShape:function(Ce,ce){return A.assert(A.strictShape(Ce),ce)}})},2218:(Mt,at,te)=>{"use strict";var D=te(3839),A={};function ge(Se,Ce){return Object.prototype.hasOwnProperty.call(Se,Ce)}Mt.exports=function(Se){if(A[Se])return A[Se];var Ce=Se.split("."),ce=Ce[0],ae=Ce[1];if(!ae)throw new Error("Invalid token");var ve=function(Se){try{return JSON.parse(D.decode(Se))}catch(Ce){throw new Error("Invalid token")}}(ae),Ue={usage:ce,user:ve.u};return ge(ve,"a")&&(Ue.authorization=ve.a),ge(ve,"exp")&&(Ue.expires=1e3*ve.exp),ge(ve,"iat")&&(Ue.created=1e3*ve.iat),ge(ve,"scopes")&&(Ue.scopes=ve.scopes),ge(ve,"client")&&(Ue.client=ve.client),ge(ve,"ll")&&(Ue.lastLogin=ve.ll),ge(ve,"iu")&&(Ue.impersonator=ve.iu),A[Se]=Ue,Ue}},8573:(Mt,at)=>{function te(A){if(A)return function(A){for(var R in te.prototype)A[R]=te.prototype[R];return A}(A)}at.Q=te,te.prototype.on=te.prototype.addEventListener=function(A,R){return this._callbacks=this._callbacks||{},(this._callbacks["$"+A]=this._callbacks["$"+A]||[]).push(R),this},te.prototype.once=function(A,R){function u(){this.off(A,u),R.apply(this,arguments)}return u.fn=R,this.on(A,u),this},te.prototype.off=te.prototype.removeListener=te.prototype.removeAllListeners=te.prototype.removeEventListener=function(A,R){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var u=this._callbacks["$"+A];if(!u)return this;if(1==arguments.length)return delete this._callbacks["$"+A],this;for(var ge,Se=0;Se<u.length;Se++)if((ge=u[Se])===R||ge.fn===R){u.splice(Se,1);break}return 0===u.length&&delete this._callbacks["$"+A],this},te.prototype.emitReserved=te.prototype.emit=function(A){this._callbacks=this._callbacks||{};for(var R=new Array(arguments.length-1),u=this._callbacks["$"+A],ge=1;ge<arguments.length;ge++)R[ge-1]=arguments[ge];if(u){ge=0;for(var Se=(u=u.slice(0)).length;ge<Se;++ge)u[ge].apply(this,R)}return this},te.prototype.listeners=function(A){return this._callbacks=this._callbacks||{},this._callbacks["$"+A]||[]},te.prototype.hasListeners=function(A){return!!this.listeners(A).length}},7591:Mt=>{function at(te){this.ms=(te=te||{}).min||100,this.max=te.max||1e4,this.factor=te.factor||2,this.jitter=te.jitter>0&&te.jitter<=1?te.jitter:0,this.attempts=0}Mt.exports=at,at.prototype.duration=function(){var te=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var D=Math.random(),A=Math.floor(D*this.jitter*te);te=0==(1&Math.floor(10*D))?te-A:te+A}return 0|Math.min(te,this.max)},at.prototype.reset=function(){this.attempts=0},at.prototype.setMin=function(te){this.ms=te},at.prototype.setMax=function(te){this.max=te},at.prototype.setJitter=function(te){this.jitter=te}},3839:function(Mt,at,te){var D;Mt=te.nmd(Mt),function(A){"object"==typeof global&&global;var Se=function(Oe){this.message=Oe};(Se.prototype=new Error).name="InvalidCharacterError";var Ce=function(Oe){throw new Se(Oe)},ce="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ae=/[\t\n\f\r ]/g,Be={encode:function(Oe){Oe=String(Oe),/[^\0-\xFF]/.test(Oe)&&Ce("The string to be encoded contains characters outside of the Latin1 range.");for(var Ot,Je,Me,Lt,Ne=Oe.length%3,ke="",lt=-1,Ht=Oe.length-Ne;++lt<Ht;)Ot=Oe.charCodeAt(lt)<<16,Je=Oe.charCodeAt(++lt)<<8,Me=Oe.charCodeAt(++lt),ke+=ce.charAt((Lt=Ot+Je+Me)>>18&63)+ce.charAt(Lt>>12&63)+ce.charAt(Lt>>6&63)+ce.charAt(63&Lt);return 2==Ne?(Ot=Oe.charCodeAt(lt)<<8,Je=Oe.charCodeAt(++lt),ke+=ce.charAt((Lt=Ot+Je)>>10)+ce.charAt(Lt>>4&63)+ce.charAt(Lt<<2&63)+"="):1==Ne&&(Lt=Oe.charCodeAt(lt),ke+=ce.charAt(Lt>>2)+ce.charAt(Lt<<4&63)+"=="),ke},decode:function(Oe){var Ne=(Oe=String(Oe).replace(ae,"")).length;Ne%4==0&&(Ne=(Oe=Oe.replace(/==?$/,"")).length),(Ne%4==1||/[^+a-zA-Z0-9/]/.test(Oe))&&Ce("Invalid character: the string to be decoded is not correctly encoded.");for(var lt,Ot,ke=0,Je="",Me=-1;++Me<Ne;)Ot=ce.indexOf(Oe.charAt(Me)),lt=ke%4?64*lt+Ot:Ot,ke++%4&&(Je+=String.fromCharCode(255&lt>>(-2*ke&6)));return Je},version:"0.1.0"};void 0!==(D=function(){return Be}.call(at,te,at,Mt))&&(Mt.exports=D)}()},3105:Mt=>{"use strict";var D,at="object"==typeof Reflect?Reflect:null,te=at&&"function"==typeof at.apply?at.apply:function(Me,Ge,Lt){return Function.prototype.apply.call(Me,Ge,Lt)};D=at&&"function"==typeof at.ownKeys?at.ownKeys:Object.getOwnPropertySymbols?function(Me){return Object.getOwnPropertyNames(Me).concat(Object.getOwnPropertySymbols(Me))}:function(Me){return Object.getOwnPropertyNames(Me)};var R=Number.isNaN||function(Me){return Me!=Me};function u(){u.init.call(this)}Mt.exports=u,Mt.exports.once=function(Je,Me){return new Promise(function(Ge,Lt){function Ht(gn){Je.removeListener(Me,zn),Lt(gn)}function zn(){"function"==typeof Je.removeListener&&Je.removeListener("error",Ht),Ge([].slice.call(arguments))}Ot(Je,Me,zn,{once:!0}),"error"!==Me&&function(Je,Me,Ge){"function"==typeof Je.on&&Ot(Je,"error",Me,{once:!0})}(Je,Ht)})},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var ge=10;function Se(Je){if("function"!=typeof Je)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Je)}function Ce(Je){return void 0===Je._maxListeners?u.defaultMaxListeners:Je._maxListeners}function ce(Je,Me,Ge,Lt){var Ht,zn,gn;if(Se(Ge),void 0===(zn=Je._events)?(zn=Je._events=Object.create(null),Je._eventsCount=0):(void 0!==zn.newListener&&(Je.emit("newListener",Me,Ge.listener?Ge.listener:Ge),zn=Je._events),gn=zn[Me]),void 0===gn)gn=zn[Me]=Ge,++Je._eventsCount;else if("function"==typeof gn?gn=zn[Me]=Lt?[Ge,gn]:[gn,Ge]:Lt?gn.unshift(Ge):gn.push(Ge),(Ht=Ce(Je))>0&&gn.length>Ht&&!gn.warned){gn.warned=!0;var Xt=new Error("Possible EventEmitter memory leak detected. "+gn.length+" "+String(Me)+" listeners added. Use emitter.setMaxListeners() to increase limit");Xt.name="MaxListenersExceededWarning",Xt.emitter=Je,Xt.type=Me,Xt.count=gn.length,function(Je){console&&console.warn&&console.warn(Je)}(Xt)}return Je}function ae(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ve(Je,Me,Ge){var Lt={fired:!1,wrapFn:void 0,target:Je,type:Me,listener:Ge},Ht=ae.bind(Lt);return Ht.listener=Ge,Lt.wrapFn=Ht,Ht}function Ue(Je,Me,Ge){var Lt=Je._events;if(void 0===Lt)return[];var Ht=Lt[Me];return void 0===Ht?[]:"function"==typeof Ht?Ge?[Ht.listener||Ht]:[Ht]:Ge?function(Je){for(var Me=new Array(Je.length),Ge=0;Ge<Me.length;++Ge)Me[Ge]=Je[Ge].listener||Je[Ge];return Me}(Ht):we(Ht,Ht.length)}function Be(Je){var Me=this._events;if(void 0!==Me){var Ge=Me[Je];if("function"==typeof Ge)return 1;if(void 0!==Ge)return Ge.length}return 0}function we(Je,Me){for(var Ge=new Array(Me),Lt=0;Lt<Me;++Lt)Ge[Lt]=Je[Lt];return Ge}function Ot(Je,Me,Ge,Lt){if("function"==typeof Je.on)Lt.once?Je.once(Me,Ge):Je.on(Me,Ge);else{if("function"!=typeof Je.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Je);Je.addEventListener(Me,function Ht(zn){Lt.once&&Je.removeEventListener(Me,Ht),Ge(zn)})}}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return ge},set:function(Je){if("number"!=typeof Je||Je<0||R(Je))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Je+".");ge=Je}}),u.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function(Me){if("number"!=typeof Me||Me<0||R(Me))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Me+".");return this._maxListeners=Me,this},u.prototype.getMaxListeners=function(){return Ce(this)},u.prototype.emit=function(Me){for(var Ge=[],Lt=1;Lt<arguments.length;Lt++)Ge.push(arguments[Lt]);var Ht="error"===Me,zn=this._events;if(void 0!==zn)Ht=Ht&&void 0===zn.error;else if(!Ht)return!1;if(Ht){var gn;if(Ge.length>0&&(gn=Ge[0]),gn instanceof Error)throw gn;var Xt=new Error("Unhandled error."+(gn?" ("+gn.message+")":""));throw Xt.context=gn,Xt}var In=zn[Me];if(void 0===In)return!1;if("function"==typeof In)te(In,this,Ge);else{var Gn=In.length,ct=we(In,Gn);for(Lt=0;Lt<Gn;++Lt)te(ct[Lt],this,Ge)}return!0},u.prototype.on=u.prototype.addListener=function(Me,Ge){return ce(this,Me,Ge,!1)},u.prototype.prependListener=function(Me,Ge){return ce(this,Me,Ge,!0)},u.prototype.once=function(Me,Ge){return Se(Ge),this.on(Me,ve(this,Me,Ge)),this},u.prototype.prependOnceListener=function(Me,Ge){return Se(Ge),this.prependListener(Me,ve(this,Me,Ge)),this},u.prototype.off=u.prototype.removeListener=function(Me,Ge){var Lt,Ht,zn,gn,Xt;if(Se(Ge),void 0===(Ht=this._events))return this;if(void 0===(Lt=Ht[Me]))return this;if(Lt===Ge||Lt.listener===Ge)0==--this._eventsCount?this._events=Object.create(null):(delete Ht[Me],Ht.removeListener&&this.emit("removeListener",Me,Lt.listener||Ge));else if("function"!=typeof Lt){for(zn=-1,gn=Lt.length-1;gn>=0;gn--)if(Lt[gn]===Ge||Lt[gn].listener===Ge){Xt=Lt[gn].listener,zn=gn;break}if(zn<0)return this;0===zn?Lt.shift():function(Je,Me){for(;Me+1<Je.length;Me++)Je[Me]=Je[Me+1];Je.pop()}(Lt,zn),1===Lt.length&&(Ht[Me]=Lt[0]),void 0!==Ht.removeListener&&this.emit("removeListener",Me,Xt||Ge)}return this},u.prototype.removeAllListeners=function(Me){var Ge,Lt,Ht;if(void 0===(Lt=this._events))return this;if(void 0===Lt.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==Lt[Me]&&(0==--this._eventsCount?this._events=Object.create(null):delete Lt[Me]),this;if(0===arguments.length){var gn,zn=Object.keys(Lt);for(Ht=0;Ht<zn.length;++Ht)"removeListener"!==(gn=zn[Ht])&&this.removeAllListeners(gn);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(Ge=Lt[Me]))this.removeListener(Me,Ge);else if(void 0!==Ge)for(Ht=Ge.length-1;Ht>=0;Ht--)this.removeListener(Me,Ge[Ht]);return this},u.prototype.listeners=function(Me){return Ue(this,Me,!0)},u.prototype.rawListeners=function(Me){return Ue(this,Me,!1)},u.listenerCount=function(Je,Me){return"function"==typeof Je.listenerCount?Je.listenerCount(Me):Be.call(Je,Me)},u.prototype.listenerCount=Be,u.prototype.eventNames=function(){return this._eventsCount>0?D(this._events):[]}},6499:Mt=>{var te;Mt.exports=te={},te.simpleFilter=function(D,A){return A.filter(function(R){return te.test(D,R)})},te.test=function(D,A){return null!==te.match(D,A)},te.match=function(D,A,R){var Be,u=0,ge=[],Se=A.length,Ce=0,ce=0,ae=(R=R||{}).pre||"",ve=R.post||"",Ue=R.caseSensitive&&A||A.toLowerCase();D=R.caseSensitive&&D||D.toLowerCase();for(var we=0;we<Se;we++)Be=A[we],Ue[we]===D[u]?(Be=ae+Be+ve,u+=1,ce+=1+ce):ce=0,Ce+=ce,ge[ge.length]=Be;return u===D.length?(Ce=Ue===D?1/0:Ce,{rendered:ge.join(""),score:Ce}):null},te.filter=function(D,A,R){return A&&0!==A.length?"string"!=typeof D?A:(R=R||{},A.reduce(function(u,ge,Se,Ce){var ce=ge;R.extract&&(ce=R.extract(ge));var ae=te.match(D,ce,R);return null!=ae&&(u[u.length]={string:ae.rendered,score:ae.score,index:Se,original:ge}),u},[]).sort(function(u,ge){return ge.score-u.score||u.index-ge.index})):[]}},4966:Mt=>{try{Mt.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(at){Mt.exports=!1}},4536:Mt=>{"use strict";var at=Object.prototype.toString;Mt.exports=function(te){var D;return"[object Object]"===at.call(te)&&(null===(D=Object.getPrototypeOf(te))||D===Object.getPrototypeOf({}))}},6906:Mt=>{var A=/^\s+|\s+$/g,R=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,ge=/^0o[0-7]+$/i,Se=parseInt,Ce="object"==typeof global&&global&&global.Object===Object&&global,ce="object"==typeof self&&self&&self.Object===Object&&self,ae=Ce||ce||Function("return this")(),Ue=Object.prototype.toString,Be=Math.max,we=Math.min,Oe=function(){return ae.Date.now()};function ke(Me){var Ge=typeof Me;return!!Me&&("object"==Ge||"function"==Ge)}function Je(Me){if("number"==typeof Me)return Me;if(function(Me){return"symbol"==typeof Me||function(Me){return!!Me&&"object"==typeof Me}(Me)&&"[object Symbol]"==Ue.call(Me)}(Me))return NaN;if(ke(Me)){var Ge="function"==typeof Me.valueOf?Me.valueOf():Me;Me=ke(Ge)?Ge+"":Ge}if("string"!=typeof Me)return 0===Me?Me:+Me;Me=Me.replace(A,"");var Lt=u.test(Me);return Lt||ge.test(Me)?Se(Me.slice(2),Lt?2:8):R.test(Me)?NaN:+Me}Mt.exports=function(Me,Ge,Lt){var Ht,zn,gn,Xt,In,Gn,ct=0,tt=!1,mt=!1,gt=!0;if("function"!=typeof Me)throw new TypeError("Expected a function");function tn(zt){var ln=Ht,Rn=zn;return Ht=zn=void 0,ct=zt,Xt=Me.apply(Rn,ln)}function an(zt){return ct=zt,In=setTimeout(Or,Ge),tt?tn(zt):Xt}function Pn(zt){var ln=zt-Gn;return void 0===Gn||ln>=Ge||ln<0||mt&&zt-ct>=gn}function Or(){var zt=Oe();if(Pn(zt))return Jr(zt);In=setTimeout(Or,function(zt){var ir=Ge-(zt-Gn);return mt?we(ir,gn-(zt-ct)):ir}(zt))}function Jr(zt){return In=void 0,gt&&Ht?tn(zt):(Ht=zn=void 0,Xt)}function Ve(){var zt=Oe(),ln=Pn(zt);if(Ht=arguments,zn=this,Gn=zt,ln){if(void 0===In)return an(Gn);if(mt)return In=setTimeout(Or,Ge),tn(Gn)}return void 0===In&&(In=setTimeout(Or,Ge)),Xt}return Ge=Je(Ge)||0,ke(Lt)&&(tt=!!Lt.leading,gn=(mt="maxWait"in Lt)?Be(Je(Lt.maxWait)||0,Ge):gn,gt="trailing"in Lt?!!Lt.trailing:gt),Ve.cancel=function(){void 0!==In&&clearTimeout(In),ct=0,Ht=Gn=zn=In=void 0},Ve.flush=function(){return void 0===In?Xt:Jr(Oe())},Ve}},2958:function(Mt){Mt.exports=function(){"use strict";var at,te,D;function A(u,ge){if(at)if(te){var Se="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/api/#transpiling-v2'); }; var sharedChunk = {}; ("+at+")(sharedChunk); ("+te+")(sharedChunk); self.onerror = null;",Ce={};at(Ce),D=ge(Ce),"undefined"!=typeof window&&(D.workerUrl=window.URL.createObjectURL(new Blob([Se],{type:"text/javascript"})))}else te=ge;else at=ge}return A(0,function(u){var Se=Ce;function Ce(s,e,o,l){this.cx=3*s,this.bx=3*(o-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=l,this.p2x=o,this.p2y=l}Ce.prototype.sampleCurveX=function(s){return((this.ax*s+this.bx)*s+this.cx)*s},Ce.prototype.sampleCurveY=function(s){return((this.ay*s+this.by)*s+this.cy)*s},Ce.prototype.sampleCurveDerivativeX=function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},Ce.prototype.solveCurveX=function(s,e){var o,l,d,m,_;for(void 0===e&&(e=1e-6),d=s,_=0;_<8;_++){if(m=this.sampleCurveX(d)-s,Math.abs(m)<e)return d;var E=this.sampleCurveDerivativeX(d);if(Math.abs(E)<1e-6)break;d-=m/E}if((d=s)<(o=0))return o;if(d>(l=1))return l;for(;o<l;){if(m=this.sampleCurveX(d),Math.abs(m-s)<e)return d;s>m?o=d:l=d,d=.5*(l-o)+o}return d},Ce.prototype.solve=function(s,e){return this.sampleCurveY(this.solveCurveX(s,e))};var ce=ae;function ae(s,e){this.x=s,this.y=e}ae.prototype={clone:function(){return new ae(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,e){return this.clone()._rotateAround(s,e)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var e=s.x-this.x,o=s.y-this.y;return e*e+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult:function(s){var e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var e=Math.cos(s),o=Math.sin(s),l=o*this.x+e*this.y;return this.x=e*this.x-o*this.y,this.y=l,this},_rotateAround:function(s,e){var o=Math.cos(s),l=Math.sin(s),d=e.y+l*(this.x-e.x)+o*(this.y-e.y);return this.x=e.x+o*(this.x-e.x)-l*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ae.convert=function(s){return s instanceof ae?s:Array.isArray(s)?new ae(s[0],s[1]):s};var ve="undefined"!=typeof self?self:{};const Ue=Math.pow(2,53)-1,Be=Math.PI/180,we=180/Math.PI;function Oe(s){return s*Be}const Ne=[[0,0],[1,0],[1,1],[0,1]];function ke(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,o=e*s;return 4*(s<.5?o:3*(s-e)+o-.75)}function lt(s,e,o,l){const d=new Se(s,e,o,l);return function(m){return d.solve(m)}}const Ot=lt(.25,.1,.25,1);function Je(s,e,o){return Math.min(o,Math.max(e,s))}function Me(s,e,o){const l=o-e,d=((s-e)%l+l)%l+e;return d===e?o:d}function Ge(s,e,o){if(!s.length)return o(null,[]);let l=s.length;const d=new Array(s.length);let m=null;s.forEach((_,E)=>{e(_,(T,O)=>{T&&(m=T),d[E]=O,0==--l&&o(m,d)})})}function Lt(s){const e=[];for(const o in s)e.push(s[o]);return e}function Ht(s,...e){for(const o of e)for(const l in o)s[l]=o[l];return s}let zn=1;function gn(){return zn++}function Xt(){return function s(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function In(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Gn(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function ct(s,e){s.forEach(o=>{e[o]&&(e[o]=e[o].bind(e))})}function tt(s,e){return-1!==s.indexOf(e,s.length-e.length)}function mt(s,e,o){const l={};for(const d in s)l[d]=e.call(o||this,s[d],d,s);return l}function gt(s,e,o){const l={};for(const d in s)e.call(o||this,s[d],d,s)&&(l[d]=s[d]);return l}function tn(s){return Array.isArray(s)?s.map(tn):"object"==typeof s&&s?mt(s,tn):s}const an={};function bn(s){an[s]||("undefined"!=typeof console&&console.warn(s),an[s]=!0)}function Pn(s,e,o){return(o.y-s.y)*(e.x-s.x)>(e.y-s.y)*(o.x-s.x)}function Or(s){let e=0;for(let o,l,d=0,m=s.length,_=m-1;d<m;_=d++)o=s[d],l=s[_],e+=(l.x-o.x)*(o.y+l.y);return e}function Jr(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function qt(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,l,d,m)=>{const _=d||m;return e[l]=!_||_.toLowerCase(),""}),e["max-age"]){const o=parseInt(e["max-age"],10);isNaN(o)?delete e["max-age"]:e["max-age"]=o}return e}let kn,Ve,zt,ln=null;function Rn(s){if(null==ln){const e=s.navigator?s.navigator.userAgent:null;ln=!!s.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ln}function ir(s){try{const e=ve[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const Vn={now:()=>void 0!==zt?zt:ve.performance.now(),setNow(s){zt=s},restoreNow(){zt=void 0},frame(s){const e=ve.requestAnimationFrame(s);return{cancel:()=>ve.cancelAnimationFrame(e)}},getImageData(s,e=0){const o=ve.document.createElement("canvas"),l=o.getContext("2d");if(!l)throw new Error("failed to create canvas 2d context");return o.width=s.width,o.height=s.height,l.drawImage(s,0,0,s.width,s.height),l.getImageData(-e,-e,s.width+2*e,s.height+2*e)},resolveURL:s=>(kn||(kn=ve.document.createElement("a")),kn.href=s,kn.href),get devicePixelRatio(){return ve.devicePixelRatio},get prefersReducedMotion(){return!!ve.matchMedia&&(null==Ve&&(Ve=ve.matchMedia("(prefers-reduced-motion: reduce)")),Ve.matches)}};let ri;const Zn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ri){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ri=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch(e){ri=s}}return ri},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},xi={supported:!1,testSupport:function(s){!zr&&Vi&&($r?as(s):yr=s)}};let yr,Vi,zr=!1,$r=!1;function as(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Vi),s.isContextLost())return;xi.supported=!0}catch(o){}s.deleteTexture(e),zr=!0}ve.document&&(Vi=ve.document.createElement("img"),Vi.onload=function(){yr&&as(yr),yr=null,$r=!0},Vi.onerror=function(){zr=!0,yr=null},Vi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const di="01",ls="NO_ACCESS_TOKEN";function Ui(s){return 0===s.indexOf("mapbox:")}function Tt(s){return Zn.API_URL_REGEX.test(s)}const rt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function nt(s){const e=s.match(rt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Wt(s){const e=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${e}`}function _t(s){if(!s)return null;const e=s.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(ve.atob(e[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(o){return null}}class hn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const o=_t(Zn.ACCESS_TOKEN);let l="";return l=o&&o.u?ve.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(d,m)=>String.fromCharCode(Number("0x"+m)))):Zn.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const e=ir("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const d=ve.localStorage.getItem(o);d&&(this.eventData=JSON.parse(d));const m=ve.localStorage.getItem(l);m&&(this.anonId=m)}catch(d){bn("Unable to read from LocalStorage")}}saveEventData(){const e=ir("localStorage"),o=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{ve.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&ve.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(d){bn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,o,l,d){if(!Zn.EVENTS_URL)return;const m=nt(Zn.EVENTS_URL);m.params.push(`access_token=${d||Zn.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.5.1",skuId:di,userId:this.anonId},E=o?Ht(_,o):_,T={url:Wt(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([E])};this.pendingRequest=N(T,O=>{this.pendingRequest=null,l(O),this.saveEventData(),this.processRequests(d)})}queueRequest(e,o){this.queue.push(e),this.processRequests(o)}}const mn=new class extends hn{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,e){Zn.EVENTS_URL&&Zn.ACCESS_TOKEN&&Array.isArray(s)&&s.some(o=>Ui(o)||Tt(o))&&this.queueRequest(Date.now(),e)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=_t(Zn.ACCESS_TOKEN),o=e?e.u:Zn.ACCESS_TOKEN;let l=o!==this.eventData.tokenU;Gn(this.anonId)||(this.anonId=Xt(),l=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(d),E=(d-this.eventData.lastSuccess)/864e5;l=l||E>=1||E<-1||m.getDate()!==_.getDate()}else l=!0;if(!l)return this.processRequests();this.postEvent(d,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=o)},s)}},_n=mn.postTurnstileEvent.bind(mn),xn=new class extends hn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,e,o,l){this.skuToken=e,this.errorCb=l,Zn.EVENTS_URL&&(o||Zn.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},o):this.errorCb(new Error(ls)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Gn(this.anonId)||(this.anonId=Xt()),this.postEvent(o,{skuToken:this.skuToken},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},s))}},jr=xn.postMapLoadEvent.bind(xn),Fr=new class extends hn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,e,o,l){if(!Zn.API_URL||!Zn.SESSION_PATH)return;const d=nt(Zn.API_URL+Zn.SESSION_PATH);d.params.push(`sku=${e||""}`),d.params.push(`access_token=${l||Zn.ACCESS_TOKEN||""}`);const m={url:Wt(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=H(m,_=>{this.pendingRequest=null,o(_),this.saveEventData(),this.processRequests(l)})}getSessionAPI(s,e,o,l){this.skuToken=e,this.errorCb=l,Zn.SESSION_PATH&&Zn.API_URL&&(o||Zn.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},o):this.errorCb(new Error(ls)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:o}=this.queue.shift();e&&this.success[e]||this.getSession(o,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},s)}},ii=Fr.getSessionAPI.bind(Fr),Wr=new Set,jn="mapbox-tiles";let wn,mi,ar=500,Yr=50;function Gr(){ve.caches&&!wn&&(wn=ve.caches.open(jn))}function vr(s){const e=s.indexOf("?");return e<0?s:s.slice(0,e)}let cs=1/0;const ro={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ro);class qi extends Error{constructor(e,o,l){401===o&&Tt(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=o,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const lr=Jr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ve.location.protocol?ve.parent:ve).location.href,K=function(s,e){if(!(/^file:/.test(o=s.url)||/^file:/.test(lr())&&!/^\w+:/.test(o))){if(ve.fetch&&ve.Request&&ve.AbortController&&ve.Request.prototype.hasOwnProperty("signal"))return function(l,d){const m=new ve.AbortController,_=new ve.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:lr(),signal:m.signal});let E=!1,T=!1;const O=(U=_.url).indexOf("sku=")>0&&Tt(U);var U;"json"===l.type&&_.headers.set("Accept","application/json");const W=(ie,ye,Ee)=>{if(T)return;if(ie&&"SecurityError"!==ie.message&&bn(ie),ye&&Ee)return Y(ye);const Le=Date.now();ve.fetch(_).then(Ke=>{if(Ke.ok){const ot=O?Ke.clone():null;return Y(Ke,ot,Le)}return d(new qi(Ke.statusText,Ke.status,l.url))}).catch(Ke=>{20!==Ke.code&&d(new Error(Ke.message))})},Y=(ie,ye,Ee)=>{("arrayBuffer"===l.type?ie.arrayBuffer():"json"===l.type?ie.json():ie.text()).then(Le=>{T||(ye&&Ee&&function(Ke,ot,xt){if(Gr(),!wn)return;const ut={status:ot.status,statusText:ot.statusText,headers:new ve.Headers};ot.headers.forEach((Et,kt)=>ut.headers.set(kt,Et));const bt=qt(ot.headers.get("Cache-Control")||"");bt["no-store"]||(bt["max-age"]&&ut.headers.set("Expires",new Date(xt+1e3*bt["max-age"]).toUTCString()),new Date(ut.headers.get("Expires")).getTime()-xt<42e4||function(Et,kt){if(void 0===mi)try{new Response(new ReadableStream),mi=!0}catch(Kt){mi=!1}mi?kt(Et.body):Et.blob().then(kt)}(ot,Et=>{const kt=new ve.Response(Et,ut);Gr(),wn&&wn.then(Kt=>Kt.put(vr(Ke.url),kt)).catch(Kt=>bn(Kt.message))}))}(_,ye,Ee),E=!0,d(null,Le,ie.headers.get("Cache-Control"),ie.headers.get("Expires")))}).catch(Le=>{T||d(new Error(Le.message))})};return O?function(ie,ye){if(Gr(),!wn)return ye(null);const Ee=vr(ie.url);wn.then(Le=>{Le.match(Ee).then(Ke=>{const ot=function(xt){if(!xt)return!1;const ut=new Date(xt.headers.get("Expires")||0),bt=qt(xt.headers.get("Cache-Control")||"");return ut>Date.now()&&!bt["no-cache"]}(Ke);Le.delete(Ee),ot&&Le.put(Ee,Ke.clone()),ye(null,Ke,ot)}).catch(ye)}).catch(ye)}(_,W):W(null,null),{cancel:()=>{T=!0,E||m.abort()}}}(s,e);if(Jr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var o;return function(l,d){const m=new ve.XMLHttpRequest;m.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===l.credentials,m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===l.type)try{_=JSON.parse(m.response)}catch(E){return d(E)}d(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else d(new qi(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}}(s,e)},k=function(s,e){return K(Ht(s,{type:"arrayBuffer"}),e)},N=function(s,e){return K(Ht(s,{method:"POST"}),e)},H=function(s,e){return K(Ht(s,{method:"GET"}),e)};function de(s){const e=ve.document.createElement("a");return e.href=s,e.protocol===ve.document.location.protocol&&e.host===ve.document.location.host}const Pe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Qe,st;Qe=[],st=0;const Ze=function(s,e){if(xi.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),st>=Zn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Qe.push(m),m}st++;let o=!1;const l=()=>{if(!o)for(o=!0,st--;Qe.length&&st<Zn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=Qe.shift(),{requestParameters:_,callback:E,cancelled:T}=m;T||(m.cancel=Ze(_,E).cancel)}},d=k(s,(m,_,E,T)=>{l(),m?e(m):_&&(ve.createImageBitmap?function(O,U){const W=new ve.Blob([new Uint8Array(O)],{type:"image/png"});ve.createImageBitmap(W).then(Y=>{U(null,Y)}).catch(Y=>{U(new Error(`Could not load image because of ${Y.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(O,U)=>e(O,U,E,T)):function(O,U){const W=new ve.Image,Y=ve.URL;W.onload=()=>{U(null,W),Y.revokeObjectURL(W.src),W.onload=null,ve.requestAnimationFrame(()=>{W.src=Pe})},W.onerror=()=>U(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const ie=new ve.Blob([new Uint8Array(O)],{type:"image/png"});W.src=O.byteLength?Y.createObjectURL(ie):Pe}(_,(O,U)=>e(O,U,E,T)))});return{cancel:()=>{d.cancel(),l()}}};function ft(s,e,o){o[s]&&-1!==o[s].indexOf(e)||(o[s]=o[s]||[],o[s].push(e))}function St(s,e,o){if(o&&o[s]){const l=o[s].indexOf(e);-1!==l&&o[s].splice(l,1)}}class Gt{constructor(e,o={}){Ht(this,o),this.type=e}}class Pt extends Gt{constructor(e,o={}){super("error",Ht({error:e},o))}}class sn{on(e,o){return this._listeners=this._listeners||{},ft(e,o,this._listeners),this}off(e,o){return St(e,o,this._listeners),St(e,o,this._oneTimeListeners),this}once(e,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},ft(e,o,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,o){"string"==typeof e&&(e=new Gt(e,o||{}));const l=e.type;if(this.listens(l)){e.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const E of d)E.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const E of m)St(l,E,this._oneTimeListeners),E.call(this,e);const _=this._eventedParent;_&&(Ht(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Pt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,o){return this._eventedParent=e,this._eventedParentData=o,this}}var He={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Ct{constructor(e,o,l,d){this.message=(e?`${e}: `:"")+l,d&&(this.identifier=d),null!=o&&o.__line__&&(this.line=o.__line__)}}function Bn(s){const e=s.value;return e?[new Ct(s.key,e,"constants have been deprecated as of v8")]:[]}function Hn(s,...e){for(const o of e)for(const l in o)s[l]=o[l];return s}function An(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function sr(s){if(Array.isArray(s))return s.map(sr);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const o in s)e[o]=sr(s[o]);return e}return An(s)}class Yn extends Error{constructor(e,o){super(o),this.message=o,this.key=e}}class tr{constructor(e,o=[]){this.parent=e,this.bindings={};for(const[l,d]of o)this.bindings[l]=d}concat(e){return new tr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Wi={kind:"null"},en={kind:"number"},Bt={kind:"string"},cn={kind:"boolean"},Tn={kind:"color"},mr={kind:"object"},On={kind:"value"},Zr={kind:"collator"},zs={kind:"formatted"},Br={kind:"resolvedImage"};function Ci(s,e){return{kind:"array",itemType:s,N:e}}function xr(s){if("array"===s.kind){const e=xr(s.itemType);return"number"==typeof s.N?`array<${e}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${e}>`}return s.kind}const Xn=[Wi,en,Bt,cn,Tn,zs,mr,Ci(On),Br];function us(s,e){if("error"===e.kind)return null;if("array"===s.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!us(s.itemType,e.itemType))&&("number"!=typeof s.N||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if("value"===s.kind)for(const o of Xn)if(!us(o,e))return null}return`Expected ${xr(s)} but found ${xr(e)} instead.`}function Is(s,e){return e.some(o=>o.kind===s.kind)}function ws(s,e){return e.some(o=>"null"===o?null===s:"array"===o?Array.isArray(s):"object"===o?s&&!Array.isArray(s)&&"object"==typeof s:o===typeof s)}function Ti(s){var e={exports:{}};return s(e,e.exports),e.exports}var Si=Ti(function(s,e){var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(E){return(E=Math.round(E))<0?0:E>255?255:E}function d(E){return l("%"===E[E.length-1]?parseFloat(E)/100*255:parseInt(E))}function m(E){return(T="%"===E[E.length-1]?parseFloat(E)/100:parseFloat(E))<0?0:T>1?1:T;var T}function _(E,T,O){return O<0?O+=1:O>1&&(O-=1),6*O<1?E+(T-E)*O*6:2*O<1?T:3*O<2?E+(T-E)*(2/3-O)*6:E}try{e.parseCSSColor=function(E){var T,O=E.replace(/ /g,"").toLowerCase();if(O in o)return o[O].slice();if("#"===O[0])return 4===O.length?(T=parseInt(O.substr(1),16))>=0&&T<=4095?[(3840&T)>>4|(3840&T)>>8,240&T|(240&T)>>4,15&T|(15&T)<<4,1]:null:7===O.length&&(T=parseInt(O.substr(1),16))>=0&&T<=16777215?[(16711680&T)>>16,(65280&T)>>8,255&T,1]:null;var U=O.indexOf("("),W=O.indexOf(")");if(-1!==U&&W+1===O.length){var Y=O.substr(0,U),ie=O.substr(U+1,W-(U+1)).split(","),ye=1;switch(Y){case"rgba":if(4!==ie.length)return null;ye=m(ie.pop());case"rgb":return 3!==ie.length?null:[d(ie[0]),d(ie[1]),d(ie[2]),ye];case"hsla":if(4!==ie.length)return null;ye=m(ie.pop());case"hsl":if(3!==ie.length)return null;var Ee=(parseFloat(ie[0])%360+360)%360/360,Le=m(ie[1]),Ke=m(ie[2]),ot=Ke<=.5?Ke*(Le+1):Ke+Le-Ke*Le,xt=2*Ke-ot;return[l(255*_(xt,ot,Ee+1/3)),l(255*_(xt,ot,Ee)),l(255*_(xt,ot,Ee-1/3)),ye];default:return null}}return null}}catch(E){}});class $n{constructor(e,o,l,d=1){this.r=e,this.g=o,this.b=l,this.a=d}static parse(e){if(!e)return;if(e instanceof $n)return e;if("string"!=typeof e)return;const o=Si.parseCSSColor(e);return o?new $n(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[e,o,l,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(o)},${Math.round(l)},${d})`}toArray(){const{r:e,g:o,b:l,a:d}=this;return 0===d?[0,0,0,0]:[255*e/d,255*o/d,255*l/d,d]}}$n.black=new $n(0,0,0,1),$n.white=new $n(1,1,1,1),$n.transparent=new $n(0,0,0,0),$n.red=new $n(1,0,0,1),$n.blue=new $n(0,0,1,1);class Ps{constructor(e,o,l){this.sensitivity=e?o?"variant":"case":o?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,o){return this.collator.compare(e,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ji{constructor(e,o,l,d,m){this.text=e,this.image=o,this.scale=l,this.fontStack=d,this.textColor=m}}class ur{constructor(e){this.sections=e}static fromString(e){return new ur([new ji(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof ur?e:ur.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const o of this.sections){if(o.image){e.push(["image",o.image.name]);continue}e.push(o.text);const l={};o.fontStack&&(l["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(l["font-scale"]=o.scale),o.textColor&&(l["text-color"]=["rgba"].concat(o.textColor.toArray())),e.push(l)}return e}}class hs{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new hs({name:e,available:!1}):null}serialize(){return["image",this.name]}}function $l(s,e,o,l){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof o&&o>=0&&o<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[s,e,o,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[s,e,o,l]:[s,e,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Es(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof $n||s instanceof Ps||s instanceof ur||s instanceof hs)return!0;if(Array.isArray(s)){for(const e of s)if(!Es(e))return!1;return!0}if("object"==typeof s){for(const e in s)if(!Es(s[e]))return!1;return!0}return!1}function si(s){if(null===s)return Wi;if("string"==typeof s)return Bt;if("boolean"==typeof s)return cn;if("number"==typeof s)return en;if(s instanceof $n)return Tn;if(s instanceof Ps)return Zr;if(s instanceof ur)return zs;if(s instanceof hs)return Br;if(Array.isArray(s)){const e=s.length;let o;for(const l of s){const d=si(l);if(o){if(o===d)continue;o=On;break}o=d}return Ci(o||On,e)}return mr}function Oi(s){const e=typeof s;return null===s?"":"string"===e||"number"===e||"boolean"===e?String(s):s instanceof $n||s instanceof ur||s instanceof hs?s.toString():JSON.stringify(s)}class Yi{constructor(e,o){this.type=e,this.value=o}static parse(e,o){if(2!==e.length)return o.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Es(e[1]))return o.error("invalid value");const l=e[1];let d=si(l);const m=o.expectedType;return"array"!==d.kind||0!==d.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(d=m),new Yi(d,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof $n?["rgba"].concat(this.value.toArray()):this.value instanceof ur?this.value.serialize():this.value}}class ei{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ar={string:Bt,number:en,boolean:cn,object:mr};class es{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");let l,d=1;const m=e[0];if("array"===m){let E,T;if(e.length>2){const O=e[1];if("string"!=typeof O||!(O in Ar)||"object"===O)return o.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ar[O],d++}else E=On;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return o.error('The length argument to "array" must be a positive integer literal',2);T=e[2],d++}l=Ci(E,T)}else l=Ar[m];const _=[];for(;d<e.length;d++){const E=o.parse(e[d],d,On);if(!E)return null;_.push(E)}return new es(l,_)}evaluate(e){for(let o=0;o<this.args.length;o++){const l=this.args[o].evaluate(e);if(!us(this.type,si(l)))return l;if(o===this.args.length-1)throw new ei(`Expected value to be of type ${xr(this.type)}, but found ${xr(si(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,o=[e.kind];if("array"===e.kind){const l=e.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){o.push(l.kind);const d=e.N;("number"==typeof d||this.args.length>1)&&o.push(d)}}return o.concat(this.args.map(l=>l.serialize()))}}class Hr{constructor(e){this.type=zs,this.sections=e}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&"object"==typeof l)return o.error("First argument must be an image or text section.");const d=[];let m=!1;for(let _=1;_<=e.length-1;++_){const E=e[_];if(m&&"object"==typeof E&&!Array.isArray(E)){m=!1;let T=null;if(E["font-scale"]&&(T=o.parse(E["font-scale"],1,en),!T))return null;let O=null;if(E["text-font"]&&(O=o.parse(E["text-font"],1,Ci(Bt)),!O))return null;let U=null;if(E["text-color"]&&(U=o.parse(E["text-color"],1,Tn),!U))return null;const W=d[d.length-1];W.scale=T,W.font=O,W.textColor=U}else{const T=o.parse(e[_],1,On);if(!T)return null;const O=T.type.kind;if("string"!==O&&"value"!==O&&"null"!==O&&"resolvedImage"!==O)return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:T,scale:null,font:null,textColor:null})}}return new Hr(d)}evaluate(e){return new ur(this.sections.map(o=>{const l=o.content.evaluate(e);return si(l)===Br?new ji("",l,null,null,null):new ji(Oi(l),null,o.scale?o.scale.evaluate(e):null,o.font?o.font.evaluate(e).join(","):null,o.textColor?o.textColor.evaluate(e):null)}))}eachChild(e){for(const o of this.sections)e(o.content),o.scale&&e(o.scale),o.font&&e(o.font),o.textColor&&e(o.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const o of this.sections){e.push(o.content.serialize());const l={};o.scale&&(l["font-scale"]=o.scale.serialize()),o.font&&(l["text-font"]=o.font.serialize()),o.textColor&&(l["text-color"]=o.textColor.serialize()),e.push(l)}return e}}class Fi{constructor(e){this.type=Br,this.input=e}static parse(e,o){if(2!==e.length)return o.error("Expected two arguments.");const l=o.parse(e[1],1,Bt);return l?new Fi(l):o.error("No image name provided.")}evaluate(e){const o=this.input.evaluate(e),l=hs.fromString(o);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(o)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ki={"to-boolean":cn,"to-color":Tn,"to-number":en,"to-string":Bt};class Li{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expected at least one argument.");const l=e[0];if(("to-boolean"===l||"to-string"===l)&&2!==e.length)return o.error("Expected one argument.");const d=Ki[l],m=[];for(let _=1;_<e.length;_++){const E=o.parse(e[_],_,On);if(!E)return null;m.push(E)}return new Li(d,m)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let o,l;for(const d of this.args){if(o=d.evaluate(e),l=null,o instanceof $n)return o;if("string"==typeof o){const m=e.parseColor(o);if(m)return m}else if(Array.isArray(o)&&(l=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:$l(o[0],o[1],o[2],o[3]),!l))return new $n(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new ei(l||`Could not parse color from value '${"string"==typeof o?o:String(JSON.stringify(o))}'`)}if("number"===this.type.kind){let o=null;for(const l of this.args){if(o=l.evaluate(e),null===o)return 0;const d=Number(o);if(!isNaN(d))return d}throw new ei(`Could not convert ${JSON.stringify(o)} to number.`)}return"formatted"===this.type.kind?ur.fromString(Oi(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?hs.fromString(Oi(this.args[0].evaluate(e))):Oi(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Hr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Fi(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(o=>{e.push(o.serialize())}),e}}const Hs=["Unknown","Point","LineString","Polygon"];class qr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Hs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let o=this._parseColorCache[e];return o||(o=this._parseColorCache[e]=$n.parse(e)),o}}class ts{constructor(e,o,l,d){this.name=e,this.type=o,this._evaluate=l,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,o){const l=e[0],d=ts.definitions[l];if(!d)return o.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,_=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,E=_.filter(([O])=>!Array.isArray(O)||O.length===e.length-1);let T=null;for(const[O,U]of E){T=new Cs(o.registry,o.path,null,o.scope);const W=[];let Y=!1;for(let ie=1;ie<e.length;ie++){const ye=e[ie],Ee=Array.isArray(O)?O[ie-1]:O.type,Le=T.parse(ye,1+W.length,Ee);if(!Le){Y=!0;break}W.push(Le)}if(!Y)if(Array.isArray(O)&&O.length!==W.length)T.error(`Expected ${O.length} arguments, but found ${W.length} instead.`);else{for(let ie=0;ie<W.length;ie++){const ye=Array.isArray(O)?O[ie]:O.type,Ee=W[ie];T.concat(ie+1).checkSubtype(ye,Ee.type)}if(0===T.errors.length)return new ts(l,m,U,W)}}if(1===E.length)o.errors.push(...T.errors);else{const O=(E.length?E:_).map(([W])=>{return Y=W,Array.isArray(Y)?`(${Y.map(xr).join(", ")})`:`(${xr(Y.type)}...)`;var Y}).join(" | "),U=[];for(let W=1;W<e.length;W++){const Y=o.parse(e[W],1+U.length);if(!Y)return null;U.push(xr(Y.type))}o.error(`Expected arguments of type ${O}, but found (${U.join(", ")}) instead.`)}return null}static register(e,o){ts.definitions=o;for(const l in o)e[l]=ts}}class Ni{constructor(e,o,l){this.type=Zr,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=o}static parse(e,o){if(2!==e.length)return o.error("Expected one argument.");const l=e[1];if("object"!=typeof l||Array.isArray(l))return o.error("Collator options argument must be an object.");const d=o.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,cn);if(!d)return null;const m=o.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,cn);if(!m)return null;let _=null;return l.locale&&(_=o.parse(l.locale,1,Bt),!_)?null:new Ni(d,m,_)}evaluate(e){return new Ps(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const qs=8192;function Ao(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Wo(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function ua(s,e){const o=(180+s[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(o*d*qs),Math.round(l*d*qs)]}function Ka(s,e,o){const l=s[0]-e[0],d=s[1]-e[1],m=s[0]-o[0],_=s[1]-o[1];return l*_-m*d==0&&l*m<=0&&d*_<=0}function ha(s,e){let o=!1;for(let _=0,E=e.length;_<E;_++){const T=e[_];for(let O=0,U=T.length;O<U-1;O++){if(Ka(s,T[O],T[O+1]))return!1;(d=T[O])[1]>(l=s)[1]!=(m=T[O+1])[1]>l[1]&&l[0]<(m[0]-d[0])*(l[1]-d[1])/(m[1]-d[1])+d[0]&&(o=!o)}}var l,d,m;return o}function da(s,e){for(let o=0;o<e.length;o++)if(ha(s,e[o]))return!0;return!1}function ds(s,e,o,l){const d=l[0]-o[0],m=l[1]-o[1],_=(s[0]-o[0])*m-d*(s[1]-o[1]),E=(e[0]-o[0])*m-d*(e[1]-o[1]);return _>0&&E<0||_<0&&E>0}function ml(s,e,o){for(const O of o)for(let U=0;U<O.length-1;++U)if((E=[(_=O[U+1])[0]-(m=O[U])[0],_[1]-m[1]])[0]*(T=[(d=e)[0]-(l=s)[0],d[1]-l[1]])[1]-E[1]*T[0]!=0&&ds(l,d,m,_)&&ds(m,_,l,d))return!0;var l,d,m,_,E,T;return!1}function io(s,e){for(let o=0;o<s.length;++o)if(!ha(s[o],e))return!1;for(let o=0;o<s.length-1;++o)if(ml(s[o],s[o+1],e))return!1;return!0}function Xa(s,e){for(let o=0;o<e.length;o++)if(io(s,e[o]))return!0;return!1}function go(s,e,o){const l=[];for(let d=0;d<s.length;d++){const m=[];for(let _=0;_<s[d].length;_++){const E=ua(s[d][_],o);Ao(e,E),m.push(E)}l.push(m)}return l}function Xi(s,e,o){const l=[];for(let d=0;d<s.length;d++){const m=go(s[d],e,o);l.push(m)}return l}function Yo(s,e,o,l){if(s[0]<o[0]||s[0]>o[2]){const d=.5*l;let m=s[0]-o[0]>d?-l:o[0]-s[0]>d?l:0;0===m&&(m=s[0]-o[2]>d?-l:o[2]-s[0]>d?l:0),s[0]+=m}Ao(e,s)}function Mo(s,e,o,l){const d=Math.pow(2,l.z)*qs,m=[l.x*qs,l.y*qs],_=[];for(const E of s)for(const T of E){const O=[T.x+m[0],T.y+m[1]];Yo(O,e,o,d),_.push(O)}return _}function Ws(s,e,o,l){const d=Math.pow(2,l.z)*qs,m=[l.x*qs,l.y*qs],_=[];for(const T of s){const O=[];for(const U of T){const W=[U.x+m[0],U.y+m[1]];Ao(e,W),O.push(W)}_.push(O)}if(e[2]-e[0]<=d/2){(E=e)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const T of _)for(const O of T)Yo(O,e,o,d)}var E;return _}class Di{constructor(e,o){this.type=cn,this.geojson=e,this.geometries=o}static parse(e,o){if(2!==e.length)return o.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Es(e[1])){const l=e[1];if("FeatureCollection"===l.type)for(let d=0;d<l.features.length;++d){const m=l.features[d].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new Di(l,l.features[d].geometry)}else if("Feature"===l.type){const d=l.geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new Di(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new Di(l,l)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(o,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if("Polygon"===l.type){const E=go(l.coordinates,m,_),T=Mo(o.geometry(),d,m,_);if(!Wo(d,m))return!1;for(const O of T)if(!ha(O,E))return!1}if("MultiPolygon"===l.type){const E=Xi(l.coordinates,m,_),T=Mo(o.geometry(),d,m,_);if(!Wo(d,m))return!1;for(const O of T)if(!da(O,E))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(o,l){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if("Polygon"===l.type){const E=go(l.coordinates,m,_),T=Ws(o.geometry(),d,m,_);if(!Wo(d,m))return!1;for(const O of T)if(!io(O,E))return!1}if("MultiPolygon"===l.type){const E=Xi(l.coordinates,m,_),T=Ws(o.geometry(),d,m,_);if(!Wo(d,m))return!1;for(const O of T)if(!Xa(O,E))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function so(s){if(s instanceof ts&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof Di)return!1;let e=!0;return s.eachChild(o=>{e&&!so(o)&&(e=!1)}),e}function _o(s){if(s instanceof ts&&"feature-state"===s.name)return!1;let e=!0;return s.eachChild(o=>{e&&!_o(o)&&(e=!1)}),e}function Io(s,e){if(s instanceof ts&&e.indexOf(s.name)>=0)return!1;let o=!0;return s.eachChild(l=>{o&&!Io(l,e)&&(o=!1)}),o}class hr{constructor(e,o){this.type=o.type,this.name=e,this.boundExpression=o}static parse(e,o){if(2!==e.length||"string"!=typeof e[1])return o.error("'var' expression requires exactly one string literal argument.");const l=e[1];return o.scope.has(l)?new hr(l,o.scope.get(l)):o.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Cs{constructor(e,o=[],l,d=new tr,m=[]){this.registry=e,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=d,this.errors=m,this.expectedType=l}parse(e,o,l,d,m={}){return o?this.concat(o,l,d)._parse(e,m):this._parse(e,m)}_parse(e,o){function l(d,m,_){return"assert"===_?new es(m,[d]):"coerce"===_?new Li(m,[d]):d}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if("string"!=typeof d)return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let _=m.parse(e,this);if(!_)return null;if(this.expectedType){const E=this.expectedType,T=_.type;if("string"!==E.kind&&"number"!==E.kind&&"boolean"!==E.kind&&"object"!==E.kind&&"array"!==E.kind||"value"!==T.kind)if("color"!==E.kind&&"formatted"!==E.kind&&"resolvedImage"!==E.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(E,T))return null}else _=l(_,E,o.typeAnnotation||"coerce");else _=l(_,E,o.typeAnnotation||"assert")}if(!(_ instanceof Yi)&&"resolvedImage"!==_.type.kind&&Aa(_)){const E=new qr;try{_=new Yi(_.type,_.evaluate(E))}catch(T){return this.error(T.message),null}}return _}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,o,l){const d="number"==typeof e?this.path.concat(e):this.path,m=l?this.scope.concat(l):this.scope;return new Cs(this.registry,d,o||null,m,this.errors)}error(e,...o){const l=`${this.key}${o.map(d=>`[${d}]`).join("")}`;this.errors.push(new Yn(l,e))}checkSubtype(e,o){const l=us(e,o);return l&&this.error(l),l}}function Aa(s){if(s instanceof hr)return Aa(s.boundExpression);if(s instanceof ts&&"error"===s.name||s instanceof Ni||s instanceof Di)return!1;const e=s instanceof Li||s instanceof es;let o=!0;return s.eachChild(l=>{o=e?o&&Aa(l):o&&l instanceof Yi}),!!o&&so(s)&&Io(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}function fa(s,e){const o=s.length-1;let l,d,m=0,_=o,E=0;for(;m<=_;)if(E=Math.floor((m+_)/2),l=s[E],d=s[E+1],l<=e){if(E===o||e<d)return E;m=E+1}else{if(!(l>e))throw new ei("Input is not a number.");_=E-1}return 0}class Rs{constructor(e,o,l){this.type=e,this.input=o,this.labels=[],this.outputs=[];for(const[d,m]of l)this.labels.push(d),this.outputs.push(m)}static parse(e,o){if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");const l=o.parse(e[1],1,en);if(!l)return null;const d=[];let m=null;o.expectedType&&"value"!==o.expectedType.kind&&(m=o.expectedType);for(let _=1;_<e.length;_+=2){const E=1===_?-1/0:e[_],T=e[_+1],O=_,U=_+1;if("number"!=typeof E)return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(d.length&&d[d.length-1][0]>=E)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const W=o.parse(T,U,m);if(!W)return null;m=m||W.type,d.push([E,W])}return new Rs(m,l,d)}evaluate(e){const o=this.labels,l=this.outputs;if(1===o.length)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return l[0].evaluate(e);const m=o.length;return d>=o[m-1]?l[m-1].evaluate(e):l[fa(o,d)].evaluate(e)}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&e.push(this.labels[o]),e.push(this.outputs[o].serialize());return e}}function gr(s,e,o){return s*(1-o)+e*o}var oo=Object.freeze({__proto__:null,number:gr,color:function(s,e,o){return new $n(gr(s.r,e.r,o),gr(s.g,e.g,o),gr(s.b,e.b,o),gr(s.a,e.a,o))},array:function(s,e,o){return s.map((l,d)=>gr(l,e[d],o))}});const pa=4/29,ao=6/29,J=3*ao*ao,he=Math.PI/180,ee=180/Math.PI;function _e(s){return s>.008856451679035631?Math.pow(s,1/3):s/J+pa}function Xe(s){return s>ao?s*s*s:J*(s-pa)}function Dt(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function jt(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function q(s){const e=jt(s.r),o=jt(s.g),l=jt(s.b),d=_e((.4124564*e+.3575761*o+.1804375*l)/.95047),m=_e((.2126729*e+.7151522*o+.072175*l)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-_e((.0193339*e+.119192*o+.9503041*l)/1.08883)),alpha:s.a}}function $(s){let e=(s.l+16)/116,o=isNaN(s.a)?e:e+s.a/500,l=isNaN(s.b)?e:e-s.b/200;return e=1*Xe(e),o=.95047*Xe(o),l=1.08883*Xe(l),new $n(Dt(3.2404542*o-1.5371385*e-.4985314*l),Dt(-.969266*o+1.8760108*e+.041556*l),Dt(.0556434*o-.2040259*e+1.0572252*l),s.alpha)}function V(s,e,o){const l=e-s;return s+o*(l>180||l<-180?l-360*Math.round(l/360):l)}const ue={forward:q,reverse:$,interpolate:function(s,e,o){return{l:gr(s.l,e.l,o),a:gr(s.a,e.a,o),b:gr(s.b,e.b,o),alpha:gr(s.alpha,e.alpha,o)}}},yt={forward:function(s){const{l:e,a:o,b:l}=q(s),d=Math.atan2(l,o)*ee;return{h:d<0?d+360:d,c:Math.sqrt(o*o+l*l),l:e,alpha:s.a}},reverse:function(s){const e=s.h*he,o=s.c;return $({l:s.l,a:Math.cos(e)*o,b:Math.sin(e)*o,alpha:s.alpha})},interpolate:function(s,e,o){return{h:V(s.h,e.h,o),c:gr(s.c,e.c,o),l:gr(s.l,e.l,o),alpha:gr(s.alpha,e.alpha,o)}}};var Qt=Object.freeze({__proto__:null,lab:ue,hcl:yt});class Mn{constructor(e,o,l,d,m){this.type=e,this.operator=o,this.interpolation=l,this.input=d,this.labels=[],this.outputs=[];for(const[_,E]of m)this.labels.push(_),this.outputs.push(E)}static interpolationFactor(e,o,l,d){let m=0;if("exponential"===e.name)m=Vr(o,e.base,l,d);else if("linear"===e.name)m=Vr(o,1,l,d);else if("cubic-bezier"===e.name){const _=e.controlPoints;m=new Se(_[0],_[1],_[2],_[3]).solve(Vr(o,1,l,d))}return m}static parse(e,o){let[l,d,m,..._]=e;if(!Array.isArray(d)||0===d.length)return o.error("Expected an interpolation type expression.",1);if("linear"===d[0])d={name:"linear"};else if("exponential"===d[0]){const O=d[1];if("number"!=typeof O)return o.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:O}}else{if("cubic-bezier"!==d[0])return o.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const O=d.slice(1);if(4!==O.length||O.some(U=>"number"!=typeof U||U<0||U>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:O}}}if(e.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(m=o.parse(m,2,en),!m)return null;const E=[];let T=null;"interpolate-hcl"===l||"interpolate-lab"===l?T=Tn:o.expectedType&&"value"!==o.expectedType.kind&&(T=o.expectedType);for(let O=0;O<_.length;O+=2){const U=_[O],W=_[O+1],Y=O+3,ie=O+4;if("number"!=typeof U)return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Y);if(E.length&&E[E.length-1][0]>=U)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Y);const ye=o.parse(W,ie,T);if(!ye)return null;T=T||ye.type,E.push([U,ye])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new Mn(T,l,d,m,E):o.error(`Type ${xr(T)} is not interpolatable.`)}evaluate(e){const o=this.labels,l=this.outputs;if(1===o.length)return l[0].evaluate(e);const d=this.input.evaluate(e);if(d<=o[0])return l[0].evaluate(e);const m=o.length;if(d>=o[m-1])return l[m-1].evaluate(e);const _=fa(o,d),E=Mn.interpolationFactor(this.interpolation,d,o[_],o[_+1]),T=l[_].evaluate(e),O=l[_+1].evaluate(e);return"interpolate"===this.operator?oo[this.type.kind.toLowerCase()](T,O,E):"interpolate-hcl"===this.operator?yt.reverse(yt.interpolate(yt.forward(T),yt.forward(O),E)):ue.reverse(ue.interpolate(ue.forward(T),ue.forward(O),E))}eachChild(e){e(this.input);for(const o of this.outputs)e(o)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)o.push(this.labels[l],this.outputs[l].serialize());return o}}function Vr(s,e,o,l){const d=l-o,m=s-o;return 0===d?0:1===e?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class Ai{constructor(e,o){this.type=e,this.args=o}static parse(e,o){if(e.length<2)return o.error("Expectected at least one argument.");let l=null;const d=o.expectedType;d&&"value"!==d.kind&&(l=d);const m=[];for(const E of e.slice(1)){const T=o.parse(E,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!T)return null;l=l||T.type,m.push(T)}const _=d&&m.some(E=>us(d,E.type));return new Ai(_?On:l,m)}evaluate(e){let o,l=null,d=0;for(const m of this.args)if(d++,l=m.evaluate(e),l&&l instanceof hs&&!l.available&&(o||(o=l.name),l=null,d===this.args.length&&(l=o)),null!==l)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class oi{constructor(e,o){this.type=o.type,this.bindings=[].concat(e),this.result=o}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const o of this.bindings)e(o[1]);e(this.result)}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const _=e[m];if("string"!=typeof _)return o.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",m);const E=o.parse(e[m+1],m+1);if(!E)return null;l.push([_,E])}const d=o.parse(e[e.length-1],e.length-1,o.expectedType,l);return d?new oi(l,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[o,l]of this.bindings)e.push(o,l.serialize());return e.push(this.result.serialize()),e}}class fs{constructor(e,o,l){this.type=e,this.index=o,this.input=l}static parse(e,o){if(3!==e.length)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,en),d=o.parse(e[2],2,Ci(o.expectedType||On));return l&&d?new fs(d.type.itemType,l,d):null}evaluate(e){const o=this.index.evaluate(e),l=this.input.evaluate(e);if(o<0)throw new ei(`Array index out of bounds: ${o} < 0.`);if(o>=l.length)throw new ei(`Array index out of bounds: ${o} > ${l.length-1}.`);if(o!==Math.floor(o))throw new ei(`Array index must be an integer, but found ${o} instead.`);return l[o]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ps{constructor(e,o){this.type=cn,this.needle=e,this.haystack=o}static parse(e,o){if(3!==e.length)return o.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,On),d=o.parse(e[2],2,On);return l&&d?Is(l.type,[cn,Bt,en,Wi,On])?new ps(l,d):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${xr(l.type)} instead`):null}evaluate(e){const o=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!ws(o,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${xr(si(o))} instead.`);if(!ws(l,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${xr(si(l))} instead.`);return l.indexOf(o)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Mr{constructor(e,o,l){this.type=en,this.needle=e,this.haystack=o,this.fromIndex=l}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,On),d=o.parse(e[2],2,On);if(!l||!d)return null;if(!Is(l.type,[cn,Bt,en,Wi,On]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${xr(l.type)} instead`);if(4===e.length){const m=o.parse(e[3],3,en);return m?new Mr(l,d,m):null}return new Mr(l,d)}evaluate(e){const o=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!ws(o,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${xr(si(o))} instead.`);if(!ws(l,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${xr(si(l))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return l.indexOf(o,d)}return l.indexOf(o)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Mi{constructor(e,o,l,d,m,_){this.inputType=e,this.type=o,this.input=l,this.cases=d,this.outputs=m,this.otherwise=_}static parse(e,o){if(e.length<5)return o.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return o.error("Expected an even number of arguments.");let l,d;o.expectedType&&"value"!==o.expectedType.kind&&(d=o.expectedType);const m={},_=[];for(let O=2;O<e.length-1;O+=2){let U=e[O];const W=e[O+1];Array.isArray(U)||(U=[U]);const Y=o.concat(O);if(0===U.length)return Y.error("Expected at least one branch label.");for(const ye of U){if("number"!=typeof ye&&"string"!=typeof ye)return Y.error("Branch labels must be numbers or strings.");if("number"==typeof ye&&Math.abs(ye)>Number.MAX_SAFE_INTEGER)return Y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof ye&&Math.floor(ye)!==ye)return Y.error("Numeric branch labels must be integer values.");if(l){if(Y.checkSubtype(l,si(ye)))return null}else l=si(ye);if(void 0!==m[String(ye)])return Y.error("Branch labels must be unique.");m[String(ye)]=_.length}const ie=o.parse(W,O,d);if(!ie)return null;d=d||ie.type,_.push(ie)}const E=o.parse(e[1],1,On);if(!E)return null;const T=o.parse(e[e.length-1],e.length-1,d);return T?"value"!==E.type.kind&&o.concat(1).checkSubtype(l,E.type)?null:new Mi(l,d,E,m,_,T):null}evaluate(e){const o=this.input.evaluate(e);return(si(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),l=[],d={};for(const _ of o){const E=d[this.cases[_]];void 0===E?(d[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[E][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,E]of l)e.push(1===E.length?m(E[0]):E.map(m)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class lo{constructor(e,o,l){this.type=e,this.branches=o,this.otherwise=l}static parse(e,o){if(e.length<4)return o.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return o.error("Expected an odd number of arguments.");let l;o.expectedType&&"value"!==o.expectedType.kind&&(l=o.expectedType);const d=[];for(let _=1;_<e.length-1;_+=2){const E=o.parse(e[_],_,cn);if(!E)return null;const T=o.parse(e[_+1],_+1,l);if(!T)return null;d.push([E,T]),l=l||T.type}const m=o.parse(e[e.length-1],e.length-1,l);return m?new lo(l,d,m):null}evaluate(e){for(const[o,l]of this.branches)if(o.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[o,l]of this.branches)e(o),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(o=>{e.push(o.serialize())}),e}}class Po{constructor(e,o,l,d){this.type=e,this.input=o,this.beginIndex=l,this.endIndex=d}static parse(e,o){if(e.length<=2||e.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=o.parse(e[1],1,On),d=o.parse(e[2],2,en);if(!l||!d)return null;if(!Is(l.type,[Ci(On),Bt,On]))return o.error(`Expected first argument to be of type array or string, but found ${xr(l.type)} instead`);if(4===e.length){const m=o.parse(e[3],3,en);return m?new Po(l.type,l,d,m):null}return new Po(l.type,l,d)}evaluate(e){const o=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!ws(o,["string","array"]))throw new ei(`Expected first argument to be of type array or string, but found ${xr(si(o))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return o.slice(l,d)}return o.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function gl(s,e){return"=="===s||"!="===s?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Ro(s,e,o,l){return 0===l.compare(e,o)}function ko(s,e,o){const l="=="!==s&&"!="!==s;return class zb{constructor(m,_,E){this.type=cn,this.lhs=m,this.rhs=_,this.collator=E,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const E=m[0];let T=_.parse(m[1],1,On);if(!T)return null;if(!gl(E,T.type))return _.concat(1).error(`"${E}" comparisons are not supported for type '${xr(T.type)}'.`);let O=_.parse(m[2],2,On);if(!O)return null;if(!gl(E,O.type))return _.concat(2).error(`"${E}" comparisons are not supported for type '${xr(O.type)}'.`);if(T.type.kind!==O.type.kind&&"value"!==T.type.kind&&"value"!==O.type.kind)return _.error(`Cannot compare types '${xr(T.type)}' and '${xr(O.type)}'.`);l&&("value"===T.type.kind&&"value"!==O.type.kind?T=new es(O.type,[T]):"value"!==T.type.kind&&"value"===O.type.kind&&(O=new es(T.type,[O])));let U=null;if(4===m.length){if("string"!==T.type.kind&&"string"!==O.type.kind&&"value"!==T.type.kind&&"value"!==O.type.kind)return _.error("Cannot use collator to compare non-string types.");if(U=_.parse(m[3],3,Zr),!U)return null}return new zb(T,O,U)}evaluate(m){const _=this.lhs.evaluate(m),E=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const T=si(_),O=si(E);if(T.kind!==O.kind||"string"!==T.kind&&"number"!==T.kind)throw new ei(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${T.kind}, ${O.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const T=si(_),O=si(E);if("string"!==T.kind||"string"!==O.kind)return e(m,_,E)}return this.collator?o(m,_,E,this.collator.evaluate(m)):e(m,_,E)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[s];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const Qa=ko("==",function(s,e,o){return e===o},Ro),nr=ko("!=",function(s,e,o){return e!==o},function(s,e,o,l){return!Ro(0,e,o,l)}),_l=ko("<",function(s,e,o){return e<o},function(s,e,o,l){return l.compare(e,o)<0}),kc=ko(">",function(s,e,o){return e>o},function(s,e,o,l){return l.compare(e,o)>0}),Gl=ko("<=",function(s,e,o){return e<=o},function(s,e,o,l){return l.compare(e,o)<=0}),Ja=ko(">=",function(s,e,o){return e>=o},function(s,e,o,l){return l.compare(e,o)>=0});class yl{constructor(e,o,l,d,m){this.type=Bt,this.number=e,this.locale=o,this.currency=l,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,o){if(3!==e.length)return o.error("Expected two arguments.");const l=o.parse(e[1],1,en);if(!l)return null;const d=e[2];if("object"!=typeof d||Array.isArray(d))return o.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=o.parse(d.locale,1,Bt),!m))return null;let _=null;if(d.currency&&(_=o.parse(d.currency,1,Bt),!_))return null;let E=null;if(d["min-fraction-digits"]&&(E=o.parse(d["min-fraction-digits"],1,en),!E))return null;let T=null;return d["max-fraction-digits"]&&(T=o.parse(d["max-fraction-digits"],1,en),!T)?null:new yl(l,m,_,E,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Ko{constructor(e){this.type=en,this.input=e}static parse(e,o){if(2!==e.length)return o.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=o.parse(e[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?o.error(`Expected argument of type string or array, but found ${xr(l.type)} instead.`):new Ko(l):null}evaluate(e){const o=this.input.evaluate(e);if("string"==typeof o||Array.isArray(o))return o.length;throw new ei(`Expected value to be of type string or array, but found ${xr(si(o))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(o=>{e.push(o.serialize())}),e}}const ma={"==":Qa,"!=":nr,">":kc,"<":_l,">=":Ja,"<=":Gl,array:es,at:fs,boolean:es,case:lo,coalesce:Ai,collator:Ni,format:Hr,image:Fi,in:ps,"index-of":Mr,interpolate:Mn,"interpolate-hcl":Mn,"interpolate-lab":Mn,length:Ko,let:oi,literal:Yi,match:Mi,number:es,"number-format":yl,object:es,slice:Po,step:Rs,string:es,"to-boolean":Li,"to-color":Li,"to-number":Li,"to-string":Li,var:hr,within:Di};function Jt(s,[e,o,l,d]){e=e.evaluate(s),o=o.evaluate(s),l=l.evaluate(s);const m=d?d.evaluate(s):1,_=$l(e,o,l,m);if(_)throw new ei(_);return new $n(e/255*m,o/255*m,l/255*m,m)}function Rr(s,e){return s in e}function Ma(s,e){const o=e[s];return void 0===o?null:o}function gi(s){return{type:s}}function Oo(s){return{result:"success",value:s}}function ks(s){return{result:"error",value:s}}function ns(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function Fo(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ga(s){return!!s.expression&&s.expression.interpolated}function Ur(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function Zl(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function Ia(s){return s}function vl(s,e){const o="color"===e.type,l=s.stops&&"object"==typeof s.stops[0][0],d=l||!(l||void 0!==s.property),m=s.type||(ga(e)?"exponential":"interval");if(o&&((s=Hn({},s)).stops&&(s.stops=s.stops.map(O=>[O[0],$n.parse(O[1])])),s.default=$n.parse(s.default?s.default:e.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!Qt[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let _,E,T;if("exponential"===m)_=Ss;else if("interval"===m)_=el;else if("categorical"===m){_=yo,E=Object.create(null);for(const O of s.stops)E[O[0]]=O[1];T=typeof s.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=co}if(l){const O={},U=[];for(let ie=0;ie<s.stops.length;ie++){const ye=s.stops[ie],Ee=ye[0].zoom;void 0===O[Ee]&&(O[Ee]={zoom:Ee,type:s.type,property:s.property,default:s.default,stops:[]},U.push(Ee)),O[Ee].stops.push([ye[0].value,ye[1]])}const W=[];for(const ie of U)W.push([O[ie].zoom,vl(O[ie],e)]);const Y={name:"linear"};return{kind:"composite",interpolationType:Y,interpolationFactor:Mn.interpolationFactor.bind(void 0,Y),zoomStops:W.map(ie=>ie[0]),evaluate:({zoom:ie},ye)=>Ss({stops:W,base:s.base},e,ie).evaluate(ie,ye)}}if(d){const O="exponential"===m?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:Mn.interpolationFactor.bind(void 0,O),zoomStops:s.stops.map(U=>U[0]),evaluate:({zoom:U})=>_(s,e,U,E,T)}}return{kind:"source",evaluate(O,U){const W=U&&U.properties?U.properties[s.property]:void 0;return void 0===W?_i(s.default,e.default):_(s,e,W,E,T)}}}function _i(s,e,o){return void 0!==s?s:void 0!==e?e:void 0!==o?o:void 0}function yo(s,e,o,l,d){return _i(typeof o===d?l[o]:void 0,s.default,e.default)}function el(s,e,o){if("number"!==Ur(o))return _i(s.default,e.default);const l=s.stops.length;if(1===l||o<=s.stops[0][0])return s.stops[0][1];if(o>=s.stops[l-1][0])return s.stops[l-1][1];const d=fa(s.stops.map(m=>m[0]),o);return s.stops[d][1]}function Ss(s,e,o){const l=void 0!==s.base?s.base:1;if("number"!==Ur(o))return _i(s.default,e.default);const d=s.stops.length;if(1===d||o<=s.stops[0][0])return s.stops[0][1];if(o>=s.stops[d-1][0])return s.stops[d-1][1];const m=fa(s.stops.map(U=>U[0]),o),_=function(U,W,Y,ie){const ye=ie-Y,Ee=U-Y;return 0===ye?0:1===W?Ee/ye:(Math.pow(W,Ee)-1)/(Math.pow(W,ye)-1)}(o,l,s.stops[m][0],s.stops[m+1][0]),E=s.stops[m][1],T=s.stops[m+1][1];let O=oo[e.type]||Ia;if(s.colorSpace&&"rgb"!==s.colorSpace){const U=Qt[s.colorSpace];O=(W,Y)=>U.reverse(U.interpolate(U.forward(W),U.forward(Y),_))}return"function"==typeof E.evaluate?{evaluate(...U){const W=E.evaluate.apply(void 0,U),Y=T.evaluate.apply(void 0,U);if(void 0!==W&&void 0!==Y)return O(W,Y,_)}}:O(E,T,_)}function co(s,e,o){return"color"===e.type?o=$n.parse(o):"formatted"===e.type?o=ur.fromString(o.toString()):"resolvedImage"===e.type?o=hs.fromString(o.toString()):Ur(o)===e.type||"enum"===e.type&&e.values[o]||(o=void 0),_i(o,s.default,e.default)}ts.register(ma,{error:[{kind:"error"},[Bt],(s,[e])=>{throw new ei(e.evaluate(s))}],typeof:[Bt,[On],(s,[e])=>xr(si(e.evaluate(s)))],"to-rgba":[Ci(en,4),[Tn],(s,[e])=>e.evaluate(s).toArray()],rgb:[Tn,[en,en,en],Jt],rgba:[Tn,[en,en,en,en],Jt],has:{type:cn,overloads:[[[Bt],(s,[e])=>Rr(e.evaluate(s),s.properties())],[[Bt,mr],(s,[e,o])=>Rr(e.evaluate(s),o.evaluate(s))]]},get:{type:On,overloads:[[[Bt],(s,[e])=>Ma(e.evaluate(s),s.properties())],[[Bt,mr],(s,[e,o])=>Ma(e.evaluate(s),o.evaluate(s))]]},"feature-state":[On,[Bt],(s,[e])=>Ma(e.evaluate(s),s.featureState||{})],properties:[mr,[],s=>s.properties()],"geometry-type":[Bt,[],s=>s.geometryType()],id:[On,[],s=>s.id()],zoom:[en,[],s=>s.globals.zoom],"heatmap-density":[en,[],s=>s.globals.heatmapDensity||0],"line-progress":[en,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[en,[],s=>s.globals.skyRadialProgress||0],accumulated:[On,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[en,gi(en),(s,e)=>{let o=0;for(const l of e)o+=l.evaluate(s);return o}],"*":[en,gi(en),(s,e)=>{let o=1;for(const l of e)o*=l.evaluate(s);return o}],"-":{type:en,overloads:[[[en,en],(s,[e,o])=>e.evaluate(s)-o.evaluate(s)],[[en],(s,[e])=>-e.evaluate(s)]]},"/":[en,[en,en],(s,[e,o])=>e.evaluate(s)/o.evaluate(s)],"%":[en,[en,en],(s,[e,o])=>e.evaluate(s)%o.evaluate(s)],ln2:[en,[],()=>Math.LN2],pi:[en,[],()=>Math.PI],e:[en,[],()=>Math.E],"^":[en,[en,en],(s,[e,o])=>Math.pow(e.evaluate(s),o.evaluate(s))],sqrt:[en,[en],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[en,[en],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[en,[en],(s,[e])=>Math.log(e.evaluate(s))],log2:[en,[en],(s,[e])=>Math.log(e.evaluate(s))/Math.LN2],sin:[en,[en],(s,[e])=>Math.sin(e.evaluate(s))],cos:[en,[en],(s,[e])=>Math.cos(e.evaluate(s))],tan:[en,[en],(s,[e])=>Math.tan(e.evaluate(s))],asin:[en,[en],(s,[e])=>Math.asin(e.evaluate(s))],acos:[en,[en],(s,[e])=>Math.acos(e.evaluate(s))],atan:[en,[en],(s,[e])=>Math.atan(e.evaluate(s))],min:[en,gi(en),(s,e)=>Math.min(...e.map(o=>o.evaluate(s)))],max:[en,gi(en),(s,e)=>Math.max(...e.map(o=>o.evaluate(s)))],abs:[en,[en],(s,[e])=>Math.abs(e.evaluate(s))],round:[en,[en],(s,[e])=>{const o=e.evaluate(s);return o<0?-Math.round(-o):Math.round(o)}],floor:[en,[en],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[en,[en],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[cn,[Bt,On],(s,[e,o])=>s.properties()[e.value]===o.value],"filter-id-==":[cn,[On],(s,[e])=>s.id()===e.value],"filter-type-==":[cn,[Bt],(s,[e])=>s.geometryType()===e.value],"filter-<":[cn,[Bt,On],(s,[e,o])=>{const l=s.properties()[e.value],d=o.value;return typeof l==typeof d&&l<d}],"filter-id-<":[cn,[On],(s,[e])=>{const o=s.id(),l=e.value;return typeof o==typeof l&&o<l}],"filter->":[cn,[Bt,On],(s,[e,o])=>{const l=s.properties()[e.value],d=o.value;return typeof l==typeof d&&l>d}],"filter-id->":[cn,[On],(s,[e])=>{const o=s.id(),l=e.value;return typeof o==typeof l&&o>l}],"filter-<=":[cn,[Bt,On],(s,[e,o])=>{const l=s.properties()[e.value],d=o.value;return typeof l==typeof d&&l<=d}],"filter-id-<=":[cn,[On],(s,[e])=>{const o=s.id(),l=e.value;return typeof o==typeof l&&o<=l}],"filter->=":[cn,[Bt,On],(s,[e,o])=>{const l=s.properties()[e.value],d=o.value;return typeof l==typeof d&&l>=d}],"filter-id->=":[cn,[On],(s,[e])=>{const o=s.id(),l=e.value;return typeof o==typeof l&&o>=l}],"filter-has":[cn,[On],(s,[e])=>e.value in s.properties()],"filter-has-id":[cn,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[cn,[Ci(Bt)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[cn,[Ci(On)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[cn,[Bt,Ci(On)],(s,[e,o])=>o.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[cn,[Bt,Ci(On)],(s,[e,o])=>function(l,d,m,_){for(;m<=_;){const E=m+_>>1;if(d[E]===l)return!0;d[E]>l?_=E-1:m=E+1}return!1}(s.properties()[e.value],o.value,0,o.value.length-1)],all:{type:cn,overloads:[[[cn,cn],(s,[e,o])=>e.evaluate(s)&&o.evaluate(s)],[gi(cn),(s,e)=>{for(const o of e)if(!o.evaluate(s))return!1;return!0}]]},any:{type:cn,overloads:[[[cn,cn],(s,[e,o])=>e.evaluate(s)||o.evaluate(s)],[gi(cn),(s,e)=>{for(const o of e)if(o.evaluate(s))return!0;return!1}]]},"!":[cn,[cn],(s,[e])=>!e.evaluate(s)],"is-supported-script":[cn,[Bt],(s,[e])=>{const o=s.globals&&s.globals.isSupportedScript;return!o||o(e.evaluate(s))}],upcase:[Bt,[Bt],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[Bt,[Bt],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[Bt,gi(On),(s,e)=>e.map(o=>Oi(o.evaluate(s))).join("")],"resolved-locale":[Bt,[Zr],(s,[e])=>e.evaluate(s).resolvedLocale()]});class _c{constructor(e,o){var l;this.expression=e,this._warningHistory={},this._evaluator=new qr,this._defaultValue=o?"color"===(l=o).type&&Zl(l.default)?new $n(0,0,0,0):"color"===l.type?$n.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=o&&"enum"===o.type?o.values:null}evaluateWithoutErrorHandling(e,o,l,d,m,_){return this._evaluator.globals=e,this._evaluator.feature=o,this._evaluator.featureState=l,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(e,o,l,d,m,_){this._evaluator.globals=e,this._evaluator.feature=o||null,this._evaluator.featureState=l||null,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,"undefined"!=typeof console&&console.warn(E.message)),this._defaultValue}}}function tl(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in ma}function vo(s,e){const o=new Cs(ma,[],e?function(d){const m={color:Tn,string:Bt,number:en,enum:Bt,boolean:cn,formatted:zs,resolvedImage:Br};return"array"===d.type?Ci(m[d.value]||On,d.length):m[d.type]}(e):void 0),l=o.parse(s,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return l?Oo(new _c(l,e)):ks(o.errors)}class yc{constructor(e,o){this.kind=e,this._styleExpression=o,this.isStateDependent="constant"!==e&&!_o(o.expression)}evaluateWithoutErrorHandling(e,o,l,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,o,l,d,m,_)}evaluate(e,o,l,d,m,_){return this._styleExpression.evaluate(e,o,l,d,m,_)}}class uo{constructor(e,o,l,d){this.kind=e,this.zoomStops=l,this._styleExpression=o,this.isStateDependent="camera"!==e&&!_o(o.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,o,l,d,m,_){return this._styleExpression.evaluateWithoutErrorHandling(e,o,l,d,m,_)}evaluate(e,o,l,d,m,_){return this._styleExpression.evaluate(e,o,l,d,m,_)}interpolationFactor(e,o,l){return this.interpolationType?Mn.interpolationFactor(this.interpolationType,e,o,l):0}}function Hl(s,e){if("error"===(s=vo(s,e)).result)return s;const o=s.value.expression,l=so(o);if(!l&&!ns(e))return ks([new Yn("","data expressions not supported")]);const d=Io(o,["zoom"]);if(!d&&!Fo(e))return ks([new Yn("","zoom expressions not supported")]);const m=Pa(o);return m||d?m instanceof Yn?ks([m]):m instanceof Mn&&!ga(e)?ks([new Yn("",'"interpolate" expressions cannot be used with this property')]):Oo(m?new uo(l?"camera":"composite",s.value,m.labels,m instanceof Mn?m.interpolation:void 0):new yc(l?"constant":"source",s.value)):ks([new Yn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xl{constructor(e,o){this._parameters=e,this._specification=o,Hn(this,vl(this._parameters,this._specification))}static deserialize(e){return new xl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Pa(s){let e=null;if(s instanceof oi)e=Pa(s.result);else if(s instanceof Ai){for(const o of s.args)if(e=Pa(o),e)break}else(s instanceof Rs||s instanceof Mn)&&s.input instanceof ts&&"zoom"===s.input.name&&(e=s);return e instanceof Yn||s.eachChild(o=>{const l=Pa(o);l instanceof Yn?e=l:!e&&l?e=new Yn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Yn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Ds(s){const e=s.key,o=s.value,l=s.valueSpec||{},d=s.objectElementValidators||{},m=s.style,_=s.styleSpec;let E=[];const T=Ur(o);if("object"!==T)return[new Ct(e,o,`object expected, ${T} found`)];for(const O in o){const U=O.split(".")[0],W=l[U]||l["*"];let Y;if(d[U])Y=d[U];else if(l[U])Y=Gi;else if(d["*"])Y=d["*"];else{if(!l["*"]){E.push(new Ct(e,o[O],`unknown property "${O}"`));continue}Y=Gi}E=E.concat(Y({key:(e&&`${e}.`)+O,value:o[O],valueSpec:W,style:m,styleSpec:_,object:o,objectKey:O},o))}for(const O in l)d[O]||l[O].required&&void 0===l[O].default&&void 0===o[O]&&E.push(new Ct(e,o,`missing required property "${O}"`));return E}function ql(s){const e=s.value,o=s.valueSpec,l=s.style,d=s.styleSpec,m=s.key,_=s.arrayElementValidator||Gi;if("array"!==Ur(e))return[new Ct(m,e,`array expected, ${Ur(e)} found`)];if(o.length&&e.length!==o.length)return[new Ct(m,e,`array length ${o.length} expected, length ${e.length} found`)];if(o["min-length"]&&e.length<o["min-length"])return[new Ct(m,e,`array length at least ${o["min-length"]} expected, length ${e.length} found`)];let E={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum};d.$version<7&&(E.function=o.function),"object"===Ur(o.value)&&(E=o.value);let T=[];for(let O=0;O<e.length;O++)T=T.concat(_({array:e,arrayIndex:O,value:e[O],valueSpec:E,style:l,styleSpec:d,key:`${m}[${O}]`}));return T}function _a(s){const e=s.key,o=s.value,l=s.valueSpec;let d=Ur(o);if("number"===d&&o!=o&&(d="NaN"),"number"!==d)return[new Ct(e,o,`number expected, ${d} found`)];if("minimum"in l){let m=l.minimum;if("array"===Ur(l.minimum)&&(m=l.minimum[s.arrayIndex]),o<m)return[new Ct(e,o,`${o} is less than the minimum value ${m}`)]}if("maximum"in l){let m=l.maximum;if("array"===Ur(l.maximum)&&(m=l.maximum[s.arrayIndex]),o>m)return[new Ct(e,o,`${o} is greater than the maximum value ${m}`)]}return[]}function nl(s){const e=s.valueSpec,o=An(s.value.type);let l,d,m,_={};const E="categorical"!==o&&void 0===s.value.property,T=!E,O="array"===Ur(s.value.stops)&&"array"===Ur(s.value.stops[0])&&"object"===Ur(s.value.stops[0][0]),U=Ds({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(ie){if("identity"===o)return[new Ct(ie.key,ie.value,'identity function may not have a "stops" property')];let ye=[];const Ee=ie.value;return ye=ye.concat(ql({key:ie.key,value:Ee,valueSpec:ie.valueSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:W})),"array"===Ur(Ee)&&0===Ee.length&&ye.push(new Ct(ie.key,Ee,"array must have at least one stop")),ye},default:function(ie){return Gi({key:ie.key,value:ie.value,valueSpec:e,style:ie.style,styleSpec:ie.styleSpec})}}});return"identity"===o&&E&&U.push(new Ct(s.key,s.value,'missing required property "property"')),"identity"===o||s.value.stops||U.push(new Ct(s.key,s.value,'missing required property "stops"')),"exponential"===o&&s.valueSpec.expression&&!ga(s.valueSpec)&&U.push(new Ct(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(T&&!ns(s.valueSpec)?U.push(new Ct(s.key,s.value,"property functions not supported")):E&&!Fo(s.valueSpec)&&U.push(new Ct(s.key,s.value,"zoom functions not supported"))),"categorical"!==o&&!O||void 0!==s.value.property||U.push(new Ct(s.key,s.value,'"property" property is required')),U;function W(ie){let ye=[];const Ee=ie.value,Le=ie.key;if("array"!==Ur(Ee))return[new Ct(Le,Ee,`array expected, ${Ur(Ee)} found`)];if(2!==Ee.length)return[new Ct(Le,Ee,`array length 2 expected, length ${Ee.length} found`)];if(O){if("object"!==Ur(Ee[0]))return[new Ct(Le,Ee,`object expected, ${Ur(Ee[0])} found`)];if(void 0===Ee[0].zoom)return[new Ct(Le,Ee,"object stop key must have zoom")];if(void 0===Ee[0].value)return[new Ct(Le,Ee,"object stop key must have value")];if(m&&m>An(Ee[0].zoom))return[new Ct(Le,Ee[0].zoom,"stop zoom values must appear in ascending order")];An(Ee[0].zoom)!==m&&(m=An(Ee[0].zoom),d=void 0,_={}),ye=ye.concat(Ds({key:`${Le}[0]`,value:Ee[0],valueSpec:{zoom:{}},style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:_a,value:Y}}))}else ye=ye.concat(Y({key:`${Le}[0]`,value:Ee[0],valueSpec:{},style:ie.style,styleSpec:ie.styleSpec},Ee));return tl(sr(Ee[1]))?ye.concat([new Ct(`${Le}[1]`,Ee[1],"expressions are not allowed in function stops.")]):ye.concat(Gi({key:`${Le}[1]`,value:Ee[1],valueSpec:e,style:ie.style,styleSpec:ie.styleSpec}))}function Y(ie,ye){const Ee=Ur(ie.value),Le=An(ie.value),Ke=null!==ie.value?ie.value:ye;if(l){if(Ee!==l)return[new Ct(ie.key,Ke,`${Ee} stop domain type must match previous stop domain type ${l}`)]}else l=Ee;if("number"!==Ee&&"string"!==Ee&&"boolean"!==Ee)return[new Ct(ie.key,Ke,"stop domain value must be a number, string, or boolean")];if("number"!==Ee&&"categorical"!==o){let ot=`number expected, ${Ee} found`;return ns(e)&&void 0===o&&(ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ct(ie.key,Ke,ot)]}return"categorical"!==o||"number"!==Ee||isFinite(Le)&&Math.floor(Le)===Le?"categorical"!==o&&"number"===Ee&&void 0!==d&&Le<d?[new Ct(ie.key,Ke,"stop domain values must appear in ascending order")]:(d=Le,"categorical"===o&&Le in _?[new Ct(ie.key,Ke,"stop domain values must be unique")]:(_[Le]=!0,[])):[new Ct(ie.key,Ke,`integer expected, found ${Le}`)]}}function Lo(s){const e=("property"===s.expressionContext?Hl:vo)(sr(s.value),s.valueSpec);if("error"===e.result)return e.value.map(l=>new Ct(`${s.key}${l.key}`,s.value,l.message));const o=e.value.expression||e.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!o.outputDefined())return[new Ct(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!_o(o))return[new Ct(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext&&!_o(o))return[new Ct(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Io(o,["zoom","feature-state"]))return[new Ct(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!so(o))return[new Ct(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ra(s){const e=s.key,o=s.value,l=s.valueSpec,d=[];return Array.isArray(l.values)?-1===l.values.indexOf(An(o))&&d.push(new Ct(e,o,`expected one of [${l.values.join(", ")}], ${JSON.stringify(o)} found`)):-1===Object.keys(l.values).indexOf(An(o))&&d.push(new Ct(e,o,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(o)} found`)),d}function rl(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!rl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}const bl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ka(s){if(null==s)return{filter:()=>!0,needGeometry:!1};rl(s)||(s=Os(s));const e=vo(s,bl);if("error"===e.result)throw new Error(e.value.map(o=>`${o.key}: ${o.message}`).join(", "));return{filter:(o,l,d)=>e.value.evaluate(o,l,{},d),needGeometry:rs(s)}}function vc(s,e){return s<e?-1:s>e?1:0}function rs(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let e=1;e<s.length;e++)if(rs(s[e]))return!0;return!1}function Os(s){if(!s)return!0;const e=s[0];return s.length<=1?"any"!==e:"=="===e?bi(s[1],s[2],"=="):"!="===e?wl(bi(s[1],s[2],"==")):"<"===e||">"===e||"<="===e||">="===e?bi(s[1],s[2],e):"any"===e?(o=s.slice(1),["any"].concat(o.map(Os))):"all"===e?["all"].concat(s.slice(1).map(Os)):"none"===e?["all"].concat(s.slice(1).map(Os).map(wl)):"in"===e?xc(s[1],s.slice(2)):"!in"===e?wl(xc(s[1],s.slice(2))):"has"===e?Oc(s[1]):"!has"===e?wl(Oc(s[1])):"within"!==e||s;var o}function bi(s,e,o){switch(s){case"$type":return[`filter-type-${o}`,e];case"$id":return[`filter-id-${o}`,e];default:return[`filter-${o}`,s,e]}}function xc(s,e){if(0===e.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(o=>typeof o!=typeof e[0])?["filter-in-large",s,["literal",e.sort(vc)]]:["filter-in-small",s,["literal",e]]}}function Oc(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function wl(s){return["!",s]}function Wl(s){return rl(sr(s.value))?Lo(Hn({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Oa(s)}function Oa(s){const e=s.value,o=s.key;if("array"!==Ur(e))return[new Ct(o,e,`array expected, ${Ur(e)} found`)];const l=s.styleSpec;let d,m=[];if(e.length<1)return[new Ct(o,e,"filter array must have at least 1 element")];switch(m=m.concat(Ra({key:`${o}[0]`,value:e[0],valueSpec:l.filter_operator,style:s.style,styleSpec:s.styleSpec})),An(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===An(e[1])&&m.push(new Ct(o,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&m.push(new Ct(o,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Ur(e[1]),"string"!==d&&m.push(new Ct(`${o}[1]`,e[1],`string expected, ${d} found`)));for(let _=2;_<e.length;_++)d=Ur(e[_]),"$type"===An(e[1])?m=m.concat(Ra({key:`${o}[${_}]`,value:e[_],valueSpec:l.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==d&&"number"!==d&&"boolean"!==d&&m.push(new Ct(`${o}[${_}]`,e[_],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)m=m.concat(Oa({key:`${o}[${_}]`,value:e[_],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":d=Ur(e[1]),2!==e.length?m.push(new Ct(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==d&&m.push(new Ct(`${o}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=Ur(e[1]),2!==e.length?m.push(new Ct(o,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==d&&m.push(new Ct(`${o}[1]`,e[1],`object expected, ${d} found`))}return m}function El(s,e){const o=s.key,l=s.style,d=s.styleSpec,m=s.value,_=s.objectKey,E=d[`${e}_${s.layerType}`];if(!E)return[];const T=_.match(/^(.*)-transition$/);if("paint"===e&&T&&E[T[1]]&&E[T[1]].transition)return Gi({key:o,value:m,valueSpec:d.transition,style:l,styleSpec:d});const O=s.valueSpec||E[_];if(!O)return[new Ct(o,m,`unknown property "${_}"`)];let U;if("string"===Ur(m)&&ns(O)&&!O.tokens&&(U=/^{([^}]+)}$/.exec(m)))return[new Ct(o,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const W=[];return"symbol"===s.layerType&&("text-field"===_&&l&&!l.glyphs&&W.push(new Ct(o,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Zl(sr(m))&&"identity"===An(m.type)&&W.push(new Ct(o,m,'"text-font" does not support identity functions'))),W.concat(Gi({key:s.key,value:m,valueSpec:O,style:l,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:_}))}function ms(s){return El(s,"paint")}function Xo(s){return El(s,"layout")}function Fa(s){let e=[];const o=s.value,l=s.key,d=s.style,m=s.styleSpec;o.type||o.ref||e.push(new Ct(l,o,'either "type" or "ref" is required'));let _=An(o.type);const E=An(o.ref);if(o.id){const T=An(o.id);for(let O=0;O<s.arrayIndex;O++){const U=d.layers[O];An(U.id)===T&&e.push(new Ct(l,o.id,`duplicate layer id "${o.id}", previously used at line ${U.id.__line__}`))}}if("ref"in o){let T;["type","source","source-layer","filter","layout"].forEach(O=>{O in o&&e.push(new Ct(l,o[O],`"${O}" is prohibited for ref layers`))}),d.layers.forEach(O=>{An(O.id)===E&&(T=O)}),T?T.ref?e.push(new Ct(l,o.ref,"ref cannot reference another ref layer")):_=An(T.type):e.push(new Ct(l,o.ref,`ref layer "${E}" not found`))}else if("background"!==_&&"sky"!==_)if(o.source){const T=d.sources&&d.sources[o.source],O=T&&An(T.type);T?"vector"===O&&"raster"===_?e.push(new Ct(l,o.source,`layer "${o.id}" requires a raster source`)):"raster"===O&&"raster"!==_?e.push(new Ct(l,o.source,`layer "${o.id}" requires a vector source`)):"vector"!==O||o["source-layer"]?"raster-dem"===O&&"hillshade"!==_?e.push(new Ct(l,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!o.paint||!o.paint["line-gradient"]||"geojson"===O&&T.lineMetrics||e.push(new Ct(l,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ct(l,o,`layer "${o.id}" must specify a "source-layer"`)):e.push(new Ct(l,o.source,`source "${o.source}" not found`))}else e.push(new Ct(l,o,'missing required property "source"'));return e=e.concat(Ds({key:l,value:o,valueSpec:m.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gi({key:`${l}.type`,value:o.type,valueSpec:m.layer.type,style:s.style,styleSpec:s.styleSpec,object:o,objectKey:"type"}),filter:Wl,layout:T=>Ds({layer:o,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":O=>Xo(Hn({layerType:_},O))}}),paint:T=>Ds({layer:o,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":O=>ms(Hn({layerType:_},O))}})}})),e}function $i(s){const e=s.value,o=s.key,l=Ur(e);return"string"!==l?[new Ct(o,e,`string expected, ${l} found`)]:[]}const Cl={promoteId:function({key:s,value:e}){if("string"===Ur(e))return $i({key:s,value:e});{const o=[];for(const l in e)o.push(...$i({key:`${s}.${l}`,value:e[l]}));return o}}};function xo(s){const e=s.value,o=s.key,l=s.styleSpec,d=s.style;if(!e.type)return[new Ct(o,e,'"type" is required')];const m=An(e.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=Ds({key:o,value:e,valueSpec:l[`source_${m.replace("-","_")}`],style:s.style,styleSpec:l,objectElementValidators:Cl}),_;case"geojson":if(_=Ds({key:o,value:e,valueSpec:l.source_geojson,style:d,styleSpec:l,objectElementValidators:Cl}),e.cluster)for(const E in e.clusterProperties){const[T,O]=e.clusterProperties[E],U="string"==typeof T?[T,["accumulated"],["get",E]]:T;_.push(...Lo({key:`${o}.${E}.map`,value:O,expressionContext:"cluster-map"})),_.push(...Lo({key:`${o}.${E}.reduce`,value:U,expressionContext:"cluster-reduce"}))}return _;case"video":return Ds({key:o,value:e,valueSpec:l.source_video,style:d,styleSpec:l});case"image":return Ds({key:o,value:e,valueSpec:l.source_image,style:d,styleSpec:l});case"canvas":return[new Ct(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ra({key:`${o}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:l})}}function Ks(s){const e=s.value,o=s.styleSpec,l=o.light,d=s.style;let m=[];const _=Ur(e);if(void 0===e)return m;if("object"!==_)return m=m.concat([new Ct("light",e,`object expected, ${_} found`)]),m;for(const E in e){const T=E.match(/^(.*)-transition$/);m=m.concat(T&&l[T[1]]&&l[T[1]].transition?Gi({key:E,value:e[E],valueSpec:o.transition,style:d,styleSpec:o}):l[E]?Gi({key:E,value:e[E],valueSpec:l[E],style:d,styleSpec:o}):[new Ct(E,e[E],`unknown property "${E}"`)])}return m}function il(s){const e=s.value,o=s.key,l=s.style,d=s.styleSpec,m=d.terrain;let _=[];const E=Ur(e);if(void 0===e)return _;if("object"!==E)return _=_.concat([new Ct("terrain",e,`object expected, ${E} found`)]),_;for(const T in e){const O=T.match(/^(.*)-transition$/);_=_.concat(O&&m[O[1]]&&m[O[1]].transition?Gi({key:T,value:e[T],valueSpec:d.transition,style:l,styleSpec:d}):m[T]?Gi({key:T,value:e[T],valueSpec:m[T],style:l,styleSpec:d}):[new Ct(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=l.sources&&l.sources[e.source],O=T&&An(T.type);T?"raster-dem"!==O&&_.push(new Ct(o,e.source,`terrain cannot be used with a source of type ${O}, it only be used with a "raster-dem" source type`)):_.push(new Ct(o,e.source,`source "${e.source}" not found`))}else _.push(new Ct(o,e,'terrain is missing required property "source"'));return _}function Yl(s){const e=s.value,o=s.style,l=s.styleSpec,d=l.fog;let m=[];const _=Ur(e);if(void 0===e)return m;if("object"!==_)return m=m.concat([new Ct("fog",e,`object expected, ${_} found`)]),m;for(const E in e){const T=E.match(/^(.*)-transition$/);m=m.concat(T&&d[T[1]]&&d[T[1]].transition?Gi({key:E,value:e[E],valueSpec:l.transition,style:o,styleSpec:l}):d[E]?Gi({key:E,value:e[E],valueSpec:d[E],style:o,styleSpec:l}):[new Ct(E,e[E],`unknown property "${E}"`)])}return m}const Kl={"*":()=>[],array:ql,boolean:function(s){const e=s.value,o=s.key,l=Ur(e);return"boolean"!==l?[new Ct(o,e,`boolean expected, ${l} found`)]:[]},number:_a,color:function(s){const e=s.key,o=s.value,l=Ur(o);return"string"!==l?[new Ct(e,o,`color expected, ${l} found`)]:null===Si.parseCSSColor(o)?[new Ct(e,o,`color expected, "${o}" found`)]:[]},constants:Bn,enum:Ra,filter:Wl,function:nl,layer:Fa,object:Ds,source:xo,light:Ks,terrain:il,fog:Yl,string:$i,formatted:function(s){return 0===$i(s).length?[]:Lo(s)},resolvedImage:function(s){return 0===$i(s).length?[]:Lo(s)}};function Gi(s){const e=s.value,o=s.valueSpec,l=s.styleSpec;return o.expression&&Zl(An(e))?nl(s):o.expression&&tl(sr(e))?Lo(s):o.type&&Kl[o.type]?Kl[o.type](s):Ds(Hn({},s,{valueSpec:o.type?l[o.type]:o}))}function Tl(s){const e=s.value,o=s.key,l=$i(s);return l.length||(-1===e.indexOf("{fontstack}")&&l.push(new Ct(o,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&l.push(new Ct(o,e,'"glyphs" url must include a "{range}" token'))),l}function ho(s,e=He){let o=[];return o=o.concat(Gi({key:"",value:s,valueSpec:e.$root,styleSpec:e,style:s,objectElementValidators:{glyphs:Tl,"*":()=>[]}})),s.constants&&(o=o.concat(Bn({key:"constants",value:s.constants,style:s,styleSpec:e}))),gs(o)}function gs(s){return[].concat(s).sort((e,o)=>e.line-o.line)}function Qo(s){return function(...e){return gs(s.apply(this,e))}}ho.source=Qo(xo),ho.light=Qo(Ks),ho.terrain=Qo(il),ho.fog=Qo(Yl),ho.layer=Qo(Fa),ho.filter=Qo(Wl),ho.paintProperty=Qo(ms),ho.layoutProperty=Qo(Xo);const Jo=ho,No=Jo.light,zo=Jo.fog,ya=Jo.paintProperty,Fs=Jo.layoutProperty;function ea(s,e){let o=!1;if(e&&e.length)for(const l of e)s.fire(new Pt(new Error(l.message))),o=!0;return o}var va=_s;function _s(s,e,o){var l=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var d=new Int32Array(this.arrayBuffer);s=d[0],this.d=(e=d[1])+2*(o=d[2]);for(var m=0;m<this.d*this.d;m++){var _=d[3+m],E=d[3+m+1];l.push(_===E?null:d.subarray(_,E))}var T=d[3+l.length+1];this.keys=d.subarray(d[3+l.length],T),this.bboxes=d.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*o;for(var O=0;O<this.d*this.d;O++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=s,this.padding=o,this.scale=e/s,this.uid=0;var U=o/e*s;this.min=-U,this.max=s+U}_s.prototype.insert=function(s,e,o,l,d){this._forEachCell(e,o,l,d,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(e),this.bboxes.push(o),this.bboxes.push(l),this.bboxes.push(d)},_s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_s.prototype._insertCell=function(s,e,o,l,d,m){this.cells[d].push(m)},_s.prototype.query=function(s,e,o,l,d){var m=this.min,_=this.max;if(s<=m&&e<=m&&_<=o&&_<=l&&!d)return Array.prototype.slice.call(this.keys);var E=[];return this._forEachCell(s,e,o,l,this._queryCell,E,{},d),E},_s.prototype._queryCell=function(s,e,o,l,d,m,_,E){var T=this.cells[d];if(null!==T)for(var O=this.keys,U=this.bboxes,W=0;W<T.length;W++){var Y=T[W];if(void 0===_[Y]){var ie=4*Y;(E?E(U[ie+0],U[ie+1],U[ie+2],U[ie+3]):s<=U[ie+2]&&e<=U[ie+3]&&o>=U[ie+0]&&l>=U[ie+1])?(_[Y]=!0,m.push(O[Y])):_[Y]=!1}}},_s.prototype._forEachCell=function(s,e,o,l,d,m,_,E){for(var T=this._convertToCellCoord(s),O=this._convertToCellCoord(e),U=this._convertToCellCoord(o),W=this._convertToCellCoord(l),Y=T;Y<=U;Y++)for(var ie=O;ie<=W;ie++){var ye=this.d*ie+Y;if((!E||E(this._convertFromCellCoord(Y),this._convertFromCellCoord(ie),this._convertFromCellCoord(Y+1),this._convertFromCellCoord(ie+1)))&&d.call(this,s,e,o,l,ye,m,_,E))return}},_s.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},_s.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},_s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,e=3+this.cells.length+1+1,o=0,l=0;l<this.cells.length;l++)o+=this.cells[l].length;var d=new Int32Array(e+o+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;for(var m=e,_=0;_<s.length;_++){var E=s[_];d[3+_]=m,d.set(E,m),m+=E.length}return d[3+s.length]=m,d.set(this.keys,m),d[3+s.length+1]=m+=this.keys.length,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer};const{ImageData:Xl,ImageBitmap:La}=ve,ta={};function yn(s,e,o={}){Object.defineProperty(e,"_classRegistryKey",{value:s,writeable:!1}),ta[s]={klass:e,omit:o.omit||[],shallow:o.shallow||[]}}yn("Object",Object),va.serialize=function(s,e){const o=s.toArrayBuffer();return e&&e.push(o),{buffer:o}},va.deserialize=function(s){return new va(s.buffer)},yn("Grid",va),yn("Color",$n),yn("Error",Error),yn("ResolvedImage",hs),yn("StylePropertyFunction",xl),yn("StyleExpression",_c,{omit:["_evaluator"]}),yn("ZoomDependentExpression",uo),yn("ZoomConstantExpression",yc),yn("CompoundExpression",ts,{omit:["_evaluate"]});for(const s in ma)ma[s]._classRegistryKey||yn(`Expression_${s}`,ma[s]);function Sl(s){return s&&"undefined"!=typeof ArrayBuffer&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function Fc(s){return La&&s instanceof La}function Bs(s,e){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(Sl(s)||Fc(s))return e&&e.push(s),s;if(ArrayBuffer.isView(s)){const o=s;return e&&e.push(o.buffer),o}if(s instanceof Xl)return e&&e.push(s.data.buffer),s;if(Array.isArray(s)){const o=[];for(const l of s)o.push(Bs(l,e));return o}if("object"==typeof s){const o=s.constructor,l=o._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");const d=o.serialize?o.serialize(s,e):{};if(!o.serialize){for(const m in s){if(!s.hasOwnProperty(m)||ta[l].omit.indexOf(m)>=0)continue;const _=s[m];d[m]=ta[l].shallow.indexOf(m)>=0?_:Bs(_,e)}s instanceof Error&&(d.message=s.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(d.$name=l),d}throw new Error("can't serialize object of type "+typeof s)}function sl(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||Sl(s)||Fc(s)||ArrayBuffer.isView(s)||s instanceof Xl)return s;if(Array.isArray(s))return s.map(sl);if("object"==typeof s){const e=s.$name||"Object",{klass:o}=ta[e];if(!o)throw new Error(`can't deserialize unregistered class ${e}`);if(o.deserialize)return o.deserialize(s);const l=Object.create(o.prototype);for(const d of Object.keys(s)){if("$name"===d)continue;const m=s[d];l[d]=ta[e].shallow.indexOf(d)>=0?m:sl(m)}return l}throw new Error("can't deserialize object of type "+typeof s)}class Lc{constructor(){this.first=!0}update(e,o){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=o),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}const Na=s=>s>=1536&&s<=1791,Dl=s=>s>=1872&&s<=1919,Ql=s=>s>=2208&&s<=2303,xa=s=>s>=11904&&s<=12031,ol=s=>s>=12032&&s<=12255,Nc=s=>s>=12272&&s<=12287,na=s=>s>=12288&&s<=12351,Al=s=>s>=12352&&s<=12447,za=s=>s>=12448&&s<=12543,Ml=s=>s>=12544&&s<=12591,ba=s=>s>=12704&&s<=12735,Il=s=>s>=12736&&s<=12783,al=s=>s>=12784&&s<=12799,ra=s=>s>=12800&&s<=13055,Jl=s=>s>=13056&&s<=13311,bc=s=>s>=13312&&s<=19903,B=s=>s>=19968&&s<=40959,P=s=>s>=40960&&s<=42127,S=s=>s>=42128&&s<=42191,G=s=>s>=44032&&s<=55215,ne=s=>s>=63744&&s<=64255,me=s=>s>=64336&&s<=65023,ze=s=>s>=65040&&s<=65055,et=s=>s>=65072&&s<=65103,Nt=s=>s>=65104&&s<=65135,En=s=>s>=65136&&s<=65279,dr=s=>s>=65280&&s<=65519;function Un(s){for(const e of s)if(Xs(e.charCodeAt(0)))return!0;return!1}function fi(s){for(const e of s)if(!kr(e.charCodeAt(0)))return!1;return!0}function kr(s){return!(Na(s)||Dl(s)||Ql(s)||me(s)||En(s))}function Xs(s){return!(746!==s&&747!==s&&(s<4352||!(ba(s)||Ml(s)||et(s)&&!(s>=65097&&s<=65103)||ne(s)||Jl(s)||xa(s)||Il(s)||!(!na(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||bc(s)||B(s)||ra(s)||(e=s,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(s)||(e=>e>=55216&&e<=55295)(s)||(e=>e>=4352&&e<=4607)(s)||G(s)||Al(s)||Nc(s)||(e=>e>=12688&&e<=12703)(s)||ol(s)||al(s)||za(s)&&12540!==s||!(!dr(s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Nt(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(e=>e>=5120&&e<=5759)(s)||(e=>e>=6320&&e<=6399)(s)||ze(s)||(e=>e>=19904&&e<=19967)(s)||P(s)||S(s))));var e}function Bo(s){return!(Xs(s)||(e=s,(o=e)>=128&&o<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(o=>o>=8192&&o<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(o=>o>=8448&&o<=8527)(e)||(o=>o>=8528&&o<=8591)(e)||(o=>o>=8960&&o<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(o=>o>=9216&&o<=9279)(e)&&9251!==e||(o=>o>=9280&&o<=9311)(e)||(o=>o>=9312&&o<=9471)(e)||(o=>o>=9632&&o<=9727)(e)||(o=>o>=9728&&o<=9983)(e)&&!(e>=9754&&e<=9759)||(o=>o>=11008&&o<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||na(e)||za(e)||(o=>o>=57344&&o<=63743)(e)||et(e)||Nt(e)||dr(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,o}function Lr(s){return s>=1424&&s<=2303||me(s)||En(s)}function bo(s,e){return!(!e&&Lr(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(o=s,o>=6016&&o<=6143));var o}function f(s){for(const e of s)if(Lr(e.charCodeAt(0)))return!0;return!1}const r="deferred",c="loading",p="loaded";let x=null,b="unavailable",M=null;const z=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(b="error"),x&&x(s)};function j(){Q.fire(new Gt("pluginStateChange",{pluginStatus:b,pluginURL:M}))}const Q=new sn,re=function(){return b},oe=function(){if(b!==r||!M)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");b=c,j(),M&&k({url:M},s=>{s?z(s):(b=p,j())})},le={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>b===p||null!=le.applyArabicShaping,isLoading:()=>b===c,setState(s){b=s.pluginStatus,M=s.pluginURL},isParsed:()=>null!=le.applyArabicShaping&&null!=le.processBidirectionalText&&null!=le.processStyledBidirectionalText,getPluginURL:()=>M};class pe{constructor(e,o){this.zoom=e,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Lc,this.transition={})}isSupportedScript(e){return function(o,l){for(const d of o)if(!bo(d.charCodeAt(0),l))return!1;return!0}(e,le.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,o=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*o}}}class Ae{constructor(e,o){this.property=e,this.value=o,this.expression=function(l,d){if(Zl(l))return new xl(l,d);if(tl(l)){const m=Hl(l,d);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=l;return"string"==typeof l&&"color"===d.type&&(m=$n.parse(l)),{kind:"constant",evaluate:()=>m}}}(void 0===o?e.specification.default:o,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,o,l){return this.property.possiblyEvaluate(this,e,o,l)}}class Ie{constructor(e){this.property=e,this.value=new Ae(e,void 0)}transitioned(e,o){return new be(this.property,this.value,o,Ht({},e.transition,this.transition),e.now)}untransitioned(){return new be(this.property,this.value,null,{},0)}}class qe{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return tn(this._values[e].value.value)}setValue(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new Ie(this._values[e].property)),this._values[e].value=new Ae(this._values[e].property,null===o?void 0:tn(o))}getTransition(e){return tn(this._values[e].transition)}setTransition(e,o){this._values.hasOwnProperty(e)||(this._values[e]=new Ie(this._values[e].property)),this._values[e].transition=tn(o)||void 0}serialize(){const e={};for(const o of Object.keys(this._values)){const l=this.getValue(o);void 0!==l&&(e[o]=l);const d=this.getTransition(o);void 0!==d&&(e[`${o}-transition`]=d)}return e}transitioned(e,o){const l=new Re(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].transitioned(e,o._values[d]);return l}untransitioned(){const e=new Re(this._properties);for(const o of Object.keys(this._values))e._values[o]=this._values[o].untransitioned();return e}}class be{constructor(e,o,l,d,m){const _=d.delay||0,E=d.duration||0;m=m||0,this.property=e,this.value=o,this.begin=m+_,this.end=this.begin+E,e.specification.transition&&(d.delay||d.duration)&&(this.prior=l)}possiblyEvaluate(e,o,l){const d=e.now||0,m=this.value.possiblyEvaluate(e,o,l),_=this.prior;if(_){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return _.possiblyEvaluate(e,o,l);{const E=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,o,l),m,ke(E))}}return m}}class Re{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,o,l){const d=new it(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,o,l);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class $e{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return tn(this._values[e].value)}setValue(e,o){this._values[e]=new Ae(this._values[e].property,null===o?void 0:tn(o))}serialize(){const e={};for(const o of Object.keys(this._values)){const l=this.getValue(o);void 0!==l&&(e[o]=l)}return e}possiblyEvaluate(e,o,l){const d=new it(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,o,l);return d}}class We{constructor(e,o,l){this.property=e,this.value=o,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,o,l,d){return this.property.evaluate(this.value,this.parameters,e,o,l,d)}}class it{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Fe{constructor(e){this.specification=e}possiblyEvaluate(e,o){return e.expression.evaluate(o)}interpolate(e,o,l){const d=oo[this.specification.type];return d?d(e,o,l):e}}class pt{constructor(e,o){this.specification=e,this.overrides=o}possiblyEvaluate(e,o,l,d){return new We(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(o,null,{},l,d)}:e.expression,o)}interpolate(e,o,l){if("constant"!==e.value.kind||"constant"!==o.value.kind)return e;if(void 0===e.value.value||void 0===o.value.value)return new We(this,{kind:"constant",value:void 0},e.parameters);const d=oo[this.specification.type];return d?new We(this,{kind:"constant",value:d(e.value.value,o.value.value,l)},e.parameters):e}evaluate(e,o,l,d,m,_){return"constant"===e.kind?e.value:e.evaluate(o,l,d,m,_)}}class Rt extends pt{possiblyEvaluate(e,o,l,d){if(void 0===e.value)return new We(this,{kind:"constant",value:void 0},o);if("constant"===e.expression.kind){const m=e.expression.evaluate(o,null,{},l,d),_="resolvedImage"===e.property.specification.type&&"string"!=typeof m?m.name:m,E=this._calculate(_,_,_,o);return new We(this,{kind:"constant",value:E},o)}if("camera"===e.expression.kind){const m=this._calculate(e.expression.evaluate({zoom:o.zoom-1}),e.expression.evaluate({zoom:o.zoom}),e.expression.evaluate({zoom:o.zoom+1}),o);return new We(this,{kind:"constant",value:m},o)}return new We(this,e.expression,o)}evaluate(e,o,l,d,m,_){if("source"===e.kind){const E=e.evaluate(o,l,d,m,_);return this._calculate(E,E,E,o)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(o.zoom)-1},l,d),e.evaluate({zoom:Math.floor(o.zoom)},l,d),e.evaluate({zoom:Math.floor(o.zoom)+1},l,d),o):e.value}_calculate(e,o,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:o,other:l}:{from:l,to:o,other:e}}interpolate(e){return e}}class Ut{constructor(e){this.specification=e}possiblyEvaluate(e,o,l,d){if(void 0!==e.value){if("constant"===e.expression.kind){const m=e.expression.evaluate(o,null,{},l,d);return this._calculate(m,m,m,o)}return this._calculate(e.expression.evaluate(new pe(Math.floor(o.zoom-1),o)),e.expression.evaluate(new pe(Math.floor(o.zoom),o)),e.expression.evaluate(new pe(Math.floor(o.zoom+1),o)),o)}}_calculate(e,o,l,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:o}:{from:l,to:o}}interpolate(e){return e}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,o,l,d){return!!e.expression.evaluate(o,null,{},l,d)}interpolate(){return!1}}class At{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const o in e){const l=e[o];l.specification.overridable&&this.overridableProperties.push(o);const d=this.defaultPropertyValues[o]=new Ae(l,void 0),m=this.defaultTransitionablePropertyValues[o]=new Ie(l);this.defaultTransitioningPropertyValues[o]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=d.possiblyEvaluate({})}}}function on(s,e){return 256*(s=Je(Math.floor(s),0,255))+Je(Math.floor(e),0,255)}yn("DataDrivenProperty",pt),yn("DataConstantProperty",Fe),yn("CrossFadedDataDrivenProperty",Rt),yn("CrossFadedProperty",Ut),yn("ColorRampProperty",dt);const Cn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vn{constructor(e,o){this._structArray=e,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,o){return e._trim(),o&&(e.isTransferred=!0,o.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const o=Object.create(this.prototype);return o.arrayBuffer=e.arrayBuffer,o.length=e.length,o.capacity=e.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Dn(s,e=1){let o=0,l=0;return{members:s.map(d=>{const m=Cn[d.type].BYTES_PER_ELEMENT,_=o=Er(o,Math.max(e,m)),E=d.components||1;return l=Math.max(l,m),o+=m*E,{name:d.name,type:d.type,components:E,offset:_}}),size:Er(o,Math.max(l,e)),alignment:e}}function Er(s,e){return Math.ceil(s/e)*e}class Qn extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const d=2*e;return this.int16[d+0]=o,this.int16[d+1]=l,e}}Qn.prototype.bytesPerElement=4,yn("StructArrayLayout2i4",Qn);class zi extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,l,d)}emplace(e,o,l,d,m){const _=4*e;return this.int16[_+0]=o,this.int16[_+1]=l,this.int16[_+2]=d,this.int16[_+3]=m,e}}zi.prototype.bytesPerElement=8,yn("StructArrayLayout4i8",zi);class wi extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,_,E){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,l,d,m,_,E)}emplace(e,o,l,d,m,_,E,T){const O=6*e,U=12*e,W=3*e;return this.int16[O+0]=o,this.int16[O+1]=l,this.uint8[U+4]=d,this.uint8[U+5]=m,this.uint8[U+6]=_,this.uint8[U+7]=E,this.float32[W+2]=T,e}}wi.prototype.bytesPerElement=12,yn("StructArrayLayout2i4ub1f12",wi);class _r extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,l)}emplace(e,o,l,d){const m=3*e;return this.float32[m+0]=o,this.float32[m+1]=l,this.float32[m+2]=d,e}}_r.prototype.bytesPerElement=12,yn("StructArrayLayout3f12",_r);class fr extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,_,E,T,O,U){const W=this.length;return this.resize(W+1),this.emplace(W,e,o,l,d,m,_,E,T,O,U)}emplace(e,o,l,d,m,_,E,T,O,U,W){const Y=10*e;return this.uint16[Y+0]=o,this.uint16[Y+1]=l,this.uint16[Y+2]=d,this.uint16[Y+3]=m,this.uint16[Y+4]=_,this.uint16[Y+5]=E,this.uint16[Y+6]=T,this.uint16[Y+7]=O,this.uint16[Y+8]=U,this.uint16[Y+9]=W,e}}fr.prototype.bytesPerElement=20,yn("StructArrayLayout10ui20",fr);class yi extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,_,E,T){const O=this.length;return this.resize(O+1),this.emplace(O,e,o,l,d,m,_,E,T)}emplace(e,o,l,d,m,_,E,T,O){const U=8*e;return this.uint16[U+0]=o,this.uint16[U+1]=l,this.uint16[U+2]=d,this.uint16[U+3]=m,this.uint16[U+4]=_,this.uint16[U+5]=E,this.uint16[U+6]=T,this.uint16[U+7]=O,e}}yi.prototype.bytesPerElement=16,yn("StructArrayLayout8ui16",yi);class Qs extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le){const Ke=this.length;return this.resize(Ke+1),this.emplace(Ke,e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le)}emplace(e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le,Ke){const ot=16*e;return this.int16[ot+0]=o,this.int16[ot+1]=l,this.int16[ot+2]=d,this.int16[ot+3]=m,this.uint16[ot+4]=_,this.uint16[ot+5]=E,this.uint16[ot+6]=T,this.uint16[ot+7]=O,this.int16[ot+8]=U,this.int16[ot+9]=W,this.int16[ot+10]=Y,this.int16[ot+11]=ie,this.int16[ot+12]=ye,this.int16[ot+13]=Ee,this.int16[ot+14]=Le,this.int16[ot+15]=Ke,e}}Qs.prototype.bytesPerElement=32,yn("StructArrayLayout4i4ui4i4i32",Qs);class Ba extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint32[1*e+0]=o,e}}Ba.prototype.bytesPerElement=4,yn("StructArrayLayout1ul4",Ba);class is extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,_,E,T,O,U,W,Y,ie){const ye=this.length;return this.resize(ye+1),this.emplace(ye,e,o,l,d,m,_,E,T,O,U,W,Y,ie)}emplace(e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye){const Ee=20*e,Le=10*e;return this.int16[Ee+0]=o,this.int16[Ee+1]=l,this.int16[Ee+2]=d,this.int16[Ee+3]=m,this.int16[Ee+4]=_,this.float32[Le+3]=E,this.float32[Le+4]=T,this.float32[Le+5]=O,this.float32[Le+6]=U,this.int16[Ee+14]=W,this.uint32[Le+8]=Y,this.uint16[Ee+18]=ie,this.uint16[Ee+19]=ye,e}}is.prototype.bytesPerElement=40,yn("StructArrayLayout5i4f1i1ul2ui40",is);class Vs extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,_,E){const T=this.length;return this.resize(T+1),this.emplace(T,e,o,l,d,m,_,E)}emplace(e,o,l,d,m,_,E,T){const O=8*e;return this.int16[O+0]=o,this.int16[O+1]=l,this.int16[O+2]=d,this.int16[O+4]=m,this.int16[O+5]=_,this.int16[O+6]=E,this.int16[O+7]=T,e}}Vs.prototype.bytesPerElement=16,yn("StructArrayLayout3i2i2i16",Vs);class Js extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,l,d,m)}emplace(e,o,l,d,m,_){const E=4*e,T=8*e;return this.float32[E+0]=o,this.float32[E+1]=l,this.float32[E+2]=d,this.int16[T+6]=m,this.int16[T+7]=_,e}}Js.prototype.bytesPerElement=16,yn("StructArrayLayout2f1f2i16",Js);class Va extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,l,d)}emplace(e,o,l,d,m){const _=12*e,E=3*e;return this.uint8[_+0]=o,this.uint8[_+1]=l,this.float32[E+1]=d,this.float32[E+2]=m,e}}Va.prototype.bytesPerElement=12,yn("StructArrayLayout2ub2f12",Va);class ai extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,l)}emplace(e,o,l,d){const m=3*e;return this.uint16[m+0]=o,this.uint16[m+1]=l,this.uint16[m+2]=d,e}}ai.prototype.bytesPerElement=6,yn("StructArrayLayout3ui6",ai);class Ii extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le,Ke,ot,xt,ut,bt){const Et=this.length;return this.resize(Et+1),this.emplace(Et,e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le,Ke,ot,xt,ut,bt)}emplace(e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le,Ke,ot,xt,ut,bt,Et){const kt=30*e,Kt=15*e,nn=60*e;return this.int16[kt+0]=o,this.int16[kt+1]=l,this.int16[kt+2]=d,this.float32[Kt+2]=m,this.float32[Kt+3]=_,this.uint16[kt+8]=E,this.uint16[kt+9]=T,this.uint32[Kt+5]=O,this.uint32[Kt+6]=U,this.uint32[Kt+7]=W,this.uint16[kt+16]=Y,this.uint16[kt+17]=ie,this.uint16[kt+18]=ye,this.float32[Kt+10]=Ee,this.float32[Kt+11]=Le,this.uint8[nn+48]=Ke,this.uint8[nn+49]=ot,this.uint8[nn+50]=xt,this.uint32[Kt+13]=ut,this.int16[kt+28]=bt,this.uint8[nn+58]=Et,e}}Ii.prototype.bytesPerElement=60,yn("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",Ii);class L extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le,Ke,ot,xt,ut,bt,Et,kt,Kt,nn,dn,Vt,Yt,fn,$t){const qn=this.length;return this.resize(qn+1),this.emplace(qn,e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le,Ke,ot,xt,ut,bt,Et,kt,Kt,nn,dn,Vt,Yt,fn,$t)}emplace(e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee,Le,Ke,ot,xt,ut,bt,Et,kt,Kt,nn,dn,Vt,Yt,fn,$t,qn){const Sn=38*e,Xr=19*e;return this.int16[Sn+0]=o,this.int16[Sn+1]=l,this.int16[Sn+2]=d,this.float32[Xr+2]=m,this.float32[Xr+3]=_,this.int16[Sn+8]=E,this.int16[Sn+9]=T,this.int16[Sn+10]=O,this.int16[Sn+11]=U,this.int16[Sn+12]=W,this.int16[Sn+13]=Y,this.uint16[Sn+14]=ie,this.uint16[Sn+15]=ye,this.uint16[Sn+16]=Ee,this.uint16[Sn+17]=Le,this.uint16[Sn+18]=Ke,this.uint16[Sn+19]=ot,this.uint16[Sn+20]=xt,this.uint16[Sn+21]=ut,this.uint16[Sn+22]=bt,this.uint16[Sn+23]=Et,this.uint16[Sn+24]=kt,this.uint16[Sn+25]=Kt,this.uint16[Sn+26]=nn,this.uint16[Sn+27]=dn,this.uint16[Sn+28]=Vt,this.uint32[Xr+15]=Yt,this.float32[Xr+16]=fn,this.float32[Xr+17]=$t,this.float32[Xr+18]=qn,e}}L.prototype.bytesPerElement=76,yn("StructArrayLayout3i2f6i15ui1ul3f76",L);class y extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.float32[1*e+0]=o,e}}y.prototype.bytesPerElement=4,yn("StructArrayLayout1f4",y);class v extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,o,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,o,l)}emplace(e,o,l,d){const m=3*e;return this.int16[m+0]=o,this.int16[m+1]=l,this.int16[m+2]=d,e}}v.prototype.bytesPerElement=6,yn("StructArrayLayout3i6",v);class I extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,l,d)}emplace(e,o,l,d,m){const _=6*e;return this.uint32[3*e+0]=o,this.uint16[_+2]=l,this.uint16[_+3]=d,this.uint16[_+4]=m,e}}I.prototype.bytesPerElement=12,yn("StructArrayLayout1ul3ui12",I);class X extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const d=2*e;return this.uint16[d+0]=o,this.uint16[d+1]=l,e}}X.prototype.bytesPerElement=4,yn("StructArrayLayout2ui4",X);class fe extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const o=this.length;return this.resize(o+1),this.emplace(o,e)}emplace(e,o){return this.uint16[1*e+0]=o,e}}fe.prototype.bytesPerElement=2,yn("StructArrayLayout1ui2",fe);class Te extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,d,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,o,l,d,m)}emplace(e,o,l,d,m,_){const E=5*e;return this.float32[E+0]=o,this.float32[E+1]=l,this.float32[E+2]=d,this.float32[E+3]=m,this.float32[E+4]=_,e}}Te.prototype.bytesPerElement=20,yn("StructArrayLayout5f20",Te);class je extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,o)}emplace(e,o,l){const d=2*e;return this.float32[d+0]=o,this.float32[d+1]=l,e}}je.prototype.bytesPerElement=8,yn("StructArrayLayout2f8",je);class vt extends rn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,o,l,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,o,l,d)}emplace(e,o,l,d,m){const _=4*e;return this.float32[_+0]=o,this.float32[_+1]=l,this.float32[_+2]=d,this.float32[_+3]=m,e}}vt.prototype.bytesPerElement=16,yn("StructArrayLayout4f16",vt);class Ft extends vn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ft.prototype.size=40;class un extends is{get(e){return new Ft(this,e)}}yn("CollisionBoxArray",un);class Fn extends vn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Fn.prototype.size=60;class or extends Ii{get(e){return new Fn(this,e)}}yn("PlacedSymbolArray",or);class Ir extends vn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Ir.prototype.size=76;class rr extends L{get(e){return new Ir(this,e)}}yn("SymbolInstanceArray",rr);class cr extends y{getoffsetX(e){return this.float32[1*e+0]}}yn("GlyphOffsetArray",cr);class Cr extends v{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}yn("SymbolLineVertexArray",Cr);class Pi extends vn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Pi.prototype.size=12;class vi extends I{get(e){return new Pi(this,e)}}yn("FeatureIndexArray",vi);class fo extends vn{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}fo.prototype.size=4;class Ls extends X{get(e){return new fo(this,e)}}yn("FillExtrusionCentroidArray",Ls);const ec=Dn([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),ia=Dn([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var eo=Ti(function(s){s.exports=function(e,o){var l,d,m,_,E,T,O,U;for(d=e.length-(l=3&e.length),m=o,E=3432918353,T=461845907,U=0;U<d;)O=255&e.charCodeAt(U)|(255&e.charCodeAt(++U))<<8|(255&e.charCodeAt(++U))<<16|(255&e.charCodeAt(++U))<<24,++U,m=27492+(65535&(_=5*(65535&(m=(m^=O=(65535&(O=(O=(65535&O)*E+(((O>>>16)*E&65535)<<16)&4294967295)<<15|O>>>17))*T+(((O>>>16)*T&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(O=0,l){case 3:O^=(255&e.charCodeAt(U+2))<<16;case 2:O^=(255&e.charCodeAt(U+1))<<8;case 1:m^=O=(65535&(O=(O=(65535&(O^=255&e.charCodeAt(U)))*E+(((O>>>16)*E&65535)<<16)&4294967295)<<15|O>>>17))*T+(((O>>>16)*T&65535)<<16)&4294967295}return m^=e.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),Pl=Ti(function(s){s.exports=function(e,o){for(var l,d=e.length,m=o^d,_=0;d>=4;)l=1540483477*(65535&(l=255&e.charCodeAt(_)|(255&e.charCodeAt(++_))<<8|(255&e.charCodeAt(++_))<<16|(255&e.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++_;switch(d){case 3:m^=(255&e.charCodeAt(_+2))<<16;case 2:m^=(255&e.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&e.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),sa=eo,Vo=Pl;sa.murmur3=eo,sa.murmur2=Vo;class Rl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,o,l,d){this.ids.push(zc(e)),this.positions.push(o,l,d)}getPositions(e){const o=zc(e);let l=0,d=this.ids.length-1;for(;l<d;){const _=l+d>>1;this.ids[_]>=o?d=_:l=_+1}const m=[];for(;this.ids[l]===o;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(e,o){const l=new Float64Array(e.ids),d=new Uint32Array(e.positions);return tc(l,d,0,l.length-1),o&&o.push(l.buffer,d.buffer),{ids:l,positions:d}}static deserialize(e){const o=new Rl;return o.ids=e.ids,o.positions=e.positions,o.indexed=!0,o}}function zc(s){const e=+s;return!isNaN(e)&&e<=Ue?e:sa(String(s))}function tc(s,e,o,l){for(;o<l;){const d=s[o+l>>1];let m=o-1,_=l+1;for(;;){do{m++}while(s[m]<d);do{_--}while(s[_]>d);if(m>=_)break;Bc(s,m,_),Bc(e,3*m,3*_),Bc(e,3*m+1,3*_+1),Bc(e,3*m+2,3*_+2)}_-o<l-_?(tc(s,e,o,_),o=_+1):(tc(s,e,_+1,l),l=_)}}function Bc(s,e,o){const l=s[e];s[e]=s[o],s[o]=l}yn("FeaturePositionMap",Rl);class kl{constructor(e,o){this.gl=e.gl,this.location=o}}class Ln extends kl{constructor(e,o){super(e,o),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Kn extends kl{constructor(e,o){super(e,o),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class br extends kl{constructor(e,o){super(e,o),this.current=$n.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Kr=new Float32Array(16),ys=new Float32Array(9);function Uo(s){return[on(255*s.r,255*s.g),on(255*s.b,255*s.a)]}class ss{constructor(e,o,l){this.value=e,this.uniformNames=o.map(d=>`u_${d}`),this.type=l}setUniform(e,o,l){e.set(l.constantOr(this.value))}getBinding(e,o,l){return"color"===this.type?new br(e,o):new Ln(e,o)}}class oa{constructor(e,o){this.uniformNames=o.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=o.tl.concat(o.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,o,l,d){const m="u_pattern_to"===d||"u_dash_to"===d?this.patternTo:"u_pattern_from"===d||"u_dash_from"===d?this.patternFrom:"u_pixel_ratio_to"===d?this.pixelRatioTo:"u_pixel_ratio_from"===d?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,o,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new Kn(e,o):new Ln(e,o)}}class pi{constructor(e,o,l,d){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=o.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,o,l,d,m){const _=this.paintVertexArray.length,E=this.expression.evaluate(new pe(0),o,{},d,[],m);this.paintVertexArray.resize(e),this._setPaintValue(_,e,E)}updatePaintArray(e,o,l,d){const m=this.expression.evaluate({zoom:0},l,d);this._setPaintValue(e,o,m)}_setPaintValue(e,o,l){if("color"===this.type){const d=Uo(l);for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=e;d<o;d++)this.paintVertexArray.emplace(d,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ll{constructor(e,o,l,d,m,_){this.expression=e,this.uniformNames=o.map(E=>`u_${E}_t`),this.type=l,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=o.map(E=>({name:`a_${E}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,o,l,d,m){const _=this.expression.evaluate(new pe(this.zoom),o,{},d,[],m),E=this.expression.evaluate(new pe(this.zoom+1),o,{},d,[],m),T=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(T,e,_,E)}updatePaintArray(e,o,l,d){const m=this.expression.evaluate({zoom:this.zoom},l,d),_=this.expression.evaluate({zoom:this.zoom+1},l,d);this._setPaintValue(e,o,m,_)}_setPaintValue(e,o,l,d){if("color"===this.type){const m=Uo(l),_=Uo(d);for(let E=e;E<o;E++)this.paintVertexArray.emplace(E,m[0],m[1],_[0],_[1])}else{for(let m=e;m<o;m++)this.paintVertexArray.emplace(m,l,d);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,o){const l=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,d=Je(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,o,l){return new Ln(e,o)}}class As{constructor(e,o,l,d,m,_,E){this.expression=e,this.type=l,this.useIntegerZoom=d,this.zoom=m,this.layerId=E,this.paintVertexAttributes=("array"===l?ia:ec).members;for(let T=0;T<o.length;++T);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(e,o,l){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,o.patterns&&o.patterns[this.layerId],l)}updatePaintArray(e,o,l,d,m){this._setPaintValues(e,o,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(e,o,l,d){if(!d||!l)return;const{min:m,mid:_,max:E}=l,T=d[m],O=d[_],U=d[E];if(T&&O&&U)for(let W=e;W<o;W++)this._setPaintValue(this.zoomInPaintVertexArray,W,O,T),this._setPaintValue(this.zoomOutPaintVertexArray,W,O,U)}_setPaintValue(e,o,l,d){e.emplace(o,l.tl[0],l.tl[1],l.br[0],l.br[1],d.tl[0],d.tl[1],d.br[0],d.br[1],l.pixelRatio,d.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class wo{constructor(e,o,l=(()=>!0)){this.binders={},this._buffers=[];const d=[];for(const m in e.paint._values){if(!l(m))continue;const _=e.paint.get(m);if(!(_ instanceof We&&ns(_.property.specification)))continue;const E=gu(m,e.type),T=_.value,O=_.property.specification.type,U=_.property.useIntegerZoom,W=_.property.specification["property-type"],Y="cross-faded"===W||"cross-faded-data-driven"===W,ie="line-dasharray"===String(m)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==T.kind||ie)if("source"===T.kind||ie||Y){const ye=Xf(m,O,"source");this.binders[m]=Y?new As(T,E,O,U,o,ye,e.id):new pi(T,E,O,ye),d.push(`/a_${m}`)}else{const ye=Xf(m,O,"composite");this.binders[m]=new ll(T,E,O,U,o,ye),d.push(`/z_${m}`)}else this.binders[m]=Y?new oa(T.value,E):new ss(T.value,E,O),d.push(`/u_${m}`)}this.cacheKey=d.sort().join("")}getMaxValue(e){const o=this.binders[e];return o instanceof pi||o instanceof ll?o.maxValue:0}populatePaintArrays(e,o,l,d,m){for(const _ in this.binders){const E=this.binders[_];(E instanceof pi||E instanceof ll||E instanceof As)&&E.populatePaintArray(e,o,l,d,m)}}setConstantPatternPositions(e,o){for(const l in this.binders){const d=this.binders[l];d instanceof oa&&d.setConstantPatternPositions(e,o)}}updatePaintArrays(e,o,l,d,m){let _=!1;for(const E in e){const T=o.getPositions(E);for(const O of T){const U=l.feature(O.index);for(const W in this.binders){const Y=this.binders[W];if((Y instanceof pi||Y instanceof ll||Y instanceof As)&&!0===Y.expression.isStateDependent){const ie=d.paint.get(W);Y.expression=ie.value,Y.updatePaintArray(O.start,O.end,U,e[E],m),_=!0}}}}return _}defines(){const e=[];for(const o in this.binders){const l=this.binders[o];(l instanceof ss||l instanceof oa)&&e.push(...l.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof pi||l instanceof ll||l instanceof As)for(let d=0;d<l.paintVertexAttributes.length;d++)e.push(l.paintVertexAttributes[d].name)}return e}getBinderUniforms(){const e=[];for(const o in this.binders){const l=this.binders[o];if(l instanceof ss||l instanceof oa||l instanceof ll)for(const d of l.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,o){const l=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof ss||m instanceof oa||m instanceof ll)for(const _ of m.uniformNames)if(o[_]){const E=m.getBinding(e,o[_],_);l.push({name:_,property:d,binding:E})}}return l}setUniforms(e,o,l,d){for(const{name:m,property:_,binding:E}of o)this.binders[_].setUniform(E,d,l.get(_),m)}updatePaintBuffers(e){this._buffers=[];for(const o in this.binders){const l=this.binders[o];if(e&&l instanceof As){const d=2===e.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(l instanceof pi||l instanceof ll)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const o in this.binders){const l=this.binders[o];(l instanceof pi||l instanceof ll||l instanceof As)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const o=this.binders[e];(o instanceof pi||o instanceof ll||o instanceof As)&&o.destroy()}}}class Ua{constructor(e,o,l=(()=>!0)){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new wo(d,o,l);this.needsUpload=!1,this._featureMap=new Rl,this._bufferOffset=0}populatePaintArrays(e,o,l,d,m,_){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,o,d,m,_);void 0!==o.id&&this._featureMap.add(o.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,o,l,d){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,o,m,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const nc={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function gu(s,e){return nc[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const nu={"line-pattern":{source:fr,composite:fr},"fill-pattern":{source:fr,composite:fr},"fill-extrusion-pattern":{source:fr,composite:fr},"line-dasharray":{source:yi,composite:yi}},Wm={color:{source:je,composite:vt},number:{source:y,composite:je}};function Xf(s,e,o){const l=nu[s];return l&&l[o]||Wm[e][o]}yn("ConstantBinder",ss),yn("CrossFadedConstantBinder",oa),yn("SourceExpressionBinder",pi),yn("CrossFadedCompositeBinder",As),yn("CompositeExpressionBinder",ll),yn("ProgramConfiguration",wo,{omit:["_buffers"]}),yn("ProgramConfigurationSet",Ua);const ih="-transition";class Ol extends sn{constructor(e,o){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),o.layout&&(this._unevaluatedLayout=new $e(o.layout)),o.paint)){this._transitionablePaint=new qe(o.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new it(o.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,o,l={}){null!=o&&this._validate(Fs,`layers.${this.id}.layout.${e}`,e,o,l)||("visibility"!==e?this._unevaluatedLayout.setValue(e,o):this.visibility=o)}getPaintProperty(e){return tt(e,ih)?this._transitionablePaint.getTransition(e.slice(0,-ih.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,o,l={}){if(null!=o&&this._validate(ya,`layers.${this.id}.paint.${e}`,e,o,l))return!1;if(tt(e,ih))return this._transitionablePaint.setTransition(e.slice(0,-ih.length),o||void 0),!1;{const d=this._transitionablePaint._values[e],m="cross-faded-data-driven"===d.property.specification["property-type"],_=d.value.isDataDriven(),E=d.value;this._transitionablePaint.setValue(e,o),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value;return T.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(e,E,T)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,o,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,o){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,o)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),gt(e,(o,l)=>!(void 0===o||"layout"===l&&!Object.keys(o).length||"paint"===l&&!Object.keys(o).length))}_validate(e,o,l,d,m={}){return(!m||!1!==m.validate)&&ea(this,e.call(Jo,{key:o,layerType:this.type,objectKey:l,value:d,styleSpec:He,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const o=this.paint.get(e);if(o instanceof We&&ns(o.property.specification)&&("source"===o.value.kind||"composite"===o.value.kind)&&o.value.isStateDependent)return!0}return!1}}const Ym=Dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:wc}=Ym;class Ms{constructor(e=[]){this.segments=e}prepareSegment(e,o,l,d){let m=this.segments[this.segments.length-1];return e>Ms.MAX_VERTEX_ARRAY_LENGTH&&bn(`Max vertices per segment is ${Ms.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>Ms.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:o.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==d&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const o in e.vaos)e.vaos[o].destroy()}static simpleSegment(e,o,l,d){return new Ms([{vertexOffset:e,primitiveOffset:o,vertexLength:l,primitiveLength:d,vaos:{},sortKey:0}])}}Ms.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yn("SegmentVector",Ms);var ti=8192;const _d=Math.pow(2,14)-1,Qf=-_d-1;function ru(s){const e=ti/s.extent,o=s.loadGeometry();for(let l=0;l<o.length;l++){const d=o[l];for(let m=0;m<d.length;m++){const _=d[m],E=Math.round(_.x*e),T=Math.round(_.y*e);_.x=Je(E,Qf,_d),_.y=Je(T,Qf,_d),(E<_.x||E>_.x+1||T<_.y||T>_.y+1)&&bn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return o}function iu(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?ru(s):[]}}function sh(s,e,o,l,d){s.emplaceBack(2*e+(l+1)/2,2*o+(d+1)/2)}class oh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Qn,this.indexArray=new ai,this.segments=new Ms,this.programConfigurations=new Ua(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l){const d=this.layers[0],m=[];let _=null;"circle"===d.type&&(_=d.layout.get("circle-sort-key"));for(const{feature:E,id:T,index:O,sourceLayerIndex:U}of e){const W=this.layers[0]._featureFilter.needGeometry,Y=iu(E,W);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),Y,l))continue;const ie=_?_.evaluate(Y,{},l):void 0,ye={id:T,properties:E.properties,type:E.type,sourceLayerIndex:U,index:O,geometry:W?Y.geometry:ru(E),patterns:{},sortKey:ie};m.push(ye)}_&&m.sort((E,T)=>E.sortKey-T.sortKey);for(const E of m){const{geometry:T,index:O,sourceLayerIndex:U}=E,W=e[O].feature;this.addFeature(E,T,O,l),o.featureIndex.insert(W,T,O,U,this.index)}}update(e,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,l,d){for(const m of o)for(const _ of m){const E=_.x,T=_.y;if(E<0||E>=ti||T<0||T>=ti)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),U=O.vertexLength;sh(this.layoutVertexArray,E,T,-1,-1),sh(this.layoutVertexArray,E,T,1,-1),sh(this.layoutVertexArray,E,T,1,1),sh(this.layoutVertexArray,E,T,-1,1),this.indexArray.emplaceBack(U,U+1,U+2),this.indexArray.emplaceBack(U,U+3,U+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},d)}}function Jf(s,e){for(let o=0;o<s.length;o++)if(rc(e,s[o]))return!0;for(let o=0;o<e.length;o++)if(rc(s,e[o]))return!0;return!!tp(s,e)}function Km(s,e,o){return!!rc(s,e)||!!su(e,s,o)}function ep(s,e){if(1===s.length)return Fl(e,s[0]);for(let o=0;o<e.length;o++){const l=e[o];for(let d=0;d<l.length;d++)if(rc(s,l[d]))return!0}for(let o=0;o<s.length;o++)if(Fl(e,s[o]))return!0;for(let o=0;o<e.length;o++)if(tp(s,e[o]))return!0;return!1}function Xm(s,e,o){if(s.length>1){if(tp(s,e))return!0;for(let l=0;l<e.length;l++)if(su(e[l],s,o))return!0}for(let l=0;l<s.length;l++)if(su(s[l],e,o))return!0;return!1}function tp(s,e){if(0===s.length||0===e.length)return!1;for(let o=0;o<s.length-1;o++){const l=s[o],d=s[o+1];for(let m=0;m<e.length-1;m++)if(Qm(l,d,e[m],e[m+1]))return!0}return!1}function Qm(s,e,o,l){return Pn(s,o,l)!==Pn(e,o,l)&&Pn(s,e,o)!==Pn(s,e,l)}function su(s,e,o){const l=o*o;if(1===e.length)return s.distSqr(e[0])<l;for(let d=1;d<e.length;d++)if(yd(s,e[d-1],e[d])<l)return!0;return!1}function yd(s,e,o){const l=e.distSqr(o);if(0===l)return s.distSqr(e);const d=((s.x-e.x)*(o.x-e.x)+(s.y-e.y)*(o.y-e.y))/l;return s.distSqr(d<0?e:d>1?o:o.sub(e)._mult(d)._add(e))}function Fl(s,e){let o,l,d,m=!1;for(let _=0;_<s.length;_++){o=s[_];for(let E=0,T=o.length-1;E<o.length;T=E++)l=o[E],d=o[T],l.y>e.y!=d.y>e.y&&e.x<(d.x-l.x)*(e.y-l.y)/(d.y-l.y)+l.x&&(m=!m)}return m}function rc(s,e){let o=!1;for(let l=0,d=s.length-1;l<s.length;d=l++){const m=s[l],_=s[d];m.y>e.y!=_.y>e.y&&e.x<(_.x-m.x)*(e.y-m.y)/(_.y-m.y)+m.x&&(o=!o)}return o}function vd(s,e,o,l,d){for(const _ of s)if(e<=_.x&&o<=_.y&&l>=_.x&&d>=_.y)return!0;const m=[new ce(e,o),new ce(e,d),new ce(l,d),new ce(l,o)];if(s.length>2)for(const _ of m)if(rc(s,_))return!0;for(let _=0;_<s.length-1;_++)if(np(s[_],s[_+1],m))return!0;return!1}function np(s,e,o){const l=o[0],d=o[2];if(s.x<l.x&&e.x<l.x||s.x>d.x&&e.x>d.x||s.y<l.y&&e.y<l.y||s.y>d.y&&e.y>d.y)return!1;const m=Pn(s,e,o[0]);return m!==Pn(s,e,o[1])||m!==Pn(s,e,o[2])||m!==Pn(s,e,o[3])}function ou(s,e,o){const l=e.paint.get(s).value;return"constant"===l.kind?l.value:o.programConfigurations.get(e.id).getMaxValue(s)}function xd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Jm(s,e,o,l,d){if(!e[0]&&!e[1])return s;const m=ce.convert(e)._mult(d);"viewport"===o&&m._rotate(-l);const _=[];for(let E=0;E<s.length;E++)_.push(s[E].sub(m));return _}function eg(s,e,o,l){const d=ce.convert(s)._mult(l);return"viewport"===e&&d._rotate(-o),d}yn("CircleBucket",oh,{omit:["layers"]});const bd=new At({"circle-sort-key":new pt(He.layout_circle["circle-sort-key"])});var wd={paint:new At({"circle-radius":new pt(He.paint_circle["circle-radius"]),"circle-color":new pt(He.paint_circle["circle-color"]),"circle-blur":new pt(He.paint_circle["circle-blur"]),"circle-opacity":new pt(He.paint_circle["circle-opacity"]),"circle-translate":new Fe(He.paint_circle["circle-translate"]),"circle-translate-anchor":new Fe(He.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Fe(He.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Fe(He.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pt(He.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pt(He.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pt(He.paint_circle["circle-stroke-opacity"])}),layout:bd},jo="undefined"!=typeof Float32Array?Float32Array:Array;function tg(){var s=new jo(9);return jo!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function rp(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Ed(s,e,o){var l=e[0],d=e[1],m=e[2],_=e[3],E=e[4],T=e[5],O=e[6],U=e[7],W=e[8],Y=e[9],ie=e[10],ye=e[11],Ee=e[12],Le=e[13],Ke=e[14],ot=e[15],xt=o[0],ut=o[1],bt=o[2],Et=o[3];return s[0]=xt*l+ut*E+bt*W+Et*Ee,s[1]=xt*d+ut*T+bt*Y+Et*Le,s[2]=xt*m+ut*O+bt*ie+Et*Ke,s[3]=xt*_+ut*U+bt*ye+Et*ot,s[4]=(xt=o[4])*l+(ut=o[5])*E+(bt=o[6])*W+(Et=o[7])*Ee,s[5]=xt*d+ut*T+bt*Y+Et*Le,s[6]=xt*m+ut*O+bt*ie+Et*Ke,s[7]=xt*_+ut*U+bt*ye+Et*ot,s[8]=(xt=o[8])*l+(ut=o[9])*E+(bt=o[10])*W+(Et=o[11])*Ee,s[9]=xt*d+ut*T+bt*Y+Et*Le,s[10]=xt*m+ut*O+bt*ie+Et*Ke,s[11]=xt*_+ut*U+bt*ye+Et*ot,s[12]=(xt=o[12])*l+(ut=o[13])*E+(bt=o[14])*W+(Et=o[15])*Ee,s[13]=xt*d+ut*T+bt*Y+Et*Le,s[14]=xt*m+ut*O+bt*ie+Et*Ke,s[15]=xt*_+ut*U+bt*ye+Et*ot,s}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)});var ng=Ed;function ah(){var s=new jo(3);return jo!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function ip(s){return Math.hypot(s[0],s[1],s[2])}function _u(s,e,o){var l=new jo(3);return l[0]=s,l[1]=e,l[2]=o,l}function Cd(s,e,o){return s[0]=e[0]-o[0],s[1]=e[1]-o[1],s[2]=e[2]-o[2],s}function Pu(s,e,o){return s[0]=e[0]*o[0],s[1]=e[1]*o[1],s[2]=e[2]*o[2],s}function Td(s,e,o,l){return s[0]=e[0]+o[0]*l,s[1]=e[1]+o[1]*l,s[2]=e[2]+o[2]*l,s}function lh(s,e){var o=e[0],l=e[1],d=e[2],m=o*o+l*l+d*d;return m>0&&(m=1/Math.sqrt(m)),s[0]=e[0]*m,s[1]=e[1]*m,s[2]=e[2]*m,s}function sp(s,e,o){var l=o[0],d=o[1],m=o[2],_=e[0],E=e[1],T=e[2],O=d*T-m*E,U=m*_-l*T,W=l*E-d*_,Y=d*W-m*U,ie=m*O-l*W,ye=l*U-d*O,Ee=2*o[3];return U*=Ee,W*=Ee,ie*=2,ye*=2,s[0]=_+(O*=Ee)+(Y*=2),s[1]=E+U+ie,s[2]=T+W+ye,s}var Zi,rg=Cd,ig=Pu,Sd=ip;function yu(s,e,o){var l=e[0],d=e[1],m=e[2],_=e[3];return s[0]=o[0]*l+o[4]*d+o[8]*m+o[12]*_,s[1]=o[1]*l+o[5]*d+o[9]*m+o[13]*_,s[2]=o[2]*l+o[6]*d+o[10]*m+o[14]*_,s[3]=o[3]*l+o[7]*d+o[11]*m+o[15]*_,s}function Dd(){var s=new jo(4);return jo!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function op(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function ap(s,e,o){o*=.5;var l=e[0],d=e[1],m=e[2],_=e[3],E=Math.sin(o),T=Math.cos(o);return s[0]=l*T+_*E,s[1]=d*T+m*E,s[2]=m*T-d*E,s[3]=_*T-l*E,s}function lp(s,e,o,l,d,m,_,E,T){if(m&&s.queryGeometry.isAboveHorizon)return!1;m&&(T*=s.pixelToTileUnitsFactor);for(const O of e)for(const U of O){const W=U.add(E),Y=d&&o.elevation?o.elevation.exaggeration()*d.getElevationAt(W.x,W.y,!0):0,ie=m?W:sg(W,Y,l),ye=m?s.tilespaceRays.map(Le=>Ru(Le,Y)):s.queryGeometry.screenGeometry,Ee=yu([],[U.x,U.y,Y,1],l);if(!_&&m?T*=Ee[3]/o.cameraToCenterDistance:_&&!m&&(T*=o.cameraToCenterDistance/Ee[3]),Km(ye,ie,T))return!0}return!1}function sg(s,e,o){const l=yu([],[s.x,s.y,e,1],o);return new ce(l[0]/l[3],l[1]/l[3])}ah(),Zi=new jo(4),jo!=Float32Array&&(Zi[0]=0,Zi[1]=0,Zi[2]=0,Zi[3]=0),ah(),_u(1,0,0),_u(0,1,0),Dd(),Dd(),tg();const og=_u(0,0,0),Sy=_u(0,0,1);function Ru(s,e){const o=ah();return og[2]=e,s.intersectsPlane(og,Sy,o),new ce(o[0],o[1])}class $o extends oh{}function ku(s,{width:e,height:o},l,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*o*l)throw new RangeError("mismatched image size")}else d=new Uint8Array(e*o*l);return s.width=e,s.height=o,s.data=d,s}function Ad(s,{width:e,height:o},l){if(e===s.width&&o===s.height)return;const d=ku({},{width:e,height:o},l);ch(s,d,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,e),height:Math.min(s.height,o)},l),s.width=e,s.height=o,s.data=d.data}function ch(s,e,o,l,d,m){if(0===d.width||0===d.height)return e;if(d.width>s.width||d.height>s.height||o.x>s.width-d.width||o.y>s.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||l.x>e.width-d.width||l.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const _=s.data,E=e.data;for(let T=0;T<d.height;T++){const O=((o.y+T)*s.width+o.x)*m,U=((l.y+T)*e.width+l.x)*m;for(let W=0;W<d.width*m;W++)E[U+W]=_[O+W]}return e}yn("HeatmapBucket",$o,{omit:["layers"]});class vs{constructor(e,o){ku(this,e,1,o)}resize(e){Ad(this,e,1)}clone(){return new vs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,l,d,m){ch(e,o,l,d,m,1)}}class Eo{constructor(e,o){ku(this,e,4,o)}resize(e){Ad(this,e,4)}replace(e,o){o?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Eo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,o,l,d,m){ch(e,o,l,d,m,4)}}yn("AlphaImage",vs),yn("RGBAImage",Eo);var Md={paint:new At({"heatmap-radius":new pt(He.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pt(He.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Fe(He.paint_heatmap["heatmap-intensity"]),"heatmap-color":new dt(He.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Fe(He.paint_heatmap["heatmap-opacity"])})};function Id(s){const e={},o=s.resolution||256,l=s.clips?s.clips.length:1,d=s.image||new Eo({width:o,height:l}),m=(_,E,T)=>{e[s.evaluationKey]=T;const O=s.expression.evaluate(e);d.data[_+E+0]=Math.floor(255*O.r/O.a),d.data[_+E+1]=Math.floor(255*O.g/O.a),d.data[_+E+2]=Math.floor(255*O.b/O.a),d.data[_+E+3]=Math.floor(255*O.a)};if(s.clips)for(let _=0,E=0;_<l;++_,E+=4*o)for(let T=0,O=0;T<o;T++,O+=4){const U=T/(o-1),{start:W,end:Y}=s.clips[_];m(E,O,W*(1-U)+Y*U)}else for(let _=0,E=0;_<o;_++,E+=4)m(0,E,_/(o-1));return d}var ag={paint:new At({"hillshade-illumination-direction":new Fe(He.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Fe(He.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Fe(He.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Fe(He.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Fe(He.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Fe(He.paint_hillshade["hillshade-accent-color"])})};const cp=Dn([{name:"a_pos",components:2,type:"Int16"}],4),{members:lg}=cp;var uh=Ou,cg=Ou;function Ou(s,e,o){o=o||2;var l,d,m,_,E,T,O,U=e&&e.length,W=U?e[0]*o:s.length,Y=up(s,0,W,o,!0),ie=[];if(!Y||Y.next===Y.prev)return ie;if(U&&(Y=function(Ee,Le,Ke,ot){var xt,ut,bt,Et=[];for(xt=0,ut=Le.length;xt<ut;xt++)(bt=up(Ee,Le[xt]*ot,xt<ut-1?Le[xt+1]*ot:Ee.length,ot,!1))===bt.next&&(bt.steiner=!0),Et.push(hg(bt));for(Et.sort(Dy),xt=0;xt<Et.length;xt++)fp(Et[xt],Ke),Ke=Vc(Ke,Ke.next);return Ke}(s,e,Y,o)),s.length>80*o){l=m=s[0],d=_=s[1];for(var ye=o;ye<W;ye+=o)(E=s[ye])<l&&(l=E),(T=s[ye+1])<d&&(d=T),E>m&&(m=E),T>_&&(_=T);O=0!==(O=Math.max(m-l,_-d))?1/O:0}return Fu(Y,ie,o,l,d,O),ie}function up(s,e,o,l,d){var m,_;if(d===gp(s,e,o,l)>0)for(m=e;m<o;m+=l)_=mp(m,s[m],s[m+1],_);else for(m=o-l;m>=e;m-=l)_=mp(m,s[m],s[m+1],_);return _&&dh(_,_.next)&&(Lu(_),_=_.next),_}function Vc(s,e){if(!s)return s;e||(e=s);var o,l=s;do{if(o=!1,l.steiner||!dh(l,l.next)&&0!==xs(l.prev,l,l.next))l=l.next;else{if(Lu(l),(l=e=l.prev)===l.next)break;o=!0}}while(o||l!==e);return e}function Fu(s,e,o,l,d,m,_){if(s){!_&&m&&function(U,W,Y,ie){var ye=U;do{null===ye.z&&(ye.z=Rd(ye.x,ye.y,W,Y,ie)),ye.prevZ=ye.prev,ye.nextZ=ye.next,ye=ye.next}while(ye!==U);ye.prevZ.nextZ=null,ye.prevZ=null,function(Ee){var Le,Ke,ot,xt,ut,bt,Et,kt,Kt=1;do{for(Ke=Ee,Ee=null,ut=null,bt=0;Ke;){for(bt++,ot=Ke,Et=0,Le=0;Le<Kt&&(Et++,ot=ot.nextZ);Le++);for(kt=Kt;Et>0||kt>0&&ot;)0!==Et&&(0===kt||!ot||Ke.z<=ot.z)?(xt=Ke,Ke=Ke.nextZ,Et--):(xt=ot,ot=ot.nextZ,kt--),ut?ut.nextZ=xt:Ee=xt,xt.prevZ=ut,ut=xt;Ke=ot}ut.nextZ=null,Kt*=2}while(bt>1)}(ye)}(s,l,d,m);for(var E,T,O=s;s.prev!==s.next;)if(E=s.prev,T=s.next,m?Pd(s,l,d,m):hp(s))e.push(E.i/o),e.push(s.i/o),e.push(T.i/o),Lu(s),s=T.next,O=T.next;else if((s=T)===O){_?1===_?Fu(s=dp(Vc(s),e,o),e,o,l,d,m,2):2===_&&ug(s,e,o,l,d,m):Fu(Vc(s),e,o,l,d,m,1);break}}}function hp(s){var e=s.prev,o=s,l=s.next;if(xs(e,o,l)>=0)return!1;for(var d=s.next.next;d!==s.prev;){if(Ll(e.x,e.y,o.x,o.y,l.x,l.y,d.x,d.y)&&xs(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Pd(s,e,o,l){var d=s.prev,m=s,_=s.next;if(xs(d,m,_)>=0)return!1;for(var E=d.x>m.x?d.x>_.x?d.x:_.x:m.x>_.x?m.x:_.x,T=d.y>m.y?d.y>_.y?d.y:_.y:m.y>_.y?m.y:_.y,O=Rd(d.x<m.x?d.x<_.x?d.x:_.x:m.x<_.x?m.x:_.x,d.y<m.y?d.y<_.y?d.y:_.y:m.y<_.y?m.y:_.y,e,o,l),U=Rd(E,T,e,o,l),W=s.prevZ,Y=s.nextZ;W&&W.z>=O&&Y&&Y.z<=U;){if(W!==s.prev&&W!==s.next&&Ll(d.x,d.y,m.x,m.y,_.x,_.y,W.x,W.y)&&xs(W.prev,W,W.next)>=0||(W=W.prevZ,Y!==s.prev&&Y!==s.next&&Ll(d.x,d.y,m.x,m.y,_.x,_.y,Y.x,Y.y)&&xs(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;W&&W.z>=O;){if(W!==s.prev&&W!==s.next&&Ll(d.x,d.y,m.x,m.y,_.x,_.y,W.x,W.y)&&xs(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;Y&&Y.z<=U;){if(Y!==s.prev&&Y!==s.next&&Ll(d.x,d.y,m.x,m.y,_.x,_.y,Y.x,Y.y)&&xs(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function dp(s,e,o){var l=s;do{var d=l.prev,m=l.next.next;!dh(d,m)&&pp(d,l,l.next,m)&&Go(d,m)&&Go(m,d)&&(e.push(d.i/o),e.push(l.i/o),e.push(m.i/o),Lu(l),Lu(l.next),l=s=m),l=l.next}while(l!==s);return Vc(l)}function ug(s,e,o,l,d,m){var _=s;do{for(var E=_.next.next;E!==_.prev;){if(_.i!==E.i&&dg(_,E)){var T=kd(_,E);return _=Vc(_,_.next),T=Vc(T,T.next),Fu(_,e,o,l,d,m),void Fu(T,e,o,l,d,m)}E=E.next}_=_.next}while(_!==s)}function Dy(s,e){return s.x-e.x}function fp(s,e){if(e=function(l,d){var m,_=d,E=l.x,T=l.y,O=-1/0;do{if(T<=_.y&&T>=_.next.y&&_.next.y!==_.y){var U=_.x+(T-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(U<=E&&U>O){if(O=U,U===E){if(T===_.y)return _;if(T===_.next.y)return _.next}m=_.x<_.next.x?_:_.next}}_=_.next}while(_!==d);if(!m)return null;if(E===O)return m;var W,Y=m,ie=m.x,ye=m.y,Ee=1/0;_=m;do{E>=_.x&&_.x>=ie&&E!==_.x&&Ll(T<ye?E:O,T,ie,ye,T<ye?O:E,T,_.x,_.y)&&(W=Math.abs(T-_.y)/(E-_.x),Go(_,l)&&(W<Ee||W===Ee&&(_.x>m.x||_.x===m.x&&hh(m,_)))&&(m=_,Ee=W)),_=_.next}while(_!==Y);return m}(s,e)){var o=kd(e,s);Vc(e,e.next),Vc(o,o.next)}}function hh(s,e){return xs(s.prev,s,e.prev)<0&&xs(e.next,s,s.next)<0}function Rd(s,e,o,l,d){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=32767*(s-o)*d)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-l)*d)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function hg(s){var e=s,o=s;do{(e.x<o.x||e.x===o.x&&e.y<o.y)&&(o=e),e=e.next}while(e!==s);return o}function Ll(s,e,o,l,d,m,_,E){return(d-_)*(e-E)-(s-_)*(m-E)>=0&&(s-_)*(l-E)-(o-_)*(e-E)>=0&&(o-_)*(m-E)-(d-_)*(l-E)>=0}function dg(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(o,l){var d=o;do{if(d.i!==o.i&&d.next.i!==o.i&&d.i!==l.i&&d.next.i!==l.i&&pp(d,d.next,o,l))return!0;d=d.next}while(d!==o);return!1}(s,e)&&(Go(s,e)&&Go(e,s)&&function(o,l){var d=o,m=!1,_=(o.x+l.x)/2,E=(o.y+l.y)/2;do{d.y>E!=d.next.y>E&&d.next.y!==d.y&&_<(d.next.x-d.x)*(E-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next}while(d!==o);return m}(s,e)&&(xs(s.prev,s,e.prev)||xs(s,e.prev,e))||dh(s,e)&&xs(s.prev,s,s.next)>0&&xs(e.prev,e,e.next)>0)}function xs(s,e,o){return(e.y-s.y)*(o.x-e.x)-(e.x-s.x)*(o.y-e.y)}function dh(s,e){return s.x===e.x&&s.y===e.y}function pp(s,e,o,l){var d=au(xs(s,e,o)),m=au(xs(s,e,l)),_=au(xs(o,l,s)),E=au(xs(o,l,e));return d!==m&&_!==E||!(0!==d||!fh(s,o,e))||!(0!==m||!fh(s,l,e))||!(0!==_||!fh(o,s,l))||!(0!==E||!fh(o,e,l))}function fh(s,e,o){return e.x<=Math.max(s.x,o.x)&&e.x>=Math.min(s.x,o.x)&&e.y<=Math.max(s.y,o.y)&&e.y>=Math.min(s.y,o.y)}function au(s){return s>0?1:s<0?-1:0}function Go(s,e){return xs(s.prev,s,s.next)<0?xs(s,e,s.next)>=0&&xs(s,s.prev,e)>=0:xs(s,e,s.prev)<0||xs(s,s.next,e)<0}function kd(s,e){var o=new ph(s.i,s.x,s.y),l=new ph(e.i,e.x,e.y),d=s.next,m=e.prev;return s.next=e,e.prev=s,o.next=d,d.prev=o,l.next=o,o.prev=l,m.next=l,l.prev=m,l}function mp(s,e,o,l){var d=new ph(s,e,o);return l?(d.next=l.next,d.prev=l,l.next.prev=d,l.next=d):(d.prev=d,d.next=d),d}function Lu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function ph(s,e,o){this.i=s,this.x=e,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gp(s,e,o,l){for(var d=0,m=e,_=o-l;m<o;m+=l)d+=(s[_]-s[m])*(s[m+1]+s[_+1]),_=m;return d}function _p(s,e,o,l,d){yp(s,e,o||0,l||s.length-1,d||fg)}function yp(s,e,o,l,d){for(;l>o;){if(l-o>600){var m=l-o+1,_=e-o+1,E=Math.log(m),T=.5*Math.exp(2*E/3),O=.5*Math.sqrt(E*T*(m-T)/m)*(_-m/2<0?-1:1);yp(s,e,Math.max(o,Math.floor(e-_*T/m+O)),Math.min(l,Math.floor(e+(m-_)*T/m+O)),d)}var U=s[e],W=o,Y=l;for(Nu(s,o,e),d(s[l],U)>0&&Nu(s,o,l);W<Y;){for(Nu(s,W,Y),W++,Y--;d(s[W],U)<0;)W++;for(;d(s[Y],U)>0;)Y--}0===d(s[o],U)?Nu(s,o,Y):Nu(s,++Y,l),Y<=e&&(o=Y+1),e<=Y&&(l=Y-1)}}function Nu(s,e,o){var l=s[e];s[e]=s[o],s[o]=l}function fg(s,e){return s<e?-1:s>e?1:0}function Uc(s,e){const o=s.length;if(o<=1)return[s];const l=[];let d,m;for(let _=0;_<o;_++){const E=Or(s[_]);0!==E&&(s[_].area=Math.abs(E),void 0===m&&(m=E<0),m===E<0?(d&&l.push(d),d=[s[_]]):d.push(s[_]))}if(d&&l.push(d),e>1)for(let _=0;_<l.length;_++)l[_].length<=e||(_p(l[_],e,1,l[_].length-1,ic),l[_]=l[_].slice(0,e));return l}function ic(s,e){return e.area-s.area}function vp(s,e,o){const l=o.patternDependencies;let d=!1;for(const m of e){const _=m.paint.get(`${s}-pattern`);_.isConstant()||(d=!0);const E=_.constantOr(null);E&&(d=!0,l[E.to]=!0,l[E.from]=!0)}return d}function xp(s,e,o,l,d){const m=d.patternDependencies;for(const _ of e){const E=_.paint.get(`${s}-pattern`).value;if("constant"!==E.kind){let T=E.evaluate({zoom:l-1},o,{},d.availableImages),O=E.evaluate({zoom:l},o,{},d.availableImages),U=E.evaluate({zoom:l+1},o,{},d.availableImages);T=T&&T.name?T.name:T,O=O&&O.name?O.name:O,U=U&&U.name?U.name:U,m[T]=!0,m[O]=!0,m[U]=!0,o.patterns[_.id]={min:T,mid:O,max:U}}}return o}Ou.deviation=function(s,e,o,l){var d=e&&e.length,m=Math.abs(gp(s,0,d?e[0]*o:s.length,o));if(d)for(var _=0,E=e.length;_<E;_++)m-=Math.abs(gp(s,e[_]*o,_<E-1?e[_+1]*o:s.length,o));var T=0;for(_=0;_<l.length;_+=3){var O=l[_]*o,U=l[_+1]*o,W=l[_+2]*o;T+=Math.abs((s[O]-s[W])*(s[U+1]-s[O+1])-(s[O]-s[U])*(s[W+1]-s[O+1]))}return 0===m&&0===T?0:Math.abs((T-m)/m)},Ou.flatten=function(s){for(var e=s[0][0].length,o={vertices:[],holes:[],dimensions:e},l=0,d=0;d<s.length;d++){for(var m=0;m<s[d].length;m++)for(var _=0;_<e;_++)o.vertices.push(s[d][m][_]);d>0&&o.holes.push(l+=s[d-1].length)}return o},uh.default=cg;class mh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Qn,this.indexArray=new ai,this.indexArray2=new X,this.programConfigurations=new Ua(e.layers,e.zoom),this.segments=new Ms,this.segments2=new Ms,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l){this.hasPattern=vp("fill",this.layers,o);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:_,id:E,index:T,sourceLayerIndex:O}of e){const U=this.layers[0]._featureFilter.needGeometry,W=iu(_,U);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),W,l))continue;const Y=d?d.evaluate(W,{},l,o.availableImages):void 0,ie={id:E,properties:_.properties,type:_.type,sourceLayerIndex:O,index:T,geometry:U?W.geometry:ru(_),patterns:{},sortKey:Y};m.push(ie)}d&&m.sort((_,E)=>_.sortKey-E.sortKey);for(const _ of m){const{geometry:E,index:T,sourceLayerIndex:O}=_;if(this.hasPattern){const U=xp("fill",this.layers,_,this.zoom,o);this.patternFeatures.push(U)}else this.addFeature(_,E,T,l,{});o.featureIndex.insert(e[T].feature,E,T,O,this.index)}}update(e,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l)}addFeatures(e,o,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,o,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,o,l,d,m){for(const _ of Uc(o,500)){let E=0;for(const ie of _)E+=ie.length;const T=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),O=T.vertexLength,U=[],W=[];for(const ie of _){if(0===ie.length)continue;ie!==_[0]&&W.push(U.length/2);const ye=this.segments2.prepareSegment(ie.length,this.layoutVertexArray,this.indexArray2),Ee=ye.vertexLength;this.layoutVertexArray.emplaceBack(ie[0].x,ie[0].y),this.indexArray2.emplaceBack(Ee+ie.length-1,Ee),U.push(ie[0].x),U.push(ie[0].y);for(let Le=1;Le<ie.length;Le++)this.layoutVertexArray.emplaceBack(ie[Le].x,ie[Le].y),this.indexArray2.emplaceBack(Ee+Le-1,Ee+Le),U.push(ie[Le].x),U.push(ie[Le].y);ye.vertexLength+=ie.length,ye.primitiveLength+=ie.length}const Y=uh(U,W);for(let ie=0;ie<Y.length;ie+=3)this.indexArray.emplaceBack(O+Y[ie],O+Y[ie+1],O+Y[ie+2]);T.vertexLength+=E,T.primitiveLength+=Y.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,d)}}yn("FillBucket",mh,{omit:["layers","patternFeatures"]});const Ay=new At({"fill-sort-key":new pt(He.layout_fill["fill-sort-key"])});var sc={paint:new At({"fill-antialias":new Fe(He.paint_fill["fill-antialias"]),"fill-opacity":new pt(He.paint_fill["fill-opacity"]),"fill-color":new pt(He.paint_fill["fill-color"]),"fill-outline-color":new pt(He.paint_fill["fill-outline-color"]),"fill-translate":new Fe(He.paint_fill["fill-translate"]),"fill-translate-anchor":new Fe(He.paint_fill["fill-translate-anchor"]),"fill-pattern":new Rt(He.paint_fill["fill-pattern"])}),layout:Ay};const Od=Dn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Fd=Dn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:pg}=Od;var Ld=oc;function oc(s,e,o,l,d){this.properties={},this.extent=o,this.type=0,this._pbf=s,this._geometry=-1,this._keys=l,this._values=d,s.readFields(bp,this,e)}function bp(s,e,o){1==s?e.id=o.readVarint():2==s?function(l,d){for(var m=l.readVarint()+l.pos;l.pos<m;){var _=d._keys[l.readVarint()],E=d._values[l.readVarint()];d.properties[_]=E}}(o,e):3==s?e.type=o.readVarint():4==s&&(e._geometry=o.pos)}function wp(s){for(var e,o,l=0,d=0,m=s.length,_=m-1;d<m;_=d++)l+=((o=s[_]).x-(e=s[d]).x)*(e.y+o.y);return l}oc.types=["Unknown","Point","LineString","Polygon"],oc.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var e,o=s.readVarint()+s.pos,l=1,d=0,m=0,_=0,E=[];s.pos<o;){if(d<=0){var T=s.readVarint();l=7&T,d=T>>3}if(d--,1===l||2===l)m+=s.readSVarint(),_+=s.readSVarint(),1===l&&(e&&E.push(e),e=[]),e.push(new ce(m,_));else{if(7!==l)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&E.push(e),E},oc.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var e=s.readVarint()+s.pos,o=1,l=0,d=0,m=0,_=1/0,E=-1/0,T=1/0,O=-1/0;s.pos<e;){if(l<=0){var U=s.readVarint();o=7&U,l=U>>3}if(l--,1===o||2===o)(d+=s.readSVarint())<_&&(_=d),d>E&&(E=d),(m+=s.readSVarint())<T&&(T=m),m>O&&(O=m);else if(7!==o)throw new Error("unknown command "+o)}return[_,T,E,O]},oc.prototype.toGeoJSON=function(s,e,o){var l,d,m=this.extent*Math.pow(2,o),_=this.extent*s,E=this.extent*e,T=this.loadGeometry(),O=oc.types[this.type];function U(ie){for(var ye=0;ye<ie.length;ye++){var Ee=ie[ye];ie[ye]=[360*(Ee.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ee.y+E)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(l=0;l<T.length;l++)W[l]=T[l][0];U(T=W);break;case 2:for(l=0;l<T.length;l++)U(T[l]);break;case 3:for(T=function(ie){var ye=ie.length;if(ye<=1)return[ie];for(var Ee,Le,Ke=[],ot=0;ot<ye;ot++){var xt=wp(ie[ot]);0!==xt&&(void 0===Le&&(Le=xt<0),Le===xt<0?(Ee&&Ke.push(Ee),Ee=[ie[ot]]):Ee.push(ie[ot]))}return Ee&&Ke.push(Ee),Ke}(T),l=0;l<T.length;l++)for(d=0;d<T[l].length;d++)U(T[l][d])}1===T.length?T=T[0]:O="Multi"+O;var Y={type:"Feature",geometry:{type:O,coordinates:T},properties:this.properties};return"id"in this&&(Y.id=this.id),Y};var gh=_h;function _h(s,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Ep,this,e),this.length=this._features.length}function Ep(s,e,o){15===s?e.version=o.readVarint():1===s?e.name=o.readString():5===s?e.extent=o.readVarint():2===s?e._features.push(o.pos):3===s?e._keys.push(o.readString()):4===s&&e._values.push(function(l){for(var d=null,m=l.readVarint()+l.pos;l.pos<m;){var _=l.readVarint()>>3;d=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return d}(o))}function My(s,e,o){if(3===s){var l=new gh(o,o.readVarint()+o.pos);l.length&&(e[l.name]=l)}}_h.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var e=this._pbf.readVarint()+this._pbf.pos;return new Ld(this._pbf,e,this.extent,this._keys,this._values)};var cl={VectorTile:function(s,e){this.layers=s.readFields(My,{},e)},VectorTileFeature:Ld,VectorTileLayer:gh};const Nd=cl.VectorTileFeature.types,Cp=Math.pow(2,13);function zu(s,e,o,l,d,m,_,E){s.emplaceBack((e<<1)+_,(o<<1)+m,(Math.floor(l*Cp)<<1)+d,Math.round(E))}class yh{constructor(){this.acc=new ce(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ce(e.x,e.y),this.max=new ce(e.x,e.y))}append(e,o){this.currentPolyCount.edges++,this.acc._add(e);let l=!!this.borders;const d=this.min,m=this.max;e.x<d.x?(d.x=e.x,l=!0):e.x>m.x&&(m.x=e.x,l=!0),e.y<d.y?(d.y=e.y,l=!0):e.y>m.y&&(m.y=e.y,l=!0),((0===e.x||e.x===ti)&&e.x===o.x)!=((0===e.y||e.y===ti)&&e.y===o.y)&&this.processBorderOverlap(e,o),l&&this.checkBorderIntersection(e,o)}checkBorderIntersection(e,o){o.x<0!=e.x<0&&this.addBorderIntersection(0,gr(o.y,e.y,(0-o.x)/(e.x-o.x))),o.x>ti!=e.x>ti&&this.addBorderIntersection(1,gr(o.y,e.y,(ti-o.x)/(e.x-o.x))),o.y<0!=e.y<0&&this.addBorderIntersection(2,gr(o.x,e.x,(0-o.y)/(e.y-o.y))),o.y>ti!=e.y>ti&&this.addBorderIntersection(3,gr(o.x,e.x,(ti-o.y)/(e.y-o.y)))}addBorderIntersection(e,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];o<l[0]&&(l[0]=o),o>l[1]&&(l[1]=o)}processBorderOverlap(e,o){if(e.x===o.x){if(e.y===o.y)return;const l=0===e.x?0:1;this.addBorderIntersection(l,o.y),this.addBorderIntersection(l,e.y)}else{const l=0===e.y?2:3;this.addBorderIntersection(l,o.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((o,l)=>o+l.edges,0);return 0!==e?this.acc.div(e)._round():new ce(0,0)}span(){return new ce(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,o)=>e+ +(o[0]!==Number.MAX_VALUE),0)}}class zd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new zi,this.centroidVertexArray=new Ls,this.indexArray=new ai,this.programConfigurations=new Ua(e.layers,e.zoom),this.segments=new Ms,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.enableTerrain=e.enableTerrain}populate(e,o,l){this.features=[],this.hasPattern=vp("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(d){const m=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*m/(m*m+1)/ti/(1<<d.z)}(l);for(const{feature:d,id:m,index:_,sourceLayerIndex:E}of e){const T=this.layers[0]._featureFilter.needGeometry,O=iu(d,T);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),O,l))continue;const U={id:m,sourceLayerIndex:E,index:_,geometry:T?O.geometry:ru(d),properties:d.properties,type:d.type,patterns:{}},W=this.layoutVertexArray.length;this.hasPattern?this.features.push(xp("fill-extrusion",this.layers,U,this.zoom,o)):this.addFeature(U,U.geometry,_,l,{}),o.featureIndex.insert(d,U.geometry,_,E,this.index,W)}this.sortBorders()}addFeatures(e,o,l){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,o,l)}this.sortBorders()}update(e,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pg),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Fd.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,o,l,d,m){const _=this.enableTerrain?new yh:null;for(const T of Uc(o,500)){let O=0,U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===T.length||(E=T[0]).every(Ee=>Ee.x<=0)||E.every(Ee=>Ee.x>=ti)||E.every(Ee=>Ee.y<=0)||E.every(Ee=>Ee.y>=ti))continue;for(let Ee=0;Ee<T.length;Ee++){const Le=T[Ee];if(0===Le.length)continue;O+=Le.length;let Ke=0;_&&_.startRing(Le[0]);for(let ot=0;ot<Le.length;ot++){const xt=Le[ot];if(ot>=1){const ut=Le[ot-1];if(!mg(xt,ut)){_&&_.append(xt,ut),U.vertexLength+4>Ms.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const bt=xt.sub(ut)._perp(),Et=bt.x/(Math.abs(bt.x)+Math.abs(bt.y)),kt=bt.y>0?1:0,Kt=ut.dist(xt);Ke+Kt>32768&&(Ke=0),zu(this.layoutVertexArray,xt.x,xt.y,Et,kt,0,0,Ke),zu(this.layoutVertexArray,xt.x,xt.y,Et,kt,0,1,Ke),Ke+=Kt,zu(this.layoutVertexArray,ut.x,ut.y,Et,kt,0,0,Ke),zu(this.layoutVertexArray,ut.x,ut.y,Et,kt,0,1,Ke);const nn=U.vertexLength;this.indexArray.emplaceBack(nn,nn+2,nn+1),this.indexArray.emplaceBack(nn+1,nn+2,nn+3),U.vertexLength+=4,U.primitiveLength+=2}}}}if(U.vertexLength+O>Ms.MAX_VERTEX_ARRAY_LENGTH&&(U=this.segments.prepareSegment(O,this.layoutVertexArray,this.indexArray)),"Polygon"!==Nd[e.type])continue;const W=[],Y=[],ie=U.vertexLength;for(let Ee=0;Ee<T.length;Ee++){const Le=T[Ee];if(0!==Le.length){Le!==T[0]&&Y.push(W.length/2);for(let Ke=0;Ke<Le.length;Ke++){const ot=Le[Ke];zu(this.layoutVertexArray,ot.x,ot.y,0,0,1,1,0),W.push(ot.x),W.push(ot.y),_&&_.currentPolyCount.top++}}}const ye=uh(W,Y);for(let Ee=0;Ee<ye.length;Ee+=3)this.indexArray.emplaceBack(ie+ye[Ee],ie+ye[Ee+2],ie+ye[Ee+1]);U.primitiveLength+=ye.length/3,U.vertexLength+=O}var E;if(_&&_.polyCount.length>0){if(_.borders){_.vertexArrayOffset=this.centroidVertexArray.length;const T=_.borders,O=this.featuresOnBorder.push(_)-1;for(let U=0;U<4;U++)T[U][0]!==Number.MAX_VALUE&&this.borders[U].push(O)}this.encodeCentroid(_.borders?void 0:_.centroid(),_)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,d)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((o,l)=>this.featuresOnBorder[o].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,o,l=!0){let d,m;if(e)if(0!==e.y){const E=o.span()._mult(this.tileToMeter);d=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(E.x/10)),m=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(E.y/10))}else d=Math.ceil(7*(e.x+450)),m=0;else d=0,m=+l;let _=l?this.centroidVertexArray.length:o.vertexArrayOffset;for(const E of o.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*E.edges+E.top);for(let T=0;T<2*E.edges;T++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,d,m);for(let T=0;T<E.top;T++)this.centroidVertexArray.emplace(_++,d,m)}}}function mg(s,e){return s.x===e.x&&(s.x<0||s.x>ti)||s.y===e.y&&(s.y<0||s.y>ti)}yn("FillExtrusionBucket",zd,{omit:["layers","features"]}),yn("PartMetadata",yh);var gg={paint:new At({"fill-extrusion-opacity":new Fe(He["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pt(He["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Fe(He["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Fe(He["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Rt(He["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new pt(He["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pt(He["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Fe(He["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Bu(s,e){return s.x*e.x+s.y*e.y}function Tp(s,e){if(1===s.length){let o=0;const l=e[o++];let d;for(;!d||l.equals(d);)if(d=e[o++],!d)return 1/0;for(;o<e.length;o++){const m=e[o],_=s[0],E=d.sub(l),T=m.sub(l),O=_.sub(l),U=Bu(E,E),W=Bu(E,T),Y=Bu(T,T),ie=Bu(O,E),ye=Bu(O,T),Ee=U*Y-W*W,Le=(Y*ie-W*ye)/Ee,Ke=(U*ye-W*ie)/Ee,ot=l.z*(1-Le-Ke)+d.z*Le+m.z*Ke;if(isFinite(ot))return ot}return 1/0}{let o=1/0;for(const l of e)o=Math.min(o,l.z);return o}}function Sp(s){const e=new ce(s[0],s[1]);return e.z=s[2],e}function Dp(s,e,o,l,d,m,_,E){const T=_*d.getElevationAt(s,e,!0,!0),O=0!==m[0],U=O?0===m[1]?_*(m[0]/7-450):_*function(W,Y,ie){const ye=Math.floor(Y[0]/8),Ee=Math.floor(Y[1]/8),Le=10*(Y[0]-8*ye),Ke=10*(Y[1]-8*Ee),ot=W.getElevationAt(ye,Ee,!0,!0),xt=W.getMeterToDEM(ie),ut=Math.floor(.5*(Le*xt-1)),bt=Math.floor(.5*(Ke*xt-1)),Et=W.tileCoordToPixel(ye,Ee),kt=2*ut+1,Kt=2*bt+1,nn=(Jn=kt,Sr=Kt,[(qn=W).getElevationAtPixel(Sn=Et.x-ut,Xr=Et.y-bt,!0),qn.getElevationAtPixel(Sn+Sr,Xr,!0),qn.getElevationAtPixel(Sn,Xr+Sr,!0),qn.getElevationAtPixel(Sn+Jn,Xr+Sr,!0)]),dn=Math.abs(nn[0]-nn[1]),Vt=Math.abs(nn[2]-nn[3]),Yt=Math.abs(nn[0]-nn[2])+Math.abs(nn[1]-nn[3]),fn=Math.min(.25,.5*xt*(dn+Vt)/kt),$t=Math.min(.25,.5*xt*Yt/Kt);var qn,Sn,Xr,Jn,Sr;return ot+Math.max(fn*Le,$t*Ke)}(d,m,E):T;return{base:T+(0===o)?-1:o,top:O?Math.max(U+l,T+o+2):T+l}}const Bd=Dn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ap}=Bd,Vd=Dn([{name:"a_packed",components:3,type:"Float32"}]),{members:_g}=Vd,yg=cl.VectorTileFeature.types,Mp=Math.cos(Math.PI/180*37.5);class vh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(o=>o.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new wi,this.layoutVertexArray2=new _r,this.indexArray=new ai,this.programConfigurations=new Ua(e.layers,e.zoom),this.segments=new Ms,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(e,o,l){this.hasPattern=vp("line",this.layers,o);const d=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:O,id:U,index:W,sourceLayerIndex:Y}of e){const ie=this.layers[0]._featureFilter.needGeometry,ye=iu(O,ie);if(!this.layers[0]._featureFilter.filter(new pe(this.zoom),ye,l))continue;const Ee=d?d.evaluate(ye,{},l):void 0,Le={id:U,properties:O.properties,type:O.type,sourceLayerIndex:Y,index:W,geometry:ie?ye.geometry:ru(O),patterns:{},sortKey:Ee};m.push(Le)}d&&m.sort((O,U)=>O.sortKey-U.sortKey);const{lineAtlas:_,featureIndex:E}=o,T=this.addConstantDashes(_);for(const O of m){const{geometry:U,index:W,sourceLayerIndex:Y}=O;if(T&&this.addFeatureDashes(O,_),this.hasPattern){const ie=xp("line",this.layers,O,this.zoom,o);this.patternFeatures.push(ie)}else this.addFeature(O,U,W,l,_.positions);E.insert(e[W].feature,U,W,Y,this.index)}}addConstantDashes(e){let o=!1;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if("constant"!==d.kind||"constant"!==m.kind)o=!0;else{const _=m.value,E=d.value;if(!E)continue;e.addDash(E.from,_),e.addDash(E.to,_),E.other&&e.addDash(E.other,_)}}return o}addFeatureDashes(e,o){const l=this.zoom;for(const d of this.layers){const m=d.paint.get("line-dasharray").value,_=d.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let E,T,O,U,W,Y;if("constant"===m.kind){const Le=m.value;if(!Le)continue;E=Le.other||Le.to,T=Le.to,O=Le.from}else E=m.evaluate({zoom:l-1},e),T=m.evaluate({zoom:l},e),O=m.evaluate({zoom:l+1},e);"constant"===_.kind?U=W=Y=_.value:(U=_.evaluate({zoom:l-1},e),W=_.evaluate({zoom:l},e),Y=_.evaluate({zoom:l+1},e)),o.addDash(E,U),o.addDash(T,W),o.addDash(O,Y);const ie=o.getKey(E,U),ye=o.getKey(T,W),Ee=o.getKey(O,Y);e.patterns[d.id]={min:ie,mid:ye,max:Ee}}}update(e,o,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,o,this.stateDependentLayers,l)}addFeatures(e,o,l){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,o,l)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,_g)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ap),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,o,l,d,m){const _=this.layers[0].layout,E=_.get("line-join").evaluate(e,{}),T=_.get("line-cap").evaluate(e,{}),O=_.get("line-miter-limit"),U=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const W of o)this.addLine(W,e,E,T,O,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,m,d)}addLine(e,o,l,d,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ke=0;Ke<e.length-1;Ke++)this.totalDistance+=e[Ke].dist(e[Ke+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E="Polygon"===yg[o.type];let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let O=0;for(;O<T-1&&e[O].equals(e[O+1]);)O++;if(T<(E?3:2))return;"bevel"===l&&(m=1.05);const U=this.overscaling<=16?122880/(512*this.overscaling):0,W=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let Y,ie,ye,Ee,Le;this.e1=this.e2=-1,E&&(Y=e[T-2],Le=e[O].sub(Y)._unit()._perp());for(let Ke=O;Ke<T;Ke++){if(ye=Ke===T-1?E?e[O+1]:void 0:e[Ke+1],ye&&e[Ke].equals(ye))continue;Le&&(Ee=Le),Y&&(ie=Y),Y=e[Ke],Le=ye?ye.sub(Y)._unit()._perp():Ee,Ee=Ee||Le;let ot=Ee.add(Le);0===ot.x&&0===ot.y||ot._unit();const xt=Ee.x*Le.x+Ee.y*Le.y,ut=ot.x*Le.x+ot.y*Le.y,bt=0!==ut?1/ut:1/0,Et=2*Math.sqrt(2-2*ut),kt=ut<Mp&&ie&&ye,Kt=Ee.x*Le.y-Ee.y*Le.x>0;if(kt&&Ke>O){const Vt=Y.dist(ie);if(Vt>2*U){const Yt=Y.sub(Y.sub(ie)._mult(U/Vt)._round());this.updateDistance(ie,Yt),this.addCurrentVertex(Yt,Ee,0,0,W),ie=Yt}}const nn=ie&&ye;let dn=nn?l:E?"butt":d;if(nn&&"round"===dn&&(bt<_?dn="miter":bt<=2&&(dn="fakeround")),"miter"===dn&&bt>m&&(dn="bevel"),"bevel"===dn&&(bt>2&&(dn="flipbevel"),bt<m&&(dn="miter")),ie&&this.updateDistance(ie,Y),"miter"===dn)ot._mult(bt),this.addCurrentVertex(Y,ot,0,0,W);else if("flipbevel"===dn){if(bt>100)ot=Le.mult(-1);else{const Vt=bt*Ee.add(Le).mag()/Ee.sub(Le).mag();ot._perp()._mult(Vt*(Kt?-1:1))}this.addCurrentVertex(Y,ot,0,0,W),this.addCurrentVertex(Y,ot.mult(-1),0,0,W)}else if("bevel"===dn||"fakeround"===dn){const Vt=-Math.sqrt(bt*bt-1),Yt=Kt?Vt:0,fn=Kt?0:Vt;if(ie&&this.addCurrentVertex(Y,Ee,Yt,fn,W),"fakeround"===dn){const $t=Math.round(180*Et/Math.PI/20);for(let qn=1;qn<$t;qn++){let Sn=qn/$t;if(.5!==Sn){const Jn=Sn-.5;Sn+=Sn*Jn*(Sn-1)*((1.0904+xt*(xt*(3.55645-1.43519*xt)-3.2452))*Jn*Jn+(.848013+xt*(.215638*xt-1.06021)))}const Xr=Le.sub(Ee)._mult(Sn)._add(Ee)._unit()._mult(Kt?-1:1);this.addHalfVertex(Y,Xr.x,Xr.y,!1,Kt,0,W)}}ye&&this.addCurrentVertex(Y,Le,-Yt,-fn,W)}else if("butt"===dn)this.addCurrentVertex(Y,ot,0,0,W);else if("square"===dn){const Vt=ie?1:-1;ie||this.addCurrentVertex(Y,ot,Vt,Vt,W),this.addCurrentVertex(Y,ot,0,0,W),ie&&this.addCurrentVertex(Y,ot,Vt,Vt,W)}else"round"===dn&&(ie&&(this.addCurrentVertex(Y,Ee,0,0,W),this.addCurrentVertex(Y,Ee,1,1,W,!0)),ye&&(this.addCurrentVertex(Y,Le,-1,-1,W,!0),this.addCurrentVertex(Y,Le,0,0,W)));if(kt&&Ke<T-1){const Vt=Y.dist(ye);if(Vt>2*U){const Yt=Y.add(ye.sub(Y)._mult(U/Vt)._round());this.updateDistance(Y,Yt),this.addCurrentVertex(Yt,Le,0,0,W),Y=Yt}}}}addCurrentVertex(e,o,l,d,m,_=!1){const E=o.y*d-o.x,T=-o.y-o.x*d;this.addHalfVertex(e,o.x+o.y*l,o.y-o.x*l,_,!1,l,m),this.addHalfVertex(e,E,T,_,!0,-d,m)}addHalfVertex({x:e,y:o},l,d,m,_,E,T){this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(o<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*d)+128,1+(0===E?0:E<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const O=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),T.primitiveLength++),_?this.e2=O:this.e1=O}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,o){this.distance+=e.dist(o),this.updateScaledDistance()}}yn("LineBucket",vh,{omit:["layers","patternFeatures"]});const lu=new At({"line-cap":new pt(He.layout_line["line-cap"]),"line-join":new pt(He.layout_line["line-join"]),"line-miter-limit":new Fe(He.layout_line["line-miter-limit"]),"line-round-limit":new Fe(He.layout_line["line-round-limit"]),"line-sort-key":new pt(He.layout_line["line-sort-key"])});var Ud={paint:new At({"line-opacity":new pt(He.paint_line["line-opacity"]),"line-color":new pt(He.paint_line["line-color"]),"line-translate":new Fe(He.paint_line["line-translate"]),"line-translate-anchor":new Fe(He.paint_line["line-translate-anchor"]),"line-width":new pt(He.paint_line["line-width"]),"line-gap-width":new pt(He.paint_line["line-gap-width"]),"line-offset":new pt(He.paint_line["line-offset"]),"line-blur":new pt(He.paint_line["line-blur"]),"line-dasharray":new Rt(He.paint_line["line-dasharray"]),"line-pattern":new Rt(He.paint_line["line-pattern"]),"line-gradient":new dt(He.paint_line["line-gradient"])}),layout:lu};const jd=new class extends pt{possiblyEvaluate(s,e){return e=new pe(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(s,e)}evaluate(s,e,o,l){return e=Ht({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(s,e,o,l)}}(Ud.paint.properties["line-width"].specification);function Ip(s,e){return e>0?e+2*s:s}jd.useIntegerZoom=!0;const xh=Dn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),vg=Dn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Dn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Pp=Dn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Rp=Dn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const $d=Dn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Gd=Dn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Dn([{name:"triangle",components:3,type:"Uint16"}]),Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Dn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Dn([{type:"Float32",name:"offsetX"}]),Dn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const ja=128;function vu(s,e){const{expression:o}=e;if("constant"===o.kind)return{kind:"constant",layoutSize:o.evaluate(new pe(s+1))};if("source"===o.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:d}=o;let m=0;for(;m<l.length&&l[m]<=s;)m++;m=Math.max(0,m-1);let _=m;for(;_<l.length&&l[_]<s+1;)_++;_=Math.min(l.length-1,_);const E=l[m],T=l[_];return"composite"===o.kind?{kind:"composite",minZoom:E,maxZoom:T,interpolationType:d}:{kind:"camera",minZoom:E,maxZoom:T,minSize:o.evaluate(new pe(E)),maxSize:o.evaluate(new pe(T)),interpolationType:d}}}function Vu(s,{uSize:e,uSizeT:o},{lowerSize:l,upperSize:d}){return"source"===s.kind?l/ja:"composite"===s.kind?gr(l/ja,d/ja,o):e}function jc(s,e){let o=0,l=0;if("constant"===s.kind)l=s.layoutSize;else if("source"!==s.kind){const{interpolationType:d,minZoom:m,maxZoom:_}=s,E=d?Je(Mn.interpolationFactor(d,e,m,_),0,1):0;"camera"===s.kind?l=gr(s.minSize,s.maxSize,E):o=E}return{uSizeT:o,uSize:l}}var kp=Object.freeze({__proto__:null,getSizeData:vu,evaluateSizeForFeature:Vu,evaluateSizeForZoom:jc,SIZE_PACK_FACTOR:ja});function Zd(s,e,o){return s.sections.forEach(l=>{l.text=function(d,m,_){const E=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===E?d=d.toLocaleUpperCase():"lowercase"===E&&(d=d.toLocaleLowerCase()),le.applyArabicShaping&&(d=le.applyArabicShaping(d)),d}(l.text,e,o)}),s}const Ec={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function xg(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function Op(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var Fp=function(s,e,o,l,d){var m,_,E=8*d-l-1,T=(1<<E)-1,O=T>>1,U=-7,W=o?d-1:0,Y=o?-1:1,ie=s[e+W];for(W+=Y,m=ie&(1<<-U)-1,ie>>=-U,U+=E;U>0;m=256*m+s[e+W],W+=Y,U-=8);for(_=m&(1<<-U)-1,m>>=-U,U+=l;U>0;_=256*_+s[e+W],W+=Y,U-=8);if(0===m)m=1-O;else{if(m===T)return _?NaN:1/0*(ie?-1:1);_+=Math.pow(2,l),m-=O}return(ie?-1:1)*_*Math.pow(2,m-l)},Lp=function(s,e,o,l,d,m){var _,E,T,O=8*m-d-1,U=(1<<O)-1,W=U>>1,Y=23===d?Math.pow(2,-24)-Math.pow(2,-77):0,ie=l?0:m-1,ye=l?1:-1,Ee=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(E=isNaN(e)?1:0,_=U):(_=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-_))<1&&(_--,T*=2),(e+=_+W>=1?Y/T:Y*Math.pow(2,1-W))*T>=2&&(_++,T/=2),_+W>=U?(E=0,_=U):_+W>=1?(E=(e*T-1)*Math.pow(2,d),_+=W):(E=e*Math.pow(2,W-1)*Math.pow(2,d),_=0));d>=8;s[o+ie]=255&E,ie+=ye,E/=256,d-=8);for(_=_<<d|E,O+=d;O>0;s[o+ie]=255&_,ie+=ye,_/=256,O-=8);s[o+ie-ye]|=128*Ee},xu=li;function li(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}li.Varint=0,li.Fixed64=1,li.Bytes=2,li.Fixed32=5;var bh=4294967296,bg=1/bh,Hd="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Cc(s){return s.type===li.Bytes?s.readVarint()+s.pos:s.pos+1}function Np(s,e,o){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));o.realloc(l);for(var d=o.pos-1;d>=s;d--)o.buf[d+l]=o.buf[d]}function wg(s,e){for(var o=0;o<s.length;o++)e.writeVarint(s[o])}function Nl(s,e){for(var o=0;o<s.length;o++)e.writeSVarint(s[o])}function Eg(s,e){for(var o=0;o<s.length;o++)e.writeFloat(s[o])}function zp(s,e){for(var o=0;o<s.length;o++)e.writeDouble(s[o])}function Cg(s,e){for(var o=0;o<s.length;o++)e.writeBoolean(s[o])}function Tg(s,e){for(var o=0;o<s.length;o++)e.writeFixed32(s[o])}function Sg(s,e){for(var o=0;o<s.length;o++)e.writeSFixed32(s[o])}function Dg(s,e){for(var o=0;o<s.length;o++)e.writeFixed64(s[o])}function Bp(s,e){for(var o=0;o<s.length;o++)e.writeSFixed64(s[o])}function wh(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+16777216*s[e+3]}function bu(s,e,o){s[o]=e,s[o+1]=e>>>8,s[o+2]=e>>>16,s[o+3]=e>>>24}function Vp(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16)+(s[e+3]<<24)}function Tr(s,e,o){e.glyphs=[],1===s&&o.readMessage(Up,e)}function Up(s,e,o){if(3===s){const{id:l,bitmap:d,width:m,height:_,left:E,top:T,advance:O}=o.readMessage(jp,{});e.glyphs.push({id:l,bitmap:new vs({width:m+6,height:_+6},d),metrics:{width:m,height:_,left:E,top:T,advance:O}})}else 4===s?e.ascender=o.readSVarint():5===s&&(e.descender=o.readSVarint())}function jp(s,e,o){1===s?e.id=o.readVarint():2===s?e.bitmap=o.readBytes():3===s?e.width=o.readVarint():4===s?e.height=o.readVarint():5===s?e.left=o.readSVarint():6===s?e.top=o.readSVarint():7===s&&(e.advance=o.readVarint())}function wu(s){let e=0,o=0;for(const _ of s)e+=_.w*_.h,o=Math.max(o,_.w);s.sort((_,E)=>E.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),o),h:1/0}];let d=0,m=0;for(const _ of s)for(let E=l.length-1;E>=0;E--){const T=l[E];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,m=Math.max(m,_.y+_.h),d=Math.max(d,_.x+_.w),_.w===T.w&&_.h===T.h){const O=l.pop();E<l.length&&(l[E]=O)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(l.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}li.prototype={destroy:function(){this.buf=null},readFields:function(s,e,o){for(o=o||this.length;this.pos<o;){var l=this.readVarint(),d=l>>3,m=this.pos;this.type=7&l,s(d,e,this),this.pos===m&&this.skip(l)}return e},readMessage:function(s,e){return this.readFields(s,e,this.readVarint()+this.pos)},readFixed32:function(){var s=wh(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Vp(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=wh(this.buf,this.pos)+wh(this.buf,this.pos+4)*bh;return this.pos+=8,s},readSFixed64:function(){var s=wh(this.buf,this.pos)+Vp(this.buf,this.pos+4)*bh;return this.pos+=8,s},readFloat:function(){var s=Fp(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Fp(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var e,o,l=this.buf;return e=127&(o=l[this.pos++]),o<128?e:(e|=(127&(o=l[this.pos++]))<<7,o<128?e:(e|=(127&(o=l[this.pos++]))<<14,o<128?e:(e|=(127&(o=l[this.pos++]))<<21,o<128?e:function(d,m,_){var E,T,O=_.buf;if(E=(112&(T=O[_.pos++]))>>4,T<128||(E|=(127&(T=O[_.pos++]))<<3,T<128)||(E|=(127&(T=O[_.pos++]))<<10,T<128)||(E|=(127&(T=O[_.pos++]))<<17,T<128)||(E|=(127&(T=O[_.pos++]))<<24,T<128)||(E|=(1&(T=O[_.pos++]))<<31,T<128))return function(s,e,o){return o?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}(d,E,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(o=l[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&Hd?Hd.decode(this.buf.subarray(e,s)):function(o,l,d){for(var m="",_=l;_<d;){var E,T,O,U=o[_],W=null,Y=U>239?4:U>223?3:U>191?2:1;if(_+Y>d)break;1===Y?U<128&&(W=U):2===Y?128==(192&(E=o[_+1]))&&(W=(31&U)<<6|63&E)<=127&&(W=null):3===Y?(T=o[_+2],128==(192&(E=o[_+1]))&&128==(192&T)&&((W=(15&U)<<12|(63&E)<<6|63&T)<=2047||W>=55296&&W<=57343)&&(W=null)):4===Y&&(T=o[_+2],O=o[_+3],128==(192&(E=o[_+1]))&&128==(192&T)&&128==(192&O)&&((W=(15&U)<<18|(63&E)<<12|(63&T)<<6|63&O)<=65535||W>=1114112)&&(W=null)),null===W?(W=65533,Y=1):W>65535&&(W-=65536,m+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),m+=String.fromCharCode(W),_+=Y}return m}(this.buf,e,s)},readBytes:function(){var s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e},readPackedVarint:function(s,e){if(this.type!==li.Bytes)return s.push(this.readVarint(e));var o=Cc(this);for(s=s||[];this.pos<o;)s.push(this.readVarint(e));return s},readPackedSVarint:function(s){if(this.type!==li.Bytes)return s.push(this.readSVarint());var e=Cc(this);for(s=s||[];this.pos<e;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==li.Bytes)return s.push(this.readBoolean());var e=Cc(this);for(s=s||[];this.pos<e;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==li.Bytes)return s.push(this.readFloat());var e=Cc(this);for(s=s||[];this.pos<e;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==li.Bytes)return s.push(this.readDouble());var e=Cc(this);for(s=s||[];this.pos<e;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==li.Bytes)return s.push(this.readFixed32());var e=Cc(this);for(s=s||[];this.pos<e;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==li.Bytes)return s.push(this.readSFixed32());var e=Cc(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==li.Bytes)return s.push(this.readFixed64());var e=Cc(this);for(s=s||[];this.pos<e;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==li.Bytes)return s.push(this.readSFixed64());var e=Cc(this);for(s=s||[];this.pos<e;)s.push(this.readSFixed64());return s},skip:function(s){var e=7&s;if(e===li.Varint)for(;this.buf[this.pos++]>127;);else if(e===li.Bytes)this.pos=this.readVarint()+this.pos;else if(e===li.Fixed32)this.pos+=4;else{if(e!==li.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(s,e){this.writeVarint(s<<3|e)},realloc:function(s){for(var e=this.length||16;e<this.pos+s;)e*=2;if(e!==this.length){var o=new Uint8Array(e);o.set(this.buf),this.buf=o,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),bu(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),bu(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),bu(this.buf,-1&s,this.pos),bu(this.buf,Math.floor(s*bg),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),bu(this.buf,-1&s,this.pos),bu(this.buf,Math.floor(s*bg),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(e,o){var l,d,m,E;if(e>=0?(l=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,d=d+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),m=l,(E=o).buf[E.pos++]=127&m|128,m>>>=7,E.buf[E.pos++]=127&m|128,m>>>=7,E.buf[E.pos++]=127&m|128,m>>>=7,E.buf[E.pos++]=127&m|128,E.buf[E.pos]=127&(m>>>=7),function(m,_){var E=(7&m)<<4;_.buf[_.pos++]|=E|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(d,o)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var e=this.pos;this.pos=function(l,d,m){for(var _,E,T=0;T<d.length;T++){if((_=d.charCodeAt(T))>55295&&_<57344){if(!E){_>56319||T+1===d.length?(l[m++]=239,l[m++]=191,l[m++]=189):E=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,E=_;continue}_=E-55296<<10|_-56320|65536,E=null}else E&&(l[m++]=239,l[m++]=191,l[m++]=189,E=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m}(this.buf,s,this.pos);var o=this.pos-e;o>=128&&Np(e,o,this),this.pos=e-1,this.writeVarint(o),this.pos+=o},writeFloat:function(s){this.realloc(4),Lp(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Lp(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var e=s.length;this.writeVarint(e),this.realloc(e);for(var o=0;o<e;o++)this.buf[this.pos++]=s[o]},writeRawMessage:function(s,e){this.pos++;var o=this.pos;s(e,this);var l=this.pos-o;l>=128&&Np(o,l,this),this.pos=o-1,this.writeVarint(l),this.pos+=l},writeMessage:function(s,e,o){this.writeTag(s,li.Bytes),this.writeRawMessage(e,o)},writePackedVarint:function(s,e){e.length&&this.writeMessage(s,wg,e)},writePackedSVarint:function(s,e){e.length&&this.writeMessage(s,Nl,e)},writePackedBoolean:function(s,e){e.length&&this.writeMessage(s,Cg,e)},writePackedFloat:function(s,e){e.length&&this.writeMessage(s,Eg,e)},writePackedDouble:function(s,e){e.length&&this.writeMessage(s,zp,e)},writePackedFixed32:function(s,e){e.length&&this.writeMessage(s,Tg,e)},writePackedSFixed32:function(s,e){e.length&&this.writeMessage(s,Sg,e)},writePackedFixed64:function(s,e){e.length&&this.writeMessage(s,Dg,e)},writePackedSFixed64:function(s,e){e.length&&this.writeMessage(s,Bp,e)},writeBytesField:function(s,e){this.writeTag(s,li.Bytes),this.writeBytes(e)},writeFixed32Field:function(s,e){this.writeTag(s,li.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(s,e){this.writeTag(s,li.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(s,e){this.writeTag(s,li.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(s,e){this.writeTag(s,li.Fixed64),this.writeSFixed64(e)},writeVarintField:function(s,e){this.writeTag(s,li.Varint),this.writeVarint(e)},writeSVarintField:function(s,e){this.writeTag(s,li.Varint),this.writeSVarint(e)},writeStringField:function(s,e){this.writeTag(s,li.Bytes),this.writeString(e)},writeFloatField:function(s,e){this.writeTag(s,li.Fixed32),this.writeFloat(e)},writeDoubleField:function(s,e){this.writeTag(s,li.Fixed64),this.writeDouble(e)},writeBooleanField:function(s,e){this.writeVarintField(s,Boolean(e))}};class $a{constructor(e,{pixelRatio:o,version:l,stretchX:d,stretchY:m,content:_}){this.paddedRect=e,this.pixelRatio=o,this.stretchX=d,this.stretchY=m,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class qd{constructor(e,o){const l={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,l,m),this.addImages(o,d,m);const{w:_,h:E}=wu(m),T=new Eo({width:_||1,height:E||1});for(const O in e){const U=e[O],W=l[O].paddedRect;Eo.copy(U.data,T,{x:0,y:0},{x:W.x+1,y:W.y+1},U.data)}for(const O in o){const U=o[O],W=d[O].paddedRect,Y=W.x+1,ie=W.y+1,ye=U.data.width,Ee=U.data.height;Eo.copy(U.data,T,{x:0,y:0},{x:Y,y:ie},U.data),Eo.copy(U.data,T,{x:0,y:Ee-1},{x:Y,y:ie-1},{width:ye,height:1}),Eo.copy(U.data,T,{x:0,y:0},{x:Y,y:ie+Ee},{width:ye,height:1}),Eo.copy(U.data,T,{x:ye-1,y:0},{x:Y-1,y:ie},{width:1,height:Ee}),Eo.copy(U.data,T,{x:0,y:0},{x:Y+ye,y:ie},{width:1,height:Ee})}this.image=T,this.iconPositions=l,this.patternPositions=d}addImages(e,o,l){for(const d in e){const m=e[d],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(_),o[d]=new $a(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,o){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),o),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),o)}patchUpdatedImage(e,o,l){if(!e||!o||e.version===o.version)return;e.version=o.version;const[d,m]=e.tl;l.update(o.data,void 0,{x:d,y:m})}}yn("ImagePosition",$a),yn("ImageAtlas",qd);const Ga={horizontal:1,vertical:2,horizontalOnly:3};class uu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,o){const l=new uu;return l.scale=e||1,l.fontStack=o,l}static forImage(e){const o=new uu;return o.imageName=e,o}}class wa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,o){const l=new wa;for(let d=0;d<e.sections.length;d++){const m=e.sections[d];m.image?l.addImageSection(m):l.addTextSection(m,o)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(o,l){let d="";for(let m=0;m<o.length;m++){const _=o.charCodeAt(m+1)||null,E=o.charCodeAt(m-1)||null;d+=!l&&(_&&Bo(_)&&!Ec[o[m+1]]||E&&Bo(E)&&!Ec[o[m-1]])||!Ec[o[m]]?o[m]:Ec[o[m]]}return d}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&ju[this.text.charCodeAt(l)];l++)e++;let o=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&ju[this.text.charCodeAt(l)];l--)o--;this.text=this.text.substring(e,o),this.sectionIndex=this.sectionIndex.slice(e,o)}substring(e,o){const l=new wa;return l.text=this.text.substring(e,o),l.sectionIndex=this.sectionIndex.slice(e,o),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,o)=>Math.max(e,this.sections[o].scale),0)}addTextSection(e,o){this.text+=e.text,this.sections.push(uu.forText(e.scale,e.fontStack||o));const l=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(l)}addImageSection(e){const o=e.image?e.image.name:"";if(0===o.length)return void bn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(uu.forImage(o)),this.sectionIndex.push(this.sections.length-1)):bn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Uu(s,e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee){const Le=wa.fromFeature(s,d);let Ke;W===Ga.vertical&&Le.verticalizePunctuation(Y);const{processBidirectionalText:ot,processStyledBidirectionalText:xt}=le;if(ot&&1===Le.sections.length){Ke=[];const Et=ot(Le.toString(),Eu(Le,O,m,e,l,ie,ye));for(const kt of Et){const Kt=new wa;Kt.text=kt,Kt.sections=Le.sections;for(let nn=0;nn<kt.length;nn++)Kt.sectionIndex.push(0);Ke.push(Kt)}}else if(xt){Ke=[];const Et=xt(Le.text,Le.sectionIndex,Eu(Le,O,m,e,l,ie,ye));for(const kt of Et){const Kt=new wa;Kt.text=kt[0],Kt.sectionIndex=kt[1],Kt.sections=Le.sections,Ke.push(Kt)}}else Ke=function(Et,kt){const Kt=[],nn=Et.text;let dn=0;for(const Vt of kt)Kt.push(Et.substring(dn,Vt)),dn=Vt;return dn<nn.length&&Kt.push(Et.substring(dn,nn.length)),Kt}(Le,Eu(Le,O,m,e,l,ie,ye));const ut=[],bt={positionedLines:ut,text:Le.toString(),top:U[1],bottom:U[1],left:U[0],right:U[0],writingMode:W,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Et,kt,Kt,nn,dn,Vt,Yt,fn,$t,qn,Sn,Xr){let Jn=0,Sr=0,Nn=0;const er="right"===fn?1:"left"===fn?0:.5;let Nr=!1;for(const ci of dn){const ui=ci.getSections();for(const po of ui){if(po.imageName)continue;const Qi=kt[po.fontStack];if(Qi&&(Nr=void 0!==Qi.ascender&&void 0!==Qi.descender,!Nr))break}if(!Nr)break}let Us=0;for(const ci of dn){ci.trim();const ui=ci.getMaxScale(),po=24*(ui-1),Qi={positionedGlyphs:[],lineOffset:0};Et.positionedLines[Us]=Qi;const no=Qi.positionedGlyphs;let Gs=0;if(!ci.length()){Sr+=Vt,++Us;continue}let Ei=0,la=0;for(let Ri=0;Ri<ci.length();Ri++){const Ji=ci.getSection(Ri),Co=ci.getSectionIndex(Ri),mo=ci.getCharCode(Ri);let hi=Ji.scale,ni=null,ca=null,Za=null,dl=24,Ha=0;const fl=!($t===Ga.horizontal||!Sn&&!Xs(mo)||Sn&&(ju[mo]||(Hi=mo,Na(Hi)||Dl(Hi)||Ql(Hi)||me(Hi)||En(Hi))));if(Ji.imageName){const hc=nn[Ji.imageName];if(!hc)continue;Za=Ji.imageName,Et.iconsInText=Et.iconsInText||!0,ca=hc.paddedRect;const Zo=hc.displaySize;hi=24*hi/Xr,ni={width:Zo[0],height:Zo[1],left:1,top:-3,advance:fl?Zo[1]:Zo[0],localGlyph:!1},Ha=Nr?-ni.height*hi:24*ui-17-Zo[1]*hi,dl=ni.advance;const Vl=(fl?Zo[0]:Zo[1])*hi-24*ui;Vl>0&&Vl>Gs&&(Gs=Vl)}else{const hc=Kt[Ji.fontStack];if(!hc)continue;hc[mo]&&(ca=hc[mo]);const Zo=kt[Ji.fontStack];if(!Zo)continue;const Vl=Zo.glyphs[mo];if(!Vl)continue;if(ni=Vl.metrics,dl=8203!==mo?24:0,Nr){const Tc=void 0!==Zo.ascender?Math.abs(Zo.ascender):0,qa=void 0!==Zo.descender?Math.abs(Zo.descender):0,pu=(Tc+qa)*hi;Ei<pu&&(Ei=pu,la=(Tc-qa)/2*hi),Ha=-Tc*hi}else Ha=24*(ui-hi)-17}fl?(Et.verticalizable=!0,no.push({glyph:mo,imageName:Za,x:Jn,y:Sr+Ha,vertical:fl,scale:hi,localGlyph:ni.localGlyph,fontStack:Ji.fontStack,sectionIndex:Co,metrics:ni,rect:ca}),Jn+=dl*hi+qn):(no.push({glyph:mo,imageName:Za,x:Jn,y:Sr+Ha,vertical:fl,scale:hi,localGlyph:ni.localGlyph,fontStack:Ji.fontStack,sectionIndex:Co,metrics:ni,rect:ca}),Jn+=ni.advance*hi+qn)}0!==no.length&&(Nn=Math.max(Jn-qn,Nn),Nr?Mg(no,er,Gs,la,Vt*ui/2):Mg(no,er,Gs,0,Vt/2)),Jn=0;const Bi=Vt*ui+Gs;Qi.lineOffset=Math.max(Gs,po),Sr+=Bi,++Us}var Hi;const js=Sr,{horizontalAlign:$s,verticalAlign:os}=Gu(Yt);(function(ci,ui,po,Qi,no,Gs){const Ei=(ui-po)*no,la=-Gs*Qi;for(const Bi of ci)for(const Ri of Bi.positionedGlyphs)Ri.x+=Ei,Ri.y+=la})(Et.positionedLines,er,$s,os,Nn,js),Et.top+=-os*js,Et.bottom=Et.top+js,Et.left+=-$s*Nn,Et.right=Et.left+Nn,Et.hasBaseline=Nr}(bt,e,o,l,Ke,_,E,T,W,O,Y,Ee),!function(Et){for(const kt of Et)if(0!==kt.positionedGlyphs.length)return!1;return!0}(ut)&&bt}const ju={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Wd={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ag(s,e,o,l,d,m){if(e.imageName){const _=l[e.imageName];return _?_.displaySize[0]*e.scale*24/m+d:0}{const _=o[e.fontStack],E=_&&_.glyphs[s];return E?E.metrics.advance*e.scale+d:0}}function Yd(s,e,o,l){const d=Math.pow(s-e,2);return l?s<e?d/2:2*d:d+Math.abs(o)*o}function Iy(s,e,o){let l=0;return 10===s&&(l-=1e4),o&&(l+=150),40!==s&&65288!==s||(l+=50),41!==e&&65289!==e||(l+=50),l}function ac(s,e,o,l,d,m){let _=null,E=Yd(e,o,d,m);for(const T of l){const O=Yd(e-T.x,o,d,m)+T.badness;O<=E&&(_=T,E=O)}return{index:s,x:e,priorBreak:_,badness:E}}function $u(s){return s?$u(s.priorBreak).concat(s.index):[]}function Eu(s,e,o,l,d,m,_){if("point"!==m)return[];if(!s)return[];const E=[],T=function(Y,ie,ye,Ee,Le,Ke){let ot=0;for(let xt=0;xt<Y.length();xt++){const ut=Y.getSection(xt);ot+=Ag(Y.getCharCode(xt),ut,Ee,Le,ie,Ke)}return ot/Math.max(1,Math.ceil(ot/ye))}(s,e,o,l,d,_),O=s.text.indexOf("\u200b")>=0;let U=0;for(let Y=0;Y<s.length();Y++){const ie=s.getSection(Y),ye=s.getCharCode(Y);if(ju[ye]||(U+=Ag(ye,ie,l,d,e,_)),Y<s.length()-1){const Ee=!((W=ye)<11904||!(ba(W)||Ml(W)||et(W)||ne(W)||Jl(W)||xa(W)||Il(W)||na(W)||bc(W)||B(W)||ra(W)||dr(W)||Al(W)||Nc(W)||ol(W)||al(W)||za(W)||ze(W)||S(W)||P(W)));(Wd[ye]||Ee||ie.imageName)&&E.push(ac(Y+1,U,T,E,Iy(ye,s.getCharCode(Y+1),Ee&&O),!1))}}var W;return $u(ac(s.length(),U,T,E,0,!0))}function Gu(s){let e=.5,o=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:e,verticalAlign:o}}function Mg(s,e,o,l,d){if(!(e||o||l||d))return;const m=s.length-1,_=s[m],E=(_.x+_.metrics.advance*_.scale)*e;for(let T=0;T<=m;T++)s[T].x-=E,s[T].y+=o+l+d}function Ig(s,e,o){const{horizontalAlign:l,verticalAlign:d}=Gu(o),m=e[0]-s.displaySize[0]*l,_=e[1]-s.displaySize[1]*d;return{image:s,top:_,bottom:_+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function Kd(s,e,o,l,d,m){const _=s.image;let E;if(_.content){const Le=_.content,Ke=_.pixelRatio||1;E=[Le[0]/Ke,Le[1]/Ke,_.displaySize[0]-Le[2]/Ke,_.displaySize[1]-Le[3]/Ke]}const T=e.left*m,O=e.right*m;let U,W,Y,ie;"width"===o||"both"===o?(ie=d[0]+T-l[3],W=d[0]+O+l[1]):(ie=d[0]+(T+O-_.displaySize[0])/2,W=ie+_.displaySize[0]);const ye=e.top*m,Ee=e.bottom*m;return"height"===o||"both"===o?(U=d[1]+ye-l[0],Y=d[1]+Ee+l[2]):(U=d[1]+(ye+Ee-_.displaySize[1])/2,Y=U+_.displaySize[1]),{image:_,top:U,right:W,bottom:Y,left:ie,collisionPadding:E}}class hu extends ce{constructor(e,o,l,d,m){super(e,o),this.angle=d,this.z=l,void 0!==m&&(this.segment=m)}clone(){return new hu(this.x,this.y,this.z,this.angle,this.segment)}}function $p(s,e,o,l,d){if(void 0===e.segment)return!0;let m=e,_=e.segment+1,E=0;for(;E>-o/2;){if(_--,_<0)return!1;E-=s[_].dist(m),m=s[_]}E+=s[_].dist(s[_+1]),_++;const T=[];let O=0;for(;E<o/2;){const U=s[_],W=s[_+1];if(!W)return!1;let Y=s[_-1].angleTo(U)-U.angleTo(W);for(Y=Math.abs((Y+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:E,angleDelta:Y}),O+=Y;E-T[0].distance>l;)O-=T.shift().angleDelta;if(O>d)return!1;_++,E+=U.dist(W)}return!0}function Pg(s){let e=0;for(let o=0;o<s.length-1;o++)e+=s[o].dist(s[o+1]);return e}function Xd(s,e,o){return s?.6*e*o:0}function Qd(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function Rg(s,e,o,l,d,m){const _=Xd(o,d,m),E=Qd(o,l)*m;let T=0;const O=Pg(s)/2;for(let U=0;U<s.length-1;U++){const W=s[U],Y=s[U+1],ie=W.dist(Y);if(T+ie>O){const ye=(O-T)/ie,Ee=gr(W.x,Y.x,ye),Le=gr(W.y,Y.y,ye),Ke=new hu(Ee,Le,0,Y.angleTo(W),U);return!_||$p(s,Ke,E,_,e)?Ke:void 0}T+=ie}}function Jd(s,e,o,l,d,m,_,E,T){const O=Xd(l,m,_),U=Qd(l,d),W=U*_,Y=0===s[0].x||s[0].x===T||0===s[0].y||s[0].y===T;return e-W<e/4&&(e=W+e/4),kg(s,Y?e/2*E%e:(U/2+2*m)*_*E%e,e,O,o,W,Y,!1,T)}function kg(s,e,o,l,d,m,_,E,T){const O=m/2,U=Pg(s);let W=0,Y=e-o,ie=[];for(let ye=0;ye<s.length-1;ye++){const Ee=s[ye],Le=s[ye+1],Ke=Ee.dist(Le),ot=Le.angleTo(Ee);for(;Y+o<W+Ke;){Y+=o;const xt=(Y-W)/Ke,ut=gr(Ee.x,Le.x,xt),bt=gr(Ee.y,Le.y,xt);if(ut>=0&&ut<T&&bt>=0&&bt<T&&Y-O>=0&&Y+O<=U){const Et=new hu(ut,bt,0,ot,ye);Et._round(),l&&!$p(s,Et,m,l,d)||ie.push(Et)}}W+=Ke}return E||ie.length||_||(ie=kg(s,W/2,o,l,d,m,_,!0,T)),ie}function Og(s,e,o,l,d){const m=[];for(let _=0;_<s.length;_++){const E=s[_];let T;for(let O=0;O<E.length-1;O++){let U=E[O],W=E[O+1];U.x<e&&W.x<e||(U.x<e?U=new ce(e,U.y+(e-U.x)/(W.x-U.x)*(W.y-U.y))._round():W.x<e&&(W=new ce(e,U.y+(e-U.x)/(W.x-U.x)*(W.y-U.y))._round()),U.y<o&&W.y<o||(U.y<o?U=new ce(U.x+(o-U.y)/(W.y-U.y)*(W.x-U.x),o)._round():W.y<o&&(W=new ce(U.x+(o-U.y)/(W.y-U.y)*(W.x-U.x),o)._round()),U.x>=l&&W.x>=l||(U.x>=l?U=new ce(l,U.y+(l-U.x)/(W.x-U.x)*(W.y-U.y))._round():W.x>=l&&(W=new ce(l,U.y+(l-U.x)/(W.x-U.x)*(W.y-U.y))._round()),U.y>=d&&W.y>=d||(U.y>=d?U=new ce(U.x+(d-U.y)/(W.y-U.y)*(W.x-U.x),d)._round():W.y>=d&&(W=new ce(U.x+(d-U.y)/(W.y-U.y)*(W.x-U.x),d)._round()),T&&U.equals(T[T.length-1])||(T=[U],m.push(T)),T.push(W)))))}}return m}yn("Anchor",hu);const Eh=1e20;function Fg(s,e,o,l,d,m,_,E,T){for(let O=e;O<e+l;O++)Lg(s,o*m+O,m,d,_,E,T);for(let O=o;O<o+d;O++)Lg(s,O*m+e,1,l,_,E,T)}function Lg(s,e,o,l,d,m,_){m[0]=0,_[0]=-Eh,_[1]=Eh,d[0]=s[e];for(let E=1,T=0,O=0;E<l;E++){d[E]=s[e+E*o];const U=E*E;do{const W=m[T];O=(d[E]-d[W]+U-W*W)/(E-W)/2}while(O<=_[T]&&--T>-1);T++,m[T]=E,_[T]=O,_[T+1]=Eh}for(let E=0,T=0;E<l;E++){for(;_[T+1]<E;)T++;const O=m[T],U=E-O;s[e+E*o]=d[O]+U*U}}const Gp={none:0,ideographs:1,all:2};class Zu{constructor(e,o,l){this.requestManager=e,this.localGlyphMode=o,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,o){const l=[];for(const d in e)for(const m of e[d])l.push({stack:d,id:m});Ge(l,({stack:d,id:m},_)=>{let E=this.entries[d];E||(E=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=E.glyphs[m];if(void 0!==T)return void _(null,{stack:d,id:m,glyph:T});if(T=this._tinySDF(E,d,m),T)return E.glyphs[m]=T,void _(null,{stack:d,id:m,glyph:T});const O=Math.floor(m/256);if(256*O>65535)return void _(new Error("glyphs > 65535 not supported"));if(E.ranges[O])return void _(null,{stack:d,id:m,glyph:T});let U=E.requests[O];U||(U=E.requests[O]=[],Zu.loadGlyphRange(d,O,this.url,this.requestManager,(W,Y)=>{if(Y){E.ascender=Y.ascender,E.descender=Y.descender;for(const ie in Y.glyphs)this._doesCharSupportLocalGlyph(+ie)||(E.glyphs[+ie]=Y.glyphs[+ie]);E.ranges[O]=!0}for(const ie of U)ie(W,Y);delete E.requests[O]})),U.push((W,Y)=>{W?_(W):Y&&_(null,{stack:d,id:m,glyph:Y.glyphs[m]||null})})},(d,m)=>{if(d)o(d);else if(m){const _={};for(const{stack:E,id:T,glyph:O}of m)void 0===_[E]&&(_[E]={}),void 0===_[E].glyphs&&(_[E].glyphs={}),_[E].glyphs[T]=O&&{id:O.id,bitmap:O.bitmap.clone(),metrics:O.metrics},_[E].ascender=this.entries[E].ascender,_[E].descender=this.entries[E].descender;o(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Gp.none&&(this.localGlyphMode===Gp.all?!!this.localFontFamily:!!this.localFontFamily&&(B(e)||G(e)||Al(e)||za(e))||na(e))}_tinySDF(e,o,l){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let Ee="400";/bold/i.test(o)?Ee="900":/medium/i.test(o)?Ee="500":/light/i.test(o)&&(Ee="200"),m=e.tinySDF=new Zu.TinySDF({fontFamily:d,fontWeight:Ee,fontSize:48,buffer:6,radius:16}),m.fontWeight=Ee}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const _=String.fromCharCode(l),{data:E,width:T,height:O,glyphWidth:U,glyphHeight:W,glyphLeft:Y,glyphTop:ie,glyphAdvance:ye}=m.draw(_);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new vs({width:T,height:O},E),metrics:{width:U/2,height:W/2,left:Y/2,top:ie/2-27,advance:ye/2,localGlyph:!0}}}}function Ng(s,e,o,l){const d=[],m=s.image,_=m.pixelRatio,E=m.paddedRect.w-2,T=m.paddedRect.h-2,O=s.right-s.left,U=s.bottom-s.top,W=m.stretchX||[[0,E]],Y=m.stretchY||[[0,T]],ie=(Vt,Yt)=>Vt+Yt[1]-Yt[0],ye=W.reduce(ie,0),Ee=Y.reduce(ie,0),Le=E-ye,Ke=T-Ee;let ot=0,xt=ye,ut=0,bt=Ee,Et=0,kt=Le,Kt=0,nn=Ke;if(m.content&&l){const Vt=m.content;ot=ef(W,0,Vt[0]),ut=ef(Y,0,Vt[1]),xt=ef(W,Vt[0],Vt[2]),bt=ef(Y,Vt[1],Vt[3]),Et=Vt[0]-ot,Kt=Vt[1]-ut,kt=Vt[2]-Vt[0]-xt,nn=Vt[3]-Vt[1]-bt}const dn=(Vt,Yt,fn,$t)=>{const qn=tf(Vt.stretch-ot,xt,O,s.left),Sn=zl(Vt.fixed-Et,kt,Vt.stretch,ye),Xr=tf(Yt.stretch-ut,bt,U,s.top),Jn=zl(Yt.fixed-Kt,nn,Yt.stretch,Ee),Sr=tf(fn.stretch-ot,xt,O,s.left),Nn=zl(fn.fixed-Et,kt,fn.stretch,ye),er=tf($t.stretch-ut,bt,U,s.top),Nr=zl($t.fixed-Kt,nn,$t.stretch,Ee),Us=new ce(qn,Xr),Hi=new ce(Sr,Xr),js=new ce(Sr,er),$s=new ce(qn,er),os=new ce(Sn/_,Jn/_),ci=new ce(Nn/_,Nr/_),ui=e*Math.PI/180;if(ui){const no=Math.sin(ui),Gs=Math.cos(ui),Ei=[Gs,-no,no,Gs];Us._matMult(Ei),Hi._matMult(Ei),$s._matMult(Ei),js._matMult(Ei)}const po=Vt.stretch+Vt.fixed,Qi=Yt.stretch+Yt.fixed;return{tl:Us,tr:Hi,bl:$s,br:js,tex:{x:m.paddedRect.x+1+po,y:m.paddedRect.y+1+Qi,w:fn.stretch+fn.fixed-po,h:$t.stretch+$t.fixed-Qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:os,pixelOffsetBR:ci,minFontScaleX:kt/_/O,minFontScaleY:nn/_/U,isSDF:o}};if(l&&(m.stretchX||m.stretchY)){const Vt=zg(W,Le,ye),Yt=zg(Y,Ke,Ee);for(let fn=0;fn<Vt.length-1;fn++){const $t=Vt[fn],qn=Vt[fn+1];for(let Sn=0;Sn<Yt.length-1;Sn++)d.push(dn($t,Yt[Sn],qn,Yt[Sn+1]))}}else d.push(dn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:T+1}));return d}function ef(s,e,o){let l=0;for(const d of s)l+=Math.max(e,Math.min(o,d[1]))-Math.max(e,Math.min(o,d[0]));return l}function zg(s,e,o){const l=[{fixed:-1,stretch:0}];for(const[d,m]of s){const _=l[l.length-1];l.push({fixed:d-_.stretch,stretch:_.stretch}),l.push({fixed:d-_.stretch,stretch:_.stretch+(m-d)})}return l.push({fixed:e+1,stretch:o}),l}function tf(s,e,o,l){return s/e*o+l}function zl(s,e,o,l){return s-e*o/l}function nf(s,e,o,l){const d=e+s.positionedLines[l].lineOffset;return 0===l?o+d/2:o+(d+(e+s.positionedLines[l-1].lineOffset))/2}Zu.loadGlyphRange=function(s,e,o,l,d){const m=256*e,_=m+255,E=l.transformRequest(l.normalizeGlyphsURL(o).replace("{fontstack}",s).replace("{range}",`${m}-${_}`),ro.Glyphs);k(E,(T,O)=>{if(T)d(T);else if(O){const U={},W=new xu(O).readFields(Tr,{});for(const Y of W.glyphs)U[Y.id]=Y;d(null,{glyphs:U,ascender:W.ascender,descender:W.descender})}})},Zu.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:o=8,cutoff:l=.25,fontFamily:d="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}){this.buffer=e,this.cutoff=l,this.radius=o;const E=this.size=s+4*e,T=this._createCanvas(E),O=this.ctx=T.getContext("2d",{willReadFrequently:!0});O.font=`${_} ${m} ${s}px ${d}`,O.textBaseline="alphabetic",O.textAlign="left",O.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:o,actualBoundingBoxDescent:l,actualBoundingBoxLeft:d,actualBoundingBoxRight:m}=this.ctx.measureText(s),_=Math.floor(o),E=Math.min(this.size-this.buffer,Math.ceil(m-d)),T=Math.min(this.size-this.buffer,Math.ceil(o)+Math.ceil(l)),O=E+2*this.buffer,U=T+2*this.buffer,W=O*U,Y=new Uint8ClampedArray(W),ie={data:Y,width:O,height:U,glyphWidth:E,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===E||0===T)return ie;const{ctx:ye,buffer:Ee,gridInner:Le,gridOuter:Ke}=this;ye.clearRect(Ee,Ee,E,T),ye.fillText(s,Ee,Ee+_+1);const ot=ye.getImageData(Ee,Ee,E,T);Ke.fill(Eh,0,W),Le.fill(0,0,W);for(let xt=0;xt<T;xt++)for(let ut=0;ut<E;ut++){const bt=ot.data[4*(xt*E+ut)+3]/255;if(0===bt)continue;const Et=(xt+Ee)*O+ut+Ee;if(1===bt)Ke[Et]=0,Le[Et]=Eh;else{const kt=.5-bt;Ke[Et]=kt>0?kt*kt:0,Le[Et]=kt<0?kt*kt:0}}Fg(Ke,0,0,O,U,O,this.f,this.v,this.z),Fg(Le,Ee,Ee,E,T,O,this.f,this.v,this.z);for(let xt=0;xt<W;xt++){const ut=Math.sqrt(Ke[xt])-Math.sqrt(Le[xt]);Y[xt]=Math.round(255-255*(ut/this.radius+this.cutoff))}return ie}};class Bg{constructor(e=[],o=Zp){if(this.data=e,this.length=this.data.length,this.compare=o,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:o,compare:l}=this,d=o[e];for(;e>0;){const m=e-1>>1,_=o[m];if(l(d,_)>=0)break;o[e]=_,e=m}o[e]=d}_down(e){const{data:o,compare:l}=this,d=this.length>>1,m=o[e];for(;e<d;){let _=1+(e<<1),E=o[_];const T=_+1;if(T<this.length&&l(o[T],E)<0&&(_=T,E=o[T]),l(E,m)>=0)break;o[e]=E,e=_}o[e]=m}}function Zp(s,e){return s<e?-1:s>e?1:0}function rf(s,e=1,o=!1){let l=1/0,d=1/0,m=-1/0,_=-1/0;const E=s[0];for(let ie=0;ie<E.length;ie++){const ye=E[ie];(!ie||ye.x<l)&&(l=ye.x),(!ie||ye.y<d)&&(d=ye.y),(!ie||ye.x>m)&&(m=ye.x),(!ie||ye.y>_)&&(_=ye.y)}const T=Math.min(m-l,_-d);let O=T/2;const U=new Bg([],Hp);if(0===T)return new ce(l,d);for(let ie=l;ie<m;ie+=T)for(let ye=d;ye<_;ye+=T)U.push(new $c(ie+O,ye+O,O,s));let W=function(ie){let ye=0,Ee=0,Le=0;const Ke=ie[0];for(let ot=0,xt=Ke.length,ut=xt-1;ot<xt;ut=ot++){const bt=Ke[ot],Et=Ke[ut],kt=bt.x*Et.y-Et.x*bt.y;Ee+=(bt.x+Et.x)*kt,Le+=(bt.y+Et.y)*kt,ye+=3*kt}return new $c(Ee/ye,Le/ye,0,ie)}(s),Y=U.length;for(;U.length;){const ie=U.pop();(ie.d>W.d||!W.d)&&(W=ie,o&&console.log("found best %d after %d probes",Math.round(1e4*ie.d)/1e4,Y)),ie.max-W.d<=e||(O=ie.h/2,U.push(new $c(ie.p.x-O,ie.p.y-O,O,s)),U.push(new $c(ie.p.x+O,ie.p.y-O,O,s)),U.push(new $c(ie.p.x-O,ie.p.y+O,O,s)),U.push(new $c(ie.p.x+O,ie.p.y+O,O,s)),Y+=4)}return o&&(console.log(`num probes: ${Y}`),console.log(`best distance: ${W.d}`)),W.p}function Hp(s,e){return e.max-s.max}function $c(s,e,o,l){this.p=new ce(s,e),this.h=o,this.d=function(d,m){let _=!1,E=1/0;for(let T=0;T<m.length;T++){const O=m[T];for(let U=0,W=O.length,Y=W-1;U<W;Y=U++){const ie=O[U],ye=O[Y];ie.y>d.y!=ye.y>d.y&&d.x<(ye.x-ie.x)*(d.y-ie.y)/(ye.y-ie.y)+ie.x&&(_=!_),E=Math.min(E,yd(d,ie,ye))}}return(_?1:-1)*Math.sqrt(E)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const sf=Number.POSITIVE_INFINITY,Gc=Math.sqrt(2);function of(s,e){return e[1]!==sf?function(o,l,d){let m=0,_=0;switch(l=Math.abs(l),d=Math.abs(d),o){case"top-right":case"top-left":case"top":_=d-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-d}switch(o){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,_]}(s,e[0],e[1]):function(o,l){let d=0,m=0;l<0&&(l=0);const _=l/Gc;switch(o){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(o){case"top-right":case"bottom-right":d=-_;break;case"top-left":case"bottom-left":d=_;break;case"left":d=l;break;case"right":d=-l}return[d,m]}(s,e[0])}function Vg(s,e,o,l,d,m,_,E){s.createArrays(),s.tilePixelRatio=ti/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const T=s.layers[0].layout,O=s.layers[0]._unevaluatedLayout._values,U={};if("composite"===s.textSizeData.kind){const{minZoom:ie,maxZoom:ye}=s.textSizeData;U.compositeTextSizes=[O["text-size"].possiblyEvaluate(new pe(ie),_),O["text-size"].possiblyEvaluate(new pe(ye),_)]}if("composite"===s.iconSizeData.kind){const{minZoom:ie,maxZoom:ye}=s.iconSizeData;U.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new pe(ie),_),O["icon-size"].possiblyEvaluate(new pe(ye),_)]}U.layoutTextSize=O["text-size"].possiblyEvaluate(new pe(E+1),_),U.layoutIconSize=O["icon-size"].possiblyEvaluate(new pe(E+1),_),U.textMaxSize=O["text-size"].possiblyEvaluate(new pe(18),_);const W="map"===T.get("text-rotation-alignment")&&"point"!==T.get("symbol-placement"),Y=T.get("text-size");for(const ie of s.features){const ye=T.get("text-font").evaluate(ie,{},_).join(","),Ee=Y.evaluate(ie,{},_),Le=U.layoutTextSize.evaluate(ie,{},_),Ke=(U.layoutIconSize.evaluate(ie,{},_),{horizontal:{},vertical:void 0}),ot=ie.text;let xt,ut=[0,0];if(ot){const kt=ot.toString(),Kt=24*T.get("text-letter-spacing").evaluate(ie,{},_),nn=24*T.get("text-line-height").evaluate(ie,{},_),dn=fi(kt)?Kt:0,Vt=T.get("text-anchor").evaluate(ie,{},_),Yt=T.get("text-variable-anchor");if(!Yt){const Jn=T.get("text-radial-offset").evaluate(ie,{},_);ut=Jn?of(Vt,[24*Jn,sf]):T.get("text-offset").evaluate(ie,{},_).map(Sr=>24*Sr)}let fn=W?"center":T.get("text-justify").evaluate(ie,{},_);const $t=T.get("symbol-placement"),qn="point"===$t,Sn="point"===$t?24*T.get("text-max-width").evaluate(ie,{},_):0,Xr=Jn=>{s.allowVerticalPlacement&&Un(kt)&&(Ke.vertical=Uu(ot,e,o,d,ye,Sn,nn,Vt,Jn,dn,ut,Ga.vertical,!0,$t,Le,Ee))};if(!W&&Yt){const Jn="auto"===fn?Yt.map(Nn=>qp(Nn)):[fn];let Sr=!1;for(let Nn=0;Nn<Jn.length;Nn++){const er=Jn[Nn];if(!Ke.horizontal[er])if(Sr)Ke.horizontal[er]=Ke.horizontal[0];else{const Nr=Uu(ot,e,o,d,ye,Sn,nn,"center",er,dn,ut,Ga.horizontal,!1,$t,Le,Ee);Nr&&(Ke.horizontal[er]=Nr,Sr=1===Nr.positionedLines.length)}}Xr("left")}else{if("auto"===fn&&(fn=qp(Vt)),qn||T.get("text-writing-mode").indexOf("horizontal")>=0||!Un(kt)){const Jn=Uu(ot,e,o,d,ye,Sn,nn,Vt,fn,dn,ut,Ga.horizontal,!1,$t,Le,Ee);Jn&&(Ke.horizontal[fn]=Jn)}Xr("point"===$t?"left":fn)}}let bt=!1;if(ie.icon&&ie.icon.name){const kt=l[ie.icon.name];kt&&(xt=Ig(d[ie.icon.name],T.get("icon-offset").evaluate(ie,{},_),T.get("icon-anchor").evaluate(ie,{},_)),bt=kt.sdf,void 0===s.sdfIcons?s.sdfIcons=kt.sdf:s.sdfIcons!==kt.sdf&&bn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(kt.pixelRatio!==s.pixelRatio||0!==T.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Et=Wp(Ke.horizontal)||Ke.vertical;s.iconsInText||(s.iconsInText=!!Et&&Et.iconsInText),(Et||xt)&&af(s,ie,Ke,xt,l,U,Le,0,ut,bt,_)}m&&s.generateCollisionDebugBuffers(E,s.collisionBoxArray)}function qp(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function af(s,e,o,l,d,m,_,E,T,O,U){let W=m.textMaxSize.evaluate(e,{},U);void 0===W&&(W=_);const Y=s.layers[0].layout,ie=Y.get("icon-offset").evaluate(e,{},U),ye=Wp(o.horizontal)||o.vertical,Ee=_/24,Le=s.tilePixelRatio*W/24,Ke=s.tilePixelRatio*Y.get("symbol-spacing"),ot=Y.get("text-padding")*s.tilePixelRatio,xt=Y.get("icon-padding")*s.tilePixelRatio,ut=Oe(Y.get("text-max-angle")),bt="map"===Y.get("text-rotation-alignment")&&"point"!==Y.get("symbol-placement"),Et="map"===Y.get("icon-rotation-alignment")&&"point"!==Y.get("symbol-placement"),kt=Y.get("symbol-placement"),Kt=Ke/2,nn=Y.get("icon-text-fit");let dn;l&&"none"!==nn&&(s.allowVerticalPlacement&&o.vertical&&(dn=Kd(l,o.vertical,nn,Y.get("icon-text-fit-padding"),ie,Ee)),ye&&(l=Kd(l,ye,nn,Y.get("icon-text-fit-padding"),ie,Ee)));const Vt=(Yt,fn)=>{fn.x<0||fn.x>=ti||fn.y<0||fn.y>=ti||function($t,qn,Sn,Xr,Jn,Sr,Nn,er,Nr,Us,Hi,js,$s,os,ci,ui,po,Qi,no,Gs,Ei,la,Bi,Ri){const Ji=$t.addToLineVertexArray(qn,Xr);let Co,mo,hi,ni,ca,Za,dl,Ha=0,fl=0,hc=0,Zo=0,Vl=-1,Tc=-1;const qa={};let pu=sa(""),bf=0,wf=0;if(void 0===Nr._unevaluatedLayout.getValue("text-radial-offset")?[bf,wf]=Nr.layout.get("text-offset").evaluate(Ei,{},Ri).map(Ca=>24*Ca):(bf=24*Nr.layout.get("text-radial-offset").evaluate(Ei,{},Ri),wf=sf),$t.allowVerticalPlacement&&Jn.vertical){const Ca=Jn.vertical;if(ci)Za=du(Ca),er&&(dl=du(er));else{const To=Nr.layout.get("text-rotate").evaluate(Ei,{},Ri)+90;hi=Ch(Us,Sn,qn,Hi,js,$s,Ca,os,To,ui),er&&(ni=Ch(Us,Sn,qn,Hi,js,$s,er,Qi,To))}}if(Sr){const Ca=Nr.layout.get("icon-rotate").evaluate(Ei,{},Ri),To="none"!==Nr.layout.get("icon-text-fit"),dc=Ng(Sr,Ca,Bi,To),$h=er?Ng(er,Ca,Bi,To):void 0;mo=Ch(Us,Sn,qn,Hi,js,$s,Sr,Qi,Ca),Ha=4*dc.length;const pl=$t.iconSizeData;let Ul=null;"source"===pl.kind?(Ul=[ja*Nr.layout.get("icon-size").evaluate(Ei,{},Ri)],Ul[0]>Zc&&bn(`${$t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===pl.kind&&(Ul=[ja*la.compositeIconSizes[0].evaluate(Ei,{},Ri),ja*la.compositeIconSizes[1].evaluate(Ei,{},Ri)],(Ul[0]>Zc||Ul[1]>Zc)&&bn(`${$t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),$t.addSymbols($t.icon,dc,Ul,Gs,no,Ei,!1,Sn,qn,Ji.lineStartIndex,Ji.lineLength,-1,Ri),Vl=$t.icon.placedSymbolArray.length-1,$h&&(fl=4*$h.length,$t.addSymbols($t.icon,$h,Ul,Gs,no,Ei,Ga.vertical,Sn,qn,Ji.lineStartIndex,Ji.lineLength,-1,Ri),Tc=$t.icon.placedSymbolArray.length-1)}for(const Ca in Jn.horizontal){const To=Jn.horizontal[Ca];Co||(pu=sa(To.text),ci?ca=du(To):Co=Ch(Us,Sn,qn,Hi,js,$s,To,os,Nr.layout.get("text-rotate").evaluate(Ei,{},Ri),ui));const dc=1===To.positionedLines.length;if(hc+=lf($t,Sn,qn,To,Nn,Nr,ci,Ei,ui,Ji,Jn.vertical?Ga.horizontal:Ga.horizontalOnly,dc?Object.keys(Jn.horizontal):[Ca],qa,Vl,la,Ri),dc)break}Jn.vertical&&(Zo+=lf($t,Sn,qn,Jn.vertical,Nn,Nr,ci,Ei,ui,Ji,Ga.vertical,["vertical"],qa,Tc,la,Ri));let Kc=-1;const Ef=(Ca,To)=>Ca?Math.max(Ca,To):To;Kc=Ef(ca,Kc),Kc=Ef(Za,Kc),Kc=Ef(dl,Kc);const Yg=Kc>-1?1:0;$t.glyphOffsetArray.length>=lc.MAX_GLYPHS&&bn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ei.sortKey&&$t.addToSortKeyRanges($t.symbolInstances.length,Ei.sortKey),$t.symbolInstances.emplaceBack(Sn.x,Sn.y,Sn.z,qn.x,qn.y,qa.right>=0?qa.right:-1,qa.center>=0?qa.center:-1,qa.left>=0?qa.left:-1,qa.vertical>=0?qa.vertical:-1,Vl,Tc,pu,void 0!==Co?Co:$t.collisionBoxArray.length,void 0!==Co?Co+1:$t.collisionBoxArray.length,void 0!==hi?hi:$t.collisionBoxArray.length,void 0!==hi?hi+1:$t.collisionBoxArray.length,void 0!==mo?mo:$t.collisionBoxArray.length,void 0!==mo?mo+1:$t.collisionBoxArray.length,ni||$t.collisionBoxArray.length,ni?ni+1:$t.collisionBoxArray.length,Hi,hc,Zo,Ha,fl,Yg,0,bf,wf,Kc)}(s,fn,fn,Yt,o,l,d,dn,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,ot,bt,T,0,xt,Et,ie,e,m,O,U)};if("line"===kt)for(const Yt of Og(e.geometry,0,0,ti,ti)){const fn=Jd(Yt,Ke,ut,o.vertical||ye,l,24,Le,s.overscaling,ti);for(const $t of fn){const qn=ye;qn&&Cu(s,qn.text,Kt,$t)||Vt(Yt,$t)}}else if("line-center"===kt){for(const Yt of e.geometry)if(Yt.length>1){const fn=Rg(Yt,ut,o.vertical||ye,l,24,Le);fn&&Vt(Yt,fn)}}else if("Polygon"===e.type)for(const Yt of Uc(e.geometry,0)){const fn=rf(Yt,16);Vt(Yt[0],new hu(fn.x,fn.y,0,0,void 0))}else if("LineString"===e.type)for(const Yt of e.geometry)Vt(Yt,new hu(Yt[0].x,Yt[0].y,0,0,void 0));else if("Point"===e.type)for(const Yt of e.geometry)for(const fn of Yt)Vt([fn],new hu(fn.x,fn.y,0,0,void 0))}const Zc=32640;function lf(s,e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee){const Le=function(xt,ut,bt,Et,kt,Kt,nn,dn){const Vt=[];if(0===ut.positionedLines.length)return Vt;const Yt=Et.layout.get("text-rotate").evaluate(Kt,{})*Math.PI/180,fn=function(Jn){const Sr=Jn[0],Nn=Jn[1],er=Sr*Nn;return er>0?[Sr,-Nn]:er<0?[-Sr,Nn]:0===Sr?[Nn,Sr]:[Nn,-Sr]}(bt);let $t=Math.abs(ut.top-ut.bottom);for(const Jn of ut.positionedLines)$t-=Jn.lineOffset;const qn=ut.positionedLines.length,Sn=$t/qn;let Xr=ut.top-bt[1];for(let Jn=0;Jn<qn;++Jn){const Sr=ut.positionedLines[Jn];Xr=nf(ut,Sn,Xr,Jn);for(const Nn of Sr.positionedGlyphs){if(!Nn.rect)continue;const er=Nn.rect||{};let Nr=4,Us=!0,Hi=1,js=0;if(Nn.imageName){const ni=nn[Nn.imageName];if(!ni)continue;if(ni.sdf){bn("SDF images are not supported in formatted text and will be ignored.");continue}Us=!1,Hi=ni.pixelRatio,Nr=1/Hi}const $s=(kt||dn)&&Nn.vertical,os=Nn.metrics.advance*Nn.scale/2,ci=Nn.metrics,ui=Nn.rect;if(null===ui)continue;dn&&ut.verticalizable&&(js=Nn.imageName?os-Nn.metrics.width*Nn.scale/2:0);const po=kt?[Nn.x+os,Nn.y]:[0,0];let Qi=[0,0],no=[0,0],Gs=!1;kt||($s?(no=[Nn.x+os+fn[0],Nn.y+fn[1]-js],Gs=!0):Qi=[Nn.x+os+bt[0],Nn.y+bt[1]-js]);const Ei=ui.w*Nn.scale/(Hi*(Nn.localGlyph?2:1)),la=ui.h*Nn.scale/(Hi*(Nn.localGlyph?2:1));let Bi,Ri,Ji,Co;if($s){const ni=Nn.y-Xr,ca=new ce(-os,os-ni),Za=-Math.PI/2,dl=new ce(...no);Bi=new ce(-os+Qi[0],Qi[1]),Bi._rotateAround(Za,ca)._add(dl),Bi.x+=-ni+os,Bi.y-=(ci.left-Nr)*Nn.scale;const Ha=Nn.imageName?ci.advance*Nn.scale:24*Nn.scale,fl=String.fromCharCode(Nn.glyph);xg(fl)?Bi.x+=(1-Nr)*Nn.scale:Op(fl)?Bi.x+=Ha-ci.height*Nn.scale+(-Nr-1)*Nn.scale:Bi.x+=Nn.imageName||ci.width+2*Nr===ui.w&&ci.height+2*Nr===ui.h?(Ha-la)/2:(Ha-(ci.height+2*Nr)*Nn.scale)/2,Ri=new ce(Bi.x,Bi.y-Ei),Ji=new ce(Bi.x+la,Bi.y),Co=new ce(Bi.x+la,Bi.y-Ei)}else{const ni=(ci.left-Nr)*Nn.scale-os+Qi[0],ca=(-ci.top-Nr)*Nn.scale+Qi[1],Za=ni+Ei,dl=ca+la;Bi=new ce(ni,ca),Ri=new ce(Za,ca),Ji=new ce(ni,dl),Co=new ce(Za,dl)}if(Yt){let ni;ni=kt?new ce(0,0):Gs?new ce(fn[0],fn[1]):new ce(bt[0],bt[1]),Bi._rotateAround(Yt,ni),Ri._rotateAround(Yt,ni),Ji._rotateAround(Yt,ni),Co._rotateAround(Yt,ni)}const mo=new ce(0,0),hi=new ce(0,0);Vt.push({tl:Bi,tr:Ri,bl:Ji,br:Co,tex:er,writingMode:ut.writingMode,glyphOffset:po,sectionIndex:Nn.sectionIndex,isSDF:Us,pixelOffsetTL:mo,pixelOffsetBR:hi,minFontScaleX:0,minFontScaleY:0})}}return Vt}(0,l,T,m,_,E,d,s.allowVerticalPlacement),Ke=s.textSizeData;let ot=null;"source"===Ke.kind?(ot=[ja*m.layout.get("text-size").evaluate(E,{},Ee)],ot[0]>Zc&&bn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Ke.kind&&(ot=[ja*ye.compositeTextSizes[0].evaluate(E,{},Ee),ja*ye.compositeTextSizes[1].evaluate(E,{},Ee)],(ot[0]>Zc||ot[1]>Zc)&&bn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,Le,ot,T,_,E,U,e,o,O.lineStartIndex,O.lineLength,ie,Ee);for(const xt of W)Y[xt]=s.text.placedSymbolArray.length-1;return 4*Le.length}function Wp(s){for(const e in s)return s[e];return null}function Ch(s,e,o,l,d,m,_,E,T,O){let U=_.top,W=_.bottom,Y=_.left,ie=_.right;const ye=_.collisionPadding;if(ye&&(Y-=ye[0],U-=ye[1],ie+=ye[2],W+=ye[3]),T){const Ee=new ce(Y,U),Le=new ce(ie,U),Ke=new ce(Y,W),ot=new ce(ie,W),xt=Oe(T);let ut=new ce(0,0);O&&(ut=new ce(O[0],O[1])),Ee._rotateAround(xt,ut),Le._rotateAround(xt,ut),Ke._rotateAround(xt,ut),ot._rotateAround(xt,ut),Y=Math.min(Ee.x,Le.x,Ke.x,ot.x),ie=Math.max(Ee.x,Le.x,Ke.x,ot.x),U=Math.min(Ee.y,Le.y,Ke.y,ot.y),W=Math.max(Ee.y,Le.y,Ke.y,ot.y)}return s.emplaceBack(e.x,e.y,e.z,o.x,o.y,Y,U,ie,W,E,l,d,m),s.length-1}function du(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function Cu(s,e,o,l){const d=s.compareText;if(e in d){const m=d[e];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<o)return!0}else d[e]=[];return d[e].push(l),!1}const cf=cl.VectorTileFeature.types,Tu=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Hc(s,e,o,l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee){const Le=U?Math.min(Zc,Math.round(U[0])):0,Ke=U?Math.min(Zc,Math.round(U[1])):0;s.emplaceBack(e,o,Math.round(32*_),Math.round(32*E),T,O,(Le<<1)+(W?1:0),Ke,16*Y,16*ie,256*ye,256*Ee,l,d,m,0)}function qc(s,e,o){s.emplaceBack(e.x,e.y,o),s.emplaceBack(e.x,e.y,o),s.emplaceBack(e.x,e.y,o),s.emplaceBack(e.x,e.y,o)}function Ug(s){for(const e of s.sections)if(f(e.text))return!0;return!1}class Th{constructor(e){this.layoutVertexArray=new Qs,this.indexArray=new ai,this.programConfigurations=e,this.segments=new Ms,this.dynamicLayoutVertexArray=new _r,this.opacityVertexArray=new Ba,this.placedSymbolArray=new or}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,o,l,d){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vg.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Tu,!0),this.opacityVertexBuffer.itemSize=1),(l||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}yn("SymbolBuffers",Th);class Sh{constructor(e,o,l){this.layoutVertexArray=new e,this.layoutAttributes=o,this.indexArray=new l,this.segments=new Ms,this.collisionVertexArray=new Va,this.collisionVertexArrayExt=new _r}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Pp.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Rp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yn("CollisionBuffers",Sh);class lc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=rp([]),this.placementViewportMatrix=rp([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=vu(this.zoom,o["text-size"]),this.iconSizeData=vu(this.zoom,o["icon-size"]);const l=this.layers[0].layout,d=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==d.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>Ga[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID}createArrays(){this.text=new Th(new Ua(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Th(new Ua(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new cr,this.lineVertexArray=new Cr,this.symbolInstances=new rr}calculateGlyphDependencies(e,o,l,d,m){for(let _=0;_<e.length;_++)if(o[e.charCodeAt(_)]=!0,d&&m){const E=Ec[e.charAt(_)];E&&(o[E.charCodeAt(0)]=!0)}}populate(e,o,l){const d=this.layers[0],m=d.layout,_=m.get("text-font"),E=m.get("text-field"),T=m.get("icon-image"),O=("constant"!==E.value.kind||E.value.value instanceof ur&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&("constant"!==_.value.kind||_.value.value.length>0),U="constant"!==T.value.kind||!!T.value.value||Object.keys(T.parameters).length>0,W=m.get("symbol-sort-key");if(this.features=[],!O&&!U)return;const Y=o.iconDependencies,ie=o.glyphDependencies,ye=o.availableImages,Ee=new pe(this.zoom);for(const{feature:Le,id:Ke,index:ot,sourceLayerIndex:xt}of e){const ut=d._featureFilter.needGeometry,bt=iu(Le,ut);if(!d._featureFilter.filter(Ee,bt,l))continue;let Et,kt;if(ut||(bt.geometry=ru(Le)),O){const nn=d.getValueAndResolveTokens("text-field",bt,l,ye),dn=ur.factory(nn);Ug(dn)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===re()||this.hasRTLText&&le.isParsed())&&(Et=Zd(dn,d,bt))}if(U){const nn=d.getValueAndResolveTokens("icon-image",bt,l,ye);kt=nn instanceof hs?nn:hs.fromString(nn)}if(!Et&&!kt)continue;const Kt=this.sortFeaturesByKey?W.evaluate(bt,{},l):void 0;if(this.features.push({id:Ke,text:Et,icon:kt,index:ot,sourceLayerIndex:xt,geometry:bt.geometry,properties:Le.properties,type:cf[Le.type],sortKey:Kt}),kt&&(Y[kt.name]=!0),Et){const nn=_.evaluate(bt,{},l).join(","),dn="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ga.vertical)>=0;for(const Vt of Et.sections)if(Vt.image)Y[Vt.image.name]=!0;else{const Yt=Un(Et.toString()),fn=Vt.fontStack||nn,$t=ie[fn]=ie[fn]||{};this.calculateGlyphDependencies(Vt.text,$t,dn,this.allowVerticalPlacement,Yt)}}}"line"===m.get("symbol-placement")&&(this.features=function(Le){const Ke={},ot={},xt=[];let ut=0;function bt(nn){xt.push(Le[nn]),ut++}function Et(nn,dn,Vt){const Yt=ot[nn];return delete ot[nn],ot[dn]=Yt,xt[Yt].geometry[0].pop(),xt[Yt].geometry[0]=xt[Yt].geometry[0].concat(Vt[0]),Yt}function kt(nn,dn,Vt){const Yt=Ke[dn];return delete Ke[dn],Ke[nn]=Yt,xt[Yt].geometry[0].shift(),xt[Yt].geometry[0]=Vt[0].concat(xt[Yt].geometry[0]),Yt}function Kt(nn,dn,Vt){const Yt=Vt?dn[0][dn[0].length-1]:dn[0][0];return`${nn}:${Yt.x}:${Yt.y}`}for(let nn=0;nn<Le.length;nn++){const dn=Le[nn],Vt=dn.geometry,Yt=dn.text?dn.text.toString():null;if(!Yt){bt(nn);continue}const fn=Kt(Yt,Vt),$t=Kt(Yt,Vt,!0);if(fn in ot&&$t in Ke&&ot[fn]!==Ke[$t]){const qn=kt(fn,$t,Vt),Sn=Et(fn,$t,xt[qn].geometry);delete Ke[fn],delete ot[$t],ot[Kt(Yt,xt[Sn].geometry,!0)]=Sn,xt[qn].geometry=null}else fn in ot?Et(fn,$t,Vt):$t in Ke?kt(fn,$t,Vt):(bt(nn),Ke[fn]=ut-1,ot[$t]=ut-1)}return xt.filter(nn=>nn.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Le,Ke)=>Le.sortKey-Ke.sortKey)}update(e,o,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,o,this.layers,l),this.icon.programConfigurations.updatePaintArrays(e,o,this.layers,l))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,o){const l=this.lineVertexArray.length;if(void 0!==e.segment){let d=e.dist(o[e.segment+1]),m=e.dist(o[e.segment]);const _={};for(let E=e.segment+1;E<o.length;E++)_[E]={x:o[E].x,y:o[E].y,tileUnitDistanceFromAnchor:d},E<o.length-1&&(d+=o[E+1].dist(o[E]));for(let E=e.segment||0;E>=0;E--)_[E]={x:o[E].x,y:o[E].y,tileUnitDistanceFromAnchor:m},E>0&&(m+=o[E-1].dist(o[E]));for(let E=0;E<o.length;E++){const T=_[E];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,o,l,d,m,_,E,T,O,U,W,Y,ie){const ye=e.indexArray,Ee=e.layoutVertexArray,Le=e.segments.prepareSegment(4*o.length,Ee,ye,this.canOverlap?_.sortKey:void 0),Ke=this.glyphOffsetArray.length,ot=Le.vertexLength,xt=this.allowVerticalPlacement&&E===Ga.vertical?Math.PI/2:0,ut=_.text&&_.text.sections;for(let bt=0;bt<o.length;bt++){const{tl:Et,tr:kt,bl:Kt,br:nn,tex:dn,pixelOffsetTL:Vt,pixelOffsetBR:Yt,minFontScaleX:fn,minFontScaleY:$t,glyphOffset:qn,isSDF:Sn,sectionIndex:Xr}=o[bt],Jn=Le.vertexLength,Sr=qn[1];Hc(Ee,T.x,T.y,T.z,O.x,O.y,Et.x,Sr+Et.y,dn.x,dn.y,l,Sn,Vt.x,Vt.y,fn,$t),Hc(Ee,T.x,T.y,T.z,O.x,O.y,kt.x,Sr+kt.y,dn.x+dn.w,dn.y,l,Sn,Yt.x,Vt.y,fn,$t),Hc(Ee,T.x,T.y,T.z,O.x,O.y,Kt.x,Sr+Kt.y,dn.x,dn.y+dn.h,l,Sn,Vt.x,Yt.y,fn,$t),Hc(Ee,T.x,T.y,T.z,O.x,O.y,nn.x,Sr+nn.y,dn.x+dn.w,dn.y+dn.h,l,Sn,Yt.x,Yt.y,fn,$t),qc(e.dynamicLayoutVertexArray,T,xt),ye.emplaceBack(Jn,Jn+1,Jn+2),ye.emplaceBack(Jn+1,Jn+2,Jn+3),Le.vertexLength+=4,Le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(qn[0]),bt!==o.length-1&&Xr===o[bt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Ee.length,_,_.index,{},ie,ut&&ut[Xr])}e.placedSymbolArray.emplaceBack(T.x,T.y,T.z,O.x,O.y,Ke,this.glyphOffsetArray.length-Ke,ot,U,W,O.segment,l?l[0]:0,l?l[1]:0,d[0],d[1],E,0,!1,0,Y,0)}_commitLayoutVertex(e,o,l,d,m,_,E){e.emplaceBack(o,l,d,m,_,Math.round(E.x),Math.round(E.y))}_addCollisionDebugVertices(e,o,l,d,m,_,E){const T=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),O=T.vertexLength,U=E.tileAnchorX,W=E.tileAnchorY;for(let ie=0;ie<4;ie++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(o,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(o,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(o,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(o,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,U,W,new ce(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,U,W,new ce(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,U,W,new ce(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,d,m,_,U,W,new ce(e.x1,e.y2)),T.vertexLength+=4;const Y=l.indexArray;Y.emplaceBack(O,O+1),Y.emplaceBack(O+1,O+2),Y.emplaceBack(O+2,O+3),Y.emplaceBack(O+3,O),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,o,l,d,m,_){for(let E=d;E<m;E++){const T=l.get(E),O=this.getSymbolInstanceTextSize(e,_,o,E);this._addCollisionDebugVertices(T,O,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,o,l,d,m,_){for(let E=d;E<m;E++){const T=l.get(E),O=this.getSymbolInstanceIconSize(e,o,E);this._addCollisionDebugVertices(T,O,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sh(Vs,$d.members,X),this.iconCollisionBox=new Sh(Vs,$d.members,X);const l=jc(this.iconSizeData,e),d=jc(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(d,e,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(d,e,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,e,o,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,e,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,o,l,d){const m=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:d),_=Vu(this.textSizeData,e,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,o,l){const d=this.icon.placedSymbolArray.get(l),m=Vu(this.iconSizeData,e,d);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(e,o,l){e.emplaceBack(o,-l,-l),e.emplaceBack(o,l,-l),e.emplaceBack(o,l,l),e.emplaceBack(o,-l,l)}_updateTextDebugCollisionBoxes(e,o,l,d,m,_){for(let E=d;E<m;E++){const T=l.get(E),O=this.getSymbolInstanceTextSize(e,_,o,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,O,T.padding)}}_updateIconDebugCollisionBoxes(e,o,l,d,m){for(let _=d;_<m;_++){const E=l.get(_),T=this.getSymbolInstanceIconSize(e,o,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,T,E.padding)}}updateCollisionDebugBuffers(e,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=jc(this.iconSizeData,e),d=jc(this.textSizeData,e);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(d,e,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(d,e,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,e,o,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,e,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,o,l,d,m,_,E,T,O){const U={};for(let W=o;W<l;W++){const Y=e.get(W);U.textBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,padding:Y.padding,projectedAnchorX:Y.projectedAnchorX,projectedAnchorY:Y.projectedAnchorY,projectedAnchorZ:Y.projectedAnchorZ,tileAnchorX:Y.tileAnchorX,tileAnchorY:Y.tileAnchorY},U.textFeatureIndex=Y.featureIndex;break}for(let W=d;W<m;W++){const Y=e.get(W);U.verticalTextBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,padding:Y.padding,projectedAnchorX:Y.projectedAnchorX,projectedAnchorY:Y.projectedAnchorY,projectedAnchorZ:Y.projectedAnchorZ,tileAnchorX:Y.tileAnchorX,tileAnchorY:Y.tileAnchorY},U.verticalTextFeatureIndex=Y.featureIndex;break}for(let W=_;W<E;W++){const Y=e.get(W);U.iconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,padding:Y.padding,projectedAnchorX:Y.projectedAnchorX,projectedAnchorY:Y.projectedAnchorY,projectedAnchorZ:Y.projectedAnchorZ,tileAnchorX:Y.tileAnchorX,tileAnchorY:Y.tileAnchorY},U.iconFeatureIndex=Y.featureIndex;break}for(let W=T;W<O;W++){const Y=e.get(W);U.verticalIconBox={x1:Y.x1,y1:Y.y1,x2:Y.x2,y2:Y.y2,padding:Y.padding,projectedAnchorX:Y.projectedAnchorX,projectedAnchorY:Y.projectedAnchorY,projectedAnchorZ:Y.projectedAnchorZ,tileAnchorX:Y.tileAnchorX,tileAnchorY:Y.tileAnchorY},U.verticalIconFeatureIndex=Y.featureIndex;break}return U}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const l=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,o){const l=e.placedSymbolArray.get(o),d=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const o=Math.sin(e),l=Math.cos(e),d=[],m=[],_=[];for(let E=0;E<this.symbolInstances.length;++E){_.push(E);const T=this.symbolInstances.get(E);d.push(0|Math.round(o*T.tileAnchorX+l*T.tileAnchorY)),m.push(T.featureIndex)}return _.sort((E,T)=>d[E]-d[T]||m[T]-m[E]),_}addToSortKeyRanges(e,o){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===o?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const l=this.symbolInstances.get(o);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((d,m,_)=>{d>=0&&_.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}yn("SymbolBucket",lc,{omit:["layers","collisionBoxArray","features","compareText"]}),lc.MAX_GLYPHS=65535,lc.addDynamicAttributes=qc;const uf=new At({"symbol-placement":new Fe(He.layout_symbol["symbol-placement"]),"symbol-spacing":new Fe(He.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Fe(He.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pt(He.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Fe(He.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Fe(He.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Fe(He.layout_symbol["icon-ignore-placement"]),"icon-optional":new Fe(He.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Fe(He.layout_symbol["icon-rotation-alignment"]),"icon-size":new pt(He.layout_symbol["icon-size"]),"icon-text-fit":new Fe(He.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fe(He.layout_symbol["icon-text-fit-padding"]),"icon-image":new pt(He.layout_symbol["icon-image"]),"icon-rotate":new pt(He.layout_symbol["icon-rotate"]),"icon-padding":new Fe(He.layout_symbol["icon-padding"]),"icon-keep-upright":new Fe(He.layout_symbol["icon-keep-upright"]),"icon-offset":new pt(He.layout_symbol["icon-offset"]),"icon-anchor":new pt(He.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Fe(He.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Fe(He.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Fe(He.layout_symbol["text-rotation-alignment"]),"text-field":new pt(He.layout_symbol["text-field"]),"text-font":new pt(He.layout_symbol["text-font"]),"text-size":new pt(He.layout_symbol["text-size"]),"text-max-width":new pt(He.layout_symbol["text-max-width"]),"text-line-height":new pt(He.layout_symbol["text-line-height"]),"text-letter-spacing":new pt(He.layout_symbol["text-letter-spacing"]),"text-justify":new pt(He.layout_symbol["text-justify"]),"text-radial-offset":new pt(He.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Fe(He.layout_symbol["text-variable-anchor"]),"text-anchor":new pt(He.layout_symbol["text-anchor"]),"text-max-angle":new Fe(He.layout_symbol["text-max-angle"]),"text-writing-mode":new Fe(He.layout_symbol["text-writing-mode"]),"text-rotate":new pt(He.layout_symbol["text-rotate"]),"text-padding":new Fe(He.layout_symbol["text-padding"]),"text-keep-upright":new Fe(He.layout_symbol["text-keep-upright"]),"text-transform":new pt(He.layout_symbol["text-transform"]),"text-offset":new pt(He.layout_symbol["text-offset"]),"text-allow-overlap":new Fe(He.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Fe(He.layout_symbol["text-ignore-placement"]),"text-optional":new Fe(He.layout_symbol["text-optional"])});var Dh={paint:new At({"icon-opacity":new pt(He.paint_symbol["icon-opacity"]),"icon-color":new pt(He.paint_symbol["icon-color"]),"icon-halo-color":new pt(He.paint_symbol["icon-halo-color"]),"icon-halo-width":new pt(He.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pt(He.paint_symbol["icon-halo-blur"]),"icon-translate":new Fe(He.paint_symbol["icon-translate"]),"icon-translate-anchor":new Fe(He.paint_symbol["icon-translate-anchor"]),"text-opacity":new pt(He.paint_symbol["text-opacity"]),"text-color":new pt(He.paint_symbol["text-color"],{runtimeType:Tn,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new pt(He.paint_symbol["text-halo-color"]),"text-halo-width":new pt(He.paint_symbol["text-halo-width"]),"text-halo-blur":new pt(He.paint_symbol["text-halo-blur"]),"text-translate":new Fe(He.paint_symbol["text-translate"]),"text-translate-anchor":new Fe(He.paint_symbol["text-translate-anchor"])}),layout:uf};class Hu{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Wi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(e.formattedSection))return o.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yn("FormatSectionOverride",Hu,{omit:["defaultValue"]});class Ah extends Ol{constructor(e){super(e,Dh)}recalculate(e,o){super.recalculate(e,o),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const d=[];for(const m of l)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,o,l,d){const m=this.layout.get(e).evaluate(o,{},l,d),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||tl(_.value)||!m?m:(E=o.properties,m.replace(/{([^{}]+)}/g,(O,U)=>U in E?String(E[U]):""));var E}createBucket(e){return new lc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Dh.paint.overridableProperties){if(!Ah.hasPaintOverride(this.layout,e))continue;const o=this.paint.get(e),l=new Hu(o),d=new _c(l,o.property.specification);let m=null;m="constant"===o.value.kind||"source"===o.value.kind?new yc("source",d):new uo("composite",d,o.value.zoomStops,o.value._interpolationType),this.paint._values[e]=new We(o.property,m,o.parameters)}}_handleOverridablePaintPropertyUpdate(e,o,l){return!(!this.layout||o.isDataDriven()||l.isDataDriven())&&Ah.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,o){const l=e.get("text-field"),d=Dh.paint.properties[o];let m=!1;const _=E=>{for(const T of E)if(d.overrides&&d.overrides.hasOverride(T))return void(m=!0)};if("constant"===l.value.kind&&l.value.value instanceof ur)_(l.value.value.sections);else if("source"===l.value.kind){const E=O=>{m||(O instanceof Yi&&si(O.value)===zs?_(O.value.sections):O instanceof Hr?_(O.sections):O.eachChild(E))},T=l.value;T._styleExpression&&E(T._styleExpression.expression)}return m}getProgramConfiguration(e){return new wo(this,e)}}var Yp={paint:new At({"background-color":new Fe(He.paint_background["background-color"]),"background-pattern":new Ut(He.paint_background["background-pattern"]),"background-opacity":new Fe(He.paint_background["background-opacity"])})},Py={paint:new At({"raster-opacity":new Fe(He.paint_raster["raster-opacity"]),"raster-hue-rotate":new Fe(He.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Fe(He.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Fe(He.paint_raster["raster-brightness-max"]),"raster-saturation":new Fe(He.paint_raster["raster-saturation"]),"raster-contrast":new Fe(He.paint_raster["raster-contrast"]),"raster-resampling":new Fe(He.paint_raster["raster-resampling"]),"raster-fade-duration":new Fe(He.paint_raster["raster-fade-duration"])})};class Kp extends Ol{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Xp={paint:new At({"sky-type":new Fe(He.paint_sky["sky-type"]),"sky-atmosphere-sun":new Fe(He.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Fe(He.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Fe(He.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Fe(He.paint_sky["sky-gradient-radius"]),"sky-gradient":new dt(He.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Fe(He.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Fe(He.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Fe(He.paint_sky["sky-opacity"])})};function hf(s,e,o){const l=_u(0,0,1),d=op(Dd());return function(m,_,E){E*=.5;var T=_[0],O=_[1],U=_[2],W=_[3],Y=Math.sin(E),ie=Math.cos(E);m[0]=T*ie-U*Y,m[1]=O*ie+W*Y,m[2]=U*ie+T*Y,m[3]=W*ie-O*Y}(d,d,o?-Oe(s)+Math.PI:Oe(s)),ap(d,d,-Oe(e)),sp(l,l,d),lh(l,l)}const Qp={circle:class extends Ol{constructor(s){super(s,wd)}createBucket(s){return new oh(s)}queryRadius(s){const e=s;return ou("circle-radius",this,e)+ou("circle-stroke-width",this,e)+xd(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,o,l,d,m,_,E){const T=eg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),O=this.paint.get("circle-radius").evaluate(e,o)+this.paint.get("circle-stroke-width").evaluate(e,o);return lp(s,l,m,_,E,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,O)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new wo(this,s)}},heatmap:class extends Ol{createBucket(s){return new $o(s)}constructor(s){super(s,Md),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Id({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return ou("heatmap-radius",this,s)}queryIntersectsFeature(s,e,o,l,d,m,_,E){const T=this.paint.get("heatmap-radius").evaluate(e,o);return lp(s,l,m,_,E,!0,!0,new ce(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new wo(this,s)}},hillshade:class extends Ol{constructor(s){super(s,ag)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(s){return new wo(this,s)}},fill:class extends Ol{constructor(s){super(s,sc)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),o=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(s){return new wo(this,s)}recalculate(s,e){super.recalculate(s,e);const o=this.paint._values["fill-outline-color"];"constant"===o.value.kind&&void 0===o.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new mh(s)}queryRadius(){return xd(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,o,l,d,m){return!s.queryGeometry.isAboveHorizon&&ep(Jm(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Ol{constructor(s){super(s,gg)}createBucket(s){return new zd(s)}queryRadius(){return xd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new wo(this,s)}queryIntersectsFeature(s,e,o,l,d,m,_,E,T){const O=eg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),U=this.paint.get("fill-extrusion-height").evaluate(e,o),W=this.paint.get("fill-extrusion-base").evaluate(e,o),Y=[0,0],ie=E&&m.elevation,ye=m.elevation?m.elevation.exaggeration():1;if(ie){const Ke=s.tile.getBucket(this).centroidVertexArray,ot=T+1;if(ot<Ke.length){const xt=Ke.get(ot);Y[0]=xt.a_centroid_pos0,Y[1]=xt.a_centroid_pos1}}if(0===Y[0]&&1===Y[1])return!1;const Ee=(Ke=l,ot=W,xt=U,ut=O,bt=_,(Et=ie?E:null)?function(dn,Vt,Yt,fn,$t,qn,Sn,Xr,Jn){const Sr=[],Nn=[],er=[0,0,0,1];for(const Nr of dn){const Us=[],Hi=[];for(const js of Nr){const $s=js.x+fn.x,os=js.y+fn.y,ci=Dp($s,os,Vt,Yt,qn,Sn,Xr,Jn);er[0]=$s,er[1]=os,er[2]=ci.base,er[3]=1,yu(er,er,$t),er[3]=Math.max(er[3],1e-5);const ui=Sp([er[0]/er[3],er[1]/er[3],er[2]/er[3]]);er[0]=$s,er[1]=os,er[2]=ci.top,er[3]=1,yu(er,er,$t),er[3]=Math.max(er[3],1e-5);const po=Sp([er[0]/er[3],er[1]/er[3],er[2]/er[3]]);Us.push(ui),Hi.push(po)}Sr.push(Us),Nn.push(Hi)}return[Sr,Nn]}(Ke,ot,xt,ut,bt,Et,Y,ye,m.center.lat):function(dn,Vt,Yt,fn,$t){const qn=[],Sn=[],Xr=$t[8]*Vt,Jn=$t[9]*Vt,Sr=$t[10]*Vt,Nn=$t[11]*Vt,er=$t[8]*Yt,Nr=$t[9]*Yt,Us=$t[10]*Yt,Hi=$t[11]*Yt;for(const js of dn){const $s=[],os=[];for(const ci of js){const ui=ci.x+fn.x,po=ci.y+fn.y,Qi=$t[0]*ui+$t[4]*po+$t[12],no=$t[1]*ui+$t[5]*po+$t[13],Gs=$t[2]*ui+$t[6]*po+$t[14],Ei=$t[3]*ui+$t[7]*po+$t[15],la=Qi+Xr,Bi=no+Jn,Ri=Gs+Sr,Ji=Math.max(Ei+Nn,1e-5),Co=Qi+er,mo=no+Nr,hi=Gs+Us,ni=Math.max(Ei+Hi,1e-5),ca=new ce(la/Ji,Bi/Ji);ca.z=Ri/Ji,$s.push(ca);const Za=new ce(Co/ni,mo/ni);Za.z=hi/ni,os.push(Za)}qn.push($s),Sn.push(os)}return[qn,Sn]}(Ke,ot,xt,ut,bt)),Le=s.queryGeometry;var Ke,ot,xt,ut,bt,Et;return function(Ke,ot,xt){let ut=1/0;ep(xt,ot)&&(ut=Tp(xt,ot[0]));for(let bt=0;bt<ot.length;bt++){const Et=ot[bt],kt=Ke[bt];for(let Kt=0;Kt<Et.length-1;Kt++){const nn=Et[Kt],dn=[nn,Et[Kt+1],kt[Kt+1],kt[Kt],nn];Jf(xt,dn)&&(ut=Math.min(ut,Tp(xt,dn)))}}return ut!==1/0&&ut}(Ee[0],Ee[1],Le.isPointQuery()?Le.screenBounds:Le.screenGeometry)}},line:class extends Ol{constructor(s){super(s,Ud),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Rs,this.gradientVersion=(this.gradientVersion+1)%Ue}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=jd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new vh(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new wo(this,s)}queryRadius(s){const e=s,o=Ip(ou("line-width",this,e),ou("line-gap-width",this,e)),l=ou("line-offset",this,e);return o/2+Math.abs(l)+xd(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,o,l,d,m){if(s.queryGeometry.isAboveHorizon)return!1;const _=Jm(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,s.pixelToTileUnitsFactor),E=s.pixelToTileUnitsFactor/2*Ip(this.paint.get("line-width").evaluate(e,o),this.paint.get("line-gap-width").evaluate(e,o)),T=this.paint.get("line-offset").evaluate(e,o);return T&&(l=function(O,U){const W=[],Y=new ce(0,0);for(let ie=0;ie<O.length;ie++){const ye=O[ie],Ee=[];for(let Le=0;Le<ye.length;Le++){const Ke=ye[Le-1],ot=ye[Le],xt=ye[Le+1],ut=0===Le?Y:ot.sub(Ke)._unit()._perp(),bt=Le===ye.length-1?Y:xt.sub(ot)._unit()._perp(),Et=ut._add(bt)._unit();Et._mult(1/(Et.x*bt.x+Et.y*bt.y)),Ee.push(Et._mult(U)._add(ot))}W.push(Ee)}return W}(l,T*s.pixelToTileUnitsFactor)),function(O,U,W){for(let Y=0;Y<U.length;Y++){const ie=U[Y];if(O.length>=3)for(let ye=0;ye<ie.length;ye++)if(rc(O,ie[ye]))return!0;if(Xm(O,ie,W))return!0}return!1}(_,l,E)}isTileClipped(){return!0}},symbol:Ah,background:class extends Ol{constructor(s){super(s,Yp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ol{constructor(s){super(s,Py)}getProgramIds(){return["raster"]}},sky:class extends Ol{constructor(s){super(s,Xp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Id({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(s,e){const o=this.paint.get("sky-type");if("atmosphere"===o){const l=this.paint.get("sky-atmosphere-sun"),d=!l,m=s.style.light,_=m.properties.get("position");return d&&"viewport"===m.properties.get("anchor")&&bn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?hf(_.azimuthal,90-_.polar,e):hf(l[0],90-l[1],e)}if("gradient"===o){const l=this.paint.get("sky-gradient-center");return hf(l[0],90-l[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}},{HTMLImageElement:Jp,HTMLCanvasElement:em,HTMLVideoElement:Ea,ImageData:tm,ImageBitmap:Mh}=ve;class df{constructor(e,o,l,d){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(o,d)}update(e,o,l){const{width:d,height:m}=e,_=!(this.size&&this.size[0]===d&&this.size[1]===m||l),{context:E}=this,{gl:T}=E;if(this.useMipmap=Boolean(o&&o.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),E.pixelStoreUnpackFlipY.set(!1),E.pixelStoreUnpack.set(1),E.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!o||!1!==o.premultiply)),_)this.size=[d,m],e instanceof Jp||e instanceof em||e instanceof Ea||e instanceof tm||Mh&&e instanceof Mh?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,d,m,0,this.format,T.UNSIGNED_BYTE,e.data);else{const{x:O,y:U}=l||{x:0,y:0};e instanceof Jp||e instanceof em||e instanceof Ea||e instanceof tm||Mh&&e instanceof Mh?T.texSubImage2D(T.TEXTURE_2D,0,O,U,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,O,U,d,m,T.RGBA,T.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(e,o,l){const{context:d}=this,{gl:m}=d;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||e),this.filter=e),o!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Su{constructor(e,o){e&&(o?this.setSouthWest(e).setNorthEast(o):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof bs?new bs(e.lng,e.lat):bs.convert(e),this}setSouthWest(e){return this._sw=e instanceof bs?new bs(e.lng,e.lat):bs.convert(e),this}extend(e){const o=this._sw,l=this._ne;let d,m;if(e instanceof bs)d=e,m=e;else{if(!(e instanceof Su))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Su.convert(e)):this.extend(bs.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return o||l?(o.lng=Math.min(d.lng,o.lng),o.lat=Math.min(d.lat,o.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new bs(d.lng,d.lat),this._ne=new bs(m.lng,m.lat)),this}getCenter(){return new bs((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new bs(this.getWest(),this.getNorth())}getSouthEast(){return new bs(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:o,lat:l}=bs.convert(e);let d=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&d}static convert(e){return!e||e instanceof Su?e:new Su(e)}}const ff=6371008.8;class bs{constructor(e,o){if(isNaN(e)||isNaN(o))throw new Error(`Invalid LngLat object: (${e}, ${o})`);if(this.lng=+e,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new bs(Me(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const o=Math.PI/180,l=this.lat*o,d=e.lat*o,m=Math.sin(l)*Math.sin(d)+Math.cos(l)*Math.cos(d)*Math.cos((e.lng-this.lng)*o);return ff*Math.acos(Math.min(m,1))}toBounds(e=0){const o=360*e/40075017,l=o/Math.cos(Math.PI/180*this.lat);return new Su(new bs(this.lng-l,this.lat-o),new bs(this.lng+l,this.lat+o))}static convert(e){if(e instanceof bs)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new bs(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new bs(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const nm=2*Math.PI*ff;function Ih(s){return nm*Math.cos(s*Math.PI/180)}function pf(s){return(180+s)/360}function rm(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function mf(s,e){return s/Ih(e)}function Ph(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Rh(s,e){return s*Ih(Ph(e))}class Du{constructor(e,o,l=0){this.x=+e,this.y=+o,this.z=+l}static fromLngLat(e,o=0){const l=bs.convert(e);return new Du(pf(l.lng),rm(l.lat),mf(o,l.lat))}toLngLat(){return new bs(360*this.x-180,Ph(this.y))}toAltitude(){return Rh(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/nm*(e=Ph(this.y),1/Math.cos(e*Math.PI/180));var e}}class kh{constructor(e,o){this.width=e,this.height=o,this.nextRow=0,this.image=new vs({width:e,height:o}),this.positions={},this.uploaded=!1}getDash(e,o){const l=this.getKey(e,o);return this.positions[l]}trim(){const e=this.width,o=this.height=In(this.nextRow);this.image.resize({width:e,height:o})}getKey(e,o){return e.join(",")+o}getDashRanges(e,o,l){const d=[];let m=e.length%2==1?-e[e.length-1]*l:0,_=e[0]*l,E=!0;d.push({left:m,right:_,isDash:E,zeroLength:0===e[0]});let T=e[0];for(let O=1;O<e.length;O++){E=!E;const U=e[O];m=T*l,T+=U,_=T*l,d.push({left:m,right:_,isDash:E,zeroLength:0===U})}return d}addRoundDash(e,o,l){const d=o/2;for(let m=-l;m<=l;m++){const _=this.width*(this.nextRow+l+m);let E=0,T=e[E];for(let O=0;O<this.width;O++){O/T.right>1&&(T=e[++E]);const U=Math.abs(O-T.left),W=Math.abs(O-T.right),Y=Math.min(U,W);let ie;const ye=m/l*(d+1);if(T.isDash){const Ee=d-Math.abs(ye);ie=Math.sqrt(Y*Y+Ee*Ee)}else ie=d-Math.sqrt(Y*Y+ye*ye);this.image.data[_+O]=Math.max(0,Math.min(255,ie+128))}}}addRegularDash(e,o){for(let T=e.length-1;T>=0;--T){const O=e[T],U=e[T+1];O.zeroLength?e.splice(T,1):U&&U.isDash===O.isDash&&(U.left=O.left,e.splice(T,1))}const l=e[0],d=e[e.length-1];l.isDash===d.isDash&&(l.left=d.left-this.width,d.right=l.right+this.width);const m=this.width*this.nextRow;let _=0,E=e[_];for(let T=0;T<this.width;T++){T/E.right>1&&(E=e[++_]);const O=Math.abs(T-E.left),U=Math.abs(T-E.right),W=Math.min(O,U);this.image.data[m+T]=Math.max(0,Math.min(255,(E.isDash?W:-W)+o+128))}}addDash(e,o){const l=this.getKey(e,o);if(this.positions[l])return this.positions[l];const d="round"===o,m=d?7:0,_=2*m+1;if(this.nextRow+_>this.height)return bn("LineAtlas out of space"),null;0===e.length&&e.push(1);let E=0;for(let U=0;U<e.length;U++)e[U]<0&&(bn("Negative value is found in line dasharray, replacing values with 0"),e[U]=0),E+=e[U];if(0!==E){const U=this.width/E,W=this.getDashRanges(e,this.width,U);d?this.addRoundDash(W,U,m):this.addRegularDash(W,"square"===o?.5*U:0)}const T=this.nextRow+m;this.nextRow+=_;const O={tl:[T,m],br:[E,0]};return this.positions[l]=O,O}}yn("LineAtlas",kh);class jg{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const $g=ve.performance;function gf(s){const e=s?s.url.toString():void 0;return $g.getEntriesByName(e)}class im{constructor(){this.tasks={},this.taskQueue=[],ct(["process"],this),this.invoker=new jg(this.process),this.nextId=0}add(e,o){const l=this.nextId++,d=function({type:m,isSymbolTile:_,zoom:E}){return E=E||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-E:"maybePrepare"===m&&_?400-E:500:200-E:100-E}(o);if(0===d){Jr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:o,priority:d,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Jr();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const o=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let e=null,o=1/0;for(let d=0;d<this.taskQueue.length;d++){const m=this.tasks[this.taskQueue[d]];m.priority<o&&(o=m.priority,e=d)}if(null===e)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}function sm(s,e,o){var l=2*Math.PI*6378137/256/Math.pow(2,o);return[s*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class ul{constructor(e,o,l){this.z=e,this.x=o,this.y=l,this.key=qu(0,e,e,o,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,o){const l=(m=this.y,_=this.z,E=sm(256*(d=this.x),256*(m=Math.pow(2,_)-m-1),_),T=sm(256*(d+1),256*(m+1),_),E[0]+","+E[1]+","+T[0]+","+T[1]);var d,m,_,E,T;const O=function(U,W,Y){let ie,ye="";for(let Ee=U;Ee>0;Ee--)ie=1<<Ee-1,ye+=(W&ie?1:0)+(Y&ie?2:0);return ye}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===o?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",O).replace("{bbox-epsg-3857}",l)}getTilePoint(e){const o=Math.pow(2,this.z);return new ce((e.x*o-this.x)*ti,(e.y*o-this.y)*ti)}getTileVec3(e){const o=Math.pow(2,this.z);return _u((e.x*o-this.x)*ti,(e.y*o-this.y)*ti,Rh(e.z,e.y))}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oh{constructor(e,o){this.wrap=e,this.canonical=o,this.key=qu(e,o.z,o.z,o.x,o.y)}}class aa{constructor(e,o,l,d,m){this.overscaledZ=e,this.wrap=o,this.canonical=new ul(l,+d,+m),this.key=0===o&&e===l?this.canonical.key:qu(o,e,l,d,m)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const o=this.canonical.z-e;return e>this.canonical.z?new aa(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new aa(e,this.wrap,e,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(e,o=!0){if(this.overscaledZ===e&&o)return this.key;if(e>this.canonical.z)return qu(this.wrap*+o,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return qu(this.wrap*+o,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const o=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>o&&e.canonical.y===this.canonical.y>>o}children(e){if(this.overscaledZ>=e)return[new aa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,l=2*this.canonical.x,d=2*this.canonical.y;return[new aa(o,this.wrap,o,l,d),new aa(o,this.wrap,o,l+1,d),new aa(o,this.wrap,o,l,d+1),new aa(o,this.wrap,o,l+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new aa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new aa(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Du(e.x-this.wrap,e.y))}getTileVec3(e){return this.canonical.getTileVec3(new Du(e.x-this.wrap,e.y,e.z))}}function qu(s,e,o,l,d){const m=1<<Math.min(o,22);let _=m*(d%m)+l%m;return s&&o<22&&(_+=m*m*((s<0?-2*s-1:2*s)%(1<<2*(22-o)))),16*(32*_+o)+(e-o)}yn("CanonicalTileID",ul),yn("OverscaledTileID",aa,{omit:["projMatrix"]});class Gg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let o=0;o<e.length;o++){const l=e[o];this._stringToNumber[l]=o,this._numberToString[o]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class _f{constructor(e,o,l,d,m){this.type="Feature",this._vectorTileFeature=e,e._z=o,e._x=l,e._y=d,this.properties=e.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const o in this)"_geometry"!==o&&"_vectorTileFeature"!==o&&(e[o]=this[o]);return e}}var Zg=Dn([{name:"a_pos",type:"Int16",components:2}]);class om{constructor(e,o,l){this.tileID=e,this.uid=gn(),this.uses=0,this.tileSize=o,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const o=e+this.timeAdded;o<Vn.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}loadVectorData(e,o,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(d,m){const _={};if(!m)return _;for(const E of d){const T=E.layerIds.map(O=>m.getLayer(O)).filter(Boolean);if(0!==T.length){E.layers=T,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(O=>T.filter(U=>U.id===O)[0]));for(const O of T)_[O.id]=E}}return _}(e.buckets,o.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof lc){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof lc&&m.hasRTLText){this.hasRTLText=!0,le.isLoading()||le.isLoaded()||"deferred"!==re()||oe();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(d).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new un}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const d=this.buckets[l];d.uploadPending()&&d.upload(e)}const o=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new df(e,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new df(e,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new df(e,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,o,l,d,m,_,E,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:d,pixelPosMatrix:E,transform:_,params:m},e,o,l):{}}querySourceFeatures(e,o){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const d=l.loadVTLayers(),m=o?o.sourceLayer:"",_=d._geojsonTileLayer||d[m];if(!_)return;const E=ka(o&&o.filter),{z:T,x:O,y:U}=this.tileID.canonical,W={z:T,x:O,y:U};for(let Y=0;Y<_.length;Y++){const ie=_.feature(Y);if(E.needGeometry){const Le=iu(ie,!0);if(!E.filter(new pe(this.tileID.overscaledZ),Le,this.tileID.canonical))continue}else if(!E.filter(new pe(this.tileID.overscaledZ),ie))continue;const ye=l.getId(ie,m),Ee=new _f(ie,T,O,U,ye);Ee.tile=W,e.push(Ee)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const o=this.expirationTime;if(e.cacheControl){const l=qt(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let d=!1;if(this.expirationTime>l)d=!1;else if(o)if(this.expirationTime<o)d=!0;else{const m=this.expirationTime-o;m?this.expirationTime=l+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length)return;const l=this.latestFeatureIndex.loadVTLayers();for(const d in this.buckets){if(!o.style.hasLayer(d))continue;const m=this.buckets[d],_=m.layers[0].sourceLayer||"_geojsonTileLayer",E=l[_],T=e[_];if(!E||!T||0===Object.keys(T).length)continue;m.update(T,E,this.imageAtlas&&this.imageAtlas.patternPositions||{});const O=o&&o.style&&o.style.getLayer(d);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(m)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Vn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Vn.now()+e}setDependencies(e,o){const l={};for(const d of o)l[d]=!0;this.dependencies[e]=l}hasDependency(e,o){for(const l of e){const d=this.dependencies[l];if(d)for(const m of o)if(d[m])return!0}return!1}clearQueryDebugViz(){}}class Hg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,o,l){const d=String(o);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][d]=this.stateChanges[e][d]||{},Ht(this.stateChanges[e][d],l),null===this.deletedStates[e]){this.deletedStates[e]={};for(const m in this.state[e])m!==d&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][d]){this.deletedStates[e][d]={};for(const m in this.state[e][d])l[m]||(this.deletedStates[e][d][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][d]&&null===this.deletedStates[e][d][m]&&delete this.deletedStates[e][d][m]}removeFeatureState(e,o,l){if(null===this.deletedStates[e])return;const d=String(o);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&void 0!==o)null!==this.deletedStates[e][d]&&(this.deletedStates[e][d]=this.deletedStates[e][d]||{},this.deletedStates[e][d][l]=null);else if(void 0!==o)if(this.stateChanges[e]&&this.stateChanges[e][d])for(l in this.deletedStates[e][d]={},this.stateChanges[e][d])this.deletedStates[e][d][l]=null;else this.deletedStates[e][d]=null;else this.deletedStates[e]=null}getState(e,o){const l=String(o),d=Ht({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const m=this.deletedStates[e][o];if(null===m)return{};for(const _ in m)delete d[_]}return d}initializeTileState(e,o){e.setFeatureState(this.state,o)}coalesceChanges(e,o){const l={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),Ht(this.state[d][_],this.stateChanges[d][_]),m[_]=this.state[d][_];l[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(null===this.deletedStates[d])for(const _ in this.state[d])m[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(null===this.deletedStates[d][_])this.state[d][_]={};else for(const E of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][E];m[_]=this.state[d][_]}l[d]=l[d]||{},Ht(l[d],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const d in e)e[d].setFeatureState(l,o)}}class Fh{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,o){const l=this.toIdx(e,o);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,o){return this.leaves[this.toIdx(e,o)]}toIdx(e,o){return o*this.size+e}}function am(s,e,o,l){let d=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(o[_]<s[_]||o[_]>e[_])return null}else{const E=1/l[_];let T=(s[_]-o[_])*E,O=(e[_]-o[_])*E;if(T>O){const U=T;T=O,O=U}if(T>d&&(d=T),O<m&&(m=O),d>m)return null}return d}function lm(s,e,o,l,d,m,_,E,T,O,U){const W=l-s,Y=d-e,ie=m-o,ye=_-s,Ee=E-e,Le=T-o,Ke=U[1]*Le-U[2]*Ee,ot=U[2]*ye-U[0]*Le,xt=U[0]*Ee-U[1]*ye,ut=W*Ke+Y*ot+ie*xt;if(Math.abs(ut)<1e-15)return null;const bt=1/ut,Et=O[0]-s,kt=O[1]-e,Kt=O[2]-o,nn=(Et*Ke+kt*ot+Kt*xt)*bt;if(nn<0||nn>1)return null;const dn=kt*ie-Kt*Y,Vt=Kt*W-Et*ie,Yt=Et*Y-kt*W,fn=(U[0]*dn+U[1]*Vt+U[2]*Yt)*bt;return fn<0||nn+fn>1?null:(ye*dn+Ee*Vt+Le*Yt)*bt}function Wu(s,e,o){return(s-e)/(o-e)}function Lh(s,e,o,l,d,m,_,E,T){const O=1<<o,U=m-l,W=_-d,Y=(s+1)/O*U+l,ie=(e+0)/O*W+d,ye=(e+1)/O*W+d;E[0]=(s+0)/O*U+l,E[1]=ie,T[0]=Y,T[1]=ye}class cm{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(m){const _=Math.ceil(Math.log2(m.dim/8)),E=[];let T=Math.ceil(Math.pow(2,_));const O=1/T,U=(ie,ye,Ee,Le,Ke)=>{const ot=Le?1:0,xt=(ie+1)*Ee-ot,ut=ye*Ee,bt=(ye+1)*Ee-ot;Ke[0]=ie*Ee,Ke[1]=ut,Ke[2]=xt,Ke[3]=bt};let W=new Fh(T);const Y=[];for(let ie=0;ie<T*T;ie++){U(ie%T,Math.floor(ie/T),O,!1,Y);const ye=cc(Y[0],Y[1],m),Ee=cc(Y[2],Y[1],m),Le=cc(Y[2],Y[3],m),Ke=cc(Y[0],Y[3],m);W.minimums.push(Math.min(ye,Ee,Le,Ke)),W.maximums.push(Math.max(ye,Ee,Le,Ke)),W.leaves.push(1)}for(E.push(W),T/=2;T>=1;T/=2){const ie=E[E.length-1];W=new Fh(T);for(let ye=0;ye<T*T;ye++){U(ye%T,Math.floor(ye/T),2,!0,Y);const Ee=ie.getElevation(Y[0],Y[1]),Le=ie.getElevation(Y[2],Y[1]),Ke=ie.getElevation(Y[2],Y[3]),ot=ie.getElevation(Y[0],Y[3]),xt=ie.isLeaf(Y[0],Y[1]),ut=ie.isLeaf(Y[2],Y[1]),bt=ie.isLeaf(Y[2],Y[3]),Et=ie.isLeaf(Y[0],Y[3]),kt=Math.min(Ee.min,Le.min,Ke.min,ot.min),Kt=Math.max(Ee.max,Le.max,Ke.max,ot.max),nn=xt&&ut&&bt&&Et;W.maximums.push(Kt),W.minimums.push(kt),W.leaves.push(Kt-kt<=5&&nn?1:0)}E.push(W)}return E}(this.dem),l=o.length-1,d=o[l];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(o,0,0,l,0)}raycastRoot(e,o,l,d,m,_,E=1){return am([e,o,-100],[l,d,this.maximums[0]*E],m,_)}raycast(e,o,l,d,m,_,E=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,o,l,d,m,_,E);if(null==T)return null;const O=[],U=[],W=[],Y=[],ie=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;ie.length>0;){const{idx:ye,t:Ee,nodex:Le,nodey:Ke,depth:ot}=ie.pop();if(this.leaves[ye]){Lh(Le,Ke,ot,e,o,l,d,W,Y);const ut=1<<ot,bt=(Le+0)/ut,Et=(Le+1)/ut,kt=(Ke+0)/ut,Kt=(Ke+1)/ut,nn=cc(bt,kt,this.dem)*E,dn=cc(Et,kt,this.dem)*E,Vt=cc(Et,Kt,this.dem)*E,Yt=cc(bt,Kt,this.dem)*E,fn=lm(W[0],W[1],nn,Y[0],W[1],dn,Y[0],Y[1],Vt,m,_),$t=lm(Y[0],Y[1],Vt,W[0],Y[1],Yt,W[0],W[1],nn,m,_),qn=Math.min(null!==fn?fn:Number.MAX_VALUE,null!==$t?$t:Number.MAX_VALUE);if(qn!==Number.MAX_VALUE)return qn;{const Sn=Td([],m,_,Ee);if(Nh(nn,dn,Yt,Vt,Wu(Sn[0],W[0],Y[0]),Wu(Sn[1],W[1],Y[1]))>=Sn[2])return Ee}continue}let xt=0;for(let ut=0;ut<this._siblingOffset.length;ut++){Lh((Le<<1)+this._siblingOffset[ut][0],(Ke<<1)+this._siblingOffset[ut][1],ot+1,e,o,l,d,W,Y),W[2]=-100,Y[2]=this.maximums[this.childOffsets[ye]+ut]*E;const bt=am(W,Y,m,_);if(null!=bt){const Et=bt;O[ut]=Et;let kt=!1;for(let Kt=0;Kt<xt&&!kt;Kt++)Et>=O[U[Kt]]&&(U.splice(Kt,0,ut),kt=!0);kt||(U[xt]=ut),xt++}}for(let ut=0;ut<xt;ut++){const bt=U[ut];ie.push({idx:this.childOffsets[ye]+bt,t:O[bt],nodex:(Le<<1)+this._siblingOffset[bt][0],nodey:(Ke<<1)+this._siblingOffset[bt][1],depth:ot+1})}}return null}_addNode(e,o,l){return this.minimums.push(e),this.maximums.push(o),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,o,l,d,m){if(1===e[d].isLeaf(o,l))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=d-1,E=e[_];let T,O=0;for(let U=0;U<this._siblingOffset.length;U++){const W=2*o+this._siblingOffset[U][0],Y=2*l+this._siblingOffset[U][1],ie=E.getElevation(W,Y),ye=E.isLeaf(W,Y),Ee=this._addNode(ie.min,ie.max,ye);ye&&(O|=1<<U),T||(T=Ee)}for(let U=0;U<this._siblingOffset.length;U++)O&1<<U||this._construct(e,2*o+this._siblingOffset[U][0],2*l+this._siblingOffset[U][1],_,T+U)}}function Nh(s,e,o,l,d,m){return gr(gr(s,o,m),gr(e,l,m),d)}function cc(s,e,o){const l=o.dim,d=Je(s*l-.5,0,l-1),m=Je(e*l-.5,0,l-1),_=Math.floor(d),E=Math.floor(m),T=Math.min(_+1,l-1),O=Math.min(E+1,l-1);return Nh(o.get(_,E),o.get(T,E),o.get(_,O),o.get(T,O),d-_,m-E)}const yf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class zh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,o,l,d=!1,m=!1){if(this.uid=e,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return bn(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const _=this.dim=o.height-2;if(this.data=new Uint32Array(o.data.buffer),this.encoding=l||"mapbox",this.borderReady=d,!d){for(let E=0;E<_;E++)this.data[this._idx(-1,E)]=this.data[this._idx(0,E)],this.data[this._idx(_,E)]=this.data[this._idx(_-1,E)],this.data[this._idx(E,-1)]=this.data[this._idx(E,0)],this.data[this._idx(E,_)]=this.data[this._idx(E,_-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(_,-1)]=this.data[this._idx(_-1,0)],this.data[this._idx(-1,_)]=this.data[this._idx(0,_-1)],this.data[this._idx(_,_)]=this.data[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new cm(this)}get(e,o,l=!1){const d=new Uint8Array(this.data.buffer);l&&(e=Je(e,-1,this.dim),o=Je(o,-1,this.dim));const m=4*this._idx(e,o);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(d[m],d[m+1],d[m+2])}static getUnpackVector(e){return yf[e]}get unpackVector(){return yf[this.encoding]}_idx(e,o){if(e<-1||e>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(e+1)}_unpackMapbox(e,o,l){return(256*e*256+256*o+l)/10-1e4}_unpackTerrarium(e,o,l){return 256*e+o+l/256-32768}static pack(e,o){const l=[0,0,0,0],d=zh.getUnpackVector(o);let m=Math.floor((e+d[3])/d[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new Eo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,o,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=o*this.dim,m=o*this.dim+this.dim,_=l*this.dim,E=l*this.dim+this.dim;switch(o){case-1:d=m-1;break;case 1:m=d+1}switch(l){case-1:_=E-1;break;case 1:E=_+1}const T=-o*this.dim,O=-l*this.dim;for(let U=_;U<E;U++)for(let W=d;W<m;W++)this.data[this._idx(W,U)]=e.data[this._idx(W+T,U+O)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}yn("DEMData",zh),yn("DemMinMaxQuadTree",cm,{omit:["dem"]});class qg{constructor(e,o){this.max=e,this.onRemove=o,this.reset()}reset(){for(const e in this.data)for(const o of this.data[e])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(e,o,l){const d=e.wrapped().key;void 0===this.data[d]&&(this.data[d]=[]);const m={value:o,timeout:void 0};if(void 0!==l&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const o=this.data[e].shift();return o.timeout&&clearTimeout(o.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),o.value}getByKey(e){const o=this.data[e];return o?o[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,o){if(!this.has(e))return this;const l=e.wrapped().key,d=void 0===o?0:this.data[l].indexOf(o),m=this.data[l][d];return this.data[l].splice(d,1),m.timeout&&clearTimeout(m.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(e){const o=[];for(const l in this.data)for(const d of this.data[l])e(d.value)||o.push(d);for(const l of o)this.remove(l.value.tileID,l)}}class Wc{constructor(e,o,l){this.func=e,this.mask=o,this.range=l}}Wc.ReadOnly=!1,Wc.ReadWrite=!0,Wc.disabled=new Wc(519,Wc.ReadOnly,[0,1]);class vf{constructor(e,o,l,d,m,_){this.test=e,this.ref=o,this.mask=l,this.fail=d,this.depthFail=m,this.pass=_}}vf.disabled=new vf({func:519,mask:0},0,0,7680,7680,7680);class Bl{constructor(e,o,l){this.blendFunction=e,this.blendColor=o,this.mask=l}}Bl.Replace=[1,0],Bl.disabled=new Bl(Bl.Replace,$n.transparent,[!1,!1,!1,!1]),Bl.unblended=new Bl(Bl.Replace,$n.transparent,[!0,!0,!0,!0]),Bl.alphaBlended=new Bl([1,771],$n.transparent,[!0,!0,!0,!0]);class hl{constructor(e,o,l){this.enable=e,this.mode=o,this.frontFace=l}}hl.disabled=new hl(!1,1029,2305),hl.backCCW=new hl(!0,1029,2305),hl.backCW=new hl(!0,1029,2304),hl.frontCW=new hl(!0,1028,2304),hl.frontCCW=new hl(!0,1028,2305);class Yc extends sn{constructor(e,o,l){super(),this.id=e,this._onlySymbols=l,o.on("data",d=>{"source"===d.dataType&&"metadata"===d.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===d.dataType&&"content"===d.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new qg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Hg}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const o=this._tiles[e];if("loaded"!==o.state&&"errored"!==o.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,o){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,o)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const l=this._tiles[o];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Lt(this._tiles).map(e=>e.tileID).sort(uc).map(e=>e.key)}getRenderableIds(e){const o=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&o.push(this._tiles[l]);return e?o.sort((l,d)=>{const m=l.tileID,_=d.tileID,E=new ce(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),T=new ce(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||T.y-E.y||T.x-E.x}).map(l=>l.tileID.key):o.map(l=>l.tileID).sort(uc).map(l=>l.key)}hasRenderableParent(e){const o=this.findLoadedParent(e,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(e,o){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(o||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,o){const l=this._tiles[e];l&&("loading"!==l.state&&(l.state=o),this._loadTile(l,this._tileLoaded.bind(this,l,e,o)))}_tileLoaded(e,o,l,d){if(d)return e.state="errored",void(404!==d.status?this._source.fire(new Pt(d,{tile:e})):this.update(this.transform));e.timeAdded=Vn.now(),"expired"===l&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(o,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Gt("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const o=this.getRenderableIds();for(let d=0;d<o.length;d++){const m=o[d];if(e.neighboringTiles&&e.neighboringTiles[m]){const _=this.getTileByID(m);l(e,_),l(_,e)}}function l(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-d.tileID.canonical.x;const E=m.tileID.canonical.y-d.tileID.canonical.y,T=Math.pow(2,d.tileID.canonical.z),O=m.tileID.key;0===_&&0===E||Math.abs(E)>1||(Math.abs(_)>1&&(1===Math.abs(_+T)?_+=T:1===Math.abs(_-T)&&(_-=T)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,_,E),d.neighboringTiles&&d.neighboringTiles[O]&&(d.neighboringTiles[O].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,o,l,d){for(const m in this._tiles){let _=this._tiles[m];if(d[m]||!_.hasData()||_.tileID.overscaledZ<=o||_.tileID.overscaledZ>l)continue;let E=_.tileID;for(;_&&_.tileID.overscaledZ>o+1;){const O=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[O.key],_&&_.hasData()&&(E=O)}let T=E;for(;T.overscaledZ>o;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){d[E.key]=E;break}}}findLoadedParent(e,o){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=o?l:null}for(let l=e.overscaledZ-1;l>=o;l--){const d=e.scaledTo(l),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(e){const o=this._tiles[e.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,o){o=o||this._source.tileSize;const l=Math.ceil(e.width/o)+1,d=Math.ceil(e.height/o)+1,m=Math.floor(l*d*5),_="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(e){const o=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,o){const l={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+o),l[m.tileID.key]=m}this._tiles=l;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(e,o,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let d;this.updateCacheSize(e,o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(E=>new aa(E.canonical.z,E.wrap,E.canonical.z,E.canonical.x,E.canonical.y)):(d=e.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(d=d.filter(E=>this._source.hasTile(E)))):d=[];const m=this._updateRetainedTiles(d);if(Yu(this._source.type)&&0!==d.length){const E={},T={},O=Object.keys(m);for(const W of O){const Y=m[W],ie=this._tiles[W];if(!ie||ie.fadeEndTime&&ie.fadeEndTime<=Vn.now())continue;const ye=this.findLoadedParent(Y,Math.max(Y.overscaledZ-Yc.maxOverzooming,this._source.minzoom));ye&&(this._addTile(ye.tileID),E[ye.tileID.key]=ye.tileID),T[W]=Y}const U=d[d.length-1].overscaledZ;for(const W in this._tiles){const Y=this._tiles[W];if(m[W]||!Y.hasData())continue;let ie=Y.tileID;for(;ie.overscaledZ>U;){ie=ie.scaledTo(ie.overscaledZ-1);const ye=this._tiles[ie.key];if(ye&&ye.hasData()&&T[ie.key]){m[W]=Y.tileID;break}}}for(const W in E)m[W]||(this._coveredTiles[W]=!0,m[W]=E[W])}for(const E in m)this._tiles[E].clearFadeHold();const _=function(E,T){const O=[];for(const U in E)U in T||O.push(U);return O}(this._tiles,m);for(const E of _){const T=this._tiles[E];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+E)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const o={};if(0===e.length)return o;const l={},d=e[e.length-1].overscaledZ,m=e[0].overscaledZ,_=Math.max(m-Yc.maxOverzooming,this._source.minzoom),E=Math.max(m+Yc.maxUnderzooming,this._source.minzoom),T={};for(const O of e){const U=this._addTile(O);o[O.key]=O,U.hasData()||d<this._source.maxzoom&&(T[O.key]=O)}this._retainLoadedChildren(T,d,E,o);for(const O of e){let U=this._tiles[O.key];if(U.hasData())continue;if(O.canonical.z>=this._source.maxzoom){const Y=O.children(this._source.maxzoom)[0],ie=this.getTile(Y);if(ie&&ie.hasData()){o[Y.key]=Y;continue}}else{const Y=O.children(this._source.maxzoom);if(o[Y[0].key]&&o[Y[1].key]&&o[Y[2].key]&&o[Y[3].key])continue}let W=U.wasRequested();for(let Y=O.overscaledZ-1;Y>=_;--Y){const ie=O.scaledTo(Y);if(l[ie.key]||(l[ie.key]=!0,U=this.getTile(ie),!U&&W&&(U=this._addTile(ie)),U&&(o[ie.key]=ie,W=U.wasRequested(),U.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const o=[];let l,d=this._tiles[e].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){l=this._loadedParentTiles[d.key];break}o.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;d=m}for(const m of o)this._loadedParentTiles[m]=l}}_addTile(e){let o=this._tiles[e.key];if(o)return o;o=this._cache.getAndRemove(e),o&&(this._setTileReloadTimer(e.key,o),o.tileID=e,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,o)));const l=Boolean(o);return l||(o=new om(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(o,this._tileLoaded.bind(this,o,e.key,o.state))),o?(o.uses++,this._tiles[e.key]=o,l||this._source.fire(new Gt("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(e,o){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=o.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const o=this._tiles[e];o&&(o.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),o.uses>0||(o.hasData()&&"reloading"!==o.state?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._cache.reset()}tilesIn(e,o,l){const d=[],m=this.transform;if(!m)return d;for(const _ in this._tiles){const E=this._tiles[_];if(l&&E.clearQueryDebugViz(),E.holdingForFade())continue;const T=e.containsTile(E,m,o);T&&d.push(T)}return d}getVisibleCoordinates(e){const o=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of o)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(Yu(this._source.type))for(const e in this._tiles){const o=this._tiles[e];if(void 0!==o.fadeEndTime&&o.fadeEndTime>=Vn.now())return!0}return!1}setFeatureState(e,o,l){this._state.updateState(e=e||"_geojsonTileLayer",o,l)}removeFeatureState(e,o,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",o,l)}getFeatureState(e,o){return this._state.getState(e=e||"_geojsonTileLayer",o)}setDependencies(e,o,l){const d=this._tiles[e];d&&d.setDependencies(o,l)}reloadTilesForDependencies(e,o){for(const l in this._tiles)this._tiles[l].hasDependency(e,o)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,o))}}function uc(s,e){const o=Math.abs(2*s.wrap)-+(s.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return s.overscaledZ-e.overscaledZ||l-o||e.canonical.y-s.canonical.y||e.canonical.x-s.canonical.x}function Yu(s){return"raster"===s||"image"===s||"video"===s}Yc.maxOverzooming=10,Yc.maxUnderzooming=3;class Uh{constructor(e,o,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=o,this._offset=l}static create(e,o,l){const d=l||e.findDEMTileFor(o);if(!d||!d.dem)return;const m=d.dem,_=d.tileID,E=1<<o.canonical.z-_.canonical.z;return new Uh(d,d.tileSize/ti/E,[(o.canonical.x/E-_.canonical.x)*m.dim,(o.canonical.y/E-_.canonical.y)*m.dim])}tileCoordToPixel(e,o){const l=o*this._scale+this._offset[1],d=Math.floor(e*this._scale+this._offset[0]),m=Math.floor(l);return new ce(d,m)}getElevationAt(e,o,l,d){const m=e*this._scale+this._offset[0],_=o*this._scale+this._offset[1],E=Math.floor(m),T=Math.floor(_),O=this._dem;return d=!!d,l?gr(gr(O.get(E,T,d),O.get(E,T+1,d),_-T),gr(O.get(E+1,T,d),O.get(E+1,T+1,d),_-T),m-E):O.get(E,T,d)}getElevationAtPixel(e,o,l){return this._dem.get(e,o,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*mf(1,e)*this._dem.stride}}class hm{constructor(e,o){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new va(ti,16,0),this.featureIndexArray=new vi,this.promoteId=o}insert(e,o,l,d,m,_=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,d,m,_);const T=this.grid;for(let O=0;O<o.length;O++){const U=o[O],W=[1/0,1/0,-1/0,-1/0];for(let Y=0;Y<U.length;Y++){const ie=U[Y];W[0]=Math.min(W[0],ie.x),W[1]=Math.min(W[1],ie.y),W[2]=Math.max(W[2],ie.x),W[3]=Math.max(W[3],ie.y)}W[0]<ti&&W[1]<ti&&W[2]>=0&&W[3]>=0&&T.insert(E,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new cl.VectorTile(new xu(this.rawTileData)).layers,this.sourceLayerCoder=new Gg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,o,l,d){this.loadVTLayers();const m=e.params||{},_=ka(m.filter),E=e.tileResult,T=e.transform,O=E.bufferedTilespaceBounds,U=this.grid.query(O.min.x,O.min.y,O.max.x,O.max.y,(ye,Ee,Le,Ke)=>vd(E.bufferedTilespaceGeometry,ye,Ee,Le,Ke));U.sort(Au);let W=null;T.elevation&&U.length>0&&(W=Uh.create(T.elevation,this.tileID));const Y={};let ie;for(let ye=0;ye<U.length;ye++){const Ee=U[ye];if(Ee===ie)continue;ie=Ee;const Le=this.featureIndexArray.get(Ee);let Ke=null;this.loadMatchingFeature(Y,Le,_,m.layers,m.availableImages,o,l,d,(ot,xt,ut,bt=0)=>(Ke||(Ke=ru(ot)),xt.queryIntersectsFeature(E,ot,ut,Ke,this.z,e.transform,e.pixelPosMatrix,W,bt)))}return Y}loadMatchingFeature(e,o,l,d,m,_,E,T,O){const{featureIndex:U,bucketIndex:W,sourceLayerIndex:Y,layoutVertexArrayOffset:ie}=o,ye=this.bucketLayerIDs[W];if(d&&!function(ot,xt){for(let ut=0;ut<ot.length;ut++)if(xt.indexOf(ot[ut])>=0)return!0;return!1}(d,ye))return;const Ee=this.sourceLayerCoder.decode(Y),Le=this.vtLayers[Ee].feature(U);if(l.needGeometry){const ot=iu(Le,!0);if(!l.filter(new pe(this.tileID.overscaledZ),ot,this.tileID.canonical))return}else if(!l.filter(new pe(this.tileID.overscaledZ),Le))return;const Ke=this.getId(Le,Ee);for(let ot=0;ot<ye.length;ot++){const xt=ye[ot];if(d&&d.indexOf(xt)<0)continue;const ut=_[xt];if(!ut)continue;let bt={};void 0!==Ke&&T&&(bt=T.getState(ut.sourceLayer||"_geojsonTileLayer",Ke));const Et=Ht({},E[xt]);Et.paint=Wg(Et.paint,ut.paint,Le,bt,m),Et.layout=Wg(Et.layout,ut.layout,Le,bt,m);const kt=!O||O(Le,ut,bt,ie);if(!kt)continue;const Kt=new _f(Le,this.z,this.x,this.y,Ke);Kt.layer=Et;let nn=e[xt];void 0===nn&&(nn=e[xt]=[]),nn.push({featureIndex:U,feature:Kt,intersectionZ:kt})}}lookupSymbolFeatures(e,o,l,d,m,_,E,T){const O={};this.loadVTLayers();const U=ka(m);for(const W of e)this.loadMatchingFeature(O,{bucketIndex:l,sourceLayerIndex:d,featureIndex:W,layoutVertexArrayOffset:0},U,_,E,T,o);return O}hasLayer(e){for(const o of this.bucketLayerIDs)for(const l of o)if(e===l)return!0;return!1}getId(e,o){let l=e.id;return this.promoteId&&(l=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[o]],"boolean"==typeof l&&(l=Number(l))),l}}function Wg(s,e,o,l,d){return mt(s,(m,_)=>{const E=e instanceof it?e.get(_):null;return E&&E.evaluate?E.evaluate(o,l,d):E})}function Au(s,e){return e-s}yn("FeatureIndex",hm,{omit:["rawTileData","sourceLayerCoder"]});class xf{constructor(e){const o={},l=[];for(const E in e){const T=e[E],O=o[E]={};for(const U in T.glyphs){const W=T.glyphs[+U];if(!W||0===W.bitmap.width||0===W.bitmap.height)continue;const Y=W.metrics.localGlyph?2:1,ie={x:0,y:0,w:W.bitmap.width+2*Y,h:W.bitmap.height+2*Y};l.push(ie),O[U]=ie}}const{w:d,h:m}=wu(l),_=new vs({width:d||1,height:m||1});for(const E in e){const T=e[E];for(const O in T.glyphs){const U=T.glyphs[+O];if(!U||0===U.bitmap.width||0===U.bitmap.height)continue;const W=o[E][O],Y=U.metrics.localGlyph?2:1;vs.copy(U.bitmap,_,{x:0,y:0},{x:W.x+Y,y:W.y+Y},U.bitmap)}}this.image=_,this.positions=o}}yn("GlyphAtlas",xf);class Ku{constructor(e){this.tileID=new aa(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile}parse(e,o,l,d,m){this.status="parsing",this.data=e,this.collisionBoxArray=new un;const _=new Gg(Object.keys(e.layers).sort()),E=new hm(this.tileID,this.promoteId);E.bucketLayerIDs=[];const T={},O=new kh(256,256),U={featureIndex:E,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:O,availableImages:l},W=o.familiesBySource[this.source];for(const bt in W){const Et=e.layers[bt];if(!Et)continue;let kt=!1,Kt=!1;for(const Vt of W[bt])"symbol"===Vt[0].type?kt=!0:Kt=!0;if(!0===this.isSymbolTile&&!kt||!1===this.isSymbolTile&&!Kt)continue;1===Et.version&&bn(`Vector tile source "${this.source}" layer "${bt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const nn=_.encode(bt),dn=[];for(let Vt=0;Vt<Et.length;Vt++){const Yt=Et.feature(Vt),fn=E.getId(Yt,bt);dn.push({feature:Yt,id:fn,index:Vt,sourceLayerIndex:nn})}for(const Vt of W[bt]){const Yt=Vt[0];void 0!==this.isSymbolTile&&"symbol"===Yt.type!==this.isSymbolTile||Yt.minzoom&&this.zoom<Math.floor(Yt.minzoom)||Yt.maxzoom&&this.zoom>=Yt.maxzoom||"none"!==Yt.visibility&&(fu(Vt,this.zoom,l),(T[Yt.id]=Yt.createBucket({index:E.bucketLayerIDs.length,layers:Vt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:nn,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(dn,U,this.tileID.canonical),E.bucketLayerIDs.push(Vt.map(fn=>fn.id)))}}let Y,ie,ye,Ee;O.trim();const Le={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ke=mt(U.glyphDependencies,bt=>Object.keys(bt).map(Number));Object.keys(Ke).length?d.send("getGlyphs",{uid:this.uid,stacks:Ke},(bt,Et)=>{Y||(Y=bt,ie=Et,ut.call(this))},void 0,!1,Le):ie={};const ot=Object.keys(U.iconDependencies);ot.length?d.send("getImages",{icons:ot,source:this.source,tileID:this.tileID,type:"icons"},(bt,Et)=>{Y||(Y=bt,ye=Et,ut.call(this))},void 0,!1,Le):ye={};const xt=Object.keys(U.patternDependencies);function ut(){if(Y)return m(Y);if(ie&&ye&&Ee){const bt=new xf(ie),Et=new qd(ye,Ee);for(const kt in T){const Kt=T[kt];Kt instanceof lc?(fu(Kt.layers,this.zoom,l),Vg(Kt,ie,bt.positions,ye,Et.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):Kt.hasPattern&&(Kt instanceof vh||Kt instanceof mh||Kt instanceof zd)&&(fu(Kt.layers,this.zoom,l),Kt.addFeatures(U,this.tileID.canonical,Et.patternPositions))}this.status="done",m(null,{buckets:Lt(T).filter(kt=>!kt.isEmpty()),featureIndex:E,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:bt.image,lineAtlas:O,imageAtlas:Et,glyphMap:this.returnDependencies?ie:null,iconMap:this.returnDependencies?ye:null,glyphPositions:this.returnDependencies?bt.positions:null})}}xt.length?d.send("getImages",{icons:xt,source:this.source,tileID:this.tileID,type:"patterns"},(bt,Et)=>{Y||(Y=bt,Ee=Et,ut.call(this))},void 0,!1,Le):Ee={},ut.call(this)}}function fu(s,e,o){const l=new pe(e);for(const d of s)d.recalculate(l,o)}class dm{constructor(e){this.entries={},this.scheduler=e}request(e,o,l,d){const m=this.entries[e]=this.entries[e]||{callbacks:[]};if(m.result){const[_,E]=m.result;return this.scheduler?this.scheduler.add(()=>{d(_,E)},o):d(_,E),()=>{}}return m.callbacks.push(d),m.cancel||(m.cancel=l((_,E)=>{m.result=[_,E];for(const T of m.callbacks)this.scheduler?this.scheduler.add(()=>{T(_,E)},o):T(_,E);setTimeout(()=>delete this.entries[e],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==d),m.callbacks.length||(m.cancel(),delete this.entries[e]))}}}function jh(s,e,o){const l=JSON.stringify(s.request);return s.data&&(this.deduped.entries[l]={result:[null,s.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},d=>{const m=k(s.request,(_,E,T,O)=>{_?d(_):E&&d(null,{vectorTile:o?void 0:new cl.VectorTile(new xu(E)),rawData:E,cacheControl:T,expires:O})});return()=>{m.cancel(),d()}},e)}u.ARRAY_TYPE=jo,u.AUTH_ERR_MSG=ls,u.Actor=class{constructor(s,e,o){this.target=s,this.parent=e,this.mapId=o,this.callbacks={},this.cancelCallbacks={},ct(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Jr()?s:ve,this.scheduler=new im}send(s,e,o,l,d=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=m,this.callbacks[_]=o);const E=Rn(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:s,hasCallback:!!o,targetMapId:l,mustQueue:d,sourceMapId:this.mapId,data:Bs(e,E)},E),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(s){const e=s.data,o=e.id;if(o&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const l=this.cancelCallbacks[o];delete this.cancelCallbacks[o],l&&l.cancel()}else if(e.mustQueue||Jr()){const l=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,e),l&&l.metadata||{type:"message"})}else this.processTask(o,e)}processTask(s,e){if("<response>"===e.type){const o=this.callbacks[s];delete this.callbacks[s],o&&(e.error?o(sl(e.error)):o(null,sl(e.data)))}else{const o=Rn(this.globalScope)?void 0:[],l=e.hasCallback?(m,_)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:m?Bs(m):null,data:Bs(_,o)},o)}:m=>{},d=sl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,d,l);else if(this.parent.getWorkerSource){const m=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,m[0],d.source)[m[1]](d,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=ul,u.Color=$n,u.ColorMode=Bl,u.CullFaceMode=hl,u.DEMData=zh,u.DataConstantProperty=Fe,u.DedupedRequest=dm,u.DepthMode=Wc,u.EXTENT=ti,u.Elevation=class{getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,o=!0){null==e&&(e=null);const l=this._source();if(!l||s.y<0||s.y>1)return e;const d=l.getSource().maxzoom,m=1<<d,_=Math.floor(s.x),E=s.x-_,T=new aa(d,_,d,Math.floor(E*m),Math.floor(s.y*m)),O=this.findDEMTileFor(T);if(!O||!O.dem)return e;const U=O.dem,W=1<<O.tileID.canonical.z,Y=(E*W-O.tileID.canonical.x)*U.dim,ie=(s.y*W-O.tileID.canonical.y)*U.dim,ye=Math.floor(Y),Ee=Math.floor(ie);return(o?this.exaggeration():1)*gr(gr(U.get(ye,Ee),U.get(ye,Ee+1),ie-Ee),gr(U.get(ye+1,Ee),U.get(ye+1,Ee+1),ie-Ee),Y-ye)}getAtTileOffset(s,e,o){const l=1<<s.canonical.z;return this.getAtPointOrZero(new Du(s.wrap+(s.canonical.x+e/ti)/l,(s.canonical.y+o/ti)/l))}getForTilePoints(s,e,o,l){const d=Uh.create(this,s,l);return!!d&&(e.forEach(m=>{m[2]=this.exaggeration()*d.getElevationAt(m[0],m[1],o)}),!0)}getMinMaxForTile(s){const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const o=e.dem.tree,l=e.tileID,d=1<<s.canonical.z-l.canonical.z;let m=s.canonical.x/d-l.canonical.x,_=s.canonical.y/d-l.canonical.y,E=0;for(let T=0;T<s.canonical.z-l.canonical.z&&!o.leaves[E];T++){m*=2,_*=2;const O=2*Math.floor(_)+Math.floor(m);E=o.childOffsets[E]+O,m%=1,_%=1}return{min:this.exaggeration()*o.minimums[E],max:this.exaggeration()*o.maximums[E]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,o){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=Pt,u.EvaluationParameters=pe,u.Event=Gt,u.Evented=sn,u.GlyphManager=Zu,u.ImagePosition=$a,u.LineAtlas=kh,u.LngLat=bs,u.LngLatBounds=Su,u.LocalGlyphMode=Gp,u.MAX_SAFE_INTEGER=Ue,u.MercatorCoordinate=Du,u.ONE_EM=24,u.OverscaledTileID=aa,u.Properties=At,u.RGBAImage=Eo,u.RequestManager=class{constructor(s,e,o){this._transformRequestFn=s,this._customAccessToken=e,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const s=function(){let e="";for(let o=0;o<10;o++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",di,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,e){return this._transformRequestFn&&this._transformRequestFn(s,e)||{url:s}}normalizeStyleURL(s,e){if(!Ui(s))return s;const o=nt(s);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeGlyphsURL(s,e){if(!Ui(s))return s;const o=nt(s);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||e)}normalizeSourceURL(s,e){if(!Ui(s))return s;const o=nt(s);return o.path=`/v4/${o.authority}.json`,o.params.push("secure"),this._makeAPIURL(o,this._customAccessToken||e)}normalizeSpriteURL(s,e,o,l){const d=nt(s);return Ui(s)?(d.path=`/styles/v1${d.path}/sprite${e}${o}`,this._makeAPIURL(d,this._customAccessToken||l)):(d.path+=`${e}${o}`,Wt(d))}normalizeTileURL(s,e,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ui(s))return s;const l=nt(s);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||o&&"raster"!==l.authority&&512===o?"@2x":""}${xi.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${Zn.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${Zn.TILE_URL_VERSION}${l.path}`);const d=this._customAccessToken||function(m){for(const _ of m){const E=_.match(/^access_token=(.*)$/);if(E)return E[1]}return null}(l.params)||Zn.ACCESS_TOKEN;return Zn.REQUIRE_ACCESS_TOKEN&&d&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,d)}canonicalizeTileURL(s,e){const o=nt(s);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return s;let l="mapbox://";o.path.match(/^\/raster\/v1\//)?l+=`raster/${o.path.replace(`/${Zn.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${o.path.replace(`/${Zn.TILE_URL_VERSION}/`,"")}`;let d=o.params;return e&&(d=d.filter(m=>!m.match(/^access_token=/))),d.length&&(l+=`?${d.join("&")}`),l}canonicalizeTileset(s,e){const o=!!e&&Ui(e),l=[];for(const d of s.tiles||[])Tt(d)?l.push(this.canonicalizeTileURL(d,o)):l.push(d);return l}_makeAPIURL(s,e){const o="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=nt(Zn.API_URL);if(s.protocol=l.protocol,s.authority=l.authority,"http"===s.protocol){const d=s.params.indexOf("secure");d>=0&&s.params.splice(d,1)}if("/"!==l.path&&(s.path=`${l.path}${s.path}`),!Zn.REQUIRE_ACCESS_TOKEN)return Wt(s);if(e=e||Zn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return s.params=s.params.filter(d=>-1===d.indexOf("access_token")),s.params.push(`access_token=${e||""}`),Wt(s)}},u.ResourceType=ro,u.SegmentVector=Ms,u.SourceCache=Yc,u.StencilMode=vf,u.StructArrayLayout1ui2=fe,u.StructArrayLayout2f1f2i16=Js,u.StructArrayLayout2i4=Qn,u.StructArrayLayout2ui4=X,u.StructArrayLayout3f12=_r,u.StructArrayLayout3ui6=ai,u.StructArrayLayout4i8=zi,u.Texture=df,u.Tile=om,u.Transitionable=qe,u.Uniform1f=Ln,u.Uniform1i=class extends kl{constructor(s,e){super(s,e),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},u.Uniform2f=class extends kl{constructor(s,e){super(s,e),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},u.Uniform3f=class extends kl{constructor(s,e){super(s,e),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},u.Uniform4f=Kn,u.UniformColor=br,u.UniformMatrix3f=class extends kl{constructor(s,e){super(s,e),this.current=ys}set(s){for(let e=0;e<9;e++)if(s[e]!==this.current[e]){this.current=s,this.gl.uniformMatrix3fv(this.location,!1,s);break}}},u.UniformMatrix4f=class extends kl{constructor(s,e){super(s,e),this.current=Kr}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let e=1;e<16;e++)if(s[e]!==this.current[e]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},u.UnwrappedTileID=Oh,u.ValidationError=Ct,u.VectorTileWorkerSource=class extends sn{constructor(s,e,o,l,d){super(),this.actor=s,this.layerIndex=e,this.availableImages=o,this.loadVectorData=d||jh,this.loading={},this.loaded={},this.deduped=new dm(s.scheduler),this.isSpriteLoaded=l,this.scheduler=s.scheduler}loadTile(s,e){const o=s.uid,l=s&&s.request,d=l&&l.collectResourceTiming,m=this.loading[o]=new Ku(s);m.abort=this.loadVectorData(s,(_,E)=>{const T=!this.loading[o];if(delete this.loading[o],T||_||!E)return m.status="done",T||(this.loaded[o]=m),e(_);const O=E.rawData,U={};E.expires&&(U.expires=E.expires),E.cacheControl&&(U.cacheControl=E.cacheControl),m.vectorTile=E.vectorTile||new cl.VectorTile(new xu(O));const W=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(Y,ie)=>{if(Y||!ie)return e(Y);const ye={};if(d){const Ee=gf(l);Ee.length>0&&(ye.resourceTiming=JSON.parse(JSON.stringify(Ee)))}e(null,Ht({rawTileData:O.slice(0)},ie,U,ye))})};this.isSpriteLoaded?W():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(W,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):W()}),this.loaded=this.loaded||{},this.loaded[o]=m})}reloadTile(s,e){const o=this.loaded,l=s.uid,d=this;if(o&&o[l]){const m=o[l];m.showCollisionBoxes=s.showCollisionBoxes,m.enableTerrain=!!s.enableTerrain;const _=(E,T)=>{const O=m.reloadCallback;O&&(delete m.reloadCallback,m.parse(m.vectorTile,d.layerIndex,this.availableImages,d.actor,O)),e(E,T)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(s,e){const o=s.uid,l=this.loading[o];l&&(l.abort&&l.abort(),delete this.loading[o]),e()}removeTile(s,e){const o=this.loaded,l=s.uid;o&&o[l]&&delete o[l],e()}},u.WritingMode=Ga,u.ZoomHistory=Lc,u.add=function(s,e,o){return s[0]=e[0]+o[0],s[1]=e[1]+o[1],s[2]=e[2]+o[2],s},u.addDynamicAttributes=qc,u.altitudeFromMercatorZ=Rh,u.asyncAll=Ge,u.bezier=lt,u.bindAll=ct,u.bufferConvexPolygon=function(s,e){const o=[];for(let l=0;l<s.length;l++){const d=Me(l-1,-1,s.length-1),m=Me(l+1,-1,s.length-1),_=s[l],E=s[m],T=s[d].sub(_).unit(),O=E.sub(_).unit(),U=O.angleWithSep(T.x,T.y),W=T.add(O).unit().mult(-1*e/Math.sin(U/2));o.push(_.add(W))}return o},u.cacheEntryPossiblyAdded=function(s){cs++,cs>Yr&&(s.getActor().send("enforceCacheSizeLimit",ar),cs=0)},u.clamp=Je,u.clearTileCache=function(s){const e=ve.caches.delete(jn);s&&e.catch(s).then(()=>s())},u.clipLine=Og,u.clone=function(s){var e=new jo(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e},u.clone$1=function(s){var e=new jo(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e},u.clone$2=tn,u.collisionCircleLayout=Gd,u.config=Zn,u.conjugate=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},u.copy=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s},u.create=ah,u.create$1=function(){var s=new jo(16);return jo!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},u.create$2=tg,u.createExpression=vo,u.createFilter=ka,u.createLayout=Dn,u.createStyleLayer=function(s){return"custom"===s.type?new Kp(s):new Qp[s.type](s)},u.cross=function(s,e,o){var l=e[0],d=e[1],m=e[2],_=o[0],E=o[1],T=o[2];return s[0]=d*T-m*E,s[1]=m*_-l*T,s[2]=l*E-d*_,s},u.degToRad=Oe,u.div=function(s,e,o){return s[0]=e[0]/o[0],s[1]=e[1]/o[1],s[2]=e[2]/o[2],s},u.dot=function(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]},u.dot$1=function(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]+s[3]*e[3]},u.ease=Ot,u.easeCubicInOut=ke,u.emitValidationErrors=ea,u.endsWith=tt,u.enforceCacheSizeLimit=function(s){Gr(),wn&&wn.then(e=>{e.keys().then(o=>{for(let l=0;l<o.length-s;l++)e.delete(o[l])})})},u.evaluateSizeForFeature=Vu,u.evaluateSizeForZoom=jc,u.evaluateVariableOffset=of,u.evented=Q,u.exactEquals=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},u.exactEquals$1=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]},u.exported=Vn,u.exported$1=xi,u.extend=Ht,u.filterObject=gt,u.fromMat4=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},u.fromQuat=function(s,e){var o=e[0],l=e[1],d=e[2],m=e[3],_=o+o,E=l+l,T=d+d,O=o*_,U=l*_,W=l*E,Y=d*_,ie=d*E,ye=d*T,Ee=m*_,Le=m*E,Ke=m*T;return s[0]=1-W-ye,s[1]=U+Ke,s[2]=Y-Le,s[3]=0,s[4]=U-Ke,s[5]=1-O-ye,s[6]=ie+Ee,s[7]=0,s[8]=Y+Le,s[9]=ie-Ee,s[10]=1-O-W,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},u.fromRotation=function(s,e){var o=Math.sin(e),l=Math.cos(e);return s[0]=l,s[1]=o,s[2]=0,s[3]=-o,s[4]=l,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},u.fromScaling=function(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},u.furthestTileCorner=function(s){const e=Math.round((s+45+360)%360/90)%4;return Ne[e]},u.getAABBPointSquareDist=function(s,e,o){let l=0;for(let d=0;d<2;++d){const m=o?o[d]:0;s[d]>m&&(l+=(s[d]-m)*(s[d]-m)),e[d]<m&&(l+=(m-e[d])*(m-e[d]))}return l},u.getAnchorAlignment=Gu,u.getAnchorJustification=qp,u.getBounds=function(s){let e=1/0,o=1/0,l=-1/0,d=-1/0;for(const m of s)e=Math.min(e,m.x),o=Math.min(o,m.y),l=Math.max(l,m.x),d=Math.max(d,m.y);return{min:new ce(e,o),max:new ce(l,d)}},u.getImage=Ze,u.getJSON=function(s,e){return K(Ht(s,{type:"json"}),e)},u.getMapSessionAPI=ii,u.getPerformanceMeasurement=gf,u.getRTLTextPluginStatus=re,u.getReferrer=lr,u.getVideo=function(s,e){const o=ve.document.createElement("video");o.muted=!0,o.onloadstart=function(){e(null,o)};for(let l=0;l<s.length;l++){const d=ve.document.createElement("source");de(s[l])||(o.crossOrigin="Anonymous"),d.src=s[l],o.appendChild(d)}return{cancel:()=>{}}},u.identity=rp,u.identity$1=op,u.invert=function(s,e){var o=e[0],l=e[1],d=e[2],m=e[3],_=e[4],E=e[5],T=e[6],O=e[7],U=e[8],W=e[9],Y=e[10],ie=e[11],ye=e[12],Ee=e[13],Le=e[14],Ke=e[15],ot=o*E-l*_,xt=o*T-d*_,ut=o*O-m*_,bt=l*T-d*E,Et=l*O-m*E,kt=d*O-m*T,Kt=U*Ee-W*ye,nn=U*Le-Y*ye,dn=U*Ke-ie*ye,Vt=W*Le-Y*Ee,Yt=W*Ke-ie*Ee,fn=Y*Ke-ie*Le,$t=ot*fn-xt*Yt+ut*Vt+bt*dn-Et*nn+kt*Kt;return $t?(s[0]=(E*fn-T*Yt+O*Vt)*($t=1/$t),s[1]=(d*Yt-l*fn-m*Vt)*$t,s[2]=(Ee*kt-Le*Et+Ke*bt)*$t,s[3]=(Y*Et-W*kt-ie*bt)*$t,s[4]=(T*dn-_*fn-O*nn)*$t,s[5]=(o*fn-d*dn+m*nn)*$t,s[6]=(Le*ut-ye*kt-Ke*xt)*$t,s[7]=(U*kt-Y*ut+ie*xt)*$t,s[8]=(_*Yt-E*dn+O*Kt)*$t,s[9]=(l*dn-o*Yt-m*Kt)*$t,s[10]=(ye*Et-Ee*ut+Ke*ot)*$t,s[11]=(W*ut-U*Et-ie*ot)*$t,s[12]=(E*nn-_*Vt-T*Kt)*$t,s[13]=(o*Vt-l*nn+d*Kt)*$t,s[14]=(Ee*xt-ye*bt-Le*ot)*$t,s[15]=(U*bt-W*xt+Y*ot)*$t,s):null},u.isMapAuthenticated=function(s){return Wr.has(s)},u.isMapboxURL=Ui,u.latFromMercatorY=Ph,u.len=Sd,u.length=ip,u.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},u.loadVectorTile=jh,u.makeRequest=K,u.mercatorXfromLng=pf,u.mercatorYfromLat=rm,u.mercatorZfromAltitude=mf,u.mul=function(s,e,o){return s[0]=e[0]*o[0],s[1]=e[1]*o[1],s[2]=e[2]*o[2],s[3]=e[3]*o[3],s},u.mul$1=ng,u.mul$2=ig,u.multiply=Ed,u.multiply$1=Pu,u.nextPowerOfTwo=In,u.normalize=lh,u.normalize$1=function(s,e){var o=e[0],l=e[1],d=e[2],m=e[3],_=o*o+l*l+d*d+m*m;return _>0&&(_=1/Math.sqrt(_)),s[0]=o*_,s[1]=l*_,s[2]=d*_,s[3]=m*_,s},u.number=gr,u.ortho=function(s,e,o,l,d,m,_){var E=1/(e-o),T=1/(l-d),O=1/(m-_);return s[0]=-2*E,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*T,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*O,s[11]=0,s[12]=(e+o)*E,s[13]=(d+l)*T,s[14]=(_+m)*O,s[15]=1,s},u.pbf=xu,u.perspective=function(s,e,o,l,d){var m,_=1/Math.tan(e/2);return s[0]=_/o,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=_,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=d&&d!==1/0?(s[10]=(d+l)*(m=1/(l-d)),s[14]=2*d*l*m):(s[10]=-1,s[14]=-2*l),s},u.pick=function(s,e){const o={};for(let l=0;l<e.length;l++){const d=e[l];d in s&&(o[d]=s[d])}return o},u.plugin=le,u.pointGeometry=ce,u.polygonIntersectsBox=vd,u.polygonIntersectsPolygon=Jf,u.polygonizeBounds=function(s,e,o=0,l=!0){const d=new ce(o,o),m=s.sub(d),_=e.add(d),E=[m,new ce(_.x,m.y),_,new ce(m.x,_.y)];return l&&E.push(m),E},u.posAttributes=Zg,u.postMapLoadEvent=jr,u.postTurnstileEvent=_n,u.potpack=wu,u.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},u.radToDeg=function(s){return s*we},u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(s){return s({pluginStatus:b,pluginURL:M}),Q.on("pluginStateChange",s),s},u.removeAuthState=function(s){Wr.delete(s)},u.renderColorRamp=Id,u.rotateX=function(s,e,o){var l=Math.sin(o),d=Math.cos(o),m=e[4],_=e[5],E=e[6],T=e[7],O=e[8],U=e[9],W=e[10],Y=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=m*d+O*l,s[5]=_*d+U*l,s[6]=E*d+W*l,s[7]=T*d+Y*l,s[8]=O*d-m*l,s[9]=U*d-_*l,s[10]=W*d-E*l,s[11]=Y*d-T*l,s},u.rotateX$1=ap,u.rotateY=function(s,e,o){var l=Math.sin(o),d=Math.cos(o),m=e[0],_=e[1],E=e[2],T=e[3],O=e[8],U=e[9],W=e[10],Y=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=m*d-O*l,s[1]=_*d-U*l,s[2]=E*d-W*l,s[3]=T*d-Y*l,s[8]=m*l+O*d,s[9]=_*l+U*d,s[10]=E*l+W*d,s[11]=T*l+Y*d,s},u.rotateZ=function(s,e,o){var l=Math.sin(o),d=Math.cos(o),m=e[0],_=e[1],E=e[2],T=e[3],O=e[4],U=e[5],W=e[6],Y=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=m*d+O*l,s[1]=_*d+U*l,s[2]=E*d+W*l,s[3]=T*d+Y*l,s[4]=O*d-m*l,s[5]=U*d-_*l,s[6]=W*d-E*l,s[7]=Y*d-T*l,s},u.rotateZ$1=function(s,e,o){o*=.5;var l=e[0],d=e[1],m=e[2],_=e[3],E=Math.sin(o),T=Math.cos(o);return s[0]=l*T+d*E,s[1]=d*T-l*E,s[2]=m*T+_*E,s[3]=_*T-m*E,s},u.scale=function(s,e,o){return s[0]=e[0]*o,s[1]=e[1]*o,s[2]=e[2]*o,s},u.scale$1=function(s,e,o){var l=o[0],d=o[1],m=o[2];return s[0]=e[0]*l,s[1]=e[1]*l,s[2]=e[2]*l,s[3]=e[3]*l,s[4]=e[4]*d,s[5]=e[5]*d,s[6]=e[6]*d,s[7]=e[7]*d,s[8]=e[8]*m,s[9]=e[9]*m,s[10]=e[10]*m,s[11]=e[11]*m,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s},u.scale$2=function(s,e,o){return s[0]=e[0]*o,s[1]=e[1]*o,s[2]=e[2]*o,s[3]=e[3]*o,s},u.scaleAndAdd=Td,u.setCacheLimits=function(s,e){ar=s,Yr=e},u.setRTLTextPlugin=function(s,e,o=!1){if(b===r||b===c||b===p)throw new Error("setRTLTextPlugin cannot be called multiple times.");M=Vn.resolveURL(s),b=r,x=e,j(),o||oe()},u.smoothstep=function(s,e,o){return(o=Je((o-s)/(e-s),0,1))*o*(3-2*o)},u.spec=He,u.storeAuthState=function(s,e){e?Wr.add(s):Wr.delete(s)},u.sub=rg,u.subtract=Cd,u.symbolSize=kp,u.transformMat3=function(s,e,o){var l=e[0],d=e[1],m=e[2];return s[0]=l*o[0]+d*o[3]+m*o[6],s[1]=l*o[1]+d*o[4]+m*o[7],s[2]=l*o[2]+d*o[5]+m*o[8],s},u.transformMat4=yu,u.transformMat4$1=function(s,e,o){var l=e[0],d=e[1],m=e[2],_=o[3]*l+o[7]*d+o[11]*m+o[15];return s[0]=(o[0]*l+o[4]*d+o[8]*m+o[12])/(_=_||1),s[1]=(o[1]*l+o[5]*d+o[9]*m+o[13])/_,s[2]=(o[2]*l+o[6]*d+o[10]*m+o[14])/_,s},u.transformQuat=sp,u.translate=function(s,e,o){var l,d,m,_,E,T,O,U,W,Y,ie,ye,Ee=o[0],Le=o[1],Ke=o[2];return e===s?(s[12]=e[0]*Ee+e[4]*Le+e[8]*Ke+e[12],s[13]=e[1]*Ee+e[5]*Le+e[9]*Ke+e[13],s[14]=e[2]*Ee+e[6]*Le+e[10]*Ke+e[14],s[15]=e[3]*Ee+e[7]*Le+e[11]*Ke+e[15]):(d=e[1],m=e[2],_=e[3],E=e[4],T=e[5],O=e[6],U=e[7],W=e[8],Y=e[9],ie=e[10],ye=e[11],s[0]=l=e[0],s[1]=d,s[2]=m,s[3]=_,s[4]=E,s[5]=T,s[6]=O,s[7]=U,s[8]=W,s[9]=Y,s[10]=ie,s[11]=ye,s[12]=l*Ee+E*Le+W*Ke+e[12],s[13]=d*Ee+T*Le+Y*Ke+e[13],s[14]=m*Ee+O*Le+ie*Ke+e[14],s[15]=_*Ee+U*Le+ye*Ke+e[15]),s},u.triggerPluginCompletionEvent=z,u.uniqueId=gn,u.validateCustomStyleLayer=function(s){const e=[],o=s.id;return void 0===o&&e.push({message:`layers.${o}: missing required property "id"`}),void 0===s.render&&e.push({message:`layers.${o}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&e.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateFog=zo,u.validateLight=No,u.validateStyle=Jo,u.values=Lt,u.vectorTile=cl,u.version="2.5.1",u.warnOnce=bn,u.window=ve,u.wrap=Me}),A(0,function(u){function ge(K){const k=typeof K;if("number"===k||"boolean"===k||"string"===k||null==K)return JSON.stringify(K);if(Array.isArray(K)){let de="[";for(const Pe of K)de+=`${ge(Pe)},`;return`${de}]`}const N=Object.keys(K).sort();let H="{";for(let de=0;de<N.length;de++)H+=`${JSON.stringify(N[de])}:${ge(K[N[de]])},`;return`${H}}`}function Se(K){let k="";for(const N of u.refProperties)k+=`/${ge(K[N])}`;return k}class Ce{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,N){for(const de of k){this._layerConfigs[de.id]=de;const Pe=this._layers[de.id]=u.createStyleLayer(de);Pe._featureFilter=u.createFilter(Pe.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of N)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const H=function(de,Pe){const Qe={};for(let Ze=0;Ze<de.length;Ze++){const ft=Pe&&Pe[de[Ze].id]||Se(de[Ze]);Pe&&(Pe[de[Ze].id]=ft);let St=Qe[ft];St||(St=Qe[ft]=[]),St.push(de[Ze])}const st=[];for(const Ze in Qe)st.push(Qe[Ze]);return st}(u.values(this._layerConfigs),this.keyCache);for(const de of H){const Pe=de.map(Gt=>this._layers[Gt.id]),Qe=Pe[0];if("none"===Qe.visibility)continue;const st=Qe.source||"";let Ze=this.familiesBySource[st];Ze||(Ze=this.familiesBySource[st]={});const ft=Qe.sourceLayer||"_geojsonTileLayer";let St=Ze[ft];St||(St=Ze[ft]=[]),St.push(Pe)}}}const{ImageBitmap:ce}=u.window;class ae{loadTile(k,N){const{uid:H,encoding:de,rawImageData:Pe,padding:Qe,buildQuadTree:st}=k,Ze=ce&&Pe instanceof ce?this.getImageData(Pe,Qe):Pe;N(null,new u.DEMData(H,Ze,de,Qe<1,st))}getImageData(k,N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(k.width,k.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=k.width,this.offscreenCanvas.height=k.height,this.offscreenCanvasContext.drawImage(k,0,0,k.width,k.height);const H=this.offscreenCanvasContext.getImageData(-N,-N,k.width+2*N,k.height+2*N);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new u.RGBAImage({width:H.width,height:H.height},H.data)}}var ve=function K(k,N){var H,de=k&&k.type;if("FeatureCollection"===de)for(H=0;H<k.features.length;H++)K(k.features[H],N);else if("GeometryCollection"===de)for(H=0;H<k.geometries.length;H++)K(k.geometries[H],N);else if("Feature"===de)K(k.geometry,N);else if("Polygon"===de)Ue(k.coordinates,N);else if("MultiPolygon"===de)for(H=0;H<k.coordinates.length;H++)Ue(k.coordinates[H],N);return k};function Ue(K,k){if(0!==K.length){Be(K[0],k);for(var N=1;N<K.length;N++)Be(K[N],!k)}}function Be(K,k){for(var N=0,H=0,de=K.length,Pe=de-1;H<de;Pe=H++)N+=(K[H][0]-K[Pe][0])*(K[Pe][1]+K[H][1]);N>=0!=!!k&&K.reverse()}const we=u.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Oe{constructor(k){this._feature=k,this.extent=u.EXTENT,this.type=k.type,this.properties=k.tags,"id"in k&&!isNaN(k.id)&&(this.id=parseInt(k.id,10))}loadGeometry(){if(1===this._feature.type){const k=[];for(const N of this._feature.geometry)k.push([new u.pointGeometry(N[0],N[1])]);return k}{const k=[];for(const N of this._feature.geometry){const H=[];for(const de of N)H.push(new u.pointGeometry(de[0],de[1]));k.push(H)}return k}}toGeoJSON(k,N,H){return we.call(this,k,N,H)}}class Ne{constructor(k){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=k.length,this._features=k}feature(k){return new Oe(this._features[k])}}var ke=u.vectorTile.VectorTileFeature,lt=Ot;function Ot(K,k){this.options=k||{},this.features=K,this.length=K.length}function Je(K,k){this.id="number"==typeof K.id?K.id:void 0,this.type=K.type,this.rawGeometry=1===K.type?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=k||4096}Ot.prototype.feature=function(K){return new Je(this.features[K],this.options.extent)},Je.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var k=0;k<K.length;k++){for(var N=K[k],H=[],de=0;de<N.length;de++)H.push(new u.pointGeometry(N[de][0],N[de][1]));this.geometry.push(H)}return this.geometry},Je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,k=1/0,N=-1/0,H=1/0,de=-1/0,Pe=0;Pe<K.length;Pe++)for(var Qe=K[Pe],st=0;st<Qe.length;st++){var Ze=Qe[st];k=Math.min(k,Ze.x),N=Math.max(N,Ze.x),H=Math.min(H,Ze.y),de=Math.max(de,Ze.y)}return[k,H,N,de]},Je.prototype.toGeoJSON=ke.prototype.toGeoJSON;var Me=Lt,Ge=lt;function Lt(K){var k=new u.pbf;return function(N,H){for(var de in N.layers)H.writeMessage(3,Ht,N.layers[de])}(K,k),k.finish()}function Ht(K,k){var N;k.writeVarintField(15,K.version||1),k.writeStringField(1,K.name||""),k.writeVarintField(5,K.extent||4096);var H={keys:[],values:[],keycache:{},valuecache:{}};for(N=0;N<K.length;N++)H.feature=K.feature(N),k.writeMessage(2,zn,H);var de=H.keys;for(N=0;N<de.length;N++)k.writeStringField(3,de[N]);var Pe=H.values;for(N=0;N<Pe.length;N++)k.writeMessage(4,ct,Pe[N])}function zn(K,k){var N=K.feature;void 0!==N.id&&k.writeVarintField(1,N.id),k.writeMessage(2,gn,K),k.writeVarintField(3,N.type),k.writeMessage(4,Gn,N)}function gn(K,k){var N=K.feature,H=K.keys,de=K.values,Pe=K.keycache,Qe=K.valuecache;for(var st in N.properties){var Ze=Pe[st];void 0===Ze&&(H.push(st),Pe[st]=Ze=H.length-1),k.writeVarint(Ze);var ft=N.properties[st],St=typeof ft;"string"!==St&&"boolean"!==St&&"number"!==St&&(ft=JSON.stringify(ft));var Gt=St+":"+ft,Pt=Qe[Gt];void 0===Pt&&(de.push(ft),Qe[Gt]=Pt=de.length-1),k.writeVarint(Pt)}}function Xt(K,k){return(k<<3)+(7&K)}function In(K){return K<<1^K>>31}function Gn(K,k){for(var N=K.loadGeometry(),H=K.type,de=0,Pe=0,Qe=N.length,st=0;st<Qe;st++){var Ze=N[st],ft=1;1===H&&(ft=Ze.length),k.writeVarint(Xt(1,ft));for(var St=3===H?Ze.length-1:Ze.length,Gt=0;Gt<St;Gt++){1===Gt&&1!==H&&k.writeVarint(Xt(2,St-1));var Pt=Ze[Gt].x-de,sn=Ze[Gt].y-Pe;k.writeVarint(In(Pt)),k.writeVarint(In(sn)),de+=Pt,Pe+=sn}3===H&&k.writeVarint(Xt(7,1))}}function ct(K,k){var N=typeof K;"string"===N?k.writeStringField(1,K):"boolean"===N?k.writeBooleanField(7,K):"number"===N&&(K%1!=0?k.writeDoubleField(3,K):K<0?k.writeSVarintField(6,K):k.writeVarintField(5,K))}function tt(K,k,N,H,de,Pe){if(de-H<=N)return;const Qe=H+de>>1;mt(K,k,Qe,H,de,Pe%2),tt(K,k,N,H,Qe-1,Pe+1),tt(K,k,N,Qe+1,de,Pe+1)}function mt(K,k,N,H,de,Pe){for(;de>H;){if(de-H>600){const ft=de-H+1,St=N-H+1,Gt=Math.log(ft),Pt=.5*Math.exp(2*Gt/3),sn=.5*Math.sqrt(Gt*Pt*(ft-Pt)/ft)*(St-ft/2<0?-1:1);mt(K,k,N,Math.max(H,Math.floor(N-St*Pt/ft+sn)),Math.min(de,Math.floor(N+(ft-St)*Pt/ft+sn)),Pe)}const Qe=k[2*N+Pe];let st=H,Ze=de;for(gt(K,k,H,N),k[2*de+Pe]>Qe&&gt(K,k,H,de);st<Ze;){for(gt(K,k,st,Ze),st++,Ze--;k[2*st+Pe]<Qe;)st++;for(;k[2*Ze+Pe]>Qe;)Ze--}k[2*H+Pe]===Qe?gt(K,k,H,Ze):(Ze++,gt(K,k,Ze,de)),Ze<=N&&(H=Ze+1),N<=Ze&&(de=Ze-1)}}function gt(K,k,N,H){tn(K,N,H),tn(k,2*N,2*H),tn(k,2*N+1,2*H+1)}function tn(K,k,N){const H=K[k];K[k]=K[N],K[N]=H}function an(K,k,N,H){const de=K-N,Pe=k-H;return de*de+Pe*Pe}Me.fromVectorTileJs=Lt,Me.fromGeojsonVt=function(K,k){k=k||{};var N={};for(var H in K)N[H]=new lt(K[H].features,k),N[H].name=H,N[H].version=k.version,N[H].extent=k.extent;return Lt({layers:N})},Me.GeoJSONWrapper=Ge;const bn=K=>K[0],Pn=K=>K[1];class Or{constructor(k,N=bn,H=Pn,de=64,Pe=Float64Array){this.nodeSize=de,this.points=k;const Qe=k.length<65536?Uint16Array:Uint32Array,st=this.ids=new Qe(k.length),Ze=this.coords=new Pe(2*k.length);for(let ft=0;ft<k.length;ft++)st[ft]=ft,Ze[2*ft]=N(k[ft]),Ze[2*ft+1]=H(k[ft]);tt(st,Ze,de,0,st.length-1,0)}range(k,N,H,de){return function(Pe,Qe,st,Ze,ft,St,Gt){const Pt=[0,Pe.length-1,0],sn=[];let He,Ct;for(;Pt.length;){const Bn=Pt.pop(),Hn=Pt.pop(),An=Pt.pop();if(Hn-An<=Gt){for(let tr=An;tr<=Hn;tr++)He=Qe[2*tr],Ct=Qe[2*tr+1],He>=st&&He<=ft&&Ct>=Ze&&Ct<=St&&sn.push(Pe[tr]);continue}const sr=Math.floor((An+Hn)/2);He=Qe[2*sr],Ct=Qe[2*sr+1],He>=st&&He<=ft&&Ct>=Ze&&Ct<=St&&sn.push(Pe[sr]);const Yn=(Bn+1)%2;(0===Bn?st<=He:Ze<=Ct)&&(Pt.push(An),Pt.push(sr-1),Pt.push(Yn)),(0===Bn?ft>=He:St>=Ct)&&(Pt.push(sr+1),Pt.push(Hn),Pt.push(Yn))}return sn}(this.ids,this.coords,k,N,H,de,this.nodeSize)}within(k,N,H){return function(de,Pe,Qe,st,Ze,ft){const St=[0,de.length-1,0],Gt=[],Pt=Ze*Ze;for(;St.length;){const sn=St.pop(),He=St.pop(),Ct=St.pop();if(He-Ct<=ft){for(let Yn=Ct;Yn<=He;Yn++)an(Pe[2*Yn],Pe[2*Yn+1],Qe,st)<=Pt&&Gt.push(de[Yn]);continue}const Bn=Math.floor((Ct+He)/2),Hn=Pe[2*Bn],An=Pe[2*Bn+1];an(Hn,An,Qe,st)<=Pt&&Gt.push(de[Bn]);const sr=(sn+1)%2;(0===sn?Qe-Ze<=Hn:st-Ze<=An)&&(St.push(Ct),St.push(Bn-1),St.push(sr)),(0===sn?Qe+Ze>=Hn:st+Ze>=An)&&(St.push(Bn+1),St.push(He),St.push(sr))}return Gt}(this.ids,this.coords,k,N,H,this.nodeSize)}}const Jr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},qt=Math.fround||(kn=new Float32Array(1),K=>(kn[0]=+K,kn[0]));var kn;class Ve{constructor(k){this.options=xi(Object.create(Jr),k),this.trees=new Array(this.options.maxZoom+1)}load(k){const{log:N,minZoom:H,maxZoom:de,nodeSize:Pe}=this.options;N&&console.time("total time");const Qe=`prepare ${k.length} points`;N&&console.time(Qe),this.points=k;let st=[];for(let Ze=0;Ze<k.length;Ze++)k[Ze].geometry&&st.push(ln(k[Ze],Ze));this.trees[de+1]=new Or(st,yr,Vi,Pe,Float32Array),N&&console.timeEnd(Qe);for(let Ze=de;Ze>=H;Ze--){const ft=+Date.now();st=this._cluster(st,Ze),this.trees[Ze]=new Or(st,yr,Vi,Pe,Float32Array),N&&console.log("z%d: %d clusters in %dms",Ze,st.length,+Date.now()-ft)}return N&&console.timeEnd("total time"),this}getClusters(k,N){let H=((k[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,k[1]));let Pe=180===k[2]?180:((k[2]+180)%360+360)%360-180;const Qe=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)H=-180,Pe=180;else if(H>Pe){const St=this.getClusters([H,de,180,Qe],N),Gt=this.getClusters([-180,de,Pe,Qe],N);return St.concat(Gt)}const st=this.trees[this._limitZoom(N)],Ze=st.range(Vn(H),ri(Qe),Vn(Pe),ri(de)),ft=[];for(const St of Ze){const Gt=st.points[St];ft.push(Gt.numPoints?Rn(Gt):this.points[Gt.index])}return ft}getChildren(k){const N=this._getOriginId(k),H=this._getOriginZoom(k),de="No cluster with the specified id.",Pe=this.trees[H];if(!Pe)throw new Error(de);const Qe=Pe.points[N];if(!Qe)throw new Error(de);const st=this.options.radius/(this.options.extent*Math.pow(2,H-1)),Ze=Pe.within(Qe.x,Qe.y,st),ft=[];for(const St of Ze){const Gt=Pe.points[St];Gt.parentId===k&&ft.push(Gt.numPoints?Rn(Gt):this.points[Gt.index])}if(0===ft.length)throw new Error(de);return ft}getLeaves(k,N,H){const de=[];return this._appendLeaves(de,k,N=N||10,H=H||0,0),de}getTile(k,N,H){const de=this.trees[this._limitZoom(k)],Pe=Math.pow(2,k),{extent:Qe,radius:st}=this.options,Ze=st/Qe,ft=(H-Ze)/Pe,St=(H+1+Ze)/Pe,Gt={features:[]};return this._addTileFeatures(de.range((N-Ze)/Pe,ft,(N+1+Ze)/Pe,St),de.points,N,H,Pe,Gt),0===N&&this._addTileFeatures(de.range(1-Ze/Pe,ft,1,St),de.points,Pe,H,Pe,Gt),N===Pe-1&&this._addTileFeatures(de.range(0,ft,Ze/Pe,St),de.points,-1,H,Pe,Gt),Gt.features.length?Gt:null}getClusterExpansionZoom(k){let N=this._getOriginZoom(k)-1;for(;N<=this.options.maxZoom;){const H=this.getChildren(k);if(N++,1!==H.length)break;k=H[0].properties.cluster_id}return N}_appendLeaves(k,N,H,de,Pe){const Qe=this.getChildren(N);for(const st of Qe){const Ze=st.properties;if(Ze&&Ze.cluster?Pe+Ze.point_count<=de?Pe+=Ze.point_count:Pe=this._appendLeaves(k,Ze.cluster_id,H,de,Pe):Pe<de?Pe++:k.push(st),k.length===H)break}return Pe}_addTileFeatures(k,N,H,de,Pe,Qe){for(const st of k){const Ze=N[st],ft=Ze.numPoints;let St,Gt,Pt;if(ft)St=ir(Ze),Gt=Ze.x,Pt=Ze.y;else{const Ct=this.points[Ze.index];St=Ct.properties,Gt=Vn(Ct.geometry.coordinates[0]),Pt=ri(Ct.geometry.coordinates[1])}const sn={type:1,geometry:[[Math.round(this.options.extent*(Gt*Pe-H)),Math.round(this.options.extent*(Pt*Pe-de))]],tags:St};let He;ft?He=Ze.id:this.options.generateId?He=Ze.index:this.points[Ze.index].id&&(He=this.points[Ze.index].id),void 0!==He&&(sn.id=He),Qe.features.push(sn)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(+k,this.options.maxZoom+1))}_cluster(k,N){const H=[],{radius:de,extent:Pe,reduce:Qe,minPoints:st}=this.options,Ze=de/(Pe*Math.pow(2,N));for(let ft=0;ft<k.length;ft++){const St=k[ft];if(St.zoom<=N)continue;St.zoom=N;const Gt=this.trees[N+1],Pt=Gt.within(St.x,St.y,Ze),sn=St.numPoints||1;let He=sn;for(const Ct of Pt){const Bn=Gt.points[Ct];Bn.zoom>N&&(He+=Bn.numPoints||1)}if(He>=st){let Ct=St.x*sn,Bn=St.y*sn,Hn=Qe&&sn>1?this._map(St,!0):null;const An=(ft<<5)+(N+1)+this.points.length;for(const sr of Pt){const Yn=Gt.points[sr];if(Yn.zoom<=N)continue;Yn.zoom=N;const tr=Yn.numPoints||1;Ct+=Yn.x*tr,Bn+=Yn.y*tr,Yn.parentId=An,Qe&&(Hn||(Hn=this._map(St,!0)),Qe(Hn,this._map(Yn)))}St.parentId=An,H.push(zt(Ct/He,Bn/He,An,He,Hn))}else if(H.push(St),He>1)for(const Ct of Pt){const Bn=Gt.points[Ct];Bn.zoom<=N||(Bn.zoom=N,H.push(Bn))}}return H}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,N){if(k.numPoints)return N?xi({},k.properties):k.properties;const H=this.points[k.index].properties,de=this.options.map(H);return N&&de===H?xi({},de):de}}function zt(K,k,N,H,de){return{x:qt(K),y:qt(k),zoom:1/0,id:N,parentId:-1,numPoints:H,properties:de}}function ln(K,k){const[N,H]=K.geometry.coordinates;return{x:qt(Vn(N)),y:qt(ri(H)),zoom:1/0,index:k,parentId:-1}}function Rn(K){return{type:"Feature",id:K.id,properties:ir(K),geometry:{type:"Point",coordinates:[(k=K.x,360*(k-.5)),Zn(K.y)]}};var k}function ir(K){const k=K.numPoints,N=k>=1e4?`${Math.round(k/1e3)}k`:k>=1e3?Math.round(k/100)/10+"k":k;return xi(xi({},K.properties),{cluster:!0,cluster_id:K.id,point_count:k,point_count_abbreviated:N})}function Vn(K){return K/360+.5}function ri(K){const k=Math.sin(K*Math.PI/180),N=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return N<0?0:N>1?1:N}function Zn(K){const k=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function xi(K,k){for(const N in k)K[N]=k[N];return K}function yr(K){return K.x}function Vi(K){return K.y}function zr(K,k,N,H){for(var de,Pe=H,Qe=N-k>>1,st=N-k,Ze=K[k],ft=K[k+1],St=K[N],Gt=K[N+1],Pt=k+3;Pt<N;Pt+=3){var sn=$r(K[Pt],K[Pt+1],Ze,ft,St,Gt);if(sn>Pe)de=Pt,Pe=sn;else if(sn===Pe){var He=Math.abs(Pt-Qe);He<st&&(de=Pt,st=He)}}Pe>H&&(de-k>3&&zr(K,k,de,H),K[de+2]=Pe,N-de>3&&zr(K,de,N,H))}function $r(K,k,N,H,de,Pe){var Qe=de-N,st=Pe-H;if(0!==Qe||0!==st){var Ze=((K-N)*Qe+(k-H)*st)/(Qe*Qe+st*st);Ze>1?(N=de,H=Pe):Ze>0&&(N+=Qe*Ze,H+=st*Ze)}return(Qe=K-N)*Qe+(st=k-H)*st}function as(K,k,N,H){var de={id:void 0===K?null:K,type:k,geometry:N,tags:H,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Pe){var Qe=Pe.geometry,st=Pe.type;if("Point"===st||"MultiPoint"===st||"LineString"===st)di(Pe,Qe);else if("Polygon"===st||"MultiLineString"===st)for(var Ze=0;Ze<Qe.length;Ze++)di(Pe,Qe[Ze]);else if("MultiPolygon"===st)for(Ze=0;Ze<Qe.length;Ze++)for(var ft=0;ft<Qe[Ze].length;ft++)di(Pe,Qe[Ze][ft])}(de),de}function di(K,k){for(var N=0;N<k.length;N+=3)K.minX=Math.min(K.minX,k[N]),K.minY=Math.min(K.minY,k[N+1]),K.maxX=Math.max(K.maxX,k[N]),K.maxY=Math.max(K.maxY,k[N+1])}function ls(K,k,N,H){if(k.geometry){var de=k.geometry.coordinates,Pe=k.geometry.type,Qe=Math.pow(N.tolerance/((1<<N.maxZoom)*N.extent),2),st=[],Ze=k.id;if(N.promoteId?Ze=k.properties[N.promoteId]:N.generateId&&(Ze=H||0),"Point"===Pe)Ui(de,st);else if("MultiPoint"===Pe)for(var ft=0;ft<de.length;ft++)Ui(de[ft],st);else if("LineString"===Pe)Tt(de,st,Qe,!1);else if("MultiLineString"===Pe){if(N.lineMetrics){for(ft=0;ft<de.length;ft++)Tt(de[ft],st=[],Qe,!1),K.push(as(Ze,"LineString",st,k.properties));return}rt(de,st,Qe,!1)}else if("Polygon"===Pe)rt(de,st,Qe,!0);else{if("MultiPolygon"!==Pe){if("GeometryCollection"===Pe){for(ft=0;ft<k.geometry.geometries.length;ft++)ls(K,{id:Ze,geometry:k.geometry.geometries[ft],properties:k.properties},N,H);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ft=0;ft<de.length;ft++){var St=[];rt(de[ft],St,Qe,!0),st.push(St)}}K.push(as(Ze,Pe,st,k.properties))}}function Ui(K,k){k.push(nt(K[0])),k.push(Wt(K[1])),k.push(0)}function Tt(K,k,N,H){for(var de,Pe,Qe=0,st=0;st<K.length;st++){var Ze=nt(K[st][0]),ft=Wt(K[st][1]);k.push(Ze),k.push(ft),k.push(0),st>0&&(Qe+=H?(de*ft-Ze*Pe)/2:Math.sqrt(Math.pow(Ze-de,2)+Math.pow(ft-Pe,2))),de=Ze,Pe=ft}var St=k.length-3;k[2]=1,zr(k,0,St,N),k[St+2]=1,k.size=Math.abs(Qe),k.start=0,k.end=k.size}function rt(K,k,N,H){for(var de=0;de<K.length;de++){var Pe=[];Tt(K[de],Pe,N,H),k.push(Pe)}}function nt(K){return K/360+.5}function Wt(K){var k=Math.sin(K*Math.PI/180),N=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return N<0?0:N>1?1:N}function _t(K,k,N,H,de,Pe,Qe,st){if(H/=k,Pe>=(N/=k)&&Qe<H)return K;if(Qe<N||Pe>=H)return null;for(var Ze=[],ft=0;ft<K.length;ft++){var St=K[ft],Gt=St.geometry,Pt=St.type,sn=0===de?St.minX:St.minY,He=0===de?St.maxX:St.maxY;if(sn>=N&&He<H)Ze.push(St);else if(!(He<N||sn>=H)){var Ct=[];if("Point"===Pt||"MultiPoint"===Pt)hn(Gt,Ct,N,H,de);else if("LineString"===Pt)mn(Gt,Ct,N,H,de,!1,st.lineMetrics);else if("MultiLineString"===Pt)xn(Gt,Ct,N,H,de,!1);else if("Polygon"===Pt)xn(Gt,Ct,N,H,de,!0);else if("MultiPolygon"===Pt)for(var Bn=0;Bn<Gt.length;Bn++){var Hn=[];xn(Gt[Bn],Hn,N,H,de,!0),Hn.length&&Ct.push(Hn)}if(Ct.length){if(st.lineMetrics&&"LineString"===Pt){for(Bn=0;Bn<Ct.length;Bn++)Ze.push(as(St.id,Pt,Ct[Bn],St.tags));continue}"LineString"!==Pt&&"MultiLineString"!==Pt||(1===Ct.length?(Pt="LineString",Ct=Ct[0]):Pt="MultiLineString"),"Point"!==Pt&&"MultiPoint"!==Pt||(Pt=3===Ct.length?"Point":"MultiPoint"),Ze.push(as(St.id,Pt,Ct,St.tags))}}}return Ze.length?Ze:null}function hn(K,k,N,H,de){for(var Pe=0;Pe<K.length;Pe+=3){var Qe=K[Pe+de];Qe>=N&&Qe<=H&&(k.push(K[Pe]),k.push(K[Pe+1]),k.push(K[Pe+2]))}}function mn(K,k,N,H,de,Pe,Qe){for(var st,Ze,ft=_n(K),St=0===de?Fr:ii,Gt=K.start,Pt=0;Pt<K.length-3;Pt+=3){var sn=K[Pt],He=K[Pt+1],Ct=K[Pt+2],Bn=K[Pt+3],Hn=K[Pt+4],An=0===de?sn:He,sr=0===de?Bn:Hn,Yn=!1;Qe&&(st=Math.sqrt(Math.pow(sn-Bn,2)+Math.pow(He-Hn,2))),An<N?sr>N&&(Ze=St(ft,sn,He,Bn,Hn,N),Qe&&(ft.start=Gt+st*Ze)):An>H?sr<H&&(Ze=St(ft,sn,He,Bn,Hn,H),Qe&&(ft.start=Gt+st*Ze)):jr(ft,sn,He,Ct),sr<N&&An>=N&&(Ze=St(ft,sn,He,Bn,Hn,N),Yn=!0),sr>H&&An<=H&&(Ze=St(ft,sn,He,Bn,Hn,H),Yn=!0),!Pe&&Yn&&(Qe&&(ft.end=Gt+st*Ze),k.push(ft),ft=_n(K)),Qe&&(Gt+=st)}var tr=K.length-3;sn=K[tr],He=K[tr+1],Ct=K[tr+2],(An=0===de?sn:He)>=N&&An<=H&&jr(ft,sn,He,Ct),tr=ft.length-3,Pe&&tr>=3&&(ft[tr]!==ft[0]||ft[tr+1]!==ft[1])&&jr(ft,ft[0],ft[1],ft[2]),ft.length&&k.push(ft)}function _n(K){var k=[];return k.size=K.size,k.start=K.start,k.end=K.end,k}function xn(K,k,N,H,de,Pe){for(var Qe=0;Qe<K.length;Qe++)mn(K[Qe],k,N,H,de,Pe,!1)}function jr(K,k,N,H){K.push(k),K.push(N),K.push(H)}function Fr(K,k,N,H,de,Pe){var Qe=(Pe-k)/(H-k);return K.push(Pe),K.push(N+(de-N)*Qe),K.push(1),Qe}function ii(K,k,N,H,de,Pe){var Qe=(Pe-N)/(de-N);return K.push(k+(H-k)*Qe),K.push(Pe),K.push(1),Qe}function Wr(K,k){for(var N=[],H=0;H<K.length;H++){var de,Pe=K[H],Qe=Pe.type;if("Point"===Qe||"MultiPoint"===Qe||"LineString"===Qe)de=jn(Pe.geometry,k);else if("MultiLineString"===Qe||"Polygon"===Qe){de=[];for(var st=0;st<Pe.geometry.length;st++)de.push(jn(Pe.geometry[st],k))}else if("MultiPolygon"===Qe)for(de=[],st=0;st<Pe.geometry.length;st++){for(var Ze=[],ft=0;ft<Pe.geometry[st].length;ft++)Ze.push(jn(Pe.geometry[st][ft],k));de.push(Ze)}N.push(as(Pe.id,Qe,de,Pe.tags))}return N}function jn(K,k){var N=[];N.size=K.size,void 0!==K.start&&(N.start=K.start,N.end=K.end);for(var H=0;H<K.length;H+=3)N.push(K[H]+k,K[H+1],K[H+2]);return N}function wn(K,k){if(K.transformed)return K;var N,H,de,Pe=1<<K.z,Qe=K.x,st=K.y;for(N=0;N<K.features.length;N++){var Ze=K.features[N],ft=Ze.geometry,St=Ze.type;if(Ze.geometry=[],1===St)for(H=0;H<ft.length;H+=2)Ze.geometry.push(mi(ft[H],ft[H+1],k,Pe,Qe,st));else for(H=0;H<ft.length;H++){var Gt=[];for(de=0;de<ft[H].length;de+=2)Gt.push(mi(ft[H][de],ft[H][de+1],k,Pe,Qe,st));Ze.geometry.push(Gt)}}return K.transformed=!0,K}function mi(K,k,N,H,de,Pe){return[Math.round(N*(K*H-de)),Math.round(N*(k*H-Pe))]}function ar(K,k,N,H,de){for(var Pe=k===de.maxZoom?0:de.tolerance/((1<<k)*de.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:N,y:H,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},st=0;st<K.length;st++){Qe.numFeatures++,Yr(Qe,K[st],Pe,de);var Ze=K[st].minX,ft=K[st].minY,St=K[st].maxX,Gt=K[st].maxY;Ze<Qe.minX&&(Qe.minX=Ze),ft<Qe.minY&&(Qe.minY=ft),St>Qe.maxX&&(Qe.maxX=St),Gt>Qe.maxY&&(Qe.maxY=Gt)}return Qe}function Yr(K,k,N,H){var de=k.geometry,Pe=k.type,Qe=[];if("Point"===Pe||"MultiPoint"===Pe)for(var st=0;st<de.length;st+=3)Qe.push(de[st]),Qe.push(de[st+1]),K.numPoints++,K.numSimplified++;else if("LineString"===Pe)Gr(Qe,de,K,N,!1,!1);else if("MultiLineString"===Pe||"Polygon"===Pe)for(st=0;st<de.length;st++)Gr(Qe,de[st],K,N,"Polygon"===Pe,0===st);else if("MultiPolygon"===Pe)for(var Ze=0;Ze<de.length;Ze++){var ft=de[Ze];for(st=0;st<ft.length;st++)Gr(Qe,ft[st],K,N,!0,0===st)}if(Qe.length){var St=k.tags||null;if("LineString"===Pe&&H.lineMetrics){for(var Gt in St={},k.tags)St[Gt]=k.tags[Gt];St.mapbox_clip_start=de.start/de.size,St.mapbox_clip_end=de.end/de.size}var Pt={geometry:Qe,type:"Polygon"===Pe||"MultiPolygon"===Pe?3:"LineString"===Pe||"MultiLineString"===Pe?2:1,tags:St};null!==k.id&&(Pt.id=k.id),K.features.push(Pt)}}function Gr(K,k,N,H,de,Pe){var Qe=H*H;if(H>0&&k.size<(de?Qe:H))N.numPoints+=k.length/3;else{for(var st=[],Ze=0;Ze<k.length;Ze+=3)(0===H||k[Ze+2]>Qe)&&(N.numSimplified++,st.push(k[Ze]),st.push(k[Ze+1])),N.numPoints++;de&&function(ft,St){for(var Gt=0,Pt=0,sn=ft.length,He=sn-2;Pt<sn;He=Pt,Pt+=2)Gt+=(ft[Pt]-ft[He])*(ft[Pt+1]+ft[He+1]);if(Gt>0===St)for(Pt=0,sn=ft.length;Pt<sn/2;Pt+=2){var Ct=ft[Pt],Bn=ft[Pt+1];ft[Pt]=ft[sn-2-Pt],ft[Pt+1]=ft[sn-1-Pt],ft[sn-2-Pt]=Ct,ft[sn-1-Pt]=Bn}}(st,Pe),K.push(st)}}function vr(K,k){var N=(k=this.options=function(de,Pe){for(var Qe in Pe)de[Qe]=Pe[Qe];return de}(Object.create(this.options),k)).debug;if(N&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var de,Pe,Qe,st,Ze,ft,H=function(de,Pe){var Qe=[];if("FeatureCollection"===de.type)for(var st=0;st<de.features.length;st++)ls(Qe,de.features[st],Pe,st);else ls(Qe,"Feature"===de.type?de:{geometry:de},Pe);return Qe}(K,k);this.tiles={},this.tileCoords=[],N&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(de=H,Pe=k,Qe=Pe.buffer/Pe.extent,st=de,Ze=_t(de,1,-1-Qe,Qe,0,-1,2,Pe),ft=_t(de,1,1-Qe,2+Qe,0,-1,2,Pe),(Ze||ft)&&(st=_t(de,1,-Qe,1+Qe,0,-1,2,Pe)||[],Ze&&(st=Wr(Ze,1).concat(st)),ft&&(st=st.concat(Wr(ft,-1)))),H=st).length&&this.splitTile(H,0,0,0),N&&(H.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function cs(K,k,N){return 32*((1<<K)*N+k)+K}function ro(K,k){const N=K.tileID.canonical;if(!this._geoJSONIndex)return k(null,null);const H=this._geoJSONIndex.getTile(N.z,N.x,N.y);if(!H)return k(null,null);const de=new Ne(H.features);let Pe=Me(de);0===Pe.byteOffset&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),k(null,{vectorTile:de,rawData:Pe.buffer})}vr.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vr.prototype.splitTile=function(K,k,N,H,de,Pe,Qe){for(var st=[K,k,N,H],Ze=this.options,ft=Ze.debug;st.length;){H=st.pop(),N=st.pop(),k=st.pop(),K=st.pop();var St=1<<k,Gt=cs(k,N,H),Pt=this.tiles[Gt];if(!Pt&&(ft>1&&console.time("creation"),Pt=this.tiles[Gt]=ar(K,k,N,H,Ze),this.tileCoords.push({z:k,x:N,y:H}),ft)){ft>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,N,H,Pt.numFeatures,Pt.numPoints,Pt.numSimplified),console.timeEnd("creation"));var sn="z"+k;this.stats[sn]=(this.stats[sn]||0)+1,this.total++}if(Pt.source=K,de){if(k===Ze.maxZoom||k===de)continue;var He=1<<de-k;if(N!==Math.floor(Pe/He)||H!==Math.floor(Qe/He))continue}else if(k===Ze.indexMaxZoom||Pt.numPoints<=Ze.indexMaxPoints)continue;if(Pt.source=null,0!==K.length){ft>1&&console.time("clipping");var Ct,Bn,Hn,An,sr,Yn,tr=.5*Ze.buffer/Ze.extent,Wi=.5-tr,en=.5+tr,Bt=1+tr;Ct=Bn=Hn=An=null,sr=_t(K,St,N-tr,N+en,0,Pt.minX,Pt.maxX,Ze),Yn=_t(K,St,N+Wi,N+Bt,0,Pt.minX,Pt.maxX,Ze),K=null,sr&&(Ct=_t(sr,St,H-tr,H+en,1,Pt.minY,Pt.maxY,Ze),Bn=_t(sr,St,H+Wi,H+Bt,1,Pt.minY,Pt.maxY,Ze),sr=null),Yn&&(Hn=_t(Yn,St,H-tr,H+en,1,Pt.minY,Pt.maxY,Ze),An=_t(Yn,St,H+Wi,H+Bt,1,Pt.minY,Pt.maxY,Ze),Yn=null),ft>1&&console.timeEnd("clipping"),st.push(Ct||[],k+1,2*N,2*H),st.push(Bn||[],k+1,2*N,2*H+1),st.push(Hn||[],k+1,2*N+1,2*H),st.push(An||[],k+1,2*N+1,2*H+1)}}},vr.prototype.getTile=function(K,k,N){var H=this.options,de=H.extent,Pe=H.debug;if(K<0||K>24)return null;var Qe=1<<K,st=cs(K,k=(k%Qe+Qe)%Qe,N);if(this.tiles[st])return wn(this.tiles[st],de);Pe>1&&console.log("drilling down to z%d-%d-%d",K,k,N);for(var Ze,ft=K,St=k,Gt=N;!Ze&&ft>0;)ft--,St=Math.floor(St/2),Gt=Math.floor(Gt/2),Ze=this.tiles[cs(ft,St,Gt)];return Ze&&Ze.source?(Pe>1&&console.log("found parent tile z%d-%d-%d",ft,St,Gt),Pe>1&&console.time("drilling down"),this.splitTile(Ze.source,ft,St,Gt,K,k,N),Pe>1&&console.timeEnd("drilling down"),this.tiles[st]?wn(this.tiles[st],de):null):null};class qi extends u.VectorTileWorkerSource{constructor(k,N,H,de,Pe){super(k,N,H,de,ro),Pe&&(this.loadGeoJSON=Pe)}loadData(k,N){const H=k&&k.request,de=H&&H.collectResourceTiming;this.loadGeoJSON(k,(Pe,Qe)=>{if(Pe||!Qe)return N(Pe);if("object"!=typeof Qe)return N(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));{ve(Qe,!0);try{if(k.filter){const Ze=u.createExpression(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ze.result)throw new Error(Ze.value.map(St=>`${St.key}: ${St.message}`).join(", "));const ft=Qe.features.filter(St=>Ze.value.evaluate({zoom:0},St));Qe={type:"FeatureCollection",features:ft}}this._geoJSONIndex=k.cluster?new Ve(function({superclusterOptions:Ze,clusterProperties:ft}){if(!ft||!Ze)return Ze;const St={},Gt={},Pt={accumulated:null,zoom:0},sn={properties:null},He=Object.keys(ft);for(const Ct of He){const[Bn,Hn]=ft[Ct],An=u.createExpression(Hn),sr=u.createExpression("string"==typeof Bn?[Bn,["accumulated"],["get",Ct]]:Bn);St[Ct]=An.value,Gt[Ct]=sr.value}return Ze.map=Ct=>{sn.properties=Ct;const Bn={};for(const Hn of He)Bn[Hn]=St[Hn].evaluate(Pt,sn);return Bn},Ze.reduce=(Ct,Bn)=>{sn.properties=Bn;for(const Hn of He)Pt.accumulated=Ct[Hn],Ct[Hn]=Gt[Hn].evaluate(Pt,sn)},Ze}(k)).load(Qe.features):new vr(Ze=Qe,k.geojsonVtOptions)}catch(Ze){return N(Ze)}this.loaded={};const st={};if(de){const Ze=u.getPerformanceMeasurement(H);Ze&&(st.resourceTiming={},st.resourceTiming[k.source]=JSON.parse(JSON.stringify(Ze)))}N(null,st)}var Ze})}reloadTile(k,N){const H=this.loaded;return H&&H[k.uid]?super.reloadTile(k,N):this.loadTile(k,N)}loadGeoJSON(k,N){if(k.request)u.getJSON(k.request,N);else{if("string"!=typeof k.data)return N(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`));try{return N(null,JSON.parse(k.data))}catch(H){return N(new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(k,N){try{N(null,this._geoJSONIndex.getClusterExpansionZoom(k.clusterId))}catch(H){N(H)}}getClusterChildren(k,N){try{N(null,this._geoJSONIndex.getChildren(k.clusterId))}catch(H){N(H)}}getClusterLeaves(k,N){try{N(null,this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset))}catch(H){N(H)}}}class lr{constructor(k){this.self=k,this.actor=new u.Actor(k,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded=!1,this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:qi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(N,H)=>{if(this.workerSourceTypes[N])throw new Error(`Worker source with name "${N}" already registered.`);this.workerSourceTypes[N]=H},this.self.registerRTLTextPlugin=N=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=N.applyArabicShaping,u.plugin.processBidirectionalText=N.processBidirectionalText,u.plugin.processStyledBidirectionalText=N.processStyledBidirectionalText}}checkIfReady(k,N,H){H()}setReferrer(k,N){this.referrer=N}spriteLoaded(k,N){this.isSpriteLoaded=N;for(const H in this.workerSources[k]){const de=this.workerSources[k][H];for(const Pe in de)de[Pe]instanceof u.VectorTileWorkerSource&&(de[Pe].isSpriteLoaded=N,de[Pe].fire(new u.Event("isSpriteLoaded")))}}setImages(k,N,H){this.availableImages[k]=N;for(const de in this.workerSources[k]){const Pe=this.workerSources[k][de];for(const Qe in Pe)Pe[Qe].availableImages=N}H()}enableTerrain(k,N,H){this.terrain=N,H()}setLayers(k,N,H){this.getLayerIndex(k).replace(N),H()}updateLayers(k,N,H){this.getLayerIndex(k).update(N.layers,N.removedIds),H()}loadTile(k,N,H){const de=this.enableTerrain?u.extend({enableTerrain:this.terrain},N):N;this.getWorkerSource(k,N.type,N.source).loadTile(de,H)}loadDEMTile(k,N,H){const de=this.enableTerrain?u.extend({buildQuadTree:this.terrain},N):N;this.getDEMWorkerSource(k,N.source).loadTile(de,H)}reloadTile(k,N,H){const de=this.enableTerrain?u.extend({enableTerrain:this.terrain},N):N;this.getWorkerSource(k,N.type,N.source).reloadTile(de,H)}abortTile(k,N,H){this.getWorkerSource(k,N.type,N.source).abortTile(N,H)}removeTile(k,N,H){this.getWorkerSource(k,N.type,N.source).removeTile(N,H)}removeSource(k,N,H){if(!this.workerSources[k]||!this.workerSources[k][N.type]||!this.workerSources[k][N.type][N.source])return;const de=this.workerSources[k][N.type][N.source];delete this.workerSources[k][N.type][N.source],void 0!==de.removeSource?de.removeSource(N,H):H()}loadWorkerSource(k,N,H){try{this.self.importScripts(N.url),H()}catch(de){H(de.toString())}}syncRTLPluginState(k,N,H){try{u.plugin.setState(N);const de=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=de){this.self.importScripts(de);const Pe=u.plugin.isParsed();H(Pe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${de}`),Pe)}}catch(de){H(de.toString())}}getAvailableImages(k){let N=this.availableImages[k];return N||(N=[]),N}getLayerIndex(k){let N=this.layerIndexes[k];return N||(N=this.layerIndexes[k]=new Ce),N}getWorkerSource(k,N,H){return this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][N]||(this.workerSources[k][N]={}),this.workerSources[k][N][H]||(this.workerSources[k][N][H]=new this.workerSourceTypes[N]({send:(de,Pe,Qe,st,Ze,ft)=>{this.actor.send(de,Pe,Qe,k,Ze,ft)},scheduler:this.actor.scheduler},this.getLayerIndex(k),this.getAvailableImages(k),this.isSpriteLoaded)),this.workerSources[k][N][H]}getDEMWorkerSource(k,N){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][N]||(this.demWorkerSources[k][N]=new ae),this.demWorkerSources[k][N]}enforceCacheSizeLimit(k,N){u.enforceCacheSizeLimit(N)}getWorkerPerformanceMetrics(k,N,H){H(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new lr(self)),lr}),A(0,function(u){var ge=Se;function Se(f){return r=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,x,b=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(b);try{x=new Worker(M),p=!0}catch(z){p=!1}return x&&x.terminate(),URL.revokeObjectURL(M),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var x=p.getContext("2d");if(!x)return!1;var b=x.getImageData(0,0,1,1);return b&&b.width===p.width}()||(void 0===Ce[c=r&&r.failIfMajorPerformanceCaveat]&&(Ce[c]=function(p){var x,M,z,j,b=(M=p,z=document.createElement("canvas"),(j=Object.create(Se.webGLContextAttributes)).failIfMajorPerformanceCaveat=M,z.getContext("webgl",j)||z.getContext("experimental-webgl",j));if(!b)return!1;try{x=b.createShader(b.VERTEX_SHADER)}catch(M){return!1}return!(!x||b.isContextLost())&&(b.shaderSource(x,"void main() {}"),b.compileShader(x),!0===b.getShaderParameter(x,b.COMPILE_STATUS))}(c)),!Ce[c]||document.documentMode));var r,c}var Ce={};function ce(f,r){if(Array.isArray(f)){if(!Array.isArray(r)||f.length!==r.length)return!1;for(let c=0;c<f.length;c++)if(!ce(f[c],r[c]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==r){if("object"!=typeof r||Object.keys(f).length!==Object.keys(r).length)return!1;for(const c in f)if(!ce(f[c],r[c]))return!1;return!0}return f===r}Se.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ae={create:function(f,r,c){const p=u.window.document.createElement(f);return void 0!==r&&(p.className=r),c&&c.appendChild(p),p},createNS:function(f,r){return u.window.document.createElementNS(f,r)}},ve=u.window.document&&u.window.document.documentElement.style,Ue=ve&&void 0!==ve.userSelect?"userSelect":"WebkitUserSelect";let Be;ae.disableDrag=function(){ve&&Ue&&(Be=ve[Ue],ve[Ue]="none")},ae.enableDrag=function(){ve&&Ue&&(ve[Ue]=Be)},ae.setTransform=function(f,r){f.style.transform=r};let we=!1;try{const f=Object.defineProperty({},"passive",{get(){we=!0}});u.window.addEventListener("test",f,f),u.window.removeEventListener("test",f,f)}catch(f){we=!1}ae.addEventListener=function(f,r,c,p={}){f.addEventListener(r,c,"passive"in p&&we?p:p.capture)},ae.removeEventListener=function(f,r,c,p={}){f.removeEventListener(r,c,"passive"in p&&we?p:p.capture)};const Oe=function(f){f.preventDefault(),f.stopPropagation(),u.window.removeEventListener("click",Oe,!0)};function Ne(f,r,c){const p=f.offsetWidth===r.width?1:f.offsetWidth/r.width;return new u.pointGeometry((c.clientX-r.left)*p,(c.clientY-r.top)*p)}ae.suppressClick=function(){u.window.addEventListener("click",Oe,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",Oe,!0)},0)},ae.mousePos=function(f,r){const c=f.getBoundingClientRect();return Ne(f,c,r)},ae.touchPos=function(f,r){const c=f.getBoundingClientRect(),p=[];for(let x=0;x<r.length;x++)p.push(Ne(f,c,r[x]));return p},ae.mouseButton=function(f){return void 0!==u.window.InstallTrigger&&2===f.button&&f.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button},ae.remove=function(f){f.parentNode&&f.parentNode.removeChild(f)};class ke{constructor(r,c){this.pos=r,this.dir=c}intersectsPlane(r,c,p){const x=u.dot(c,this.dir);if(Math.abs(x)<1e-6)return!1;const b=u.dot(u.sub(u.create(),r,this.pos),c)/x,M=u.scaleAndAdd(u.create(),this.pos,this.dir,b);return u.copy(p,M),!0}}class lt{constructor(r,c){this.points=r,this.planes=c}static fromInvProjectionMatrix(r,c,p){const x=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(z=>{const j=u.transformMat4([],z,r),Q=1/j[3]/c*x;return u.mul(j,j,[Q,Q,1/j[3],Q])}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(z=>{const j=u.sub([],b[z[0]],b[z[1]]),Q=u.sub([],b[z[2]],b[z[1]]),re=u.normalize([],u.cross([],j,Q)),oe=-u.dot(re,b[z[1]]);return re.concat(oe)});return new lt(b,M)}}class Ot{constructor(r,c){this.min=r,this.max=c,this.center=u.scale([],u.add([],this.min,this.max),.5)}quadrant(r){const c=[r%2==0,r<2],p=u.clone(this.min),x=u.clone(this.max);for(let b=0;b<c.length;b++)p[b]=c[b]?this.min[b]:this.center[b],x[b]=c[b]?this.center[b]:this.max[b];return x[2]=this.max[2],new Ot(p,x)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}intersects(r){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let x=0;x<r.planes.length;x++){const b=r.planes[x];let M=0;for(let z=0;z<c.length;z++)M+=u.dot$1(b,c[z])>=0;if(0===M)return 0;M!==c.length&&(p=!1)}if(p)return 2;for(let x=0;x<3;x++){let b=Number.MAX_VALUE,M=-Number.MAX_VALUE;for(let z=0;z<r.points.length;z++){const j=r.points[z][x]-this.min[x];b=Math.min(b,j),M=Math.max(M,j)}if(M<0||b>this.max[x]-this.min[x])return 0}return 1}}function Je(f){const{userImage:r}=f;return!!(r&&r.render&&r.render())&&(f.data.replace(new Uint8Array(r.data.buffer)),!0)}class Me extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:c,callback:p}of this.requestors)this._notify(c,p);this.requestors=[]}}getImage(r){return this.images[r]}addImage(r,c){this._validate(r,c)&&(this.images[r]=c)}_validate(r,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,c){if(!r)return!0;let p=0;for(const x of r){if(x[0]<p||x[1]<x[0]||c<x[1])return!1;p=x[1]}return!0}_validateContent(r,c){return!(r&&(4!==r.length||r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,c){c.version=this.images[r].version+1,this.images[r]=c,this.updatedImages[r]=!0}removeImage(r){const c=this.images[r];delete this.images[r],delete this.patterns[r],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,c){let p=!0;if(!this.isLoaded())for(const x of r)this.images[x]||(p=!1);this.isLoaded()||p?this._notify(r,c):this.requestors.push({ids:r,callback:c})}_notify(r,c){const p={};for(const x of r){this.images[x]||this.fire(new u.Event("styleimagemissing",{id:x}));const b=this.images[x];b?p[x]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:u.warnOnce(`Image "${x}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,p)}getPixelSize(){const{width:r,height:c}=this.atlasImage;return{width:r,height:c}}getPattern(r){const c=this.patterns[r],p=this.getImage(r);if(!p)return null;if(c&&c.position.version===p.version)return c.position;if(c)c.position.version=p.version;else{const x={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new u.ImagePosition(x,p);this.patterns[r]={bin:x,position:b}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const c=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(r,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const b in this.patterns)r.push(this.patterns[b].bin);const{w:c,h:p}=u.potpack(r),x=this.atlasImage;x.resize({width:c||1,height:p||1});for(const b in this.patterns){const{bin:M}=this.patterns[b],z=M.x+1,j=M.y+1,Q=this.images[b].data,re=Q.width,oe=Q.height;u.RGBAImage.copy(Q,x,{x:0,y:0},{x:z,y:j},{width:re,height:oe}),u.RGBAImage.copy(Q,x,{x:0,y:oe-1},{x:z,y:j-1},{width:re,height:1}),u.RGBAImage.copy(Q,x,{x:0,y:0},{x:z,y:j+oe},{width:re,height:1}),u.RGBAImage.copy(Q,x,{x:re-1,y:0},{x:z-1,y:j},{width:1,height:oe}),u.RGBAImage.copy(Q,x,{x:0,y:0},{x:z+re,y:j},{width:1,height:oe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const c of r){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const p=this.images[c];Je(p)&&this.updateImage(c,p)}}}const Ge=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(f,r){return function([c,p,x]){const b=u.degToRad(p+90),M=u.degToRad(x);return{x:c*Math.cos(b)*Math.sin(M),y:c*Math.sin(b)*Math.sin(M),z:c*Math.cos(M),azimuthal:p,polar:x}}(f.expression.evaluate(r))}interpolate(f,r,c){return{x:u.number(f.x,r.x,c),y:u.number(f.y,r.y,c),z:u.number(f.z,r.z,c),azimuthal:u.number(f.azimuthal,r.azimuthal,c),polar:u.number(f.polar,r.polar,c)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),Lt="-transition";class Ht extends u.Evented{constructor(r){super(),this._transitionable=new u.Transitionable(Ge),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c={}){if(!this._validate(u.validateLight,r,c))for(const p in r){const x=r[p];u.endsWith(p,Lt)?this._transitionable.setTransition(p.slice(0,-Lt.length),x):this._transitionable.setValue(p,x)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||!1!==p.validate)&&u.emitValidationErrors(this,r.call(u.validateStyle,u.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const zn=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)}),gn="-transition";class Xt extends u.Evented{constructor(r){super(),this._transitionable=new u.Transitionable(zn),this.set(r),this._transitioning=this._transitionable.untransitioned()}get(){return this._transitionable.serialize()}set(r){for(const c in r){const p=r[c];u.endsWith(c,gn)?this._transitionable.setTransition(c.slice(0,-gn.length),p):this._transitionable.setValue(c,p)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function In(f,r,c,p){const x=u.smoothstep(45,65,c),[b,M]=Gn(f,p),z=u.length(r);let j=1-Math.min(1,Math.exp((z-b)/(M-b)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*x*f.alpha}function Gn(f,r){const c=.5/Math.tan(.5*r);return[f.range[0]+c,f.range[1]+c]}const ct=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"])}),tt="-transition";class mt extends u.Evented{constructor(r){super(),this._transitionable=new u.Transitionable(ct),this.set(r),this._transitioning=this._transitionable.untransitioned()}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c={}){if(!this._validate(u.validateFog,r,c))for(const p in r){const x=r[p];u.endsWith(p,tt)?this._transitionable.setTransition(p.slice(0,-tt.length),x):this._transitionable.setValue(p,x)}}getOpacity(r){const c=this.properties&&this.properties.get("color")||1;return u.smoothstep(45,65,r)*c.a}getOpacityAtLatLng(r,c){return function(p,x,b){const M=u.MercatorCoordinate.fromLngLat(x),z=b.elevation?b.elevation.getAtPointOrZero(M):0,j=[M.x,M.y,z];return u.transformMat4$1(j,j,b.mercatorFogMatrix),In(p,j,b.pitch,b._fov)}(this.state,r,c)}getFovAdjustedRange(r){return Gn(this.state,r)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,p){return(!p||!1!==p.validate)&&u.emitValidationErrors(this,r.call(u.validateStyle,u.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class gt{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const p=this.workerPool.acquire(this.id);for(let x=0;x<p.length;x++){const b=new gt.Actor(p[x],c,this.id);b.name=`Worker ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,p){u.asyncAll(this.actors,(x,b)=>{x.send(r,c,b)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function tn(f,r,c){return r*(u.EXTENT/(f.tileSize*Math.pow(2,c-f.tileID.overscaledZ)))}gt.Actor=u.Actor;class an{constructor(r,c,p,x){this.screenBounds=r,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(b=>x.pointCoordinate3D(b)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(r,c){let p,x;if(r instanceof u.pointGeometry||"number"==typeof r[0]){const b=u.pointGeometry.convert(r);p=[u.pointGeometry.convert(r)],x=c.isPointAboveHorizon(b)}else{const b=u.pointGeometry.convert(r[0]),M=u.pointGeometry.convert(r[1]);p=[b,M],x=u.polygonizeBounds(b,M).every(z=>c.isPointAboveHorizon(z))}return new an(p,c.getCameraPoint(),x,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],x=u.polygonizeBounds(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),u.bufferConvexPolygon(x,r)}containsTile(r,c,p){const x=r.queryPadding+1,b=p?this._bufferedCameraMercator(x,c).map(pe=>r.tileID.getTilePoint(pe)):this._bufferedScreenMercator(x,c).map(pe=>r.tileID.getTilePoint(pe)),M=this.screenGeometryMercator.map(pe=>r.tileID.getTileVec3(pe)),z=M.map(pe=>new u.pointGeometry(pe[0],pe[1])),j=c.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),Q=r.tileID.getTileVec3(j),re=M.map(pe=>{const Ae=u.sub(pe,pe,Q);return u.normalize(Ae,Ae),new ke(Q,Ae)}),oe=tn(r,1,c.zoom);if(u.polygonIntersectsBox(b,0,0,u.EXTENT,u.EXTENT))return{queryGeometry:this,tilespaceGeometry:z,tilespaceRays:re,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(le=u.getBounds(b),le.min.x=u.clamp(le.min.x,0,u.EXTENT),le.min.y=u.clamp(le.min.y,0,u.EXTENT),le.max.x=u.clamp(le.max.x,0,u.EXTENT),le.max.y=u.clamp(le.max.y,0,u.EXTENT),le),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:oe};var le}_bufferedScreenMercator(r,c){const p=bn(r);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const x=this.bufferedScreenGeometry(r).map(b=>c.pointCoordinate3D(b));return this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(r,c){const p=bn(r);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const x=this.bufferedCameraGeometry(r).map(b=>c.pointCoordinate3D(b));return this._cameraRaycastCache[p]=x,x}}}function bn(f){return 100*f|0}function Pn(f,r,c){const p=function(x,b){if(x)return c(x);if(b){const M=u.pick(u.extend(b,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(M.vectorLayers=b.vector_layers,M.vectorLayerIds=M.vectorLayers.map(z=>z.id)),M.tiles=r.canonicalizeTileset(M,f.url),c(null,M)}};return f.url?u.getJSON(r.transformRequest(r.normalizeSourceURL(f.url),u.ResourceType.Source),p):u.exported.frame(()=>p(null,f))}class Or{constructor(r,c,p){this.bounds=u.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=c||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const c=Math.pow(2,r.z),p=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*c),x=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*c),b=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*c),M=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*c);return r.x>=p&&r.x<b&&r.y>=x&&r.y<M}}class Jr{constructor(r,c,p){this.context=r;const x=r.gl;this.buffer=x.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const qt={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kn{constructor(r,c,p,x){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.context=r;const b=r.gl;this.buffer=b.createBuffer(),r.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let p=0;p<this.attributes.length;p++){const x=c.attributes[this.attributes[p].name];void 0!==x&&r.enableVertexAttribArray(x)}}setVertexAttribPointers(r,c,p){for(let x=0;x<this.attributes.length;x++){const b=this.attributes[x],M=c.attributes[b.name];void 0!==M&&r.vertexAttribPointer(M,b.components,r[qt[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ve{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zt extends Ve{getDefault(){return u.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class ln extends Ve{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Rn extends Ve{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class ir extends Ve{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Vn extends Ve{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class ri extends Ve{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class Zn extends Ve{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class xi extends Ve{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class yr extends Ve{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class Vi extends Ve{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class zr extends Ve{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class $r extends Ve{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class as extends Ve{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class di extends Ve{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class ls extends Ve{getDefault(){return u.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Ui extends Ve{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Tt extends Ve{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class rt extends Ve{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class nt extends Ve{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Wt extends Ve{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class _t extends Ve{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class hn extends Ve{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class mn extends Ve{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class _n extends Ve{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class xn extends Ve{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class jr extends Ve{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Fr extends Ve{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ii extends Ve{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Wr extends Ve{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class jn extends Ve{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class wn extends Ve{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class mi extends Ve{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class ar extends mi{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Yr extends mi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Gr extends Yr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class vr{constructor(r,c,p,x){this.context=r,this.width=c,this.height=p;const b=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new ar(r,b),x&&(this.depthAttachment=new Yr(r,b))}destroy(){const r=this.context.gl,c=this.colorAttachment.get();if(c&&r.deleteTexture(c),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class cs{constructor(r){this.gl=r,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new zt(this),this.clearDepth=new ln(this),this.clearStencil=new Rn(this),this.colorMask=new ir(this),this.depthMask=new Vn(this),this.stencilMask=new ri(this),this.stencilFunc=new Zn(this),this.stencilOp=new xi(this),this.stencilTest=new yr(this),this.depthRange=new Vi(this),this.depthTest=new zr(this),this.depthFunc=new $r(this),this.blend=new as(this),this.blendFunc=new di(this),this.blendColor=new ls(this),this.blendEquation=new Ui(this),this.cullFace=new Tt(this),this.cullFaceSide=new rt(this),this.frontFace=new nt(this),this.program=new Wt(this),this.activeTexture=new _t(this),this.viewport=new hn(this),this.bindFramebuffer=new mn(this),this.bindRenderbuffer=new _n(this),this.bindTexture=new xn(this),this.bindVertexBuffer=new jr(this),this.bindElementBuffer=new Fr(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ii(this),this.pixelStoreUnpack=new Wr(this),this.pixelStoreUnpackPremultiplyAlpha=new jn(this),this.pixelStoreUnpackFlipY=new wn(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=r.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(r.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c){return new Jr(this,r,c)}createVertexBuffer(r,c,p){return new kn(this,r,c,p)}createRenderbuffer(r,c,p){const x=this.gl,b=x.createRenderbuffer();return this.bindRenderbuffer.set(b),x.renderbufferStorage(x.RENDERBUFFER,r,c,p),this.bindRenderbuffer.set(null),b}createFramebuffer(r,c,p){return new vr(this,r,c,p)}clear({color:r,depth:c,stencil:p}){const x=this.gl;let b=0;r&&(b|=x.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(b|=x.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==p&&(b|=x.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),x.clear(b)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){ce(r.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ro extends u.Evented{constructor(r,c,p,x){super(),this.id=r,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},c),u.extend(this,u.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Pn(this._options,this.map._requestManager,(r,c)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new u.ErrorEvent(r)):c&&(u.extend(this,c),c.bounds&&(this.tileBounds=new Or(c.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(c.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const p=u.exported.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);r.request=u.getImage(this.map._requestManager.transformRequest(x,u.ResourceType.Tile),(b,M,z,j)=>{if(delete r.request,r.aborted)r.state="unloaded",c(null);else if(b)r.state="errored",c(b);else if(M){this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:z,expires:j});const Q=this.map.painter.context,re=Q.gl;r.texture=this.map.painter.getTileTexture(M.width),r.texture?r.texture.update(M,{useMipmap:!0}):(r.texture=new u.Texture(Q,M,re.RGBA,{useMipmap:!0}),r.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),Q.extTextureFilterAnisotropic&&re.texParameterf(re.TEXTURE_2D,Q.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Q.extTextureFilterAnisotropicMax)),r.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),c(null)}})}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c()}unloadTile(r,c){r.texture&&this.map.painter.saveTileTexture(r.texture),c()}hasTransition(){return!1}}let qi;var lr=u.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class K extends u.Evented{constructor(r,c,p,x){super(),this.id=r,this.dispatcher=p,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(x),this.options=c}load(r,c){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(p,x)=>{this._loaded=!0,p?this.fire(new u.ErrorEvent(p)):x&&(this.image=u.exported.getImageData(x),r&&(this.coordinates=r),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this.options.url=r.url,this.load(r.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}setCoordinates(r){this.coordinates=r;const c=r.map(u.MercatorCoordinate.fromLngLat);this.tileID=function(x){let b=1/0,M=1/0,z=-1/0,j=-1/0;for(const le of x)b=Math.min(b,le.x),M=Math.min(M,le.y),z=Math.max(z,le.x),j=Math.max(j,le.y);const Q=Math.max(z-b,j-M),re=Math.max(0,Math.floor(-Math.log(Q)/Math.LN2)),oe=Math.pow(2,re);return new u.CanonicalTileID(re,Math.floor((b+z)/2*oe),Math.floor((M+j)/2*oe))}(c),this.minzoom=this.maxzoom=this.tileID.z;const p=c.map(x=>this.tileID.getTilePoint(x)._round());return this._boundsArray=new u.StructArrayLayout4i8,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,u.EXTENT,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,u.EXTENT),this._boundsArray.emplaceBack(p[2].x,p[2].y,u.EXTENT,u.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,c=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,lr.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new u.Texture(r,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));for(const p in this.tiles){const x=this.tiles[p];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}loadTile(r,c){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},c(null)):(r.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const k={vector:class extends u.Evented{constructor(f,r,c,p){if(super(),this.id=f,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(r,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Pn(this._options,this.map._requestManager,(f,r)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new u.ErrorEvent(f)):r&&(u.extend(this,r),r.bounds&&(this.tileBounds=new Or(r.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(r.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const r=this.map.style._getSourceCaches(this.id);for(const c of r)c.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,u.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=r:f.request=f.actor.send("reloadTile",p,x.bind(this));else if(f.actor=this._tileWorkers[c]=this._tileWorkers[c]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",p,x.bind(this),void 0,!0);else{const b=u.loadVectorTile.call({deduped:this._deduped},p,(M,z)=>{M||!z?x.call(this,M):(p.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},f.actor&&f.actor.send("loadTile",p,x.bind(this),void 0,!0))},!0);f.request={cancel:b}}function x(b,M){return delete f.request,f.aborted?r(null):b&&404!==b.status?r(b):(M&&M.resourceTiming&&(f.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&f.setExpiryData(M),f.loadVectorData(M,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),r(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:ro,"raster-dem":class extends ro{constructor(f,r,c,p){super(f,r,c,p),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(f,r){const c=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,b){x&&(f.state="errored",r(x)),b&&(f.dem=b,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",r(null))}f.request=u.getImage(this.map._requestManager.transformRequest(c,u.ResourceType.Tile),function(x,b,M,z){if(delete f.request,f.aborted)f.state="unloaded",r(null);else if(x)f.state="errored",r(x);else if(b){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:M,expires:z});const j=u.window.ImageBitmap&&b instanceof u.window.ImageBitmap&&(null==qi&&(qi=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),qi),Q=1-(b.width-u.prevPowerOfTwo(b.width))/2;Q<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const re=j?b:u.exported.getImageData(b,Q),oe={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:re,encoding:this.encoding,padding:Q};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",oe,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const r=f.canonical,c=Math.pow(2,r.z),p=(r.x-1+c)%c,x=0===r.x?f.wrap-1:f.wrap,b=(r.x+1+c)%c,M=r.x+1===c?f.wrap+1:f.wrap,z={};return z[new u.OverscaledTileID(f.overscaledZ,x,r.z,p,r.y).key]={backfilled:!1},z[new u.OverscaledTileID(f.overscaledZ,M,r.z,b,r.y).key]={backfilled:!1},r.y>0&&(z[new u.OverscaledTileID(f.overscaledZ,x,r.z,p,r.y-1).key]={backfilled:!1},z[new u.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},z[new u.OverscaledTileID(f.overscaledZ,M,r.z,b,r.y-1).key]={backfilled:!1}),r.y+1<c&&(z[new u.OverscaledTileID(f.overscaledZ,x,r.z,p,r.y+1).key]={backfilled:!1},z[new u.OverscaledTileID(f.overscaledZ,f.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},z[new u.OverscaledTileID(f.overscaledZ,M,r.z,b,r.y+1).key]={backfilled:!1}),z}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends u.Evented{constructor(f,r,c,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=r.data,this._options=u.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const x=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*x,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*x,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*x,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},r),this}getClusterChildren(f,r){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},r),this}getClusterLeaves(f,r,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:r,offset:c},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=u.extend({},this.workerOptions),r=this._data;"string"==typeof r?(f.request=this.map._requestManager.transformRequest(u.exported.resolveURL(r),u.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(c,p)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new u.ErrorEvent(c));else{const x={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(x.resourceTiming=p.resourceTiming[this.id]),this.fire(new u.Event("data",x)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,r){const c=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(c,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,x)=>(delete f.request,f.unloadVectorData(),f.aborted?r(null):p?r(p):(f.loadVectorData(x,this.map.painter,"reloadTile"===c),r(null))),void 0,"loadTile"===c)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends K{constructor(f,r,c,p){super(f,r,c,p),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const r of f.urls)this.urls.push(this.map._requestManager.transformRequest(r,u.ResourceType.Source).url);u.getVideo(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new u.ErrorEvent(r)):c&&(this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const r=this.video.seekable;f<r.start(0)||f>r.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,r=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,lr.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(f,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:K,canvas:class extends K{constructor(f,r,c,p){super(f,r,c,p),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(x=>!Array.isArray(x)||2!==x.length||x.some(b=>"number"!=typeof b))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context,c=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,lr.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(r,this.canvas,c.RGBA,{premultiply:!0});for(const p in this.tiles){const x=this.tiles[p];"loaded"!==x.state&&(x.state="loaded",x.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},N=function(f,r,c,p){const x=new k[r.type](f,r,c,p);if(x.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${x.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],x),x};function H(f,r){const c=u.identity([]);return u.scale$1(c,c,[.5*f.width,.5*-f.height,1]),u.translate(c,c,[1,-1,0]),u.multiply(c,c,f.calculateProjMatrix(r.toUnwrapped()))}function de(f,r,c,p,x,b,M,z=!1){const j=f.tilesIn(p,M,z);j.sort(Qe);const Q=[];for(const oe of j)Q.push({wrappedTileID:oe.tile.tileID.wrapped().key,queryResults:oe.tile.queryRenderedFeatures(r,c,f._state,oe,x,b,H(f.transform,oe.tile.tileID),z)});const re=function(oe){const le={},pe={};for(const Ae of oe){const Ie=Ae.queryResults,qe=Ae.wrappedTileID,be=pe[qe]=pe[qe]||{};for(const Re in Ie){const $e=Ie[Re],We=be[Re]=be[Re]||{},it=le[Re]=le[Re]||[];for(const Fe of $e)We[Fe.featureIndex]||(We[Fe.featureIndex]=!0,it.push(Fe))}}return le}(Q);for(const oe in re)re[oe].forEach(le=>{const pe=le.feature,Ae=f.getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=Ae});return re}function Pe(f,r){const c=f.getRenderableIds().map(b=>f.getTileByID(b)),p=[],x={};for(let b=0;b<c.length;b++){const M=c[b],z=M.tileID.canonical.key;x[z]||(x[z]=!0,M.querySourceFeatures(p,r))}return p}function Qe(f,r){const c=f.tileID,p=r.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function st(){return null!=bo.workerClass?new bo.workerClass:new u.window.Worker(bo.workerUrl)}const Ze="mapboxgl_preloaded_worker_pool";class ft{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<ft.workerCount;)this.workers.push(new st);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Ze]}numActive(){return Object.keys(this.active).length}}let St;function Gt(){return St||(St=new ft),St}function Pt(f,r){const c={};for(const p in f)"ref"!==p&&(c[p]=f[p]);return u.refProperties.forEach(p=>{p in r&&(c[p]=r[p])}),c}function sn(f){f=f.slice();const r=Object.create(null);for(let c=0;c<f.length;c++)r[f[c].id]=f[c];for(let c=0;c<f.length;c++)"ref"in f[c]&&(f[c]=Pt(f[c],r[f[c].ref]));return f}ft.workerCount=2;const He={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog"};function Ct(f,r,c){c.push({command:He.addSource,args:[f,r[f]]})}function Bn(f,r,c){r.push({command:He.removeSource,args:[f]}),c[f]=!0}function Hn(f,r,c,p){Bn(f,c,p),Ct(f,r,c)}function An(f,r,c){let p;for(p in f[c])if(f[c].hasOwnProperty(p)&&"data"!==p&&!ce(f[c][p],r[c][p]))return!1;for(p in r[c])if(r[c].hasOwnProperty(p)&&"data"!==p&&!ce(f[c][p],r[c][p]))return!1;return!0}function sr(f,r,c,p,x,b){let M;for(M in r=r||{},f=f||{})f.hasOwnProperty(M)&&(ce(f[M],r[M])||c.push({command:b,args:[p,M,r[M],x]}));for(M in r)r.hasOwnProperty(M)&&!f.hasOwnProperty(M)&&(ce(f[M],r[M])||c.push({command:b,args:[p,M,r[M],x]}))}function Yn(f){return f.id}function tr(f,r){return f[r.id]=r,f}class Wi{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=u.clamp(r,0,1);let c=1,p=this._distances[c];const x=r*this.paddedLength+this.padding;for(;p<x&&c<this._distances.length;)p=this._distances[++c];const b=c-1,M=this._distances[b],z=p-M,j=z>0?(x-M)/z:0;return this.points[b].mult(1-j).add(this.points[c].mult(j))}}class en{constructor(r,c,p){const x=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(c/p);for(let M=0;M<this.xCellCount*this.yCellCount;M++)x.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,p,x,b){this._forEachCell(c,p,x,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(b)}insertCircle(r,c,p,x){this._forEachCell(c-x,p-x,c+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(p),this.circles.push(x)}_insertBoxCell(r,c,p,x,b,M){this.boxCells[b].push(M)}_insertCircleCell(r,c,p,x,b,M){this.circleCells[b].push(M)}_query(r,c,p,x,b,M){if(p<0||r>this.width||x<0||c>this.height)return!b&&[];const z=[];if(r<=0&&c<=0&&this.width<=p&&this.height<=x){if(b)return!0;for(let j=0;j<this.boxKeys.length;j++)z.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const Q=this.circles[3*j],re=this.circles[3*j+1],oe=this.circles[3*j+2];z.push({key:this.circleKeys[j],x1:Q-oe,y1:re-oe,x2:Q+oe,y2:re+oe})}return M?z.filter(M):z}return this._forEachCell(r,c,p,x,this._queryCell,z,{hitTest:b,seenUids:{box:{},circle:{}}},M),b?z.length>0:z}_queryCircle(r,c,p,x,b){const M=r-p,z=r+p,j=c-p,Q=c+p;if(z<0||M>this.width||Q<0||j>this.height)return!x&&[];const re=[];return this._forEachCell(M,j,z,Q,this._queryCellCircle,re,{hitTest:x,circle:{x:r,y:c,radius:p},seenUids:{box:{},circle:{}}},b),x?re.length>0:re}query(r,c,p,x,b){return this._query(r,c,p,x,!1,b)}hitTest(r,c,p,x,b){return this._query(r,c,p,x,!0,b)}hitTestCircle(r,c,p,x){return this._queryCircle(r,c,p,!0,x)}_queryCell(r,c,p,x,b,M,z,j){const Q=z.seenUids,re=this.boxCells[b];if(null!==re){const le=this.bboxes;for(const pe of re)if(!Q.box[pe]){Q.box[pe]=!0;const Ae=4*pe;if(r<=le[Ae+2]&&c<=le[Ae+3]&&p>=le[Ae+0]&&x>=le[Ae+1]&&(!j||j(this.boxKeys[pe]))){if(z.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[pe],x1:le[Ae],y1:le[Ae+1],x2:le[Ae+2],y2:le[Ae+3]})}}}const oe=this.circleCells[b];if(null!==oe){const le=this.circles;for(const pe of oe)if(!Q.circle[pe]){Q.circle[pe]=!0;const Ae=3*pe;if(this._circleAndRectCollide(le[Ae],le[Ae+1],le[Ae+2],r,c,p,x)&&(!j||j(this.circleKeys[pe]))){if(z.hitTest)return M.push(!0),!0;{const Ie=le[Ae],qe=le[Ae+1],be=le[Ae+2];M.push({key:this.circleKeys[pe],x1:Ie-be,y1:qe-be,x2:Ie+be,y2:qe+be})}}}}}_queryCellCircle(r,c,p,x,b,M,z,j){const Q=z.circle,re=z.seenUids,oe=this.boxCells[b];if(null!==oe){const pe=this.bboxes;for(const Ae of oe)if(!re.box[Ae]){re.box[Ae]=!0;const Ie=4*Ae;if(this._circleAndRectCollide(Q.x,Q.y,Q.radius,pe[Ie+0],pe[Ie+1],pe[Ie+2],pe[Ie+3])&&(!j||j(this.boxKeys[Ae])))return M.push(!0),!0}}const le=this.circleCells[b];if(null!==le){const pe=this.circles;for(const Ae of le)if(!re.circle[Ae]){re.circle[Ae]=!0;const Ie=3*Ae;if(this._circlesCollide(pe[Ie],pe[Ie+1],pe[Ie+2],Q.x,Q.y,Q.radius)&&(!j||j(this.circleKeys[Ae])))return M.push(!0),!0}}}_forEachCell(r,c,p,x,b,M,z,j){const Q=this._convertToXCellCoord(r),re=this._convertToYCellCoord(c),oe=this._convertToXCellCoord(p),le=this._convertToYCellCoord(x);for(let pe=Q;pe<=oe;pe++)for(let Ae=re;Ae<=le;Ae++)if(b.call(this,r,c,p,x,this.xCellCount*Ae+pe,M,z,j))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,p,x,b,M){const z=x-r,j=b-c,Q=p+M;return Q*Q>z*z+j*j}_circleAndRectCollide(r,c,p,x,b,M,z){const j=(M-x)/2,Q=Math.abs(r-(x+j));if(Q>j+p)return!1;const re=(z-b)/2,oe=Math.abs(c-(b+re));if(oe>re+p)return!1;if(Q<=j||oe<=re)return!0;const le=Q-j,pe=oe-re;return le*le+pe*pe<=p*p}}const Bt=Math.tan(85*Math.PI/180);function cn(f,r,c,p,x){const b=u.create$1();return r?(u.scale$1(b,b,[1/x,1/x,1]),c||u.rotateZ(b,b,p.angle)):u.multiply(b,p.labelPlaneMatrix,f),b}function Tn(f,r,c,p,x){if(r){const b=u.clone$1(f);return u.scale$1(b,b,[x,x,1]),c||u.rotateZ(b,b,-p.angle),b}return p.glCoordMatrix}function mr(f,r,c=0){const p=[f.x,f.y,c,1];c?u.transformMat4(p,p,r):Si(p,p,r);const x=p[3];return{point:new u.pointGeometry(p[0]/x,p[1]/x),signedDistanceFromCamera:x}}function On(f,r){return Math.min(.5+f/r*.5,1.5)}function Zr(f,r){const c=f[0]/f[3],p=f[1]/f[3];return c>=-r[0]&&c<=r[0]&&p>=-r[1]&&p<=r[1]}function zs(f,r,c,p,x,b,M,z,j){const Q=p?f.textSizeData:f.iconSizeData,re=u.evaluateSizeForZoom(Q,c.transform.zoom),oe=[256/c.width*2+1,256/c.height*2+1],le=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;le.clear();const pe=f.lineVertexArray,Ae=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,Ie=c.transform.width/c.transform.height;let qe=!1;for(let be=0;be<Ae.length;be++){const Re=Ae.get(be);if(Re.writingMode!==u.WritingMode.vertical||qe||0!==be&&Ae.get(be-1).writingMode===u.WritingMode.horizontal||(qe=!0),Re.hidden||Re.writingMode===u.WritingMode.vertical&&!qe){Ti(Re.numGlyphs,le);continue}qe=!1;const $e=new u.pointGeometry(Re.tileAnchorX,Re.tileAnchorY),We=j?j($e):0,it=[$e.x,$e.y,We],Fe=[...it,1];if(u.transformMat4(Fe,Fe,r),!Zr(Fe,oe)){Ti(Re.numGlyphs,le);continue}const pt=On(c.transform.cameraToCenterDistance,Fe[3]),Rt=u.evaluateSizeForFeature(Q,re,Re),Ut=M?Rt/pt:Rt*pt,dt=mr(new u.pointGeometry(it[0],it[1]),x,it[2]);if(dt.signedDistanceFromCamera<=0){Ti(Re.numGlyphs,le);continue}let At={};const on=M?null:j,Cn=xr(Re,Ut,!1,z,r,x,b,f.glyphOffsetArray,pe,le,dt.point,$e,At,Ie,on);qe=Cn.useVertical,on&&Cn.needsFlipping&&(At={}),(Cn.notEnoughRoom||qe||Cn.needsFlipping&&xr(Re,Ut,!0,z,r,x,b,f.glyphOffsetArray,pe,le,dt.point,$e,At,Ie,on).notEnoughRoom)&&Ti(Re.numGlyphs,le)}p?f.text.dynamicLayoutVertexBuffer.updateData(le):f.icon.dynamicLayoutVertexBuffer.updateData(le)}function Br(f,r,c,p,x,b,M,z,j,Q,re,oe,le){const pe=z.glyphStartIndex+z.numGlyphs,Ae=z.lineStartIndex,Ie=z.lineStartIndex+z.lineLength,qe=r.getoffsetX(z.glyphStartIndex),be=r.getoffsetX(pe-1),Re=Is(f*qe,c,p,x,b,M,z.segment,Ae,Ie,j,Q,re,oe,le,!0);if(!Re)return null;const $e=Is(f*be,c,p,x,b,M,z.segment,Ae,Ie,j,Q,re,oe,le,!0);return $e?{first:Re,last:$e}:null}function Ci(f,r,c,p){return f.writingMode===u.WritingMode.horizontal&&Math.abs(c.y-r.y)>Math.abs(c.x-r.x)*p?{useVertical:!0}:f.writingMode===u.WritingMode.vertical?r.y<c.y?{needsFlipping:!0}:null:0!==f.flipState&&function(x,b,M){const z=(b.x-x.x)*M;return 0===z||Math.abs((b.y-x.y)/z)>Bt}(r,c,p)?1===f.flipState?{needsFlipping:!0}:null:r.x>c.x?{needsFlipping:!0}:null}function xr(f,r,c,p,x,b,M,z,j,Q,re,oe,le,pe,Ae){const Ie=r/24,qe=f.lineOffsetX*Ie,be=f.lineOffsetY*Ie;let Re;if(f.numGlyphs>1){const $e=f.glyphStartIndex+f.numGlyphs,We=f.lineStartIndex,it=f.lineStartIndex+f.lineLength,Fe=Br(Ie,z,qe,be,c,re,oe,f,j,b,le,Ae,!1);if(!Fe)return{notEnoughRoom:!0};const pt=mr(Fe.first.point,M).point,Rt=mr(Fe.last.point,M).point;if(p&&!c){const Ut=Ci(f,pt,Rt,pe);if(f.flipState=Ut&&Ut.needsFlipping?1:2,Ut)return Ut}Re=[Fe.first];for(let Ut=f.glyphStartIndex+1;Ut<$e-1;Ut++)Re.push(Is(Ie*z.getoffsetX(Ut),qe,be,c,re,oe,f.segment,We,it,j,b,le,Ae,!1,!1));Re.push(Fe.last)}else{if(p&&!c){const We=mr(oe,x).point,it=f.lineStartIndex+f.segment+1,Fe=new u.pointGeometry(j.getx(it),j.gety(it)),pt=mr(Fe,x),Rt=Ci(f,We,pt.signedDistanceFromCamera>0?pt.point:us(oe,Fe,We,1,x,void 0),pe);if(f.flipState=Rt&&Rt.needsFlipping?1:2,Rt)return Rt}const $e=Is(Ie*z.getoffsetX(f.glyphStartIndex),qe,be,c,re,oe,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,j,b,le,Ae,!1,!1);if(!$e)return{notEnoughRoom:!0};Re=[$e]}for(const $e of Re)u.addDynamicAttributes(Q,$e.point,$e.angle);return{}}function Xn(f,r,c){const p={x:f.x,y:f.y,z:0};if(!c)return mr(p,r,p.z);const x=c(f);return mr(new u.pointGeometry(p.x,p.y),r,p.z+x)}function us(f,r,c,p,x,b){const M=Xn(f.add(f.sub(r)._unit()),x,b).point,z=c.sub(M);return c.add(z._mult(p/z.mag()))}function Is(f,r,c,p,x,b,M,z,j,Q,re,oe,le,pe,Ae){const Ie=p?f-r:f+r;let qe=Ie>0?1:-1,be=0;p&&(qe*=-1,be=Math.PI),qe<0&&(be+=Math.PI);let Re=qe>0?z+M:z+M+1,$e=x,We=x,it=0,Fe=0;const pt=Math.abs(Ie),Rt=[],Ut=[];let dt=b;const At=()=>{const Er=Re-qe;return 0===it?b:new u.pointGeometry(Q.getx(Er),Q.gety(Er))},on=()=>us(At(),dt,We,pt-it+1,re,le);for(;it+Fe<=pt;){if(Re+=qe,Re<z||Re>=j)return null;if(We=$e,Rt.push($e),pe&&Ut.push(dt||At()),$e=oe[Re],void 0===$e){dt=new u.pointGeometry(Q.getx(Re),Q.gety(Re));const Er=Xn(dt,re,le);$e=Er.signedDistanceFromCamera>0?oe[Re]=Er.point:on()}else dt=null;it+=Fe,Fe=We.dist($e)}Ae&&le&&(dt=dt||new u.pointGeometry(Q.getx(Re),Q.gety(Re)),oe[Re]=$e=void 0===oe[Re]?$e:on(),Fe=We.dist($e));const Cn=(pt-it)/Fe,vn=$e.sub(We),rn=vn.mult(Cn)._add(We);c&&rn._add(vn._unit()._perp()._mult(c*qe));const Dn=be+Math.atan2($e.y-We.y,$e.x-We.x);return Rt.push(rn),pe&&(dt=dt||new u.pointGeometry(Q.getx(Re),Q.gety(Re)),Ut.push(function(Er,Qn,zi){const wi=1-zi;return new u.pointGeometry(Er.x*wi+Qn.x*zi,Er.y*wi+Qn.y*zi)}(Ut.length>0?Ut[Ut.length-1]:dt,dt,Cn))),{point:rn,angle:Dn,path:Rt,tilePath:Ut}}const ws=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ti(f,r){for(let c=0;c<f;c++){const p=r.length;r.resize(p+4),r.float32.set(ws,3*p)}}function Si(f,r,c){const p=r[0],x=r[1];return f[0]=c[0]*p+c[4]*x+c[12],f[1]=c[1]*p+c[5]*x+c[13],f[3]=c[3]*p+c[7]*x+c[15],f}const $n=100;class Ps{constructor(r,c,p=new en(r.width+200,r.height+200,25),x=new en(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+$n,this.screenBottomBoundary=r.height+$n,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,p,x,b,M,z){let j=c.projectedAnchorZ;c.elevation&&(j+=c.elevation);const Q=this.projectAndGetPerspectiveRatio(M,c.projectedAnchorX,c.projectedAnchorY,j,c.tileID),re=b*Q.perspectiveRatio,oe=(c.x1*r+p.x-c.padding)*re+Q.point.x,le=(c.y1*r+p.y-c.padding)*re+Q.point.y,pe=(c.x2*r+p.x+c.padding)*re+Q.point.x,Ae=(c.y2*r+p.y+c.padding)*re+Q.point.y,Ie=Q.perspectiveRatio<=.55||Q.aboveHorizon;return!this.isInsideGrid(oe,le,pe,Ae)||!x&&this.grid.hitTest(oe,le,pe,Ae,z)||Ie?{box:[],offscreen:!1}:{box:[oe,le,pe,Ae],offscreen:this.isOffscreen(oe,le,pe,Ae)}}placeCollisionCircles(r,c,p,x,b,M,z,j,Q,re,oe,le,pe,Ae){const Ie=[],qe=this.transform.elevation,be=qe?on=>qe.getAtTileOffset(Ae,on.x,on.y):on=>0,Re=new u.pointGeometry(c.tileAnchorX,c.tileAnchorY),$e=be(Re),We=this.projectAndGetPerspectiveRatio(M,Re.x,Re.y,$e,Ae),{perspectiveRatio:it}=We,Fe=(re?b/it:b*it)/u.ONE_EM,pt=mr(Re,z,$e).point,Rt=We.signedDistanceFromCamera>0?Br(Fe,x,c.lineOffsetX*Fe,c.lineOffsetY*Fe,!1,pt,Re,c,p,z,{},qe&&!re?be:null,re&&!!qe):null;let Ut=!1,dt=!1,At=!0;if(Rt&&!We.aboveHorizon){const on=.5*le*it+pe,Cn=new u.pointGeometry(-100,-100),vn=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),rn=new Wi,Dn=Rt.first,Er=Rt.last;let Qn=[];for(let _r=Dn.path.length-1;_r>=1;_r--)Qn.push(Dn.path[_r]);for(let _r=1;_r<Er.path.length;_r++)Qn.push(Er.path[_r]);const zi=2.5*on;if(j){const _r=Qn.map(qe?(fr,yi)=>{const Qs=be(yi<Dn.path.length-1?Dn.tilePath[Dn.path.length-1-yi]:Er.tilePath[yi-Dn.path.length+2]);return mr(fr,j,Qs)}:fr=>mr(fr,j));Qn=_r.some(fr=>fr.signedDistanceFromCamera<=0)?[]:_r.map(fr=>fr.point)}let wi=[];if(Qn.length>0){const _r=Qn[0].clone(),fr=Qn[0].clone();for(let yi=1;yi<Qn.length;yi++)_r.x=Math.min(_r.x,Qn[yi].x),_r.y=Math.min(_r.y,Qn[yi].y),fr.x=Math.max(fr.x,Qn[yi].x),fr.y=Math.max(fr.y,Qn[yi].y);wi=_r.x>=Cn.x&&fr.x<=vn.x&&_r.y>=Cn.y&&fr.y<=vn.y?[Qn]:fr.x<Cn.x||_r.x>vn.x||fr.y<Cn.y||_r.y>vn.y?[]:u.clipLine([Qn],Cn.x,Cn.y,vn.x,vn.y)}for(const _r of wi){rn.reset(_r,.25*on);let fr=0;fr=rn.length<=.5*on?1:Math.ceil(rn.paddedLength/zi)+1;for(let yi=0;yi<fr;yi++){const Qs=yi/Math.max(fr-1,1),Ba=rn.lerp(Qs),is=Ba.x+$n,Vs=Ba.y+$n;Ie.push(is,Vs,on,0);const Js=is-on,Va=Vs-on,ai=is+on,Ii=Vs+on;if(At=At&&this.isOffscreen(Js,Va,ai,Ii),dt=dt||this.isInsideGrid(Js,Va,ai,Ii),!r&&this.grid.hitTestCircle(is,Vs,on,oe)&&(Ut=!0,!Q))return{circles:[],offscreen:!1,collisionDetected:Ut}}}}return{circles:!Q&&Ut||!dt?[]:Ie,offscreen:At,collisionDetected:Ut}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let p=1/0,x=1/0,b=-1/0,M=-1/0;for(const re of r){const oe=new u.pointGeometry(re.x+$n,re.y+$n);p=Math.min(p,oe.x),x=Math.min(x,oe.y),b=Math.max(b,oe.x),M=Math.max(M,oe.y),c.push(oe)}const z=this.grid.query(p,x,b,M).concat(this.ignoredGrid.query(p,x,b,M)),j={},Q={};for(const re of z){const oe=re.key;if(void 0===j[oe.bucketInstanceId]&&(j[oe.bucketInstanceId]={}),j[oe.bucketInstanceId][oe.featureIndex])continue;const le=[new u.pointGeometry(re.x1,re.y1),new u.pointGeometry(re.x2,re.y1),new u.pointGeometry(re.x2,re.y2),new u.pointGeometry(re.x1,re.y2)];u.polygonIntersectsPolygon(c,le)&&(j[oe.bucketInstanceId][oe.featureIndex]=!0,void 0===Q[oe.bucketInstanceId]&&(Q[oe.bucketInstanceId]=[]),Q[oe.bucketInstanceId].push(oe.featureIndex))}return Q}insertCollisionBox(r,c,p,x,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:b},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,p,x,b){const M=c?this.ignoredGrid:this.grid,z={bucketInstanceId:p,featureIndex:x,collisionGroupID:b};for(let j=0;j<r.length;j+=4)M.insertCircle(z,r[j],r[j+1],r[j+2])}projectAndGetPerspectiveRatio(r,c,p,x,b){const M=[c,p,x||0,1];let z=!1;if(x||this.transform.pitch>0){u.transformMat4(M,M,r);let j=!1;this.fogState&&b&&(j=function(Q,re,oe,le,pe,Ae){const Ie=Ae.calculateFogTileMatrix(pe),qe=[re,oe,le];return u.transformMat4$1(qe,qe,Ie),In(Q,qe,Ae.pitch,Ae._fov)}(this.fogState,c,p,x||0,b.toUnwrapped(),this.transform)>.9),z=M[2]>M[3]||j}else Si(M,M,r);return{point:new u.pointGeometry((M[0]/M[3]+1)/2*this.transform.width+$n,(-M[1]/M[3]+1)/2*this.transform.height+$n),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/M[3]*.5,1.5),signedDistanceFromCamera:M[3],aboveHorizon:z}}isOffscreen(r,c,p,x){return p<$n||r>=this.screenRightBoundary||x<$n||c>this.screenBottomBoundary}isInsideGrid(r,c,p,x){return p>=0&&r<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=u.identity([]);return u.translate(r,r,[-100,-100,0]),r}}class ji{constructor(r,c,p,x){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):x&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class ur{constructor(r,c,p,x,b){this.text=new ji(r?r.text:null,c,p,b),this.icon=new ji(r?r.icon:null,c,x,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hs{constructor(r,c,p){this.text=r,this.icon=c,this.skipFade=p}}class $l{constructor(){this.invProjMatrix=u.create$1(),this.viewportMatrix=u.create$1(),this.circles=[]}}class Es{constructor(r,c,p,x,b){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=b}}class si{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[r]}}function Oi(f,r,c,p,x){const{horizontalAlign:b,verticalAlign:M}=u.getAnchorAlignment(f),z=-(b-.5)*r,j=-(M-.5)*c,Q=u.evaluateVariableOffset(f,p);return new u.pointGeometry(z+Q[0]*x,j+Q[1]*x)}function Yi(f,r,c,p,x){const b=new u.pointGeometry(f,r);return c&&b._rotate(p?x:-x),b}class ei{constructor(r,c,p,x,b){this.transform=r.clone(),this.collisionIndex=new Ps(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new si(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,p,x){const b=p.getBucket(c),M=p.latestFeatureIndex;if(!b||!M||c.id!==b.layerIds[0])return;const z=p.collisionBoxArray,j=b.layers[0].layout,Q=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),re=p.tileSize/u.EXTENT,oe=this.transform.calculateProjMatrix(p.tileID.toUnwrapped()),le="map"===j.get("text-pitch-alignment"),pe="map"===j.get("text-rotation-alignment"),Ae=tn(p,1,this.transform.zoom),Ie=cn(oe,le,pe,this.transform,Ae);let qe=null;if(le){const Re=Tn(oe,le,pe,this.transform,Ae);qe=u.multiply([],this.transform.labelPlaneMatrix,Re)}this.retainedQueryData[b.bucketInstanceId]=new Es(b.bucketInstanceId,M,b.sourceLayerIndex,b.index,p.tileID);const be={bucket:b,layout:j,posMatrix:oe,textLabelPlaneMatrix:Ie,labelToScreenMatrix:qe,scale:Q,textPixelRatio:re,holdingForFade:p.holdingForFade(),collisionBoxArray:z,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(x)for(const Re of b.sortKeyRanges){const{sortKey:$e,symbolInstanceStart:We,symbolInstanceEnd:it}=Re;r.push({sortKey:$e,symbolInstanceStart:We,symbolInstanceEnd:it,parameters:be})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:be})}attemptAnchorPlacement(r,c,p,x,b,M,z,j,Q,re,oe,le,pe,Ae,Ie,qe,be,Re){const $e=[le.textOffset0,le.textOffset1],We=Oi(r,p,x,$e,b),it=this.collisionIndex.placeCollisionBox(b,c,Yi(We.x,We.y,M,z,this.transform.angle),oe,j,Q,re.predicate);if((!qe||0!==this.collisionIndex.placeCollisionBox(Ae.getSymbolInstanceIconSize(Re,this.transform.zoom,pe),qe,Yi(We.x,We.y,M,z,this.transform.angle),oe,j,Q,re.predicate).box.length)&&it.box.length>0){let Fe;return this.prevPlacement&&this.prevPlacement.variableOffsets[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID]&&this.prevPlacement.placements[le.crossTileID].text&&(Fe=this.prevPlacement.variableOffsets[le.crossTileID].anchor),this.variableOffsets[le.crossTileID]={textOffset:$e,width:p,height:x,anchor:r,textScale:b,prevAnchor:Fe},this.markUsedJustification(Ae,r,le,Ie),Ae.allowVerticalPlacement&&(this.markUsedOrientation(Ae,Ie,le),this.placedOrientations[le.crossTileID]=Ie),{shift:We,placedGlyphBoxes:it}}}placeLayerBucketPart(r,c,p,x){const{bucket:b,layout:M,posMatrix:z,textLabelPlaneMatrix:j,labelToScreenMatrix:Q,textPixelRatio:re,holdingForFade:oe,collisionBoxArray:le,partiallyEvaluatedTextSize:pe,partiallyEvaluatedIconSize:Ae,collisionGroup:Ie}=r.parameters,qe=M.get("text-optional"),be=M.get("icon-optional"),Re=M.get("text-allow-overlap"),$e=M.get("icon-allow-overlap"),We="map"===M.get("text-rotation-alignment"),it="map"===M.get("text-pitch-alignment"),Fe="none"!==M.get("icon-text-fit"),pt="viewport-y"===M.get("symbol-z-order"),Rt=Re&&($e||!b.hasIconData()||be),Ut=$e&&(Re||!b.hasTextData()||qe);!b.collisionArrays&&le&&b.deserializeCollisionBoxes(le),p&&x&&b.updateCollisionDebugBuffers(this.transform.zoom,le);const dt=(At,on,Cn)=>{if(c[At.crossTileID])return;if(oe)return void(this.placements[At.crossTileID]=new hs(!1,!1,!1));let vn=!1,rn=!1,Dn=!0,Er=null,Qn={box:null,offscreen:null},zi={box:null,offscreen:null},wi=null,_r=null,fr=null,yi=0,Qs=0,Ba=0;Cn.textFeatureIndex?yi=Cn.textFeatureIndex:At.useRuntimeCollisionCircles&&(yi=At.featureIndex),Cn.verticalTextFeatureIndex&&(Qs=Cn.verticalTextFeatureIndex);const is=ai=>{ai.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||ai.elevation)&&(ai.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,ai.tileAnchorX,ai.tileAnchorY):0)},Vs=Cn.textBox;if(Vs){is(Vs);const ai=L=>{let y=u.WritingMode.horizontal;if(b.allowVerticalPlacement&&!L&&this.prevPlacement){const v=this.prevPlacement.placedOrientations[At.crossTileID];v&&(this.placedOrientations[At.crossTileID]=v,y=v,this.markUsedOrientation(b,y,At))}return y},Ii=(L,y)=>{if(b.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&Cn.verticalTextBox){for(const v of b.writingModes)if(v===u.WritingMode.vertical?(Qn=y(),zi=Qn):Qn=L(),Qn&&Qn.box&&Qn.box.length)break}else Qn=L()};if(M.get("text-variable-anchor")){let L=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[At.crossTileID]){const I=this.prevPlacement.variableOffsets[At.crossTileID];L.indexOf(I.anchor)>0&&(L=L.filter(X=>X!==I.anchor),L.unshift(I.anchor))}const y=(I,X,fe)=>{const Te=b.getSymbolInstanceTextSize(pe,At,this.transform.zoom,on),je=(I.x2-I.x1)*Te+2*I.padding,vt=(I.y2-I.y1)*Te+2*I.padding,Ft=Fe&&!$e?X:null;Ft&&is(Ft);let un={box:[],offscreen:!1};const Fn=Re?2*L.length:L.length;for(let or=0;or<Fn;++or){const Ir=this.attemptAnchorPlacement(L[or%L.length],I,je,vt,Te,We,it,re,z,Ie,or>=L.length,At,on,b,fe,Ft,pe,Ae);if(Ir&&(un=Ir.placedGlyphBoxes,un&&un.box&&un.box.length)){vn=!0,Er=Ir.shift;break}}return un};Ii(()=>y(Vs,Cn.iconBox,u.WritingMode.horizontal),()=>{const I=Cn.verticalTextBox;return I&&is(I),b.allowVerticalPlacement&&!(Qn&&Qn.box&&Qn.box.length)&&At.numVerticalGlyphVertices>0&&I?y(I,Cn.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null}}),Qn&&(vn=Qn.box,Dn=Qn.offscreen);const v=ai(Qn&&Qn.box);if(!vn&&this.prevPlacement){const I=this.prevPlacement.variableOffsets[At.crossTileID];I&&(this.variableOffsets[At.crossTileID]=I,this.markUsedJustification(b,I.anchor,At,v))}}else{const L=(y,v)=>{const I=b.getSymbolInstanceTextSize(pe,At,this.transform.zoom,on),X=this.collisionIndex.placeCollisionBox(I,y,new u.pointGeometry(0,0),Re,re,z,Ie.predicate);return X&&X.box&&X.box.length&&(this.markUsedOrientation(b,v,At),this.placedOrientations[At.crossTileID]=v),X};Ii(()=>L(Vs,u.WritingMode.horizontal),()=>{const y=Cn.verticalTextBox;return b.allowVerticalPlacement&&At.numVerticalGlyphVertices>0&&y?(is(y),L(y,u.WritingMode.vertical)):{box:null,offscreen:null}}),ai(Qn&&Qn.box&&Qn.box.length)}}if(wi=Qn,vn=wi&&wi.box&&wi.box.length>0,Dn=wi&&wi.offscreen,At.useRuntimeCollisionCircles){const ai=b.text.placedSymbolArray.get(At.centerJustifiedTextSymbolIndex>=0?At.centerJustifiedTextSymbolIndex:At.verticalPlacedTextSymbolIndex),Ii=u.evaluateSizeForFeature(b.textSizeData,pe,ai),L=M.get("text-padding");_r=this.collisionIndex.placeCollisionCircles(Re,ai,b.lineVertexArray,b.glyphOffsetArray,Ii,z,j,Q,p,it,Ie.predicate,At.collisionCircleDiameter*Ii/u.ONE_EM,L,this.retainedQueryData[b.bucketInstanceId].tileID),vn=Re||_r.circles.length>0&&!_r.collisionDetected,Dn=Dn&&_r.offscreen}if(Cn.iconFeatureIndex&&(Ba=Cn.iconFeatureIndex),Cn.iconBox){const ai=Ii=>{is(Ii);const L=Fe&&Er?Yi(Er.x,Er.y,We,it,this.transform.angle):new u.pointGeometry(0,0),y=b.getSymbolInstanceIconSize(Ae,this.transform.zoom,on);return this.collisionIndex.placeCollisionBox(y,Ii,L,$e,re,z,Ie.predicate)};zi&&zi.box&&zi.box.length&&Cn.verticalIconBox?(fr=ai(Cn.verticalIconBox),rn=fr.box.length>0):(fr=ai(Cn.iconBox),rn=fr.box.length>0),Dn=Dn&&fr.offscreen}const Js=qe||0===At.numHorizontalGlyphVertices&&0===At.numVerticalGlyphVertices,Va=be||0===At.numIconVertices;if(Js||Va?Va?Js||(rn=rn&&vn):vn=rn&&vn:rn=vn=rn&&vn,vn&&wi&&wi.box&&this.collisionIndex.insertCollisionBox(wi.box,M.get("text-ignore-placement"),b.bucketInstanceId,zi&&zi.box&&Qs?Qs:yi,Ie.ID),rn&&fr&&this.collisionIndex.insertCollisionBox(fr.box,M.get("icon-ignore-placement"),b.bucketInstanceId,Ba,Ie.ID),_r&&(vn&&this.collisionIndex.insertCollisionCircles(_r.circles,M.get("text-ignore-placement"),b.bucketInstanceId,yi,Ie.ID),p)){const ai=b.bucketInstanceId;let Ii=this.collisionCircleArrays[ai];void 0===Ii&&(Ii=this.collisionCircleArrays[ai]=new $l);for(let L=0;L<_r.circles.length;L+=4)Ii.circles.push(_r.circles[L+0]),Ii.circles.push(_r.circles[L+1]),Ii.circles.push(_r.circles[L+2]),Ii.circles.push(_r.collisionDetected?1:0)}this.placements[At.crossTileID]=new hs(vn||Rt,rn||Ut,Dn||b.justReloaded),c[At.crossTileID]=!0};if(pt){const At=b.getSortedSymbolIndexes(this.transform.angle);for(let on=At.length-1;on>=0;--on){const Cn=At[on];dt(b.symbolInstances.get(Cn),Cn,b.collisionArrays[Cn])}}else for(let At=r.symbolInstanceStart;At<r.symbolInstanceEnd;At++)dt(b.symbolInstances.get(At),At,b.collisionArrays[At]);if(p&&b.bucketInstanceId in this.collisionCircleArrays){const At=this.collisionCircleArrays[b.bucketInstanceId];u.invert(At.invProjMatrix,z),At.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(r,c,p,x){let b;b=x===u.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(c)];const M=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const z of M)z>=0&&(r.text.placedSymbolArray.get(z).crossTileID=b>=0&&z!==b?0:p.crossTileID)}markUsedOrientation(r,c,p){const x=c===u.WritingMode.horizontal||c===u.WritingMode.horizontalOnly?c:0,b=c===u.WritingMode.vertical?c:0,M=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const z of M)r.text.placedSymbolArray.get(z).placedOrientation=x;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(r):1,b=c?c.opacities:{},M=c?c.variableOffsets:{},z=c?c.placedOrientations:{};for(const j in this.placements){const Q=this.placements[j],re=b[j];re?(this.opacities[j]=new ur(re,x,Q.text,Q.icon),p=p||Q.text!==re.text.placed||Q.icon!==re.icon.placed):(this.opacities[j]=new ur(null,x,Q.text,Q.icon,Q.skipFade),p=p||Q.text||Q.icon)}for(const j in b){const Q=b[j];if(!this.opacities[j]){const re=new ur(Q,x,!1,!1);re.isHidden()||(this.opacities[j]=re,p=p||Q.text.placed||Q.icon.placed)}}for(const j in M)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=M[j]);for(const j in z)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=z[j]);p?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c){const p={};for(const x of c){const b=x.getBucket(r);b&&x.latestFeatureIndex&&r.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,x.collisionBoxArray)}}updateBucketOpacities(r,c,p){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const x=r.layers[0].layout,b=new ur(null,0,!1,!1,!0),M=x.get("text-allow-overlap"),z=x.get("icon-allow-overlap"),j=x.get("text-variable-anchor"),Q="map"===x.get("text-rotation-alignment"),re="map"===x.get("text-pitch-alignment"),oe="none"!==x.get("icon-text-fit"),le=new ur(null,0,M&&(z||!r.hasIconData()||x.get("icon-optional")),z&&(M||!r.hasTextData()||x.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const pe=(Ae,Ie,qe)=>{for(let be=0;be<Ie/4;be++)Ae.opacityVertexArray.emplaceBack(qe)};for(let Ae=0;Ae<r.symbolInstances.length;Ae++){const Ie=r.symbolInstances.get(Ae),{numHorizontalGlyphVertices:qe,numVerticalGlyphVertices:be,crossTileID:Re}=Ie;let $e=this.opacities[Re];c[Re]?$e=b:$e||($e=le,this.opacities[Re]=$e),c[Re]=!0;const We=Ie.numIconVertices>0,it=this.placedOrientations[Ie.crossTileID],Fe=it===u.WritingMode.vertical,pt=it===u.WritingMode.horizontal||it===u.WritingMode.horizontalOnly;if(qe>0||be>0){const Rt=ts($e.text);pe(r.text,qe,Fe?Ni:Rt),pe(r.text,be,pt?Ni:Rt);const Ut=$e.text.isHidden();[Ie.rightJustifiedTextSymbolIndex,Ie.centerJustifiedTextSymbolIndex,Ie.leftJustifiedTextSymbolIndex].forEach(on=>{on>=0&&(r.text.placedSymbolArray.get(on).hidden=Ut||Fe?1:0)}),Ie.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(Ie.verticalPlacedTextSymbolIndex).hidden=Ut||pt?1:0);const dt=this.variableOffsets[Ie.crossTileID];dt&&this.markUsedJustification(r,dt.anchor,Ie,it);const At=this.placedOrientations[Ie.crossTileID];At&&(this.markUsedJustification(r,"left",Ie,At),this.markUsedOrientation(r,At,Ie))}if(We){const Rt=ts($e.icon);Ie.placedIconSymbolIndex>=0&&(pe(r.icon,Ie.numIconVertices,Fe?Ni:Rt),r.icon.placedSymbolArray.get(Ie.placedIconSymbolIndex).hidden=$e.icon.isHidden()),Ie.verticalPlacedIconSymbolIndex>=0&&(pe(r.icon,Ie.numVerticalIconVertices,pt?Ni:Rt),r.icon.placedSymbolArray.get(Ie.verticalPlacedIconSymbolIndex).hidden=$e.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Rt=r.collisionArrays[Ae];if(Rt){let Ut=new u.pointGeometry(0,0);if(Rt.textBox||Rt.verticalTextBox){let At=!0;if(j){const on=this.variableOffsets[Re];on?(Ut=Oi(on.anchor,on.width,on.height,on.textOffset,on.textScale),Q&&Ut._rotate(re?this.transform.angle:-this.transform.angle)):At=!1}Rt.textBox&&Ar(r.textCollisionBox.collisionVertexArray,$e.text.placed,!At||Fe,Ut.x,Ut.y),Rt.verticalTextBox&&Ar(r.textCollisionBox.collisionVertexArray,$e.text.placed,!At||pt,Ut.x,Ut.y)}const dt=Boolean(!pt&&Rt.verticalIconBox);Rt.iconBox&&Ar(r.iconCollisionBox.collisionVertexArray,$e.icon.placed,dt,oe?Ut.x:0,oe?Ut.y:0),Rt.verticalIconBox&&Ar(r.iconCollisionBox.collisionVertexArray,$e.icon.placed,!dt,oe?Ut.x:0,oe?Ut.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const Ae=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=Ae.invProjMatrix,r.placementViewportMatrix=Ae.viewportMatrix,r.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Ar(f,r,c,p,x){f.emplaceBack(r?1:0,c?1:0,p||0,x||0),f.emplaceBack(r?1:0,c?1:0,p||0,x||0),f.emplaceBack(r?1:0,c?1:0,p||0,x||0),f.emplaceBack(r?1:0,c?1:0,p||0,x||0)}const es=Math.pow(2,25),Hr=Math.pow(2,24),Fi=Math.pow(2,17),Ki=Math.pow(2,16),Li=Math.pow(2,9),Hs=Math.pow(2,8),qr=Math.pow(2,1);function ts(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const r=f.placed?1:0,c=Math.floor(127*f.opacity);return c*es+r*Hr+c*Fi+r*Ki+c*Li+r*Hs+c*qr+r}const Ni=0;class qs{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,c,p,x,b){const M=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(M,x,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((z,j)=>z.sortKey-j.sortKey));this._currentPartIndex<M.length;){const z=M[this._currentPartIndex];if(c.placeLayerBucketPart(z,this._seenCrossTileIDs,p,0===z.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class Ao{constructor(r,c,p,x,b,M,z,j){this.placement=new ei(r,b,M,z,j),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(r,c,p){const x=u.exported.now(),b=()=>{const M=u.exported.now()-x;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=c[r[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if("symbol"===M.type&&(!M.minzoom||M.minzoom<=z)&&(!M.maxzoom||M.maxzoom>z)){if(this._inProgressLayer||(this._inProgressLayer=new qs(M)),this._inProgressLayer.continuePlacement(p[M.source],this.placement,this._showCollisionBoxes,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Wo=512/u.EXTENT/2;class ua{constructor(r,c,p){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let x=0;x<c.length;x++){const b=c.get(x),M=b.key;this.indexedSymbolInstances[M]||(this.indexedSymbolInstances[M]=[]),this.indexedSymbolInstances[M].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,r)})}}getScaledCoordinates(r,c){const p=Wo/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*u.EXTENT+r.tileAnchorX)*p),y:Math.floor((c.canonical.y*u.EXTENT+r.tileAnchorY)*p)}}findMatches(r,c,p){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let b=0;b<r.length;b++){const M=r.get(b);if(M.crossTileID)continue;const z=this.indexedSymbolInstances[M.key];if(!z)continue;const j=this.getScaledCoordinates(M,c);for(const Q of z)if(Math.abs(Q.coord.x-j.x)<=x&&Math.abs(Q.coord.y-j.y)<=x&&!p[Q.crossTileID]){p[Q.crossTileID]=!0,M.crossTileID=Q.crossTileID;break}}}}class Ka{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ha{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(0!==c)for(const p in this.indexes){const x=this.indexes[p],b={};for(const M in x){const z=x[M];z.tileID=z.tileID.unwrapTo(z.tileID.wrap+c),b[z.tileID.key]=z}this.indexes[p]=b}this.lng=r}addBucket(r,c,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const x=this.usedCrossTileIDs[r.overscaledZ];for(const b in this.indexes){const M=this.indexes[b];if(Number(b)>r.overscaledZ)for(const z in M){const j=M[z];j.tileID.isChildOf(r)&&j.findMatches(c.symbolInstances,r,x)}else{const z=M[r.scaledTo(Number(b)).key];z&&z.findMatches(c.symbolInstances,r,x)}}for(let b=0;b<c.symbolInstances.length;b++){const M=c.symbolInstances.get(b);M.crossTileID||(M.crossTileID=p.generate(),x[M.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new ua(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const p in c.indexedSymbolInstances)for(const x of c.indexedSymbolInstances[p])delete this.usedCrossTileIDs[r][x.crossTileID]}removeStaleBuckets(r){let c=!1;for(const p in this.indexes){const x=this.indexes[p];for(const b in x)r[x[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[b]),delete x[b],c=!0)}return c}}class da{constructor(){this.layerIndexes={},this.crossTileIDs=new Ka,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,p){let x=this.layerIndexes[r.id];void 0===x&&(x=this.layerIndexes[r.id]=new ha);let b=!1;const M={};x.handleWrapJump(p);for(const z of c){const j=z.getBucket(r);j&&r.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(z.tileID,j,this.crossTileIDs)&&(b=!0),M[j.bucketInstanceId]=!0)}return x.removeStaleBuckets(M)&&(b=!0),b}pruneUnusedLayers(r){const c={};r.forEach(p=>{c[p]=!0});for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const ds=(f,r)=>u.emitValidationErrors(f,r&&r.filter(c=>"source.canvas"!==c.identifier)),ml=u.pick(He,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog"]),io=u.pick(He,["setCenter","setZoom","setBearing","setPitch"]),Xa=function(){const f={},r=u.spec.$version;for(const c in u.spec.$root){const p=u.spec.$root[c];if(p.required){let x=null;x="version"===c?r:"array"===p.type?[]:{},null!=x&&(f[c]=x)}}return f}(),go={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Xi extends u.Evented{constructor(r,c={}){super(),this.map=r,this.dispatcher=new gt(Gt(),this),this.imageManager=new Me,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(r._requestManager,c.localFontFamily?u.LocalGlyphMode.all:c.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.lineAtlas=new u.LineAtlas(256,512),this.crossTileSymbolIndex=new da,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const p=this;this._rtlTextPluginCallback=Xi.registerForPluginStateChange(x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},(b,M)=>{if(u.triggerPluginCompletionEvent(b),M&&M.every(z=>z))for(const z in p._sourceCaches){const j=p._sourceCaches[z],Q=j.getSource().type;"vector"!==Q&&"geojson"!==Q||j.reload()}})}),this.on("data",x=>{if("source"!==x.dataType||"metadata"!==x.sourceDataType)return;const b=this.getSource(x.sourceId);if(b&&b.vectorLayerIds)for(const M in this._layers){const z=this._layers[M];z.source===b.id&&this._validateLayer(z)}})}loadURL(r,c={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof c.validate?c.validate:!u.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,c.accessToken);const x=this.map._requestManager.transformRequest(r,u.ResourceType.Style);this._request=u.getJSON(x,(b,M)=>{this._request=null,b?this.fire(new u.ErrorEvent(b)):M&&this._load(M,p)})}loadJSON(r,c={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(r,!1!==c.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(Xa,!1)}_updateLayerCount(r,c){const p=c?1:-1;r.is3D()&&(this._num3DLayers+=p),"circle"===r.type&&(this._numCircleLayers+=p),"symbol"===r.type&&(this._numSymbolLayers+=p)}_load(r,c){if(c&&ds(this,u.validateStyle(r)))return;this._loaded=!0,this.stylesheet=r;for(const x in r.sources)this.addSource(x,r.sources[x],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const p=sn(this.stylesheet.layers);this._order=p.map(x=>x.id),this._layers={},this._serializedLayers={};for(let x of p)x=u.createStyleLayer(x),x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ht(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}_loadSprite(r){this._spriteRequest=function(c,p,x){let b,M,z;const j=u.exported.devicePixelRatio>1?"@2x":"";let Q=u.getJSON(p.transformRequest(p.normalizeSpriteURL(c,j,".json"),u.ResourceType.SpriteJSON),(le,pe)=>{Q=null,z||(z=le,b=pe,oe())}),re=u.getImage(p.transformRequest(p.normalizeSpriteURL(c,j,".png"),u.ResourceType.SpriteImage),(le,pe)=>{re=null,z||(z=le,M=pe,oe())});function oe(){if(z)x(z);else if(b&&M){const le=u.exported.getImageData(M),pe={};for(const Ae in b){const{width:Ie,height:qe,x:be,y:Re,sdf:$e,pixelRatio:We,stretchX:it,stretchY:Fe,content:pt}=b[Ae],Rt=new u.RGBAImage({width:Ie,height:qe});u.RGBAImage.copy(le,Rt,{x:be,y:Re},{x:0,y:0},{width:Ie,height:qe}),pe[Ae]={data:Rt,pixelRatio:We,sdf:$e,stretchX:it,stretchY:Fe,content:pt}}x(null,pe)}}return{cancel(){Q&&(Q.cancel(),Q=null),re&&(re.cancel(),re=null)}}}(r,this.map._requestManager,(c,p)=>{if(this._spriteRequest=null,c)this.fire(new u.ErrorEvent(c));else if(p)for(const x in p)this.imageManager.addImage(x,p[x]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(r){const c=this.getSource(r.source);if(!c)return;const p=r.sourceLayer;p&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(p))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const c=[];for(const p of r){const x=this._layers[p];"custom"!==x.type&&c.push(x.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&go[r.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const c=this._changed;if(this._changed){const x=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(x.length||b.length)&&this._updateWorkerLayers(x,b);for(const M in this._updatedSources){const z=this._updatedSources[M];"reload"===z?this._reloadSource(M):"clear"===z&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const p={};for(const x in this._sourceCaches){const b=this._sourceCaches[x];p[x]=b.used,b.used=!1}for(const x of this._order){const b=this._layers[x];if(b.recalculate(r,this._availableImages),!b.isHidden(r.zoom)){const z=this._getLayerSourceCache(b);z&&(z.used=!0)}const M=this.map.painter;if(M){const z=b.getProgramIds();if(!z)continue;const j=b.getProgramConfiguration(r.zoom);for(const Q of z)M.useProgram(Q,j)}}for(const x in p){const b=this._sourceCaches[x];p[x]!==b.used&&b.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),ds(this,u.validateStyle(r)))return!1;(r=u.clone$2(r)).layers=sn(r.layers);const c=function(x,b){if(!x)return[{command:He.setStyle,args:[b]}];let M=[];try{if(!ce(x.version,b.version))return[{command:He.setStyle,args:[b]}];ce(x.center,b.center)||M.push({command:He.setCenter,args:[b.center]}),ce(x.zoom,b.zoom)||M.push({command:He.setZoom,args:[b.zoom]}),ce(x.bearing,b.bearing)||M.push({command:He.setBearing,args:[b.bearing]}),ce(x.pitch,b.pitch)||M.push({command:He.setPitch,args:[b.pitch]}),ce(x.sprite,b.sprite)||M.push({command:He.setSprite,args:[b.sprite]}),ce(x.glyphs,b.glyphs)||M.push({command:He.setGlyphs,args:[b.glyphs]}),ce(x.transition,b.transition)||M.push({command:He.setTransition,args:[b.transition]}),ce(x.light,b.light)||M.push({command:He.setLight,args:[b.light]}),ce(x.fog,b.fog)||M.push({command:He.setFog,args:[b.fog]});const z={},j=[];!function(oe,le,pe,Ae){let Ie;for(Ie in le=le||{},oe=oe||{})oe.hasOwnProperty(Ie)&&(le.hasOwnProperty(Ie)||Bn(Ie,pe,Ae));for(Ie in le)le.hasOwnProperty(Ie)&&(oe.hasOwnProperty(Ie)?ce(oe[Ie],le[Ie])||("geojson"===oe[Ie].type&&"geojson"===le[Ie].type&&An(oe,le,Ie)?pe.push({command:He.setGeoJSONSourceData,args:[Ie,le[Ie].data]}):Hn(Ie,le,pe,Ae)):Ct(Ie,le,pe))}(x.sources,b.sources,j,z);const Q=[];x.layers&&x.layers.forEach(oe=>{z[oe.source]?M.push({command:He.removeLayer,args:[oe.id]}):Q.push(oe)});let re=x.terrain;re&&z[re.source]&&(M.push({command:He.setTerrain,args:[void 0]}),re=void 0),M=M.concat(j),ce(re,b.terrain)||M.push({command:He.setTerrain,args:[b.terrain]}),function(oe,le,pe){le=le||[];const Ae=(oe=oe||[]).map(Yn),Ie=le.map(Yn),qe=oe.reduce(tr,{}),be=le.reduce(tr,{}),Re=Ae.slice(),$e=Object.create(null);let We,it,Fe,pt,Rt,Ut,dt;for(We=0,it=0;We<Ae.length;We++)Fe=Ae[We],be.hasOwnProperty(Fe)?it++:(pe.push({command:He.removeLayer,args:[Fe]}),Re.splice(Re.indexOf(Fe,it),1));for(We=0,it=0;We<Ie.length;We++)Fe=Ie[Ie.length-1-We],Re[Re.length-1-We]!==Fe&&(qe.hasOwnProperty(Fe)?(pe.push({command:He.removeLayer,args:[Fe]}),Re.splice(Re.lastIndexOf(Fe,Re.length-it),1)):it++,Ut=Re[Re.length-We],pe.push({command:He.addLayer,args:[be[Fe],Ut]}),Re.splice(Re.length-We,0,Fe),$e[Fe]=!0);for(We=0;We<Ie.length;We++)if(Fe=Ie[We],pt=qe[Fe],Rt=be[Fe],!$e[Fe]&&!ce(pt,Rt))if(ce(pt.source,Rt.source)&&ce(pt["source-layer"],Rt["source-layer"])&&ce(pt.type,Rt.type)){for(dt in sr(pt.layout,Rt.layout,pe,Fe,null,He.setLayoutProperty),sr(pt.paint,Rt.paint,pe,Fe,null,He.setPaintProperty),ce(pt.filter,Rt.filter)||pe.push({command:He.setFilter,args:[Fe,Rt.filter]}),ce(pt.minzoom,Rt.minzoom)&&ce(pt.maxzoom,Rt.maxzoom)||pe.push({command:He.setLayerZoomRange,args:[Fe,Rt.minzoom,Rt.maxzoom]}),pt)pt.hasOwnProperty(dt)&&"layout"!==dt&&"paint"!==dt&&"filter"!==dt&&"metadata"!==dt&&"minzoom"!==dt&&"maxzoom"!==dt&&(0===dt.indexOf("paint.")?sr(pt[dt],Rt[dt],pe,Fe,dt.slice(6),He.setPaintProperty):ce(pt[dt],Rt[dt])||pe.push({command:He.setLayerProperty,args:[Fe,dt,Rt[dt]]}));for(dt in Rt)Rt.hasOwnProperty(dt)&&!pt.hasOwnProperty(dt)&&"layout"!==dt&&"paint"!==dt&&"filter"!==dt&&"metadata"!==dt&&"minzoom"!==dt&&"maxzoom"!==dt&&(0===dt.indexOf("paint.")?sr(pt[dt],Rt[dt],pe,Fe,dt.slice(6),He.setPaintProperty):ce(pt[dt],Rt[dt])||pe.push({command:He.setLayerProperty,args:[Fe,dt,Rt[dt]]}))}else pe.push({command:He.removeLayer,args:[Fe]}),Ut=Re[Re.lastIndexOf(Fe)+1],pe.push({command:He.addLayer,args:[Rt,Ut]})}(Q,b.layers,M)}catch(z){console.warn("Unable to compute style diff:",z),M=[{command:He.setStyle,args:[b]}]}return M}(this.serialize(),r).filter(x=>!(x.command in io));if(0===c.length)return!1;const p=c.filter(x=>!(x.command in ml));if(p.length>0)throw new Error(`Unimplemented: ${p.map(x=>x.command).join(", ")}.`);return c.forEach(x=>{"setTransition"!==x.command&&this[x.command].apply(this,x.args)}),this.stylesheet=r,!0}addImage(r,c){if(this.getImage(r))return this.fire(new u.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(r,c),this._afterImageUpdated(r)}updateImage(r,c){this.imageManager.updateImage(r,c)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new u.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,c,p={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(u.validateStyle.source,`sources.${r}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=N(r,c,this.dispatcher,this);x.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:x.serialize(),sourceId:r}));const b=M=>{const z=(M?"symbol:":"other:")+r,j=this._sourceCaches[z]=new u.SourceCache(z,x,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[r]=j,j.style=this,j.onAdd(this.map)};b(!1),"vector"!==c.type&&"geojson"!==c.type||b(!0),x.onAdd&&x.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const c=this.getSource(r);if(void 0===c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===r)return this.fire(new u.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new u.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(r);for(const x of p)delete this._sourceCaches[x.id],delete this._updatedSources[x.id],x.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles();delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getSource(r).setData(c),this._changed=!0}getSource(r){const c=this._getSourceCache(r);return c&&c.getSource()}addLayer(r,c,p={}){this._checkLoaded();const x=r.id;if(this.getLayer(x))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${x}" already exists on this map`)));let b;if("custom"===r.type){if(ds(this,u.validateCustomStyleLayer(r)))return;b=u.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(x,r.source),r=u.clone$2(r),r=u.extend(r,{source:x})),this._validate(u.validateStyle.layer,`layers.${x}`,r,{arrayIndex:-1},p))return;b=u.createStyleLayer(r),this._validateLayer(b),b.setEventedParent(this,{layer:{id:x}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const M=c?this._order.indexOf(c):this._order.length;if(c&&-1===M)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(M,0,x),this._layerOrderChanged=!0,this._layers[x]=b;const z=this._getLayerSourceCache(b);if(this._removedLayers[x]&&b.source&&z&&"custom"!==b.type){const j=this._removedLayers[x];delete this._removedLayers[x],j.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",z.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,c){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===c)return;const p=this._order.indexOf(r);this._order.splice(p,1);const x=c?this._order.indexOf(c):this._order.length;c&&-1===x?this.fire(new u.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(x,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const c=this._layers[r];if(!c)return void this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=c,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,p){this._checkLoaded();const x=this.getLayer(r);x?x.minzoom===c&&x.maxzoom===p||(null!=c&&(x.minzoom=c),null!=p&&(x.maxzoom=p),this._updateLayer(x)):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,c,p={}){this._checkLoaded();const x=this.getLayer(r);if(x){if(!ce(x.filter,c))return null==c?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(u.validateStyle.filter,`layers.${x.id}.filter`,c,null,p)||(x.filter=u.clone$2(c),this._updateLayer(x)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){return u.clone$2(this.getLayer(r).filter)}setLayoutProperty(r,c,p,x={}){this._checkLoaded();const b=this.getLayer(r);b?ce(b.getLayoutProperty(c),p)||(b.setLayoutProperty(c,p,x),this._updateLayer(b)):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,c){const p=this.getLayer(r);if(p)return p.getLayoutProperty(c);this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,c,p,x={}){this._checkLoaded();const b=this.getLayer(r);b?ce(b.getPaintProperty(c),p)||(b.setPaintProperty(c,p,x)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,c){return this.getLayer(r).getPaintProperty(c)}setFeatureState(r,c){this._checkLoaded();const p=r.source,x=r.sourceLayer,b=this.getSource(p);if(void 0===b)return void this.fire(new u.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const M=b.type;if("geojson"===M&&x)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===M&&!x)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const z=this._getSourceCaches(p);for(const j of z)j.setFeatureState(x,r.id,c)}removeFeatureState(r,c){this._checkLoaded();const p=r.source,x=this.getSource(p);if(void 0===x)return void this.fire(new u.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const b=x.type,M="vector"===b?r.sourceLayer:void 0;if("vector"===b&&!M)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const z=this._getSourceCaches(p);for(const j of z)j.removeFeatureState(M,r.id,c)}getFeatureState(r){this._checkLoaded();const c=r.source,p=r.sourceLayer,x=this.getSource(c);if(void 0!==x){if("vector"!==x.type||p)return void 0===r.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(p,r.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();r[p.id]||(r[p.id]=p.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:r,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(r){this._updatedLayers[r.id]=!0;const c=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[r.source]="reload",c.pause()),this._changed=!0}_flattenAndSortRenderedFeatures(r){const c=M=>"fill-extrusion"===this._layers[M].type,p={},x=[];for(let M=this._order.length-1;M>=0;M--){const z=this._order[M];if(c(z)){p[z]=M;for(const j of r){const Q=j[z];if(Q)for(const re of Q)x.push(re)}}}x.sort((M,z)=>z.intersectionZ-M.intersectionZ);const b=[];for(let M=this._order.length-1;M>=0;M--){const z=this._order[M];if(c(z))for(let j=x.length-1;j>=0;j--){const Q=x[j].feature;if(p[Q.layer.id]<M)break;b.push(Q),x.pop()}else for(const j of r){const Q=j[z];if(Q)for(const re of Q)b.push(re.feature)}}return b}queryRenderedFeatures(r,c,p){c&&c.filter&&this._validate(u.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const x={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const j of c.layers){const Q=this._layers[j];if(!Q)return this.fire(new u.ErrorEvent(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];x[Q.source]=!0}}const b=[];c.availableImages=this._availableImages;const M=c&&c.layers?c.layers.some(j=>{const Q=this.getLayer(j);return Q&&Q.is3D()}):this.has3DLayers(),z=an.createFromScreenPoints(r,p);for(const j in this._sourceCaches){const Q=this._sourceCaches[j].getSource().id;c.layers&&!x[Q]||b.push(de(this._sourceCaches[j],this._layers,this._serializedLayers,z,c,p,M,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(j,Q,re,oe,le,pe,Ae){const Ie={},qe=pe.queryRenderedSymbols(oe),be=[];for(const Re of Object.keys(qe).map(Number))be.push(Ae[Re]);be.sort(Qe);for(const Re of be){const $e=Re.featureIndex.lookupSymbolFeatures(qe[Re.bucketInstanceId],Q,Re.bucketIndex,Re.sourceLayerIndex,le.filter,le.layers,le.availableImages,j);for(const We in $e){const it=Ie[We]=Ie[We]||[],Fe=$e[We];Fe.sort((pt,Rt)=>{const Ut=Re.featureSortOrder;if(Ut){const dt=Ut.indexOf(pt.featureIndex);return Ut.indexOf(Rt.featureIndex)-dt}return Rt.featureIndex-pt.featureIndex});for(const pt of Fe)it.push(pt)}}for(const Re in Ie)Ie[Re].forEach($e=>{const We=$e.feature,it=re(j[Re]).getFeatureState(We.layer["source-layer"],We.id);We.source=We.layer.source,We.layer["source-layer"]&&(We.sourceLayer=We.layer["source-layer"]),We.state=it});return Ie}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),z.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(r,c){c&&c.filter&&this._validate(u.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const p=this._getSourceCaches(r);let x=[];for(const b of p)x=x.concat(Pe(b,c));return x}addSourceType(r,c,p){return Xi.getSourceType(r)?p(new Error(`A source type called "${r}" already exists.`)):(Xi.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(r,c={}){this._checkLoaded();const p=this.light.getLight();let x=!1;for(const M in r)if(!ce(r[M],p[M])){x=!0;break}if(!x)return;const b={now:u.exported.now(),transition:u.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,c),this.light.updateTransitions(b)}getTerrain(){return this.terrain?this.terrain.get():null}setTerrain(r){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if("object"==typeof r.source){const c="terrain-dem-src";this.addSource(c,r.source),r=u.clone$2(r),r=u.extend(r,{source:c})}if(!this._validate(u.validateStyle.terrain,"terrain",r)){if(this.terrain){const c=this.terrain,p=c.get();for(const x in r)if(!ce(r[x],p[x])){c.set(r),this.stylesheet.terrain=r;const b={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(b);break}}else this._createTerrain(r);this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}}_createFog(r){const c=this.fog=new mt(r);this.stylesheet.fog=r;const p={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,p=c.get();for(const x in r)if(!ce(r[x],p[x])){c.set(r),this.stylesheet.fog=r;const b={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(b);break}}else this._createFog(r);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(p=>this.isLayerDraped(this._layers[p])),c=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r){const c=this.terrain=new Xt(r);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const p={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};c.updateTransitions(p)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"fill-extrusion"===c.type&&this._updateLayer(c)}}_validate(r,c,p,x,b={}){return(!b||!1!==b.validate)&&ds(this,r.call(u.validateStyle,u.extend({key:c,style:this.serialize(),value:p,styleSpec:u.spec},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const c=this._getSourceCaches(r);for(const p of c)p.clearTiles()}_reloadSource(r){const c=this._getSourceCaches(r);for(const p of c)p.resume(),p.reload()}_updateSources(r){for(const c in this._sourceCaches)this._sourceCaches[c].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,p,x,b=!1){let M=!1,z=!1;const j={};for(const Q of this._order){const re=this._layers[Q];if("symbol"!==re.type)continue;if(!j[re.source]){const le=this._getLayerSourceCache(re);if(!le)continue;j[re.source]=le.getRenderableIds(!0).map(pe=>le.getTileByID(pe)).sort((pe,Ae)=>Ae.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(Ae.tileID)?-1:1))}const oe=this.crossTileSymbolIndex.addLayer(re,j[re.source],r.center.lng);M=M||oe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),r.zoom))&&(this.pauseablePlacement=new Ao(r,this._order,b,c,p,x,this.placement,this.fog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),z=!0),M&&this.pauseablePlacement.placement.setStale()),z||M)for(const Q of this._order){const re=this._layers[Q];"symbol"===re.type&&this.placement.updateLayerOpacities(re,j[re.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,c,p){this.imageManager.getImages(c.icons,p),this._updateTilesForChangedImages();const x=b=>{b&&b.setDependencies(c.tileID.key,c.type,c.icons)};x(this._otherSourceCaches[c.source]),x(this._symbolSourceCaches[c.source])}getGlyphs(r,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(r,c,p){return u.makeRequest(c,p)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}}Xi.getSourceType=function(f){return k[f]},Xi.setSourceType=function(f,r){k[f]=r},Xi.registerForPluginStateChange=u.registerForPluginStateChange;var Yo="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Mo="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ws={},Di={};Ws=hr("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec3 elevationVector(vec2 pos) {vec2 uv=pos/8192.0;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif",!0),Di=hr("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const so=hr("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),_o=Yo;var Io={background:hr("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:hr("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:hr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:hr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:hr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec3 pos=vec3(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)));gl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:hr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:hr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:hr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:hr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),fill:hr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:hr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:hr("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:hr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:hr("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:hr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:hr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:hr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:hr("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:hr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:hr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:hr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),symbolSDF:hr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),symbolTextAndIcon:hr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec4 projectedPoint=u_matrix*vec4(vec3(a_pos,anchorZ)+h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(vec3(a_projected_pos.xy,anchorZ)+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),terrainRaster:hr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:hr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:hr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Mo),skyboxGradient:hr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Mo),skyboxCapture:hr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:hr("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {vec4 color=texture2D(u_image0,v_pos0);gl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying vec2 v_pos0;void main() {v_pos0=a_uv;gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);}"),globeAtmosphere:hr("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}"),globeDepth:hr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_globe_matrix;attribute vec3 a_globe_pos;attribute vec2 a_uv;varying float v_depth;void main() {gl_Position=u_globe_matrix*vec4(a_globe_pos+elevationVector(a_uv*8192.0)*elevation(a_uv*8192.0),1.0);v_depth=gl_Position.z/gl_Position.w;}")};function hr(f,r,c){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,x=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),M=f.match(x),z=r.match(x),j=Yo.match(x);let Q=z?z.concat(M):M;c||(Ws.staticUniforms&&(Q=Ws.staticUniforms.concat(Q)),Di.staticUniforms&&(Q=Di.staticUniforms.concat(Q))),Q&&(Q=Q.concat(j));const re={};return{fragmentSource:f=f.replace(p,(oe,le,pe,Ae,Ie)=>(re[Ie]=!0,"define"===le?`\n#ifndef HAS_UNIFORM_u_${Ie}\nvarying ${pe} ${Ae} ${Ie};\n#else\nuniform ${pe} ${Ae} u_${Ie};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${Ie}\n    ${pe} ${Ae} ${Ie} = u_${Ie};\n#endif\n`)),vertexSource:r=r.replace(p,(oe,le,pe,Ae,Ie)=>{const qe="float"===Ae?"vec2":"vec4",be=Ie.match(/color/)?"color":qe;return re[Ie]?"define"===le?`\n#ifndef HAS_UNIFORM_u_${Ie}\nuniform lowp float u_${Ie}_t;\nattribute ${pe} ${qe} a_${Ie};\nvarying ${pe} ${Ae} ${Ie};\n#else\nuniform ${pe} ${Ae} u_${Ie};\n#endif\n`:"vec4"===be?`\n#ifndef HAS_UNIFORM_u_${Ie}\n    ${Ie} = a_${Ie};\n#else\n    ${pe} ${Ae} ${Ie} = u_${Ie};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Ie}\n    ${Ie} = unpack_mix_${be}(a_${Ie}, u_${Ie}_t);\n#else\n    ${pe} ${Ae} ${Ie} = u_${Ie};\n#endif\n`:"define"===le?`\n#ifndef HAS_UNIFORM_u_${Ie}\nuniform lowp float u_${Ie}_t;\nattribute ${pe} ${qe} a_${Ie};\n#else\nuniform ${pe} ${Ae} u_${Ie};\n#endif\n`:"vec4"===be?`\n#ifndef HAS_UNIFORM_u_${Ie}\n    ${pe} ${Ae} ${Ie} = a_${Ie};\n#else\n    ${pe} ${Ae} ${Ie} = u_${Ie};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${Ie}\n    ${pe} ${Ae} ${Ie} = unpack_mix_${be}(a_${Ie}, u_${Ie}_t);\n#else\n    ${pe} ${Ae} ${Ie} = u_${Ie};\n#endif\n`}),staticAttributes:b,staticUniforms:Q}}class Cs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,c,p,x,b,M,z,j){this.context=r;let Q=this.boundPaintVertexBuffers.length!==x.length;for(let re=0;!Q&&re<x.length;re++)this.boundPaintVertexBuffers[re]!==x[re]&&(Q=!0);r.extVertexArrayObject&&this.vao&&this.boundProgram===c&&this.boundLayoutVertexBuffer===p&&!Q&&this.boundIndexBuffer===b&&this.boundVertexOffset===M&&this.boundDynamicVertexBuffer===z&&this.boundDynamicVertexBuffer2===j?(r.bindVertexArrayOES.set(this.vao),z&&z.bind(),b&&b.dynamicDraw&&b.bind(),j&&j.bind()):this.freshBind(c,p,x,b,M,z,j)}freshBind(r,c,p,x,b,M,z){let j;const Q=r.numAttributes,re=this.context,oe=re.gl;if(re.extVertexArrayObject)this.vao&&this.destroy(),this.vao=re.extVertexArrayObject.createVertexArrayOES(),re.bindVertexArrayOES.set(this.vao),j=0,this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=M,this.boundDynamicVertexBuffer2=z;else{j=re.currentNumAttributes||0;for(let le=Q;le<j;le++)oe.disableVertexAttribArray(le)}c.enableAttributes(oe,r);for(const le of p)le.enableAttributes(oe,r);M&&M.enableAttributes(oe,r),z&&z.enableAttributes(oe,r),c.bind(),c.setVertexAttribPointers(oe,r,b);for(const le of p)le.bind(),le.setVertexAttribPointers(oe,r,b);M&&(M.bind(),M.setVertexAttribPointers(oe,r,b)),x&&x.bind(),z&&(z.bind(),z.setVertexAttribPointers(oe,r,b)),re.currentNumAttributes=Q}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Aa(f,r){const c=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new u.MercatorCoordinate(0,p/c).toLngLat().lat,new u.MercatorCoordinate(0,(p+1)/c).toLngLat().lat]}function fa(f,r,c,p,x,b,M){const z=f.context,j=z.gl,Q=c.fbo;if(!Q)return;f.prepareDrawTile(r);const re=f.useProgram("hillshade");z.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,Q.colorAttachment.get());const oe=((le,pe,Ae,Ie)=>{const qe=Ae.paint.get("hillshade-shadow-color"),be=Ae.paint.get("hillshade-highlight-color"),Re=Ae.paint.get("hillshade-accent-color");let $e=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Ae.paint.get("hillshade-illumination-anchor")&&($e-=le.transform.angle);const We=!le.options.moving;return{u_matrix:Ie||le.transform.calculateProjMatrix(pe.tileID.toUnwrapped(),We),u_image:0,u_latrange:Aa(0,pe.tileID),u_light:[Ae.paint.get("hillshade-exaggeration"),$e],u_shadow:qe,u_highlight:be,u_accent:Re}})(f,c,p,f.terrain?r.projMatrix:null);f.prepareDrawProgram(z,re,r.toUnwrapped()),re.draw(z,j.TRIANGLES,x,b,M,u.CullFaceMode.disabled,oe,p.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Rs(f,r,c){if(!r.needsDEMTextureUpload)return;const p=f.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||f.getTileTexture(c.stride);const b=c.getPixels();r.demTexture?r.demTexture.update(b,{premultiply:!1}):r.demTexture=new u.Texture(p,b,x.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function gr(f,r,c,p,x,b){const M=f.context,z=M.gl;if(!r.dem)return;const j=r.dem;if(M.activeTexture.set(z.TEXTURE1),Rs(f,r,j),!r.demTexture)return;r.demTexture.bind(z.NEAREST,z.CLAMP_TO_EDGE);const Q=j.dim;M.activeTexture.set(z.TEXTURE0);let re=r.fbo;if(!re){const oe=new u.Texture(M,{width:Q,height:Q,data:null},z.RGBA);oe.bind(z.LINEAR,z.CLAMP_TO_EDGE),re=r.fbo=M.createFramebuffer(Q,Q,!0),re.colorAttachment.set(oe.texture)}M.bindFramebuffer.set(re.framebuffer),M.viewport.set([0,0,Q,Q]),f.useProgram("hillshadePrepare").draw(M,z.TRIANGLES,p,x,b,u.CullFaceMode.disabled,((oe,le)=>{const pe=le.stride,Ae=u.create$1();return u.ortho(Ae,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(Ae,Ae,[0,-u.EXTENT,0]),{u_matrix:Ae,u_image:1,u_dimension:[pe,pe],u_zoom:oe.overscaledZ,u_unpack:le.unpackVector}})(r.tileID,j),c.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),r.needsHillshadePrepare=!1}const oo=(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_image0:new u.Uniform1i(f,r.u_image0),u_skirt_height:new u.Uniform1f(f,r.u_skirt_height)}),Ys=(f,r)=>({u_matrix:f,u_image0:0,u_skirt_height:r}),Ts=new class{constructor(){this.operations={}}newMorphing(f,r,c,p,x){if(f in this.operations){const b=this.operations[f];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[f]={startTime:p,phase:0,duration:x,from:r,to:c,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const r=this.operations[f];return{from:r.from,to:r.to,phase:r.phase}}update(f){for(const r in this.operations){const c=this.operations[r];for(c.phase=(f-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,f)){delete this.operations[r];break}}}_nextOp(f,r){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=r,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},pa={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ao(f,r){const c=1<<f.z;return!r&&(0===f.x||f.x===c-1)||0===f.y||f.y===c-1}const J=f=>({u_matrix:f});function he(f,r,c,p,x){if(x>0){const b=u.exported.now(),M=(b-f.timeAdded)/x,z=r?(b-r.timeAdded)/x:-1,j=c.getSource(),Q=p.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),re=!r||Math.abs(r.tileID.overscaledZ-Q)>Math.abs(f.tileID.overscaledZ-Q),oe=re&&f.refreshedUponExpiration?1:u.clamp(re?M:1-z,0,1);return f.refreshedUponExpiration&&M>=1&&(f.refreshedUponExpiration=!1),r?{opacity:1,mix:1-oe}:{opacity:oe,mix:0}}return{opacity:1,mix:0}}class ee extends u.SourceCache{constructor(r){const c=N("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new gt(Gt(),null),r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,p){if(r.freezeTileCoverage)return;this.transform=r;const x=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,M)=>{if(b[M.key]="",!this._tiles[M.key]){const z=new u.Tile(M,this._source.tileSize*M.overscaleFactor(),r.tileZoom);z.state="loaded",this._tiles[M.key]=z}return b},{});for(const b in this._tiles)b in x||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(r){const c=this.proxyCachedFBO[r];if(void 0!==c){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class _e extends u.OverscaledTileID{constructor(r,c,p){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class Xe extends u.Elevation{constructor(r,c){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,b]=function(j){const Q=new u.StructArrayLayout4i8,re=new u.StructArrayLayout3ui6;Q.reserve(17161),re.reserve(33800);const le=u.EXTENT/128,pe=u.EXTENT+le/2,Ae=pe+le;for(let qe=-le;qe<Ae;qe+=le)for(let be=-le;be<Ae;be+=le){const Re=be<0||be>pe||qe<0||qe>pe?24575:0,$e=u.clamp(Math.round(be),0,u.EXTENT),We=u.clamp(Math.round(qe),0,u.EXTENT);Q.emplaceBack($e+Re,We,$e,We)}const Ie=(qe,be)=>{const Re=131*be+qe;re.emplaceBack(Re+1,Re,Re+131),re.emplaceBack(Re+131,Re+131+1,Re+1)};for(let qe=1;qe<129;qe++)for(let be=1;be<129;be++)Ie(be,qe);return[0,129].forEach(qe=>{for(let be=0;be<130;be++)Ie(be,qe),Ie(qe,be)}),[Q,re,32768]}(),M=r.context;this.gridBuffer=M.createVertexBuffer(p,lr.members),this.gridIndexBuffer=M.createIndexBuffer(x),this.gridSegments=u.SegmentVector.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,p.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ee(c.map),this.orthoMatrix=u.create$1(),u.ortho(this.orthoMatrix,0,u.EXTENT,0,u.EXTENT,0,1);const z=M.gl;this._overlapStencilMode=new u.StencilMode({func:z.GEQUAL,mask:255},0,255,z.KEEP,z.KEEP,z.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency()}update(r,c,p){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const x=r.terrain.properties;this.sourceCache=r._getSourceCache(x.get("source")),this._exaggeration=x.get("exaggeration");const b=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.sourceCache.getSource().tileSize/128,z=this.proxySourceCache.getSource().tileSize;this.sourceCache.update(c,M*z,!0),this._findCoveringTileCache[this.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),c.updateElevation(!p),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map(j=>{const Q=c.getTileByID(j).tileID;return Q.projMatrix=p.calculateProjMatrix(Q.toUnwrapped()),Q});(function(j,Q){const re=Q.transform.pointCoordinate(Q.transform.getCameraPoint()),oe=new u.pointGeometry(re.x,re.y);j.sort((le,pe)=>{if(pe.overscaledZ-le.overscaledZ)return pe.overscaledZ-le.overscaledZ;const Ae=new u.pointGeometry(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),Ie=new u.pointGeometry(pe.canonical.x+(1<<pe.canonical.z)*pe.wrap,pe.canonical.y),qe=oe.mult(1<<le.canonical.z);return qe.x-=.5,qe.y-=.5,qe.distSqr(Ae)-qe.distSqr(Ie)})})(x,this.painter),this._previousZoom=p.zoom;const b=this.proxyToSource||{};this.proxyToSource={},x.forEach(j=>{this.proxyToSource[j.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const j in M){const Q=M[j];if(!Q.used||(Q!==this.sourceCache&&(this._findCoveringTileCache[Q.id]={}),this._setupProxiedCoordsForOrtho(Q,r[j],b),Q.usedForTerrain))continue;const re=r[j];Q.getSource().reparseOverscaled&&this._assignTerrainTiles(re)}this.proxiedCoords[c.id]=x.map(j=>new _e(j,j.key,this.orthoMatrix)),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const z={};this._visibleDemTiles=[];for(const j of this.proxyCoords){const Q=this.terrainTileForTile[j.key];if(!Q)continue;const re=Q.tileID.key;re in z||(this._visibleDemTiles.push(Q),z[re]=re)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],b=x.dem;!b||x.demTexture&&!x.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),Rs(this.painter,x,b))}}_prepareDemTileUniforms(r,c,p,x){if(!c||null==c.demTexture)return!1;const b=r.tileID.canonical,M=Math.pow(2,c.tileID.canonical.z-b.z),z=x||"";return p[`u_dem_tl${z}`]=[b.x*M%1,b.y*M%1],p[`u_dem_scale${z}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){let r=0;const c=this._visibleDemTiles.reduce((p,x)=>{if(!x.dem)return p;const b=x.dem.tree.minimums[0];return b>0&&r++,p+b},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),x={width:1,height:1,data:new Uint8Array(u.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(x,{premultiply:!1}):b=this._emptyDEMTexture=new u.Texture(r,x,c.RGBA,{premultiply:!1}),b}setupElevationDraw(r,c,p){const x=this.painter.context,b=x.gl,M=(z=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(z),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var z;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();let j=null,Q=null,re=1;if(p&&p.morphing&&this._useVertexMorphing){const oe=p.morphing.srcDemTile,le=p.morphing.dstDemTile;re=p.morphing.phase,oe&&le&&(this._prepareDemTileUniforms(r,oe,M,"_prev")&&(Q=oe),this._prepareDemTileUniforms(r,le,M)&&(j=le))}if(Q&&j?(x.activeTexture.set(b.TEXTURE2),j.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),x.activeTexture.set(b.TEXTURE4),Q.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),M.u_dem_lerp=re):(j=this.terrainTileForTile[r.tileID.key],x.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(r,j,M)?j.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST)),p&&p.useDepthForOcclusion&&(x.activeTexture.set(b.TEXTURE3),this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),p&&p.useMeterToDem&&j){const oe=(1<<j.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=oe}p&&p.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(x,M)}renderToBackBuffer(r){const c=this.painter,p=this.painter.context;0!==r.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),this.renderingToTexture=!1,function(x,b,M,z,j){const Q=x.context,re=Q.gl;let oe,le;const pe=x.options.showTerrainWireframe?2:0,Ae=($e,We)=>{if(le===$e)return;const it=[pa[$e]];We&&it.push(pa[pe]),oe=x.useProgram("terrainRaster",null,it),le=$e},Ie=x.colorModeForRenderPass(),qe=new u.DepthMode(re.LEQUAL,u.DepthMode.ReadWrite,x.depthRangeFor3D);Ts.update(j);const be=x.transform,Re=6*Math.pow(1.5,22-be.zoom)*b.exaggeration();(pe?[!1,!0]:[!1]).forEach($e=>{le=-1;const We=$e?re.LINES:re.TRIANGLES,[it,Fe]=$e?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const Ut of z){const dt=M.getTile(Ut),At=u.StencilMode.disabled,on=b.prevTerrainTileForTile[Ut.key],Cn=b.terrainTileForTile[Ut.key];Rt=Cn,null!=(pt=on)&&null!=Rt&&pt.hasData()&&Rt.hasData()&&null!=pt.demTexture&&null!=Rt.demTexture&&pt.tileID.key!==Rt.tileID.key&&Ts.newMorphing(Ut.key,on,Cn,j,250),Q.activeTexture.set(re.TEXTURE0),dt.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST);const vn=Ts.getMorphValuesForProxy(Ut.key),rn=vn?1:0;let Dn;vn&&(Dn={morphing:{srcDemTile:vn.from,dstDemTile:vn.to,phase:u.easeCubicInOut(vn.phase)}});const Er=Ys(Ut.projMatrix,ao(Ut.canonical,be.renderWorldCopies)?Re/10:Re);Ae(rn,$e),b.setupElevationDraw(dt,oe,Dn),x.prepareDrawProgram(Q,oe,Ut.toUnwrapped()),oe.draw(Q,We,qe,At,Ie,u.CullFaceMode.backCCW,Er,"terrain_raster",b.gridBuffer,it,Fe)}var pt,Rt})}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,x=this.proxySourceCache,b=this.proxiedCoords[x.id],M=this._drapedRenderBatches.shift(),z=[],j=c.style.order;let Q=0;for(const re of b){const oe=x.getTileByID(re.proxyTileKey),le=x.proxyCachedFBO[re.key]?x.proxyCachedFBO[re.key][r]:void 0,pe=void 0!==le?x.renderCache[le]:this.pool[Q++],Ae=void 0!==le;if(oe.texture=pe.tex,Ae&&!pe.dirty){z.push(oe.tileID);continue}let Ie;p.bindFramebuffer.set(pe.fb.framebuffer),this.renderedToTile=!1,pe.dirty&&(p.clear({color:u.Color.transparent}),pe.dirty=!1);for(let qe=M.start;qe<=M.end;++qe){const be=c.style._layers[j[qe]];if(be.isHidden(c.transform.zoom))continue;const Re=c.style._getLayerSourceCache(be),$e=Re?this.proxyToSource[re.key][Re.id]:[re];if(!$e)continue;const We=$e;p.viewport.set([0,0,pe.fb.width,pe.fb.height]),Ie!==(Re?Re.id:null)&&(this._setupStencil(pe,$e,be,Re),Ie=Re?Re.id:null),c.renderLayer(c,Re,be,We)}this.renderedToTile?(pe.dirty=!0,z.push(oe.tileID)):Ae||--Q,5===Q&&(Q=0,this.renderToBackBuffer(z))}return this.renderToBackBuffer(z),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),M.end+1}postRender(){}renderCacheEfficiency(r){const c=r.order.length;if(0===c)return{efficiency:100};let p,x=0,b=0,M=!1;for(let z=0;z<c;++z){const j=r._layers[r.order[z]];this._style.isLayerDraped(j)?(M&&++x,++b):M||(M=!0,p=j.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-x/b),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,c,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const M=b.tileID,z=Math.pow(2,M.overscaledZ),{x:j,y:Q}=M.canonical,re=j/z,oe=(j+1)/z,le=Q/z,pe=(Q+1)/z;return{minx:re,miny:le,maxx:oe,maxy:pe,t:b.dem.tree.raycastRoot(re,le,oe,pe,r,c,p),tile:b}});x.sort((b,M)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==M.t?M.t:Number.MAX_VALUE));for(const b of x){if(null==b.t)return null;const M=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,r,c,p);if(null!=M)return M}return null}_createFBO(){const r=this.painter.context,c=r.gl,p=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const x=new u.Texture(r,{width:p[0],height:p[1],data:null},c.RGBA);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=r.createFramebuffer(p[0],p[1],!1);return b.colorAttachment.set(x.texture),b.depthAttachment=new Gr(r,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:b,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._layers[r],p=c.isHidden(this.painter.transform.zoom),x=c.getCrossfadeParameters(),b=!!x&&1!==x.t,M=c.hasTransition();return"custom"!==c.type&&!p&&(b||M)})}_clearRasterFadeFromRenderCache(){let r=!1;for(const c in this._style._sourceCaches)if(this._style._sourceCaches[c]._source instanceof ro){r=!0;break}if(r)for(let c=0;c<this._style.order.length;++c){const p=this._style._layers[this._style.order[c]],x=p.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(p);if("raster"!==p.type||x||!b)continue;const M=p.paint.get("raster-fade-duration");for(const z of this.proxyCoords){const j=this.proxyToSource[z.key][b.id];if(j)for(const Q of j){const re=he(b.getTile(Q),b.findLoadedParent(Q,0),b,this.painter.transform,M);(1!==re.opacity||0!==re.mix)&&this._clearRenderCacheForTile(b.id,Q)}}}}_setupDrapedRenderBatches(){const r=this._style.order,c=r.length;if(0===c)return;const p=[];let x,b=0,M=this._style._layers[r[b]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++b<c;)M=this._style._layers[r[b]];for(;b<c;++b){const z=this._style._layers[r[b]];z.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(z)?void 0===x&&(x=b):void 0!==x&&(p.push({start:x,end:b-1}),x=void 0))}void 0!==x&&p.push({start:x,end:b-1}),this._drapedRenderBatches=p}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const M=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let z=0;z<M.length;++z){const j=Object.values(M[z]);c.renderCachePool.push(...j)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let M=p.length-1;M>=0;M--){const z=p[M];if(c.getTileByID(z.key),void 0!==c.proxyCachedFBO[z.key]){const j=r[z.key],Q=this.proxyToSource[z.key];let re=0;for(const oe in Q){const le=Q[oe],pe=j[oe];if(!pe||pe.length!==le.length||le.some((Ae,Ie)=>Ae!==pe[Ie]||x[oe]&&x[oe].hasOwnProperty(Ae.key))){re=-1;break}++re}for(const oe in c.proxyCachedFBO[z.key])c.renderCache[c.proxyCachedFBO[z.key][oe]].dirty=re<0||re!==Object.values(j).length}}const b=[...this._drapedRenderBatches];b.sort((M,z)=>z.end-z.start-(M.end-M.start));for(const M of b)for(const z of p){if(c.proxyCachedFBO[z.key])continue;let j=c.renderCachePool.pop();void 0===j&&c.renderCache.length<50&&(j=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==j&&(c.proxyCachedFBO[z.key]={},c.proxyCachedFBO[z.key][M.start]=j,c.renderCache[j].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,M=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let z;if(p.isTileClipped())z=c.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);z=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+z>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=z,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(r,c){const p=this.painter,x=this.painter.context,b=x.gl;p._tileClippingMaskIDs={},x.setColorMode(u.ColorMode.disabled),x.setDepthMode(u.DepthMode.disabled);const M=p.useProgram("clippingMask");for(const z of r){const j=p._tileClippingMaskIDs[z.key]=--c;M.draw(x,b.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:b.ALWAYS,mask:0},j,255,b.KEEP,b.KEEP,b.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,J(z.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const p=[r.x,r.y,1,1];u.transformMat4(p,p,c.pixelMatrixInverse),u.scale$2(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const x=c._camera.position,b=u.mercatorZfromAltitude(1,c.center.lat),M=[x[0],x[1],x[2]/b,0],z=u.subtract([],p.slice(0,3),M);u.normalize(z,z);const j=this.raycast(M,z,this._exaggeration);return null!==j&&j?(u.scaleAndAdd(M,M,z,j),M[3]=M[2],M[2]*=b,M):null}drawDepth(){const r=this.painter,c=r.context,p=this.proxySourceCache,x=Math.ceil(r.width),b=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===x&&this._depthFBO.height===b||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const M=c.gl,z=c.createFramebuffer(x,b,!0);c.activeTexture.set(M.TEXTURE0);const j=new u.Texture(c,{width:x,height:b,data:null},M.RGBA);j.bind(M.NEAREST,M.CLAMP_TO_EDGE),z.colorAttachment.set(j.texture);const Q=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,x,b);z.depthAttachment.set(Q),this._depthFBO=z,this._depthTexture=j}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,x,b]),function(M,z,j,Q){const re=M.context,oe=re.gl;re.clear({depth:1});const le=M.useProgram("terrainDepth"),pe=new u.DepthMode(oe.LESS,u.DepthMode.ReadWrite,M.depthRangeFor3D);for(const Ae of Q){const Ie=j.getTile(Ae),qe=Ys(Ae.projMatrix,0);z.setupElevationDraw(Ie,le),le.draw(re,oe.TRIANGLES,pe,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,qe,"terrain_depth",z.gridBuffer,z.gridIndexBuffer,z.gridNoSkirtSegments)}}(r,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,c,p){if(r.getSource()instanceof K)return this._setupProxiedCoordsForImageSource(r,c,p);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const x=this.proxiedCoords[r.id]=[],b=this.proxyCoords;for(let z=0;z<b.length;z++){const j=b[z],Q=this._findTileCoveringTileID(j,r);if(Q){const re=this._createProxiedId(j,Q,p[j.key]&&p[j.key][r.id]);x.push(re),this.proxyToSource[j.key][r.id]=[re]}}let M=!1;for(let z=0;z<c.length;z++){const j=r.getTile(c[z]);if(!j||!j.hasData())continue;const Q=this._findTileCoveringTileID(j.tileID,this.proxySourceCache);if(Q&&Q.tileID.canonical.z!==j.tileID.canonical.z){const re=this.proxyToSource[Q.tileID.key][r.id],oe=this._createProxiedId(Q.tileID,j,p[Q.tileID.key]&&p[Q.tileID.key][r.id]);re?re.splice(re.length-1,0,oe):this.proxyToSource[Q.tileID.key][r.id]=[oe],x.push(oe),M=!0}}this._sourceTilesOverlap[r.id]=M}_setupProxiedCoordsForImageSource(r,c,p){if(!r.getSource().loaded())return;const x=this.proxiedCoords[r.id]=[],b=this.proxyCoords,M=r.getSource(),z=new u.pointGeometry(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),j=M.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((re,oe)=>(re.min.x=Math.min(re.min.x,oe.x-z.x),re.min.y=Math.min(re.min.y,oe.y-z.y),re.max.x=Math.max(re.max.x,oe.x-z.x),re.max.y=Math.max(re.max.y,oe.y-z.y),re),{min:new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Q=(re,oe)=>{const le=re.wrap+re.canonical.x/(1<<re.canonical.z),pe=re.canonical.y/(1<<re.canonical.z),Ae=u.EXTENT/(1<<re.canonical.z),Ie=oe.wrap+oe.canonical.x/(1<<oe.canonical.z),qe=oe.canonical.y/(1<<oe.canonical.z);return le+Ae<Ie+j.min.x||le>Ie+j.max.x||pe+Ae<qe+j.min.y||pe>qe+j.max.y};for(let re=0;re<b.length;re++){const oe=b[re];for(let le=0;le<c.length;le++){const pe=r.getTile(c[le]);if(!pe||!pe.hasData()||Q(oe,pe.tileID))continue;const Ae=this._createProxiedId(oe,pe,p[oe.key]&&p[oe.key][r.id]),Ie=this.proxyToSource[oe.key][r.id];Ie?Ie.push(Ae):this.proxyToSource[oe.key][r.id]=[Ae],x.push(Ae)}}}_createProxiedId(r,c,p){let x=this.orthoMatrix;if(p){const b=p.find(M=>M.key===c.tileID.key);if(b)return b}if(c.tileID.key!==r.key){const b=r.canonical.z-c.tileID.canonical.z;let M,z,j;x=u.create$1();const Q=c.tileID.wrap-r.wrap<<r.overscaledZ;b>0?(M=u.EXTENT>>b,z=M*((c.tileID.canonical.x<<b)-r.canonical.x+Q),j=M*((c.tileID.canonical.y<<b)-r.canonical.y)):(M=u.EXTENT<<-b,z=u.EXTENT*(c.tileID.canonical.x-(r.canonical.x+Q<<-b)),j=u.EXTENT*(c.tileID.canonical.y-(r.canonical.y<<-b))),u.ortho(x,0,M,0,M,0,1),u.translate(x,x,[z,j,0])}return new _e(c.tileID,r.key,x)}_findTileCoveringTileID(r,c){let p=c.getTile(r);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[c.id],b=x[r.key];if(p=b?c.getTileByID(b):null,p&&p.hasData()||null===b)return p;let M=p?p.tileID:r,z=M.overscaledZ;const j=c.getSource().minzoom,Q=[];if(!b){const oe=c.getSource().maxzoom;if(r.canonical.z>=oe){const le=r.canonical.z-oe;c.getSource().reparseOverscaled?(z=Math.max(r.canonical.z+2,c.transform.tileZoom),M=new u.OverscaledTileID(z,r.wrap,oe,r.canonical.x>>le,r.canonical.y>>le)):0!==le&&(z=oe,M=new u.OverscaledTileID(z,r.wrap,oe,r.canonical.x>>le,r.canonical.y>>le))}M.key!==r.key&&(Q.push(M.key),p=c.getTile(M))}const re=oe=>{Q.forEach(le=>{x[le]=oe}),Q.length=0};for(z-=1;z>=j&&(!p||!p.hasData());z--){p&&re(p.tileID.key);const oe=M.calculateScaledKey(z);if(p=c.getTileByID(oe),p&&p.hasData())break;const le=x[oe];if(null===le)break;void 0===le?Q.push(oe):p=c.getTileByID(le)}return re(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(r){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let p=this._tilesDirty[r];p||(p=this._tilesDirty[r]={}),p[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(c){let p,x,b;const M=new u.StructArrayLayout2ui4,z=131;for(x=1;x<129;x++){for(p=1;p<129;p++)b=x*z+p,M.emplaceBack(b,b+1),M.emplaceBack(b,b+z),M.emplaceBack(b+1,b+z),128===x&&M.emplaceBack(b+z,b+z+1);M.emplaceBack(b+1,b+1+z)}return M}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Dt(f){const r=[];for(let c=0;c<f.length;c++){if(null===f[c])continue;const p=f[c].split(" ");r.push(p.pop())}return r}class jt{static cacheKey(r,c,p){let x=`${r}${p?p.cacheKey:""}`;for(const b of c)x+=`/${b}`;return x}constructor(r,c,p,x,b,M){const z=r.gl;this.program=z.createProgram();const j=Dt(p.staticAttributes),Q=x?x.getBinderAttributes():[],re=j.concat(Q),oe=p.staticUniforms?Dt(p.staticUniforms):[],le=x?x.getBinderUniforms():[],pe=oe.concat(le),Ae=[];for(const it of pe)Ae.indexOf(it)<0&&Ae.push(it);let Ie=x?x.defines():[];Ie=Ie.concat(M.map(it=>`#define ${it}`));const qe=Ie.concat(so.fragmentSource,_o,Di.fragmentSource,p.fragmentSource).join("\n"),be=Ie.concat(so.vertexSource,_o,Di.vertexSource,Ws.vertexSource,p.vertexSource).join("\n"),Re=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource(Re,qe),z.compileShader(Re),z.attachShader(this.program,Re);const $e=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);z.shaderSource($e,be),z.compileShader($e),z.attachShader(this.program,$e),this.attributes={};const We={};this.numAttributes=re.length;for(let it=0;it<this.numAttributes;it++)re[it]&&(z.bindAttribLocation(this.program,it,re[it]),this.attributes[re[it]]=it);z.linkProgram(this.program),z.deleteShader($e),z.deleteShader(Re);for(let it=0;it<Ae.length;it++){const Fe=Ae[it];if(Fe&&!We[Fe]){const pt=z.getUniformLocation(this.program,Fe);pt&&(We[Fe]=pt)}}var it,Fe;this.fixedUniforms=b(r,We),this.binderUniforms=x?x.getUniforms(r,We):[],-1!==M.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(it=r,(Fe=We).u_dem),u_dem_prev:new u.Uniform1i(it,Fe.u_dem_prev),u_dem_unpack:new u.Uniform4f(it,Fe.u_dem_unpack),u_dem_tl:new u.Uniform2f(it,Fe.u_dem_tl),u_dem_scale:new u.Uniform1f(it,Fe.u_dem_scale),u_dem_tl_prev:new u.Uniform2f(it,Fe.u_dem_tl_prev),u_dem_scale_prev:new u.Uniform1f(it,Fe.u_dem_scale_prev),u_dem_size:new u.Uniform1f(it,Fe.u_dem_size),u_dem_lerp:new u.Uniform1f(it,Fe.u_dem_lerp),u_exaggeration:new u.Uniform1f(it,Fe.u_exaggeration),u_depth:new u.Uniform1i(it,Fe.u_depth),u_depth_size_inv:new u.Uniform2f(it,Fe.u_depth_size_inv),u_meter_to_dem:new u.Uniform1f(it,Fe.u_meter_to_dem),u_label_plane_matrix_inv:new u.UniformMatrix4f(it,Fe.u_label_plane_matrix_inv),u_tile_tl_up:new u.Uniform3f(it,Fe.u_tile_tl_up),u_tile_tr_up:new u.Uniform3f(it,Fe.u_tile_tr_up),u_tile_br_up:new u.Uniform3f(it,Fe.u_tile_br_up),u_tile_bl_up:new u.Uniform3f(it,Fe.u_tile_bl_up),u_tile_up_scale:new u.Uniform1f(it,Fe.u_tile_up_scale)}),-1!==M.indexOf("FOG")&&(this.fogUniforms=((it,Fe)=>({u_fog_matrix:new u.UniformMatrix4f(it,Fe.u_fog_matrix),u_fog_range:new u.Uniform2f(it,Fe.u_fog_range),u_fog_color:new u.Uniform4f(it,Fe.u_fog_color),u_fog_horizon_blend:new u.Uniform1f(it,Fe.u_fog_horizon_blend),u_fog_temporal_offset:new u.Uniform1f(it,Fe.u_fog_temporal_offset)}))(r,We))}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)p[x].set(c[x])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const x in c)p[x].location&&p[x].set(c[x])}}draw(r,c,p,x,b,M,z,j,Q,re,oe,le,pe,Ae,Ie,qe){const be=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(x),r.setColorMode(b),r.setCullFace(M);for(const $e in this.fixedUniforms)this.fixedUniforms[$e].set(z[$e]);Ae&&Ae.setUniforms(r,this.binderUniforms,le,{zoom:pe});const Re={[be.LINES]:2,[be.TRIANGLES]:3,[be.LINE_STRIP]:1}[c];for(const $e of oe.get()){const We=$e.vaos||($e.vaos={});(We[j]||(We[j]=new Cs)).bind(r,this,Q,Ae?Ae.getPaintVertexBuffers():[],re,$e.vertexOffset,Ie,qe),be.drawElements(c,$e.primitiveLength*Re,be.UNSIGNED_SHORT,$e.primitiveOffset*Re*2)}}}function q(f,r,c){const p=1/tn(c,1,r.transform.tileZoom),x=Math.pow(2,c.tileID.overscaledZ),b=c.tileSize*Math.pow(2,r.transform.tileZoom)/x,M=b*(c.tileID.canonical.x+c.tileID.wrap*x),z=b*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[p,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[M>>16,z>>16],u_pixel_coord_lower:[65535&M,65535&z]}}const $=(f,r,c,p)=>{const x=r.style.light,b=x.properties.get("position"),M=[b.x,b.y,b.z],z=u.create$2();"viewport"===x.properties.get("anchor")&&(u.fromRotation(z,-r.transform.angle),u.transformMat3(M,M,z));const j=x.properties.get("color");return{u_matrix:f,u_lightpos:M,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+c,u_opacity:p}},V=(f,r,c,p,x,b,M)=>u.extend($(f,r,c,p),q(b,r,M),{u_height_factor:-Math.pow(2,x.overscaledZ)/M.tileSize/8}),ue=f=>({u_matrix:f}),yt=(f,r,c,p)=>u.extend(ue(f),q(c,r,p)),Qt=(f,r)=>({u_matrix:f,u_world:r}),Mn=(f,r,c,p,x)=>u.extend(yt(f,r,c,p),{u_world:x}),Vr=(f,r,c,p)=>{const x=f.transform;let b;if("map"===p.paint.get("circle-pitch-alignment")){const M=tn(c,1,x.zoom);b=[M,M]}else b=x.pixelsToGLUnits;return{u_camera_to_center_distance:x.cameraToCenterDistance,u_matrix:f.translatePosMatrix(r.projMatrix,c,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:b}},Ai=f=>{const r=[];return"map"===f.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},oi=(f,r,c)=>{const p=u.EXTENT/c.tileSize;return{u_matrix:f,u_camera_to_center_distance:r.cameraToCenterDistance,u_extrude_scale:[r.pixelsToGLUnits[0]/p,r.pixelsToGLUnits[1]/p]}},fs=(f,r,c=1)=>({u_matrix:f,u_color:r,u_overlay:0,u_overlay_scale:c}),ps=(f,r,c,p)=>({u_matrix:f,u_extrude_scale:tn(r,1,c),u_intensity:p}),Mr=(f,r,c,p,x,b)=>{const M=f.transform,z={u_matrix:Po(f,r,c,x),u_ratio:1/tn(r,1,M.zoom),u_device_pixel_ratio:u.exported.devicePixelRatio,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0};if(Ro(c)){const j=lo(r,f.transform);z.u_texsize=r.lineAtlasTexture.size,z.u_scale=[j,p.fromScale,p.toScale],z.u_mix=p.t}return z},Mi=(f,r,c,p,x)=>{const b=f.transform,M=lo(r,b);return{u_matrix:Po(f,r,c,x),u_texsize:r.imageAtlasTexture.size,u_ratio:1/tn(r,1,b.zoom),u_device_pixel_ratio:u.exported.devicePixelRatio,u_image:0,u_scale:[M,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}};function lo(f,r){return 1/tn(f,1,r.tileZoom)}function Po(f,r,c,p){return f.translatePosMatrix(p||r.tileID.projMatrix,r,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const gl=f=>{const r=[];return Ro(f)&&r.push("RENDER_LINE_DASH"),f.paint.get("line-gradient")&&r.push("RENDER_LINE_GRADIENT"),r};function Ro(f){const r=f.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const ko=(f,r,c,p,x)=>{return{u_matrix:f,u_tl_parent:r,u_scale_parent:c,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(M=x.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(b=x.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:Qa(x.paint.get("raster-hue-rotate"))};var b,M};function Qa(f){f*=Math.PI/180;const r=Math.sin(f),c=Math.cos(f);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const nr=(f,r,c,p,x,b,M,z,j,Q)=>{const re=x.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:re.cameraToCenterDistance,u_pitch:re.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:re.width/re.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:M,u_coord_matrix:z,u_is_text:+j,u_pitch_with_map:+p,u_texsize:Q,u_texture:0}},_l=(f,r,c,p,x,b,M,z,j,Q,re)=>{const{cameraToCenterDistance:oe,_pitch:le}=x.transform;return u.extend(nr(f,r,c,p,x,b,M,z,j,Q),{u_gamma_scale:p?oe*Math.cos(x.terrain?0:le):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+re})},kc=(f,r,c,p,x,b,M,z,j,Q)=>u.extend(_l(f,r,c,p,x,b,M,z,!0,j,!0),{u_texsize_icon:Q,u_texture_icon:1}),Gl=(f,r,c)=>({u_matrix:f,u_opacity:r,u_color:c}),Ja=(f,r,c,p,x,b)=>u.extend(function(M,z,j,Q){const re=j.imageManager.getPattern(M.from.toString()),oe=j.imageManager.getPattern(M.to.toString()),{width:le,height:pe}=j.imageManager.getPixelSize(),Ae=Math.pow(2,Q.tileID.overscaledZ),Ie=Q.tileSize*Math.pow(2,j.transform.tileZoom)/Ae,qe=Ie*(Q.tileID.canonical.x+Q.tileID.wrap*Ae),be=Ie*Q.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:re.tl,u_pattern_br_a:re.br,u_pattern_tl_b:oe.tl,u_pattern_br_b:oe.br,u_texsize:[le,pe],u_mix:z.t,u_pattern_size_a:re.displaySize,u_pattern_size_b:oe.displaySize,u_scale_a:z.fromScale,u_scale_b:z.toScale,u_tile_units_to_pixels:1/tn(Q,1,j.transform.tileZoom),u_pixel_coord_upper:[qe>>16,be>>16],u_pixel_coord_lower:[65535&qe,65535&be]}}(p,b,c,x),{u_matrix:f,u_opacity:r}),yl={fillExtrusion:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_lightpos:new u.Uniform3f(f,r.u_lightpos),u_lightintensity:new u.Uniform1f(f,r.u_lightintensity),u_lightcolor:new u.Uniform3f(f,r.u_lightcolor),u_vertical_gradient:new u.Uniform1f(f,r.u_vertical_gradient),u_opacity:new u.Uniform1f(f,r.u_opacity)}),fillExtrusionPattern:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_lightpos:new u.Uniform3f(f,r.u_lightpos),u_lightintensity:new u.Uniform1f(f,r.u_lightintensity),u_lightcolor:new u.Uniform3f(f,r.u_lightcolor),u_vertical_gradient:new u.Uniform1f(f,r.u_vertical_gradient),u_height_factor:new u.Uniform1f(f,r.u_height_factor),u_image:new u.Uniform1i(f,r.u_image),u_texsize:new u.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new u.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new u.Uniform3f(f,r.u_scale),u_fade:new u.Uniform1f(f,r.u_fade),u_opacity:new u.Uniform1f(f,r.u_opacity)}),fill:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix)}),fillPattern:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_image:new u.Uniform1i(f,r.u_image),u_texsize:new u.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new u.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new u.Uniform3f(f,r.u_scale),u_fade:new u.Uniform1f(f,r.u_fade)}),fillOutline:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_world:new u.Uniform2f(f,r.u_world)}),fillOutlinePattern:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_world:new u.Uniform2f(f,r.u_world),u_image:new u.Uniform1i(f,r.u_image),u_texsize:new u.Uniform2f(f,r.u_texsize),u_pixel_coord_upper:new u.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(f,r.u_pixel_coord_lower),u_scale:new u.Uniform3f(f,r.u_scale),u_fade:new u.Uniform1f(f,r.u_fade)}),circle:(f,r)=>({u_camera_to_center_distance:new u.Uniform1f(f,r.u_camera_to_center_distance),u_extrude_scale:new u.Uniform2f(f,r.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(f,r.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(f,r.u_matrix)}),collisionBox:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_camera_to_center_distance:new u.Uniform1f(f,r.u_camera_to_center_distance),u_extrude_scale:new u.Uniform2f(f,r.u_extrude_scale)}),collisionCircle:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_inv_matrix:new u.UniformMatrix4f(f,r.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(f,r.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(f,r.u_viewport_size)}),debug:(f,r)=>({u_color:new u.UniformColor(f,r.u_color),u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_overlay:new u.Uniform1i(f,r.u_overlay),u_overlay_scale:new u.Uniform1f(f,r.u_overlay_scale)}),clippingMask:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix)}),heatmap:(f,r)=>({u_extrude_scale:new u.Uniform1f(f,r.u_extrude_scale),u_intensity:new u.Uniform1f(f,r.u_intensity),u_matrix:new u.UniformMatrix4f(f,r.u_matrix)}),heatmapTexture:(f,r)=>({u_image:new u.Uniform1i(f,r.u_image),u_color_ramp:new u.Uniform1i(f,r.u_color_ramp),u_opacity:new u.Uniform1f(f,r.u_opacity)}),hillshade:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_image:new u.Uniform1i(f,r.u_image),u_latrange:new u.Uniform2f(f,r.u_latrange),u_light:new u.Uniform2f(f,r.u_light),u_shadow:new u.UniformColor(f,r.u_shadow),u_highlight:new u.UniformColor(f,r.u_highlight),u_accent:new u.UniformColor(f,r.u_accent)}),hillshadePrepare:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_image:new u.Uniform1i(f,r.u_image),u_dimension:new u.Uniform2f(f,r.u_dimension),u_zoom:new u.Uniform1f(f,r.u_zoom),u_unpack:new u.Uniform4f(f,r.u_unpack)}),line:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_ratio:new u.Uniform1f(f,r.u_ratio),u_device_pixel_ratio:new u.Uniform1f(f,r.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(f,r.u_units_to_pixels),u_dash_image:new u.Uniform1i(f,r.u_dash_image),u_gradient_image:new u.Uniform1i(f,r.u_gradient_image),u_image_height:new u.Uniform1f(f,r.u_image_height),u_texsize:new u.Uniform2f(f,r.u_texsize),u_scale:new u.Uniform3f(f,r.u_scale),u_mix:new u.Uniform1f(f,r.u_mix)}),linePattern:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_texsize:new u.Uniform2f(f,r.u_texsize),u_ratio:new u.Uniform1f(f,r.u_ratio),u_device_pixel_ratio:new u.Uniform1f(f,r.u_device_pixel_ratio),u_image:new u.Uniform1i(f,r.u_image),u_units_to_pixels:new u.Uniform2f(f,r.u_units_to_pixels),u_scale:new u.Uniform3f(f,r.u_scale),u_fade:new u.Uniform1f(f,r.u_fade)}),raster:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_tl_parent:new u.Uniform2f(f,r.u_tl_parent),u_scale_parent:new u.Uniform1f(f,r.u_scale_parent),u_buffer_scale:new u.Uniform1f(f,r.u_buffer_scale),u_fade_t:new u.Uniform1f(f,r.u_fade_t),u_opacity:new u.Uniform1f(f,r.u_opacity),u_image0:new u.Uniform1i(f,r.u_image0),u_image1:new u.Uniform1i(f,r.u_image1),u_brightness_low:new u.Uniform1f(f,r.u_brightness_low),u_brightness_high:new u.Uniform1f(f,r.u_brightness_high),u_saturation_factor:new u.Uniform1f(f,r.u_saturation_factor),u_contrast_factor:new u.Uniform1f(f,r.u_contrast_factor),u_spin_weights:new u.Uniform3f(f,r.u_spin_weights)}),symbolIcon:(f,r)=>({u_is_size_zoom_constant:new u.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new u.Uniform1f(f,r.u_size_t),u_size:new u.Uniform1f(f,r.u_size),u_camera_to_center_distance:new u.Uniform1f(f,r.u_camera_to_center_distance),u_pitch:new u.Uniform1f(f,r.u_pitch),u_rotate_symbol:new u.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new u.Uniform1f(f,r.u_fade_change),u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new u.Uniform1i(f,r.u_is_text),u_pitch_with_map:new u.Uniform1i(f,r.u_pitch_with_map),u_texsize:new u.Uniform2f(f,r.u_texsize),u_texture:new u.Uniform1i(f,r.u_texture)}),symbolSDF:(f,r)=>({u_is_size_zoom_constant:new u.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new u.Uniform1f(f,r.u_size_t),u_size:new u.Uniform1f(f,r.u_size),u_camera_to_center_distance:new u.Uniform1f(f,r.u_camera_to_center_distance),u_pitch:new u.Uniform1f(f,r.u_pitch),u_rotate_symbol:new u.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new u.Uniform1f(f,r.u_fade_change),u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new u.Uniform1i(f,r.u_is_text),u_pitch_with_map:new u.Uniform1i(f,r.u_pitch_with_map),u_texsize:new u.Uniform2f(f,r.u_texsize),u_texture:new u.Uniform1i(f,r.u_texture),u_gamma_scale:new u.Uniform1f(f,r.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(f,r.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(f,r.u_is_halo)}),symbolTextAndIcon:(f,r)=>({u_is_size_zoom_constant:new u.Uniform1i(f,r.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(f,r.u_is_size_feature_constant),u_size_t:new u.Uniform1f(f,r.u_size_t),u_size:new u.Uniform1f(f,r.u_size),u_camera_to_center_distance:new u.Uniform1f(f,r.u_camera_to_center_distance),u_pitch:new u.Uniform1f(f,r.u_pitch),u_rotate_symbol:new u.Uniform1i(f,r.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(f,r.u_aspect_ratio),u_fade_change:new u.Uniform1f(f,r.u_fade_change),u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(f,r.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(f,r.u_coord_matrix),u_is_text:new u.Uniform1i(f,r.u_is_text),u_pitch_with_map:new u.Uniform1i(f,r.u_pitch_with_map),u_texsize:new u.Uniform2f(f,r.u_texsize),u_texsize_icon:new u.Uniform2f(f,r.u_texsize_icon),u_texture:new u.Uniform1i(f,r.u_texture),u_texture_icon:new u.Uniform1i(f,r.u_texture_icon),u_gamma_scale:new u.Uniform1f(f,r.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(f,r.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(f,r.u_is_halo)}),background:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_opacity:new u.Uniform1f(f,r.u_opacity),u_color:new u.UniformColor(f,r.u_color)}),backgroundPattern:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_opacity:new u.Uniform1f(f,r.u_opacity),u_image:new u.Uniform1i(f,r.u_image),u_pattern_tl_a:new u.Uniform2f(f,r.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(f,r.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(f,r.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(f,r.u_pattern_br_b),u_texsize:new u.Uniform2f(f,r.u_texsize),u_mix:new u.Uniform1f(f,r.u_mix),u_pattern_size_a:new u.Uniform2f(f,r.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(f,r.u_pattern_size_b),u_scale_a:new u.Uniform1f(f,r.u_scale_a),u_scale_b:new u.Uniform1f(f,r.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(f,r.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(f,r.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(f,r.u_tile_units_to_pixels)}),terrainRaster:oo,terrainDepth:oo,skybox:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_sun_direction:new u.Uniform3f(f,r.u_sun_direction),u_cubemap:new u.Uniform1i(f,r.u_cubemap),u_opacity:new u.Uniform1f(f,r.u_opacity),u_temporal_offset:new u.Uniform1f(f,r.u_temporal_offset)}),skyboxGradient:(f,r)=>({u_matrix:new u.UniformMatrix4f(f,r.u_matrix),u_color_ramp:new u.Uniform1i(f,r.u_color_ramp),u_center_direction:new u.Uniform3f(f,r.u_center_direction),u_radius:new u.Uniform1f(f,r.u_radius),u_opacity:new u.Uniform1f(f,r.u_opacity),u_temporal_offset:new u.Uniform1f(f,r.u_temporal_offset)}),skyboxCapture:(f,r)=>({u_matrix_3f:new u.UniformMatrix3f(f,r.u_matrix_3f),u_sun_direction:new u.Uniform3f(f,r.u_sun_direction),u_sun_intensity:new u.Uniform1f(f,r.u_sun_intensity),u_color_tint_r:new u.Uniform4f(f,r.u_color_tint_r),u_color_tint_m:new u.Uniform4f(f,r.u_color_tint_m),u_luminance:new u.Uniform1f(f,r.u_luminance)})};let Ko;function ma(f,r,c,p,x,b,M){const z=f.context,j=z.gl,Q=f.useProgram("collisionBox"),re=[];let oe=0,le=0;for(let $e=0;$e<p.length;$e++){const We=p[$e],it=r.getTile(We),Fe=it.getBucket(c);if(!Fe)continue;let pt=We.projMatrix;0===x[0]&&0===x[1]||(pt=f.translatePosMatrix(We.projMatrix,it,x,b));const Rt=M?Fe.textCollisionBox:Fe.iconCollisionBox,Ut=Fe.collisionCircleArray;if(Ut.length>0){const dt=u.create$1(),At=pt;u.mul$1(dt,Fe.placementInvProjMatrix,f.transform.glCoordMatrix),u.mul$1(dt,dt,Fe.placementViewportMatrix),re.push({circleArray:Ut,circleOffset:le,transform:At,invTransform:dt}),oe+=Ut.length/4,le=oe}Rt&&(f.terrain&&f.terrain.setupElevationDraw(it,Q),Q.draw(z,j.LINES,u.DepthMode.disabled,u.StencilMode.disabled,f.colorModeForRenderPass(),u.CullFaceMode.disabled,oi(pt,f.transform,it),c.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,null,f.transform.zoom,null,Rt.collisionVertexBuffer,Rt.collisionVertexBufferExt))}if(!M||!re.length)return;const pe=f.useProgram("collisionCircle"),Ae=new u.StructArrayLayout2f1f2i16;Ae.resize(4*oe),Ae._trim();let Ie=0;for(const $e of re)for(let We=0;We<$e.circleArray.length/4;We++){const it=4*We,Fe=$e.circleArray[it+0],pt=$e.circleArray[it+1],Rt=$e.circleArray[it+2],Ut=$e.circleArray[it+3];Ae.emplace(Ie++,Fe,pt,Rt,Ut,0),Ae.emplace(Ie++,Fe,pt,Rt,Ut,1),Ae.emplace(Ie++,Fe,pt,Rt,Ut,2),Ae.emplace(Ie++,Fe,pt,Rt,Ut,3)}(!Ko||Ko.length<2*oe)&&(Ko=function($e){const We=2*$e,it=new u.StructArrayLayout3ui6;it.resize(We),it._trim();for(let Fe=0;Fe<We;Fe++){const pt=6*Fe;it.uint16[pt+0]=4*Fe+0,it.uint16[pt+1]=4*Fe+1,it.uint16[pt+2]=4*Fe+2,it.uint16[pt+3]=4*Fe+2,it.uint16[pt+4]=4*Fe+3,it.uint16[pt+5]=4*Fe+0}return it}(oe));const qe=z.createIndexBuffer(Ko,!0),be=z.createVertexBuffer(Ae,u.collisionCircleLayout.members,!0);for(const $e of re){const We={u_matrix:$e.transform,u_inv_matrix:$e.invTransform,u_camera_to_center_distance:(Re=f.transform).cameraToCenterDistance,u_viewport_size:[Re.width,Re.height]};pe.draw(z,j.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,f.colorModeForRenderPass(),u.CullFaceMode.disabled,We,c.id,be,qe,u.SegmentVector.simpleSegment(0,2*$e.circleOffset,$e.circleArray.length,$e.circleArray.length/2),null,f.transform.zoom,null,null,null)}var Re;be.destroy(),qe.destroy()}const Jt=u.identity(new Float32Array(16));function Rr(f,r,c,p,x,b){const{horizontalAlign:M,verticalAlign:z}=u.getAnchorAlignment(f),j=-(M-.5)*r,Q=-(z-.5)*c,re=u.evaluateVariableOffset(f,p);return new u.pointGeometry((j/x+re[0])*b,(Q/x+re[1])*b)}function Ma(f,r,c,p,x,b,M,z,j,Q,re,oe){const le=f.text.placedSymbolArray,pe=f.text.dynamicLayoutVertexArray,Ae=f.icon.dynamicLayoutVertexArray,Ie={};pe.clear();for(let qe=0;qe<le.length;qe++){const be=le.get(qe),Re=f.allowVerticalPlacement&&!be.placedOrientation,$e=be.hidden||!be.crossTileID||Re?null:p[be.crossTileID];if($e){const We=new u.pointGeometry(be.tileAnchorX,be.tileAnchorY),it=oe(We),Fe=mr(We,c?z:M,it),pt=On(b.cameraToCenterDistance,Fe.signedDistanceFromCamera);let Rt=x.evaluateSizeForFeature(f.textSizeData,Q,be)*pt/u.ONE_EM;c&&(Rt*=f.tilePixelRatio/j);const{width:Ut,height:dt,anchor:At,textOffset:on,textScale:Cn}=$e,vn=Rr(At,Ut,dt,on,Cn,Rt),rn=c?mr(We.add(vn),M,it).point:Fe.point.add(r?vn.rotate(-b.angle):vn),Dn=f.allowVerticalPlacement&&be.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let Er=0;Er<be.numGlyphs;Er++)u.addDynamicAttributes(pe,rn,Dn);re&&be.associatedIconIndex>=0&&(Ie[be.associatedIconIndex]={shiftedAnchor:rn,angle:Dn})}else Ti(be.numGlyphs,pe)}if(re){Ae.clear();const qe=f.icon.placedSymbolArray;for(let be=0;be<qe.length;be++){const Re=qe.get(be);if(Re.hidden)Ti(Re.numGlyphs,Ae);else{const $e=Ie[be];if($e)for(let We=0;We<Re.numGlyphs;We++)u.addDynamicAttributes(Ae,$e.shiftedAnchor,$e.angle);else Ti(Re.numGlyphs,Ae)}}f.icon.dynamicLayoutVertexBuffer.updateData(Ae)}f.text.dynamicLayoutVertexBuffer.updateData(pe)}function gi(f,r,c){return c.iconsInText&&r?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Oo(f,r,c,p,x,b,M,z,j,Q,re,oe){const le=f.context,pe=le.gl,Ae=f.transform,Ie="map"===z,qe="map"===j,be=Ie&&"point"!==c.layout.get("symbol-placement"),Re=Ie&&!qe&&!be,$e=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let We=!1;const it=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),Fe=c.layout.get("text-variable-anchor"),pt=[],Rt=f.terrain&&qe?["PITCH_WITH_MAP_TERRAIN"]:null;for(const Ut of p){const dt=r.getTile(Ut),At=dt.getBucket(c);if(!At)continue;const on=x?At.text:At.icon;if(!on||!on.segments.get().length)continue;const Cn=on.programConfigurations.get(c.id),vn=x||At.sdfIcons,rn=x?At.textSizeData:At.iconSizeData,Dn=qe||0!==Ae.pitch,Er=f.useProgram(gi(vn,x,At),Cn,Rt),Qn=u.evaluateSizeForZoom(rn,Ae.zoom);let zi,wi,_r,fr,yi=[0,0],Qs=null;if(x){if(wi=dt.glyphAtlasTexture,_r=pe.LINEAR,zi=dt.glyphAtlasTexture.size,At.iconsInText){yi=dt.imageAtlasTexture.size,Qs=dt.imageAtlasTexture;const fe="composite"===rn.kind||"camera"===rn.kind;fr=Dn||f.options.rotating||f.options.zooming||fe?pe.LINEAR:pe.NEAREST}}else{const fe=1!==c.layout.get("icon-size").constantOr(0)||At.iconsNeedLinear;wi=dt.imageAtlasTexture,_r=vn||f.options.rotating||f.options.zooming||fe||Dn?pe.LINEAR:pe.NEAREST,zi=dt.imageAtlasTexture.size}const Ba=tn(dt,1,f.transform.zoom),is=cn(Ut.projMatrix,qe,Ie,f.transform,Ba),Vs=f.terrain&&qe&&be?u.invert(new Float32Array(16),is):Jt,Js=Tn(Ut.projMatrix,qe,Ie,f.transform,Ba),Va=Fe&&At.hasTextData(),ai="none"!==c.layout.get("icon-text-fit")&&Va&&At.hasIconData();if(be){const fe=Ae.elevation;zs(At,Ut.projMatrix,f,x,is,Js,qe,Q,fe?Te=>fe.getAtTileOffset(Ut,Te.x,Te.y):null)}const Ii=f.translatePosMatrix(Ut.projMatrix,dt,b,M),L=be||x&&Fe||ai?Jt:is,y=f.translatePosMatrix(Js,dt,b,M,!0),v=vn&&0!==c.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1);let I;I=vn?At.iconsInText?kc(rn.kind,Qn,Re,qe,f,Ii,L,y,zi,yi):_l(rn.kind,Qn,Re,qe,f,Ii,L,y,x,zi,!0):nr(rn.kind,Qn,Re,qe,f,Ii,L,y,x,zi);const X={program:Er,buffers:on,uniformValues:I,atlasTexture:wi,atlasTextureIcon:Qs,atlasInterpolation:_r,atlasInterpolationIcon:fr,isSDF:vn,hasHalo:v,tile:dt,labelPlaneMatrixInv:Vs};if($e&&At.canOverlap){We=!0;const fe=on.segments.get();for(const Te of fe)pt.push({segments:new u.SegmentVector([Te]),sortKey:Te.sortKey,state:X})}else pt.push({segments:on.segments,sortKey:0,state:X})}We&&pt.sort((Ut,dt)=>Ut.sortKey-dt.sortKey);for(const Ut of pt){const dt=Ut.state;if(f.terrain&&f.terrain.setupElevationDraw(dt.tile,dt.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:dt.labelPlaneMatrixInv}),le.activeTexture.set(pe.TEXTURE0),dt.atlasTexture.bind(dt.atlasInterpolation,pe.CLAMP_TO_EDGE),dt.atlasTextureIcon&&(le.activeTexture.set(pe.TEXTURE1),dt.atlasTextureIcon&&dt.atlasTextureIcon.bind(dt.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),dt.isSDF){const At=dt.uniformValues;dt.hasHalo&&(At.u_is_halo=1,ks(dt.buffers,Ut.segments,c,f,dt.program,it,re,oe,At)),At.u_is_halo=0}ks(dt.buffers,Ut.segments,c,f,dt.program,it,re,oe,dt.uniformValues)}}function ks(f,r,c,p,x,b,M,z,j){const Q=p.context;x.draw(Q,Q.gl.TRIANGLES,b,M,z,u.CullFaceMode.disabled,j,c.id,f.layoutVertexBuffer,f.indexBuffer,r,c.paint,p.transform.zoom,f.programConfigurations.get(c.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function ns(f,r,c,p,x,b,M){const z=f.context.gl,j=c.paint.get("fill-pattern"),Q=j&&j.constantOr(1),re=c.getCrossfadeParameters();let oe,le,pe,Ae,Ie;M?(le=Q&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",oe=z.LINES):(le=Q?"fillPattern":"fill",oe=z.TRIANGLES);for(const qe of p){const be=r.getTile(qe);if(Q&&!be.patternsLoaded())continue;const Re=be.getBucket(c);if(!Re)continue;f.prepareDrawTile(qe);const $e=Re.programConfigurations.get(c.id),We=f.useProgram(le,$e);Q&&(f.context.activeTexture.set(z.TEXTURE0),be.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),$e.updatePaintBuffers(re));const it=j.constantOr(null);if(it&&be.imageAtlas){const pt=be.imageAtlas,Rt=pt.patternPositions[it.to.toString()],Ut=pt.patternPositions[it.from.toString()];Rt&&Ut&&$e.setConstantPatternPositions(Rt,Ut)}const Fe=f.translatePosMatrix(qe.projMatrix,be,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){Ae=Re.indexBuffer2,Ie=Re.segments2;const pt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[z.drawingBufferWidth,z.drawingBufferHeight];pe="fillOutlinePattern"===le&&Q?Mn(Fe,f,re,be,pt):Qt(Fe,pt)}else Ae=Re.indexBuffer,Ie=Re.segments,pe=Q?yt(Fe,f,re,be):ue(Fe);f.prepareDrawProgram(f.context,We,qe.toUnwrapped()),We.draw(f.context,oe,x,f.stencilModeForClipping(qe),b,u.CullFaceMode.disabled,pe,c.id,Re.layoutVertexBuffer,Ae,Ie,c.paint,f.transform.zoom,$e)}}function Fo(f,r,c,p,x,b,M){const z=f.context,j=z.gl,Q=c.paint.get("fill-extrusion-pattern"),re=Q.constantOr(1),oe=c.getCrossfadeParameters(),le=c.paint.get("fill-extrusion-opacity");for(const pe of p){const Ae=r.getTile(pe),Ie=Ae.getBucket(c);if(!Ie)continue;const qe=Ie.programConfigurations.get(c.id),be=f.useProgram(re?"fillExtrusionPattern":"fillExtrusion",qe);if(f.terrain){const Fe=f.terrain;if(!Ie.enableTerrain)continue;if(Fe.setupElevationDraw(Ae,be,{useMeterToDem:!0}),ga(z,r,pe,Ie,c,Fe),!Ie.centroidVertexBuffer){const pt=be.attributes.a_centroid_pos;void 0!==pt&&j.vertexAttrib2f(pt,0,0)}}re&&(f.context.activeTexture.set(j.TEXTURE0),Ae.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),qe.updatePaintBuffers(oe));const Re=Q.constantOr(null);if(Re&&Ae.imageAtlas){const Fe=Ae.imageAtlas,pt=Fe.patternPositions[Re.to.toString()],Rt=Fe.patternPositions[Re.from.toString()];pt&&Rt&&qe.setConstantPatternPositions(pt,Rt)}const $e=f.translatePosMatrix(pe.projMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),We=c.paint.get("fill-extrusion-vertical-gradient"),it=re?V($e,f,We,le,pe,oe,Ae):$($e,f,We,le);f.prepareDrawProgram(z,be,pe.toUnwrapped()),be.draw(z,z.gl.TRIANGLES,x,b,M,u.CullFaceMode.backCCW,it,c.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,c.paint,f.transform.zoom,qe,f.terrain?Ie.centroidVertexBuffer:null)}}function ga(f,r,c,p,x,b){const M=[be=>{let Re=be.canonical.x-1,$e=be.wrap;return Re<0&&(Re=(1<<be.canonical.z)-1,$e--),new u.OverscaledTileID(be.overscaledZ,$e,be.canonical.z,Re,be.canonical.y)},be=>{let Re=be.canonical.x+1,$e=be.wrap;return Re===1<<be.canonical.z&&(Re=0,$e++),new u.OverscaledTileID(be.overscaledZ,$e,be.canonical.z,Re,be.canonical.y)},be=>new u.OverscaledTileID(be.overscaledZ,be.wrap,be.canonical.z,be.canonical.x,(0===be.canonical.y?1<<be.canonical.z:be.canonical.y)-1),be=>new u.OverscaledTileID(be.overscaledZ,be.wrap,be.canonical.z,be.canonical.x,be.canonical.y===(1<<be.canonical.z)-1?0:be.canonical.y+1)],z=be=>{const Re=r.getSource().maxzoom,$e=pt=>{const Rt=r.getTileByID(pt);if(Rt&&Rt.hasData())return Rt.getBucket(x)};let We,it,Fe;return(be.overscaledZ===be.canonical.z||be.overscaledZ>=Re)&&(We=$e(be.key)),be.overscaledZ>=Re&&(it=$e(be.calculateScaledKey(be.overscaledZ+1))),be.overscaledZ>Re&&(Fe=$e(be.calculateScaledKey(be.overscaledZ-1))),We||it||Fe},j=[0,0,0],Q=(be,Re)=>(j[0]=Math.min(be.min.y,Re.min.y),j[1]=Math.max(be.max.y,Re.max.y),j[2]=u.EXTENT-Re.min.x>be.max.x?Re.min.x-u.EXTENT:be.max.x,j),re=(be,Re)=>(j[0]=Math.min(be.min.x,Re.min.x),j[1]=Math.max(be.max.x,Re.max.x),j[2]=u.EXTENT-Re.min.y>be.max.y?Re.min.y-u.EXTENT:be.max.y,j),oe=[(be,Re)=>Q(be,Re),(be,Re)=>Q(Re,be),(be,Re)=>re(be,Re),(be,Re)=>re(Re,be)],le=new u.pointGeometry(0,0);let pe,Ae,Ie;const qe=(be,Re,$e,We,it)=>{const Fe=[[We?$e:be,We?be:$e,0],[We?$e:Re,We?Re:$e,0]],pt=it<0?u.EXTENT+it:it,Rt=[We?pt:(be+Re)/2,We?(be+Re)/2:pt,0];return 0===$e&&it<0||0!==$e&&it>0?b.getForTilePoints(Ie,[Rt],!0,Ae):Fe.push(Rt),b.getForTilePoints(c,Fe,!0,pe),Math.max(Fe[0][2],Fe[1][2],Rt[2])/b.exaggeration()};for(let be=0;be<4;be++){const Re=p.borders[be];if(0===Re.length&&(p.borderDone[be]=!0),p.borderDone[be])continue;const $e=Ie=M[be](c),We=z($e);if(!(We&&We.enableTerrain&&(Ae=b.findDEMTileFor($e),Ae&&Ae.dem)))continue;if(!pe){const Rt=b.findDEMTileFor(c);if(!Rt||!Rt.dem)return;pe=Rt}const it=(be<2?1:5)-be,Fe=We.borders[it];let pt=0;for(let Rt=0;Rt<Re.length;Rt++){const Ut=p.featuresOnBorder[Re[Rt]],dt=Ut.borders[be];let At;for(;pt<Fe.length&&(At=We.featuresOnBorder[Fe[pt]],!(At.borders[it][1]>dt[0]+3));)We.borderDone[it]||We.encodeCentroid(void 0,At,!1),pt++;if(At&&pt<Fe.length){const on=pt;let Cn=0;for(;!(At.borders[it][0]>dt[1]-3)&&(Cn++,++pt!==Fe.length);)At=We.featuresOnBorder[Fe[pt]];if(At=We.featuresOnBorder[Fe[on]],Ut.intersectsCount()>1||At.intersectsCount()>1||1!==Cn){1!==Cn&&(pt=on),p.encodeCentroid(void 0,Ut,!1),We.borderDone[it]||We.encodeCentroid(void 0,At,!1);continue}const vn=oe[be](Ut,At),rn=be%2?u.EXTENT-1:0;le.x=qe(vn[0],Math.min(u.EXTENT-1,vn[1]),rn,be<2,vn[2]),le.y=0,p.encodeCentroid(le,Ut,!1),We.borderDone[it]||We.encodeCentroid(le,At,!1)}else p.encodeCentroid(void 0,Ut,!1)}p.borderDone[be]=p.needsCentroidUpdate=!0,We.borderDone[it]||(We.borderDone[it]=We.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(f)}const Ur=new u.Color(1,0,0,1),Zl=new u.Color(0,1,0,1),Ia=new u.Color(0,0,1,1),vl=new u.Color(1,0,1,1),_i=new u.Color(0,1,1,1);function yo(f,r,c,p){Ss(f,0,r+c/2,f.transform.width,c,p)}function el(f,r,c,p){Ss(f,r-c/2,0,c,f.transform.height,p)}function Ss(f,r,c,p,x,b){const M=f.context,z=M.gl;z.enable(z.SCISSOR_TEST),z.scissor(r*u.exported.devicePixelRatio,c*u.exported.devicePixelRatio,p*u.exported.devicePixelRatio,x*u.exported.devicePixelRatio),M.clear({color:b}),z.disable(z.SCISSOR_TEST)}function co(f,r,c){const p=f.context,x=p.gl,b=c.projMatrix,M=f.useProgram("debug"),z=r.getTileByID(c.key);f.terrain&&f.terrain.setupElevationDraw(z,M);const j=u.DepthMode.disabled,Q=u.StencilMode.disabled,re=f.colorModeForRenderPass();p.activeTexture.set(x.TEXTURE0),f.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),M.draw(p,x.LINE_STRIP,j,Q,re,u.CullFaceMode.disabled,fs(b,u.Color.red),"$debug",f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments);const le=z.latestRawTileData,pe=Math.floor((le&&le.byteLength||0)/1024),Ae=r.getTile(c).tileSize,Ie=512/Math.min(Ae,512)*(c.overscaledZ/f.transform.zoom)*.5;let qe=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(qe+=` => ${c.overscaledZ}`),function(be,Re){be.initDebugOverlayCanvas();const $e=be.debugOverlayCanvas,We=be.context.gl,it=be.debugOverlayCanvas.getContext("2d");it.clearRect(0,0,$e.width,$e.height),it.shadowColor="white",it.shadowBlur=2,it.lineWidth=1.5,it.strokeStyle="white",it.textBaseline="top",it.font="bold 36px Open Sans, sans-serif",it.fillText(Re,5,5),it.strokeText(Re,5,5),be.debugOverlayTexture.update($e),be.debugOverlayTexture.bind(We.LINEAR,We.CLAMP_TO_EDGE)}(f,`${qe} ${pe}kb`),M.draw(p,x.TRIANGLES,j,Q,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,fs(b,u.Color.transparent,Ie),"$debug",f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const _c=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:tl}=_c;function vo(f,r,c,p){f.emplaceBack(r,c,p)}class yc{constructor(r){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,vo(this.vertexArray,-1,-1,1),vo(this.vertexArray,1,-1,1),vo(this.vertexArray,-1,1,1),vo(this.vertexArray,1,1,1),vo(this.vertexArray,-1,-1,-1),vo(this.vertexArray,1,-1,-1),vo(this.vertexArray,-1,1,-1),vo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,tl),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function uo(f,r,c,p,x,b){const M=f.gl,z=r.paint.get("sky-atmosphere-color"),j=r.paint.get("sky-atmosphere-halo-color"),Q=r.paint.get("sky-atmosphere-sun-intensity"),re={u_matrix_3f:u.fromMat4([],p),u_sun_direction:x,u_sun_intensity:Q,u_color_tint_r:[(Ae=z).r,Ae.g,Ae.b,Ae.a],u_color_tint_m:[(Ie=j).r,Ie.g,Ie.b,Ie.a],u_luminance:5e-5};var Ae,Ie;M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+b,r.skyboxTexture,0),c.draw(f,M.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,re,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Hl={symbol:function(f,r,c,p,x){if("translucent"!==f.renderPass)return;const b=u.StencilMode.disabled,M=f.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(z,j,Q,re,oe,le,pe){const Ae=j.transform,Ie="map"===oe,qe="map"===le;for(const be of z){const Re=re.getTile(be),$e=Re.getBucket(Q);if(!$e||!$e.text||!$e.text.segments.get().length)continue;const We=u.evaluateSizeForZoom($e.textSizeData,Ae.zoom),it=tn(Re,1,j.transform.zoom),Fe=cn(be.projMatrix,qe,Ie,j.transform,it),pt="none"!==Q.layout.get("icon-text-fit")&&$e.hasIconData();if(We){const Rt=Math.pow(2,Ae.zoom-Re.tileID.overscaledZ),Ut=Ae.elevation;Ma($e,Ie,qe,pe,u.symbolSize,Ae,Fe,be.projMatrix,Rt,We,pt,Ut?dt=>Ut.getAtTileOffset(be,dt.x,dt.y):dt=>0)}}}(p,f,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x),0!==c.paint.get("icon-opacity").constantOr(1)&&Oo(f,r,c,p,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),b,M),0!==c.paint.get("text-opacity").constantOr(1)&&Oo(f,r,c,p,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),b,M),r.map.showCollisionBoxes&&(ma(f,r,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ma(f,r,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(f,r,c,p){if("translucent"!==f.renderPass)return;const x=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),z=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===x.constantOr(1)&&(0===b.constantOr(1)||0===M.constantOr(1)))return;const j=f.context,Q=j.gl,re=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),oe=u.StencilMode.disabled,le=f.colorModeForRenderPass(),pe=[];for(let Ae=0;Ae<p.length;Ae++){const Ie=p[Ae],qe=r.getTile(Ie),be=qe.getBucket(c);if(!be)continue;const Re=be.programConfigurations.get(c.id),$e=Ai(c),We={programConfiguration:Re,program:f.useProgram("circle",Re,$e),layoutVertexBuffer:be.layoutVertexBuffer,indexBuffer:be.indexBuffer,uniformValues:Vr(f,Ie,qe,c),tile:qe};if(z){const it=be.segments.get();for(const Fe of it)pe.push({segments:new u.SegmentVector([Fe]),sortKey:Fe.sortKey,state:We})}else pe.push({segments:be.segments,sortKey:0,state:We})}z&&pe.sort((Ae,Ie)=>Ae.sortKey-Ie.sortKey);for(const Ae of pe){const{programConfiguration:Ie,program:qe,layoutVertexBuffer:be,indexBuffer:Re,uniformValues:$e,tile:We}=Ae.state,it=Ae.segments;f.terrain&&f.terrain.setupElevationDraw(We,qe,{useDepthForOcclusion:!0}),f.prepareDrawProgram(j,qe,We.tileID.toUnwrapped()),qe.draw(j,Q.TRIANGLES,re,oe,le,u.CullFaceMode.disabled,$e,c.id,be,Re,it,c.paint,f.transform.zoom,Ie)}},heatmap:function(f,r,c,p){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const x=f.context,b=x.gl,M=u.StencilMode.disabled,z=new u.ColorMode([b.ONE,b.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(j,Q,re){const oe=j.gl;j.activeTexture.set(oe.TEXTURE1),j.viewport.set([0,0,Q.width/4,Q.height/4]);let le=re.heatmapFbo;if(le)oe.bindTexture(oe.TEXTURE_2D,le.colorAttachment.get()),j.bindFramebuffer.set(le.framebuffer);else{const pe=oe.createTexture();oe.bindTexture(oe.TEXTURE_2D,pe),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_S,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_WRAP_T,oe.CLAMP_TO_EDGE),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MIN_FILTER,oe.LINEAR),oe.texParameteri(oe.TEXTURE_2D,oe.TEXTURE_MAG_FILTER,oe.LINEAR),le=re.heatmapFbo=j.createFramebuffer(Q.width/4,Q.height/4,!1),function(Ae,Ie,qe,be){const Re=Ae.gl;Re.texImage2D(Re.TEXTURE_2D,0,Re.RGBA,Ie.width/4,Ie.height/4,0,Re.RGBA,Ae.extRenderToTextureHalfFloat?Ae.extTextureHalfFloat.HALF_FLOAT_OES:Re.UNSIGNED_BYTE,null),be.colorAttachment.set(qe)}(j,Q,pe,le)}})(x,f,c),x.clear({color:u.Color.transparent});for(let j=0;j<p.length;j++){const Q=p[j];if(r.hasRenderableParent(Q))continue;const re=r.getTile(Q),oe=re.getBucket(c);if(!oe)continue;const le=oe.programConfigurations.get(c.id),pe=f.useProgram("heatmap",le),{zoom:Ae}=f.transform;f.terrain&&f.terrain.setupElevationDraw(re,pe),f.prepareDrawProgram(x,pe,Q.toUnwrapped()),pe.draw(x,b.TRIANGLES,u.DepthMode.disabled,M,z,u.CullFaceMode.disabled,ps(Q.projMatrix,re,Ae,c.paint.get("heatmap-intensity")),c.id,oe.layoutVertexBuffer,oe.indexBuffer,oe.segments,c.paint,f.transform.zoom,le)}x.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(x,b){const M=x.context,z=M.gl,j=b.heatmapFbo;if(!j)return;M.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,j.colorAttachment.get()),M.activeTexture.set(z.TEXTURE1);let Q=b.colorRampTexture;Q||(Q=b.colorRampTexture=new u.Texture(M,b.colorRamp,z.RGBA)),Q.bind(z.LINEAR,z.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(M,z.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,x.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,b.paint,x.transform.zoom)}(f,c))},line:function(f,r,c,p){if("translucent"!==f.renderPass)return;const x=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(0===x.constantOr(1)||0===b.constantOr(1))return;const M=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),z=f.colorModeForRenderPass(),j=c.paint.get("line-dasharray"),Q=j.constantOr(1),re=c.layout.get("line-cap"),oe=c.paint.get("line-pattern"),le=oe.constantOr(1),pe=c.paint.get("line-gradient"),Ae=c.getCrossfadeParameters(),Ie=le?"linePattern":"line",qe=f.context,be=qe.gl;for(const Re of p){const $e=r.getTile(Re);if(le&&!$e.patternsLoaded())continue;const We=$e.getBucket(c);if(!We)continue;f.prepareDrawTile(Re);const it=We.programConfigurations.get(c.id),Fe=gl(c),pt=f.useProgram(Ie,it,Fe),Rt=oe.constantOr(null);if(Rt&&$e.imageAtlas){const Cn=$e.imageAtlas,vn=Cn.patternPositions[Rt.to.toString()],rn=Cn.patternPositions[Rt.from.toString()];vn&&rn&&it.setConstantPatternPositions(vn,rn)}const Ut=j.constantOr(null),dt=re.constantOr(null);if(!le&&Ut&&dt&&$e.lineAtlas){const Cn=$e.lineAtlas,vn=Cn.getDash(Ut.to,dt),rn=Cn.getDash(Ut.from,dt);vn&&rn&&it.setConstantPatternPositions(vn,rn)}const At=f.terrain?Re.projMatrix:null,on=le?Mi(f,$e,c,Ae,At):Mr(f,$e,c,Ae,At,We.lineClipsArray.length);if(pe){const Cn=We.gradients[c.id];let vn=Cn.texture;if(c.gradientVersion!==Cn.version){let rn=256;if(c.stepInterpolant){const Dn=r.getSource().maxzoom,Er=Re.canonical.z===Dn?Math.ceil(1<<f.transform.maxZoom-Re.canonical.z):1;rn=u.clamp(u.nextPowerOfTwo(We.maxLineLength/u.EXTENT*1024*Er),256,qe.maxTextureSize)}Cn.gradient=u.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:rn,image:Cn.gradient||void 0,clips:We.lineClipsArray}),Cn.texture?Cn.texture.update(Cn.gradient):Cn.texture=new u.Texture(qe,Cn.gradient,be.RGBA),Cn.version=c.gradientVersion,vn=Cn.texture}qe.activeTexture.set(be.TEXTURE1),vn.bind(c.stepInterpolant?be.NEAREST:be.LINEAR,be.CLAMP_TO_EDGE)}Q&&(qe.activeTexture.set(be.TEXTURE0),$e.lineAtlasTexture.bind(be.LINEAR,be.REPEAT),it.updatePaintBuffers(Ae)),le&&(qe.activeTexture.set(be.TEXTURE0),$e.imageAtlasTexture.bind(be.LINEAR,be.CLAMP_TO_EDGE),it.updatePaintBuffers(Ae)),f.prepareDrawProgram(qe,pt,Re.toUnwrapped()),pt.draw(qe,be.TRIANGLES,M,f.stencilModeForClipping(Re),z,u.CullFaceMode.disabled,on,c.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,c.paint,f.transform.zoom,it,We.layoutVertexBuffer2)}},fill:function(f,r,c,p){const x=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(0===b.constantOr(1))return;const M=f.colorModeForRenderPass(),z=c.paint.get("fill-pattern"),j=f.opaquePassEnabledForLayer()&&!z.constantOr(1)&&1===x.constantOr(u.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(f.renderPass===j){const Q=f.depthModeForSublayer(1,"opaque"===f.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);ns(f,r,c,p,Q,M,!1)}if("translucent"===f.renderPass&&c.paint.get("fill-antialias")){const Q=f.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);ns(f,r,c,p,Q,M,!0)}},"fill-extrusion":function(f,r,c,p){const x=c.paint.get("fill-extrusion-opacity");if(0!==x&&"translucent"===f.renderPass){const b=new u.DepthMode(f.context.gl.LEQUAL,u.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==x||c.paint.get("fill-extrusion-pattern").constantOr(1))Fo(f,r,c,p,b,u.StencilMode.disabled,u.ColorMode.disabled),Fo(f,r,c,p,b,f.stencilModeFor3D(),f.colorModeForRenderPass());else{const M=f.colorModeForRenderPass();Fo(f,r,c,p,b,u.StencilMode.disabled,M)}}},hillshade:function(f,r,c,p){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const x=f.context,b=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),M=f.colorModeForRenderPass(),z=f.terrain&&f.terrain.renderingToTexture,[j,Q]="translucent"!==f.renderPass||z?[{},p]:f.stencilConfigForOverlap(p);for(const re of Q){const oe=r.getTile(re);if(oe.needsHillshadePrepare&&"offscreen"===f.renderPass)gr(f,oe,c,b,u.StencilMode.disabled,M);else if("translucent"===f.renderPass){const le=z&&f.terrain?f.terrain.stencilModeForRTTOverlap(re):j[re.overscaledZ];fa(f,re,oe,c,b,le,M)}}x.viewport.set([0,0,f.width,f.height])},raster:function(f,r,c,p,x,b){if("translucent"!==f.renderPass||0===c.paint.get("raster-opacity")||!p.length)return;const M=f.context,z=M.gl,j=r.getSource(),Q=f.useProgram("raster"),re=f.colorModeForRenderPass(),oe=f.terrain&&f.terrain.renderingToTexture,[le,pe]=j instanceof K||oe?[{},p]:f.stencilConfigForOverlap(p),Ae=pe[pe.length-1].overscaledZ,Ie=!f.options.moving;for(const qe of pe){const be=oe?u.DepthMode.disabled:f.depthModeForSublayer(qe.overscaledZ-Ae,1===c.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,z.LESS),Re=qe.toUnwrapped(),$e=r.getTile(qe);if(oe&&(!$e||!$e.hasData()))continue;const We=oe?qe.projMatrix:f.transform.calculateProjMatrix(Re,Ie),it=f.terrain&&oe?f.terrain.stencilModeForRTTOverlap(qe):le[qe.overscaledZ],Fe=b?0:c.paint.get("raster-fade-duration");$e.registerFadeDuration(Fe);const pt=r.findLoadedParent(qe,0),Rt=he($e,pt,r,f.transform,Fe);let Ut,dt;f.terrain&&f.terrain.prepareDrawTile(qe);const At="nearest"===c.paint.get("raster-resampling")?z.NEAREST:z.LINEAR;M.activeTexture.set(z.TEXTURE0),$e.texture.bind(At,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(z.TEXTURE1),pt?(pt.texture.bind(At,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),Ut=Math.pow(2,pt.tileID.overscaledZ-$e.tileID.overscaledZ),dt=[$e.tileID.canonical.x*Ut%1,$e.tileID.canonical.y*Ut%1]):$e.texture.bind(At,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST);const on=ko(We,dt||[0,0],Ut||1,Rt,c);f.prepareDrawProgram(M,Q,Re),j instanceof K?Q.draw(M,z.TRIANGLES,be,u.StencilMode.disabled,re,u.CullFaceMode.disabled,on,c.id,j.boundsBuffer,f.quadTriangleIndexBuffer,j.boundsSegments):Q.draw(M,z.TRIANGLES,be,it,re,u.CullFaceMode.disabled,on,c.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}},background:function(f,r,c,p){const x=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(0===b)return;const M=f.context,z=M.gl,j=f.transform,Q=j.tileSize,re=c.paint.get("background-pattern");if(f.isPatternMissing(re))return;const oe=!re&&1===x.a&&1===b&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==oe)return;const le=u.StencilMode.disabled,pe=f.depthModeForSublayer(0,"opaque"===oe?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),Ae=f.colorModeForRenderPass(),Ie=f.useProgram(re?"backgroundPattern":"background"),qe=p||j.coveringTiles({tileSize:Q});re&&(M.activeTexture.set(z.TEXTURE0),f.imageManager.bind(f.context));const be=c.getCrossfadeParameters();for(const Re of qe){const $e=Re.toUnwrapped(),We=p?Re.projMatrix:f.transform.calculateProjMatrix($e);f.prepareDrawTile(Re);const it=re?Ja(We,b,f,re,{tileID:Re,tileSize:Q},be):Gl(We,b,x);f.prepareDrawProgram(M,Ie,$e),Ie.draw(M,z.TRIANGLES,pe,le,Ae,u.CullFaceMode.disabled,it,c.id,f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}},sky:function(f,r,c){const p=c.paint.get("sky-opacity");if(0===p)return;const x=f.context,b=c.paint.get("sky-type"),M=new u.DepthMode(x.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),z=f.frameCounter/1e3%1;"atmosphere"===b?"offscreen"===f.renderPass?c.needsSkyboxCapture(f)&&(function(j,Q,re,oe){const le=j.context,pe=le.gl;let Ae=Q.skyboxFbo;if(!Ae){Ae=Q.skyboxFbo=le.createFramebuffer(32,32,!1),Q.skyboxGeometry=new yc(le),Q.skyboxTexture=le.gl.createTexture(),pe.bindTexture(pe.TEXTURE_CUBE_MAP,Q.skyboxTexture),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_S,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_WRAP_T,pe.CLAMP_TO_EDGE),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MIN_FILTER,pe.LINEAR),pe.texParameteri(pe.TEXTURE_CUBE_MAP,pe.TEXTURE_MAG_FILTER,pe.LINEAR);for(let Re=0;Re<6;++Re)pe.texImage2D(pe.TEXTURE_CUBE_MAP_POSITIVE_X+Re,0,pe.RGBA,32,32,0,pe.RGBA,pe.UNSIGNED_BYTE,null)}le.bindFramebuffer.set(Ae.framebuffer),le.viewport.set([0,0,32,32]);const Ie=Q.getCenter(j,!0),qe=j.useProgram("skyboxCapture"),be=new Float64Array(16);u.identity(be),u.rotateY(be,be,.5*-Math.PI),uo(le,Q,qe,be,Ie,0),u.identity(be),u.rotateY(be,be,.5*Math.PI),uo(le,Q,qe,be,Ie,1),u.identity(be),u.rotateX(be,be,.5*-Math.PI),uo(le,Q,qe,be,Ie,2),u.identity(be),u.rotateX(be,be,.5*Math.PI),uo(le,Q,qe,be,Ie,3),u.identity(be),uo(le,Q,qe,be,Ie,4),u.identity(be),u.rotateY(be,be,Math.PI),uo(le,Q,qe,be,Ie,5),le.viewport.set([0,0,j.width,j.height])}(f,c),c.markSkyboxValid(f)):"sky"===f.renderPass&&function(j,Q,re,oe,le){const pe=j.context,Ae=pe.gl,Ie=j.transform,qe=j.useProgram("skybox");pe.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_CUBE_MAP,Q.skyboxTexture);const be={u_matrix:Ie.skyboxMatrix,u_sun_direction:Q.getCenter(j,!1),u_cubemap:0,u_opacity:oe,u_temporal_offset:le};j.prepareDrawProgram(pe,qe),qe.draw(pe,Ae.TRIANGLES,re,u.StencilMode.disabled,j.colorModeForRenderPass(),u.CullFaceMode.backCW,be,"skybox",Q.skyboxGeometry.vertexBuffer,Q.skyboxGeometry.indexBuffer,Q.skyboxGeometry.segment)}(f,c,M,p,z):"gradient"===b&&"sky"===f.renderPass&&function(j,Q,re,oe,le){const pe=j.context,Ae=pe.gl,Ie=j.transform,qe=j.useProgram("skyboxGradient");Q.skyboxGeometry||(Q.skyboxGeometry=new yc(pe)),pe.activeTexture.set(Ae.TEXTURE0);let be=Q.colorRampTexture;be||(be=Q.colorRampTexture=new u.Texture(pe,Q.colorRamp,Ae.RGBA)),be.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE);const Re=($e=Ie.skyboxMatrix,We=Q.getCenter(j,!1),it=Q.paint.get("sky-gradient-radius"),Fe=oe,pt=le,{u_matrix:$e,u_color_ramp:0,u_center_direction:We,u_radius:u.degToRad(it),u_opacity:Fe,u_temporal_offset:pt});var $e,We,it,Fe,pt;j.prepareDrawProgram(pe,qe),qe.draw(pe,Ae.TRIANGLES,re,u.StencilMode.disabled,j.colorModeForRenderPass(),u.CullFaceMode.backCW,Re,"skyboxGradient",Q.skyboxGeometry.vertexBuffer,Q.skyboxGeometry.indexBuffer,Q.skyboxGeometry.segment)}(f,c,M,p,z)},debug:function(f,r,c){for(let p=0;p<c.length;p++)co(f,r,c[p])},custom:function(f,r,c){const p=f.context,x=c.implementation;if("offscreen"===f.renderPass){const b=x.prerender;b&&(f.setCustomLayerDefaults(),p.setColorMode(f.colorModeForRenderPass()),b.call(x,p.gl,f.transform.customLayerMatrix()),p.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),p.setColorMode(f.colorModeForRenderPass()),p.setStencilMode(u.StencilMode.disabled);const b="3d"===x.renderingMode?new u.DepthMode(f.context.gl.LEQUAL,u.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,u.DepthMode.ReadOnly);p.setDepthMode(b),x.render(p.gl,f.transform.customLayerMatrix()),p.setDirty(),f.setBaseState(),p.bindFramebuffer.set(null)}}};class xl{constructor(r,c){this.context=new cs(r),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new da,this.gpuTimers={},this.frameCounter=0}updateTerrain(r,c){const p=!!r&&!!r.terrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Xe(this,r));const x=this._terrain;this.transform.elevation=p?x:null,x.update(r,this.transform,c)}_updateFog(r){const c=r.fog;if(!c||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=c.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const b=p+.78*(x-p);this.transform.fogCullDistSq=b*b}get terrain(){return this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,c){if(this.width=r*u.exported.devicePixelRatio,this.height=c*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const r=this.context,c=new u.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(u.EXTENT,0),c.emplaceBack(0,u.EXTENT),c.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(c,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const p=new u.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(u.EXTENT,0),p.emplaceBack(0,u.EXTENT),p.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=r.createVertexBuffer(p,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const x=new u.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(u.EXTENT,0,u.EXTENT,0),x.emplaceBack(0,u.EXTENT,0,u.EXTENT),x.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.rasterBoundsBuffer=r.createVertexBuffer(x,lr.members),this.rasterBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const b=new u.StructArrayLayout2i4;b.emplaceBack(-1,-1),b.emplaceBack(1,-1),b.emplaceBack(-1,1),b.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(b,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const M=new u.StructArrayLayout1ui2;M.emplaceBack(0),M.emplaceBack(1),M.emplaceBack(3),M.emplaceBack(2),M.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(M);const z=new u.StructArrayLayout3ui6;z.emplaceBack(0,1,2),z.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(z),this.emptyTexture=new u.Texture(r,{width:1,height:1,data:new Uint8Array([0,0,0,0])},r.gl.RGBA),this.identityMat=u.create$1();const j=this.context.gl;this.stencilClearMode=new u.StencilMode({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.loadTimeStamps.push(u.window.performance.now())}clearStencil(){const r=this.context,c=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this.useProgram("clippingMask").draw(r,c.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,J(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,c,p){if(!(c&&this.currentStencilSource!==c.id&&r.isTileClipped()&&p&&p.length))return;this.currentStencilSource=c.id;const x=this.context,b=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(u.ColorMode.disabled),x.setDepthMode(u.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of p){const j=this._tileClippingMaskIDs[z.key]=this.nextStencilID++;M.draw(x,b.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:b.ALWAYS,mask:0},j,255,b.KEEP,b.KEEP,b.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,J(z.projMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new u.StencilMode({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new u.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,p=r.sort((M,z)=>z.overscaledZ-M.overscaledZ),x=p[p.length-1].overscaledZ,b=p[0].overscaledZ-x+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const M={};for(let z=0;z<b;z++)M[z+x]=new u.StencilMode({func:c.GEQUAL,mask:255},z+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[M,p]}return[{[x]:u.StencilMode.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;if(this._showOverdrawInspector){const c=1/8;return new u.ColorMode([r.CONSTANT_COLOR,r.ONE],new u.Color(c,c,c,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(r,c,p){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const x=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new u.DepthMode(p||this.context.gl.LEQUAL,c,[x,x])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,c){this.style=r,this.options=c,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const p=this.style.order,x=this.style._sourceCaches;for(const Q in x){const re=x[Q];re.used&&re.prepare(this.context)}const b={},M={},z={};for(const Q in x){const re=x[Q];b[Q]=re.getVisibleCoordinates(),M[Q]=b[Q].slice().reverse(),z[Q]=re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Q=0;Q<p.length;Q++)if(this.style._layers[p[Q]].is3D()){this.opaquePassCutoff=Q;break}if(this.terrain&&(this.terrain.updateTileBinding(z),this.opaquePassCutoff=0),!u.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const Q of p){const re=this.style._layers[Q],oe=r._getLayerSourceCache(re);if(!re.hasOffscreenPass()||re.isHidden(this.transform.zoom))continue;const le=oe?M[oe.id]:void 0;("custom"===re.type||re.isSky()||le&&le.length)&&this.renderLayer(this,oe,re,le)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let j=u.Color.transparent;if(this.style.fog&&(j=this.style.fog.properties.get("color")),this.context.clear({color:c.showOverdrawInspector?u.Color.black:j,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const Q=this.style._layers[p[this.currentLayer]],re=r._getLayerSourceCache(Q);if(Q.isSky())continue;const oe=re?M[re.id]:void 0;this._renderTileClippingMasks(Q,re,oe),this.renderLayer(this,re,Q,oe)}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const Q=this.style._layers[p[this.currentLayer]],re=r._getLayerSourceCache(Q);Q.isSky()&&this.renderLayer(this,re,Q,re?M[re.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const Q=this.style._layers[p[this.currentLayer]],re=r._getLayerSourceCache(Q);if(Q.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(Q)){if(Q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const oe=re?("symbol"===Q.type?z:M)[re.id]:void 0;this._renderTileClippingMasks(Q,re,re?b[re.id]:void 0),this.renderLayer(this,re,Q,oe),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let Q=null;u.values(this.style._layers).forEach(re=>{const oe=r._getLayerSourceCache(re);oe&&!re.isHidden(this.transform.zoom)&&(!Q||Q.getSource().maxzoom<oe.getSource().maxzoom)&&(Q=oe)}),Q&&this.options.showTileBoundaries&&Hl.debug(this,Q,Q.getVisibleCoordinates())}this.options.showPadding&&function(Q){const re=Q.transform.padding;yo(Q,Q.transform.height-(re.top||0),3,Ur),yo(Q,re.bottom||0,3,Zl),el(Q,re.left||0,3,Ia),el(Q,Q.transform.width-(re.right||0),3,vl);const oe=Q.transform.centerPoint;var le,pe,Ae,Ie;Ss(le=Q,(pe=oe.x)-1,(Ae=Q.transform.height-oe.y)-10,2,20,Ie=_i),Ss(le,pe-10,Ae-1,20,2,Ie)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%u.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,c,p,x){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),Hl[p.type](r,c,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),p.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}queryGpuTimers(r){const c={};for(const p in r){const x=r[p],b=this.context.extTimerQuery,M=b.getQueryObjectEXT(x.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(x.query),c[p]=M}return c}translatePosMatrix(r,c,p,x,b){if(!p[0]&&!p[1])return r;const M=b?"map"===x?this.transform.angle:0:"viewport"===x?-this.transform.angle:0;if(M){const Q=Math.sin(M),re=Math.cos(M);p=[p[0]*re-p[1]*Q,p[0]*Q+p[1]*re]}const z=[b?p[0]:tn(c,p[0],this.transform.zoom),b?p[1]:tn(c,p[1],this.transform.zoom),0],j=new Float32Array(16);return u.translate(j,r,z),j}saveTileTexture(r){const c=this._tileTextures[r.size[0]];c?c.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const c=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!c||!p}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,c=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),c&&!r&&0!==c.getOpacity(this.transform.pitch)&&p.push("FOG"),r&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(r,c,p){this.cache=this.cache||{};const x=p||[],b=this.currentGlobalDefines().concat(x),M=jt.cacheKey(r,b,c);return this.cache[M]||(this.cache[M]=new jt(this.context,r,Io[r],c,yl[r],b)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(r){this.terrain&&this.terrain.prepareDrawTile(r)}prepareDrawProgram(r,c,p){if(this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const b=x.getOpacity(this.transform.pitch);0!==b&&c.setFogUniformValues(r,((M,z,j,Q)=>{const re=z.properties.get("color"),oe=M.frameCounter/1e3%1,le=[re.r/re.a,re.g/re.a,re.b/re.a,Q];return{u_fog_matrix:j?M.transform.calculateFogTileMatrix(j):M.identityMat,u_fog_range:z.getFovAdjustedRange(M.transform._fov),u_fog_color:le,u_fog_horizon_blend:z.properties.get("horizon-blend"),u_fog_temporal_offset:oe}})(this,x,p,b))}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}}class Pa{constructor(r=0,c=0,p=0,x=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=p,this.right=x}interpolate(r,c,p){return null!=c.top&&null!=r.top&&(this.top=u.number(r.top,c.top,p)),null!=c.bottom&&null!=r.bottom&&(this.bottom=u.number(r.bottom,c.bottom,p)),null!=c.left&&null!=r.left&&(this.left=u.number(r.left,c.left,p)),null!=c.right&&null!=r.right&&(this.right=u.number(r.right,c.right,p)),this}getCenter(r,c){const p=u.clamp((this.left+r-this.right)/2,0,r),x=u.clamp((this.top+c-this.bottom)/2,0,c);return new u.pointGeometry(p,x)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Pa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ds(f,r){return[f[4*r],f[4*r+1],f[4*r+2],f[4*r+3]]}function ql(f,r,c){f[4*r+0]=c[0],f[4*r+1]=c[1],f[4*r+2]=c[2],f[4*r+3]=c[3]}function _a(f,r){const c=Ds(f,3);u.fromQuat(f,r),ql(f,3,c)}function nl(f,r){ql(f,3,[r[0],r[1],r[2],1])}function Lo(f,r){const c=u.identity$1([]);return u.rotateZ$1(c,c,-r),u.rotateX$1(c,c,-f),c}function Ra(f,r){const c=[f[0],f[1],0],p=[r[0],r[1],0];if(u.length(c)>=1e-15){const M=u.normalize([],c);u.scale(p,M,u.dot(p,M)),r[0]=p[0],r[1]=p[1]}const x=u.cross([],r,f);if(u.len(x)<1e-15)return null;const b=Math.atan2(-x[1],x[0]);return Lo(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),b)}class rl{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){this._position=this._renderWorldCopies?function(c){if(!c)return;const p=Array.isArray(c)?new u.MercatorCoordinate(c[0],c[1],c[2]):c;return p.x=u.wrap(p.x,0,1),p}(r):r}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(r)):0,x=this.position,b=u.MercatorCoordinate.fromLngLat(r,p),M=[b.x-x.x,b.y-x.y,b.z-x.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Ra(M,c)}setPitchBearing(r,c){this.orientation=Lo(u.degToRad(r),u.degToRad(-c))}}class bl{constructor(r,c){this._transform=u.identity([]),this._orientation=u.identity$1([]),c&&(this._orientation=c,_a(this._transform,this._orientation)),r&&nl(this._transform,r)}get mercatorPosition(){const r=this.position;return new u.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=Ds(this._transform,3);return[r[0],r[1],r[2]]}set position(r){nl(this._transform,r)}get orientation(){return this._orientation}set orientation(r){this._orientation=r,_a(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=Lo(r,c),_a(this._transform,this._orientation)}forward(){const r=Ds(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=Ds(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=Ds(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const p=new Float64Array(16);return u.invert(p,this.getWorldToCamera(r,c)),p}getWorldToCameraPosition(r,c,p){const x=this.position;u.scale(x,x,-r);const b=new Float64Array(16);return u.fromScaling(b,[p,p,p]),u.translate(b,b,x),b[10]*=c,b}getWorldToCamera(r,c){const p=new Float64Array(16),x=new Float64Array(4),b=this.position;return u.conjugate(x,this._orientation),u.scale(b,b,-r),u.fromQuat(p,x),u.translate(p,p,b),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(r,c,p,x){const b=new Float64Array(16);return u.perspective(b,r,c,p,x),b}getDistanceToElevation(r){const c=0===r?0:u.mercatorZfromAltitude(r,this.position[1]),p=this.forward();return(c-this.position[2])/p[2]}clone(){return new bl([...this.position],[...this.orientation])}}class ka{constructor(r,c,p,x,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===b||b,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=null==p?0:p,this._maxPitch=null==x?60:x,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Pa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._camera=new bl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._horizonShift=.1}clone(){const r=new ka(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r.tileSize=this.tileSize,r.latRange=this.latRange,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._cameraZoom=this._cameraZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,r?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(r){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),r&&this._constrainCameraAltitude(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(1,this.center.lat)*this.cameraWorldSize}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const c=-u.wrap(r,-180,180)*Math.PI/180;var p,x,b,M,z,j,Q,re,oe,le;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(p=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),x=this.rotationMatrix,M=this.angle,z=(b=this.rotationMatrix)[0],j=b[1],Q=b[2],re=b[3],oe=Math.sin(M),le=Math.cos(M),x[0]=z*le+Q*oe,x[1]=j*le+re*oe,x[2]=z*-oe+Q*le,x[3]=j*-oe+re*le)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=u.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const r=this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(this.center),-1);return-1===r?(this._cameraZoom=null,!1):(this._centerAltitude=r,!0)}_updateCameraOnTerrain(){const r=this.cameraToCenterDistance/this.worldSize,c=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(c+r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,b=0;for(let M=0;M<c.length;M++){const z=new u.pointGeometry(c[M][0]*this.width,p+c[M][1]*(this.height-p)),j=r.pointCoordinate(z);if(!j)continue;const Q=1/Math.hypot(j[0]-this._camera.position[0],j[1]-this._camera.position[1]);x+=j[3]*Q,b+=Q}return 0===b?NaN:x/b}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const r=this._cameraZoom,c=this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(this.center)),p=u.mercatorZfromAltitude(c,this.center.lat),x=this._mercatorZfromZoom(r),b=this._mercatorZfromZoom(this._maxZoom),M=Math.max(x-p,b);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let p;p=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const x=u.length(u.sub([],this._camera.position,p));return u.clamp(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!u.exactEquals(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const p=[r.position.x,r.position.y,r.position.z];u.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new rl;return c.position=new u.MercatorCoordinate(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this._renderWorldCopies,c}_setCameraOrientation(r){if(!u.length$1(r))return!1;u.normalize$1(r,r);const c=u.transformQuat([],[0,0,-1],r),p=u.transformQuat([],[0,-1,0],r);if(p[2]<0)return!1;const x=Ra(c,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;r[2]=u.clamp(r[2],x/p,x/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,p){this._unmodified=!1,this._edgeInsets.interpolate(r,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new u.UnwrappedTileID(0,r)];if(this._renderWorldCopies){const p=this.pointCoordinate(new u.pointGeometry(0,0)),x=this.pointCoordinate(new u.pointGeometry(this.width,0)),b=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),M=this.pointCoordinate(new u.pointGeometry(0,this.height)),z=Math.floor(Math.min(p.x,x.x,b.x,M.x)),j=Math.floor(Math.max(p.x,x.x,b.x,M.x)),Q=1;for(let re=z-Q;re<=j+Q;re++)0!==re&&c.push(new u.UnwrappedTileID(re,r))}return c}coveringTiles(r){let c=this.coveringZoomLevel(r);const p=c,x=this.elevation&&!r.isTerrainDEM;if(void 0!==r.minzoom&&c<r.minzoom)return[];void 0!==r.maxzoom&&c>r.maxzoom&&(c=r.maxzoom);const b=u.MercatorCoordinate.fromLngLat(this.center),M=1<<c,z=[M*b.x,M*b.y,0],j=lt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c),Q=this.pointCoordinate(this.getCameraPoint()),re=M*u.mercatorZfromAltitude(1,this.center.lat),oe=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),le=[M*Q.x,M*Q.y,oe],pe=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),Ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?c:0,Ie=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,qe=r.isTerrainDEM?-Ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=dt=>({aabb:new Ot([dt*M,0,qe],[(dt+1)*M,M,Ie]),zoom:0,x:0,y:0,wrap:dt,fullyVisible:!1}),Re=[];let $e=[];const We=c,it=r.reparseOverscaled?p:c,Fe=dt=>{if(!this._elevation||!dt.tileID)return;const At=this._elevation.getMinMaxForTile(dt.tileID),on=dt.aabb;At?(on.min[2]=At.min,on.max[2]=At.max,on.center[2]=(on.min[2]+on.max[2])/2):(dt.shouldSplit=Ut(dt),dt.shouldSplit||(on.min[2]=on.max[2]=on.center[2]=this._centerAltitude))},pt=dt=>dt*dt,Rt=pt((oe-this._centerAltitude)*re),Ut=dt=>{if(dt.zoom<Ae)return!0;if(dt.zoom===We)return!1;if(null!=dt.shouldSplit)return dt.shouldSplit;const At=dt.aabb.distanceX(le),on=dt.aabb.distanceY(le);let Cn=Rt;x&&(Cn=pt(dt.aabb.distanceZ(le)*re));const vn=At*At+on*on+Cn;return vn<pt((1<<We-dt.zoom)*pe*((rn,Dn)=>{if(Dn*pt(.707)<rn)return 1;const Er=Math.sqrt(Dn/rn);return Er/(1.4144271570014144+(Math.pow(1.1,Er-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Cn,Rt),vn))};if(this._renderWorldCopies)for(let dt=1;dt<=3;dt++)Re.push(be(-dt)),Re.push(be(dt));for(Re.push(be(0));Re.length>0;){const dt=Re.pop(),At=dt.x,on=dt.y;let Cn=dt.fullyVisible;if(!Cn){const vn=dt.aabb.intersects(j);if(0===vn)continue;Cn=2===vn}if(dt.zoom!==We&&Ut(dt))for(let vn=0;vn<4;vn++){const rn=(At<<1)+vn%2,Dn=(on<<1)+(vn>>1),Er={aabb:dt.aabb.quadrant(vn),zoom:dt.zoom+1,x:rn,y:Dn,wrap:dt.wrap,fullyVisible:Cn,tileID:void 0,shouldSplit:void 0};x&&(Er.tileID=new u.OverscaledTileID(dt.zoom+1===We?it:dt.zoom+1,dt.wrap,dt.zoom+1,rn,Dn),Fe(Er)),Re.push(Er)}else{const vn=dt.zoom===We?it:dt.zoom;if(r.minzoom&&r.minzoom>vn)continue;const rn=z[0]-(.5+At+(dt.wrap<<dt.zoom))*(1<<c-dt.zoom),Dn=z[1]-.5-on,Er=dt.tileID?dt.tileID:new u.OverscaledTileID(vn,dt.wrap,dt.zoom,At,on);$e.push({tileID:Er,distanceSq:rn*rn+Dn*Dn})}}if(this.fogCullDistSq){const dt=this.fogCullDistSq,At=this.horizonLineFromTop();$e=$e.filter(on=>{const Cn=[0,0,0,1],vn=[u.EXTENT,u.EXTENT,0,1],rn=this.calculateFogTileMatrix(on.tileID.toUnwrapped());u.transformMat4(Cn,Cn,rn),u.transformMat4(vn,vn,rn);const Dn=u.getAABBPointSquareDist(Cn,vn);if(0===Dn)return!0;let Er=!1;const Qn=this._elevation;if(Qn&&Dn>dt&&0!==At){const zi=this.calculateProjMatrix(on.tileID.toUnwrapped());let wi;r.isTerrainDEM||(wi=Qn.getMinMaxForTile(on.tileID)),wi||(wi={min:qe,max:Ie});const _r=u.furthestTileCorner(this.bearing),fr=[_r[0]*u.EXTENT,_r[1]*u.EXTENT,wi.max];u.transformMat4$1(fr,fr,zi),Er=(1-fr[1])*this.height*.5<At}return Dn<dt||Er})}return $e.sort((dt,At)=>dt.distanceSq-At.distanceSq).map(dt=>dt.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=u.clamp(r.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.pointGeometry(u.mercatorXfromLng(r.lng)*this.worldSize,u.mercatorYfromLat(c)*this.worldSize)}unproject(r){return new u.MercatorCoordinate(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}setLocationAtPoint(r,c){const p=this.pointCoordinate(c),x=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(r),M=new u.MercatorCoordinate(b.x-(p.x-x.x),b.y-(p.y-x.y));this.center=this.coordinateLocation(M),this._renderWorldCopies&&(this.center=this.center.wrap())}setLocation(r){this.center=this.coordinateLocation(r),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r){return this._coordinatePoint(this.locationCoordinate(r),!1)}locationPoint3D(r){return this._coordinatePoint(this.locationCoordinate(r),!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r){return u.MercatorCoordinate.fromLngLat(r)}coordinateLocation(r){return r.toLngLat()}pointRayIntersection(r,c){const p=null!=c?c:this._centerAltitude,x=[r.x,r.y,0,1],b=[r.x,r.y,1,1];u.transformMat4(x,x,this.pixelMatrixInverse),u.transformMat4(b,b,this.pixelMatrixInverse);const M=b[3];u.scale$2(x,x,1/x[3]),u.scale$2(b,b,1/M);const z=x[2],j=b[2];return{p0:x,p1:b,t:z===j?0:(p-z)/(j-z)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],p=[r.x,r.y,1,1];return u.transformMat4(c,c,this.pixelMatrixInverse),u.transformMat4(p,p,this.pixelMatrixInverse),u.scale$2(c,c,1/c[3]),u.scale$2(p,p,1/p[3]),c[2]=u.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,p[2]=u.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,u.scale$2(c,c,1/this.worldSize),u.scale$2(p,p,1/this.worldSize),new ke([c[0],c[1],c[2]],u.normalize([],u.sub([],p,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:p,t:x}=r,b=u.mercatorZfromAltitude(c[2],this._center.lat),M=u.mercatorZfromAltitude(p[2],this._center.lat);return new u.MercatorCoordinate(u.number(c[0],p[0],x)/this.worldSize,u.number(c[1],p[1],x)/this.worldSize,u.number(b,M,x))}pointCoordinate(r,c=this._centerAltitude){const p=this.horizonLineFromTop(!1),x=new u.pointGeometry(r.x,Math.max(p,r.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(x,c))}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);const c=this.elevation;let p=this.elevation.pointCoordinate(r);if(p)return new u.MercatorCoordinate(p[0],p[1],p[2]);let x=0,b=this.horizonLineFromTop();if(r.y>b)return this.pointCoordinate(r);const M=.02*b,z=r.clone();for(let j=0;j<10&&b-x>M;j++){z.y=u.number(x,b,.66);const Q=c.pointCoordinate(z);Q?(b=z.y,p=Q):x=z.y}return p?new u.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){if(this.elevation)return!this.elevation.pointCoordinate(r);{const c=this.horizonLineFromTop();return r.y<c}}_coordinatePoint(r,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,x=[r.x*this.worldSize,r.y*this.worldSize,p+r.toAltitude(),1];return u.transformMat4(x,x,this.pixelMatrix),x[3]>0?new u.pointGeometry(x[0]/x[3],x[1]/x[3]):new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(r,c){const p=new u.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),x=new u.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new u.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),M=new u.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let z=this.pointCoordinate(p,r),j=this.pointCoordinate(x,r);const Q=this.pointCoordinate(b,c),re=this.pointCoordinate(M,c),oe=(le,pe)=>(pe.y-le.y)/(pe.x-le.x);return z.y>1&&j.y>=0?z=new u.MercatorCoordinate((1-re.y)/oe(re,z)+re.x,1):z.y<0&&j.y<=1&&(z=new u.MercatorCoordinate(-re.y/oe(re,z)+re.x,0)),j.y>1&&z.y>=0?j=new u.MercatorCoordinate((1-Q.y)/oe(Q,j)+Q.x,1):j.y<0&&z.y<=1&&(j=new u.MercatorCoordinate(-Q.y/oe(Q,j)+Q.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(Q))}_getBounds3D(){const r=this.elevation,c=r.visibleDemTiles.reduce((p,x)=>{if(x.dem){const b=x.dem.tree;p.min=Math.min(p.min,b.minimums[0]),p.max=Math.max(p.max,b.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,p):p}getMaxBounds(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new u.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}setMaxBounds(r){if(r){const c=r.getEast(),p=r.getWest();this.lngRange=[p,c>p?c:c+360],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()}else this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude]}calculatePosMatrix(r,c){const p=r.canonical,x=c/this.zoomScale(p.z),b=p.x+Math.pow(2,p.z)*r.wrap,M=u.identity(new Float64Array(16));return u.translate(M,M,[b*x,p.y*x,0]),u.scale$1(M,M,[x/u.EXTENT,x/u.EXTENT,1]),M}calculateFogTileMatrix(r){const c=r.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const x=this.calculatePosMatrix(r,this.cameraWorldSize);return u.multiply(x,this.worldToFogMatrix,x),p[c]=new Float32Array(x),p[c]}calculateProjMatrix(r,c=!1){const p=r.key,x=c?this._alignedProjMatrixCache:this._projMatrixCache;if(x[p])return x[p];const b=this.calculatePosMatrix(r,this.worldSize);return u.multiply(b,c?this.alignedProjMatrix:this.projMatrix,b),x[p]=new Float32Array(b),x[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const c=this._camera.position,p=this._camera.forward();if(c[2]<=0||p[2]>=0)return;const x=u.mercatorZfromAltitude(1,this._center.lat);c[2]/=x,p[2]/=x,u.normalize(p,p);const b=r.raycast(c,p,r.exaggeration());if(b){const M=u.scaleAndAdd([],c,p,b),z=new u.MercatorCoordinate(M[0],M[1],u.mercatorZfromAltitude(M[2],u.latFromMercatorY(M[1]))),j=this._camera.position,Q=z.z+u.length([z.x-j[0],z.y-j[1],z.z-j[2]]);this._cameraZoom=this._zoomFromMercatorZ(Q),this._centerAltitude=z.toAltitude(),this._center=z.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const r=this._elevation;this._updateCameraState();const c=r.getAtPointOrZero(this._camera.mercatorPosition),p=this._minimumHeightOverTerrain()*Math.cos(u.degToRad(this._maxPitch)),x=u.mercatorZfromAltitude(c,this._center.lat),b=this._camera.position[2]-x;if(b<p){const M=u.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),z=this._camera.mercatorPosition,j=[M.x-z.x,M.y-z.y,M.z-z.z],Q=u.length(j);j[2]-=p-b;const re=u.length(j);if(0===re)return;u.scale(j,j,Q/re),this._camera.position=[M.x-j[0],M.y-j[1],M.z-j[2]],this._camera.orientation=Ra(j,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let r,c,p,x,b,M=1/0,z=-1/0;const j=this.size,Q=this._unmodified;if(this.latRange){const pe=this.latRange;M=u.mercatorYfromLat(pe[1])*this.worldSize,z=u.mercatorYfromLat(pe[0])*this.worldSize,p=z-M<j.y?j.y/(z-M):0}if(this.lngRange){const pe=this.lngRange;r=u.mercatorXfromLng(pe[0])*this.worldSize,c=u.mercatorXfromLng(pe[1])*this.worldSize,x=c-r<j.x?j.x/(c-r):0}const re=this.point,oe=Math.max(x||0,p||0);if(oe)return this.center=this.unproject(new u.pointGeometry(x?(c+r)/2:re.x,p?(z+M)/2:re.y)),this.zoom+=this.scaleZoom(oe),this._unmodified=Q,void(this._constraining=!1);if(this.latRange){const pe=re.y,Ae=j.y/2;pe-Ae<M&&(b=M+Ae),pe+Ae>z&&(b=z-Ae)}let le=re.x;if(this.lngRange){const pe=this.worldSize/2-(r+c)/2;le=(le+pe+this.worldSize)%this.worldSize,r+=pe,c+=pe;const Ae=j.x/2;le-Ae<r&&(le=r+Ae),le+Ae>c&&(le=c-Ae),le-=pe}le===re.x&&void 0===b||(this.center=this.unproject(new u.pointGeometry(le,void 0!==b?b:re.y))),this._constrainCameraAltitude(),this._unmodified=Q,this._constraining=!1}_minZoomForBounds(){const r=(x,b)=>Math.log2(x/(this.tileSize*Math.abs(b[1]-b[0])));let c=0;if(this.latRange){const x=this.latRange;c=r(this.height,[u.mercatorYfromLat(x[0]),u.mercatorYfromLat(x[1])])}let p=0;if(this.lngRange){const x=this.lngRange;p=r(this.width,[u.mercatorXfromLng(x[0]),u.mercatorXfromLng(x[1])])}return Math.max(c,p)}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;const c=this.pixelsPerMeter;this._updateCameraState();const p=Math.PI/2+this._pitch,x=this.fovAboveCenter,b=this.elevation?this.elevation.getMinElevationBelowMSL()*c:0,M=(this._camera.position[2]*this.worldSize-b)/Math.cos(this._pitch),z=Math.sin(x)*M/Math.sin(u.clamp(Math.PI-p-x,.01,Math.PI-.01)),j=this.point,Q=j.x,re=j.y,oe=Math.cos(Math.PI/2-this._pitch)*z+M,le=Math.min(1.01*oe,M*(1/this._horizonShift)),pe=this.height/50,Ae=this._camera.getWorldToCamera(this.worldSize,c),Ie=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,pe,le);Ie[8]=2*-r.x/this.width,Ie[9]=2*r.y/this.height;let qe=u.mul$1([],Ie,Ae);this.mercatorMatrix=u.scale$1([],qe,[this.worldSize,this.worldSize,this.worldSize/c]),this.projMatrix=qe,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const be=new Float32Array(16);u.identity(be),u.scale$1(be,be,[1,-1,1]),u.rotateX(be,be,this._pitch),u.rotateZ(be,be,this.angle);const Re=u.perspective(new Float32Array(16),this._fov,this.width/this.height,pe,le),$e=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Re[8]=2*-r.x/this.width,Re[9]=2*(r.y+$e)/this.height,this.skyboxMatrix=u.multiply(be,Re,be);const We=this.width%2/2,it=this.height%2/2,Fe=Math.cos(this.angle),pt=Math.sin(this.angle),Rt=Q-Math.round(Q)+Fe*We+pt*it,Ut=re-Math.round(re)+Fe*it+pt*We,dt=new Float64Array(qe);if(u.translate(dt,dt,[Rt>.5?Rt-1:Rt,Ut>.5?Ut-1:Ut,0]),this.alignedProjMatrix=dt,qe=u.create$1(),u.scale$1(qe,qe,[this.width/2,-this.height/2,1]),u.translate(qe,qe,[1,-1,0]),this.labelPlaneMatrix=qe,qe=u.create$1(),u.scale$1(qe,qe,[1,-1,1]),u.translate(qe,qe,[-1,-1,0]),u.scale$1(qe,qe,[2/this.width,2/this.height,1]),this.glCoordMatrix=qe,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),qe=u.invert(new Float64Array(16),this.pixelMatrix),!qe)throw new Error("failed to invert matrix");this.pixelMatrixInverse=qe,this._projMatrixCache={},this._alignedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSize,c=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height,b=[r,r,c];u.scale(b,b,x),u.scale(p,p,-1),u.multiply$1(p,p,b);const M=u.create$1();u.translate(M,M,p),u.scale$1(M,M,b),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,x)}_updateCameraState(){if(!this.height)return;this._camera.setPitchBearing(this._pitch,this.angle);const r=this._camera.forward(),c=this.cameraToCenterDistance,p=this.point,x=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-u.mercatorZfromAltitude(this._centerAltitude,this.center.lat),b=this.cameraToCenterDistance/x;this._camera.position=[p.x/this.worldSize-r[0]*c/b,p.y/this.worldSize-r[1]*c/b,u.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-r[2]*c/b]}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=r[2];let x=1;p>0&&(x=Math.min((c-this._camera.position[2])/p,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,r,x),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),b=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat),M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),z=Math.max((r[2]-b)/Math.cos(p),M),j=this._zoomFromMercatorZ(z);u.scaleAndAdd(r,r,c,z),this._pitch=u.clamp(p,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(x,-Math.PI,Math.PI),this._setZoom(u.clamp(j,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new u.MercatorCoordinate(r[0],r[1],r[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}_terrainEnabled(){return!!this._elevation}isCornerOffEdge(r,c){const p=Math.min(r.x,c.x),x=Math.max(r.x,c.x),b=Math.min(r.y,c.y),M=Math.max(r.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;const z=[new u.pointGeometry(p,b),new u.pointGeometry(x,M),new u.pointGeometry(p,M),new u.pointGeometry(x,b)],j=this._renderWorldCopies?-3:0,Q=this._renderWorldCopies?4:1;for(const re of z){const oe=this.pointRayIntersection(re);if(oe.t<0)return!0;const le=this.rayIntersectionCoordinate(oe);if(le.x<j||le.y<0||le.x>Q||le.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.isCornerOffEdge(new u.pointGeometry(0,0),new u.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,c){const p=u.length(u.sub([],this._camera.position,r)),x=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(x)}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,r))}}function vc(f,r){let c=!1,p=null;const x=()=>{p=null,c&&(f(),p=setTimeout(x,r),c=!1)};return()=>(c=!0,p||x(),p)}class rs{constructor(r){this._hashName=r&&encodeURIComponent(r),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=vc(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,u.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return u.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const c=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,x),M=Math.round(c.lng*b)/b,z=Math.round(c.lat*b)/b,j=this._map.getBearing(),Q=this._map.getPitch();let re="";if(re+=r?`/${M}/${z}/${p}`:`${p}/${z}/${M}`,(j||Q)&&(re+="/"+Math.round(10*j)/10),Q&&(re+=`/${Math.round(Q)}`),this._hashName){const oe=this._hashName;let le=!1;const pe=u.window.location.hash.slice(1).split("&").map(Ae=>{const Ie=Ae.split("=")[0];return Ie===oe?(le=!0,`${Ie}=${re}`):Ae}).filter(Ae=>Ae);return le||pe.push(`${oe}=${re}`),`#${pe.join("&")}`}return`#${re}`}_getCurrentHash(){const r=u.window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(c=p)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._getCurrentHash();if(r.length>=3&&!r.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(r[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:c,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,r)}}const Os={linearity:.3,easing:u.bezier(0,0,.3,1)},bi=u.extend({deceleration:2500,maxSpeed:1400},Os),xc=u.extend({deceleration:20,maxSpeed:1400},Os),Oc=u.extend({deceleration:1e3,maxSpeed:360},Os),wl=u.extend({deceleration:1e3,maxSpeed:90},Os);class Wl{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=u.exported.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const b=El(c.pan.mag(),p,u.extend({},bi,r||{}));x.offset=c.pan.mult(b.amount/c.pan.mag()),x.center=this._map.transform.center,Oa(x,b)}if(c.zoom){const b=El(c.zoom,p,xc);x.zoom=this._map.transform.zoom+b.amount,Oa(x,b)}if(c.bearing){const b=El(c.bearing,p,Oc);x.bearing=this._map.transform.bearing+u.clamp(b.amount,-179,179),Oa(x,b)}if(c.pitch){const b=El(c.pitch,p,wl);x.pitch=this._map.transform.pitch+b.amount,Oa(x,b)}if(x.zoom||x.bearing){const b=void 0===c.pinchAround?c.around:c.pinchAround;x.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),u.extend(x,{noMoveStart:!0})}}function Oa(f,r){(!f.duration||f.duration<r.duration)&&(f.duration=r.duration,f.easing=r.easing)}function El(f,r,c){const{maxSpeed:p,linearity:x,deceleration:b}=c,M=u.clamp(f*x/(r/1e3),-p,p),z=Math.abs(M)/(b*x);return{easing:c.easing,duration:1e3*z,amount:M*(z/2)}}class ms extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p,x={}){const b=ae.mousePos(c.getCanvasContainer(),p),M=c.unproject(b);super(r,u.extend({point:b,lngLat:M,originalEvent:p},x)),this._defaultPrevented=!1,this.target=c}}class Xo extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){const x="touchend"===r?p.changedTouches:p.touches,b=ae.touchPos(c.getCanvasContainer(),x),M=b.map(j=>c.unproject(j)),z=b.reduce((j,Q,re,oe)=>j.add(Q.div(oe.length)),new u.pointGeometry(0,0));super(r,{points:b,point:z,lngLats:M,lngLat:c.unproject(z),originalEvent:p}),this._defaultPrevented=!1}}class Fa extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class $i{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Fa(r.type,this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new ms(r.type,this._map,r))}mouseup(r){this._map.fire(new ms(r.type,this._map,r))}preclick(r){const c=u.extend({},r);c.type="preclick",this._map.fire(new ms(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new ms(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new ms(r.type,this._map,r))}mouseover(r){this._map.fire(new ms(r.type,this._map,r))}mouseout(r){this._map.fire(new ms(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Xo(r.type,this._map,r))}touchmove(r){this._map.fire(new Xo(r.type,this._map,r))}touchend(r){this._map.fire(new Xo(r.type,this._map,r))}touchcancel(r){this._map.fire(new Xo(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cl{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(r){this._map.fire(new ms(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new ms(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xo{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&0===r.button&&(ae.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const p=c;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const x=this._startPos;this._lastPos=p,this._box||(this._box=ae.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const b=Math.min(x.x,p.x),M=Math.max(x.x,p.x),z=Math.min(x.y,p.y),j=Math.max(x.y,p.y);this._map._requestDomTask(()=>{this._box&&(ae.setTransform(this._box,`translate(${b}px,${z}px)`),this._box.style.width=M-b+"px",this._box.style.height=j-z+"px")})}mouseupWindow(r,c){if(!this._active||0!==r.button)return;const p=this._startPos,x=c;if(this.reset(),ae.suppressClick(),p.x!==x.x||p.y!==x.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:b=>b.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(ae.remove(this._box),this._box=null),ae.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new u.Event(r,{originalEvent:c}))}}function Ks(f,r){const c={};for(let p=0;p<f.length;p++)c[f[p].identifier]=r[p];return c}class il{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(x){const b=new u.pointGeometry(0,0);for(const M of x)b._add(M);return b.div(x.length)}(c),this.touches=Ks(p,c)))}touchmove(r,c,p){if(this.aborted||!this.centroid)return;const x=Ks(p,c);for(const b in this.touches){const M=this.touches[b],z=x[b];(!z||z.dist(M)>30)&&(this.aborted=!0)}}touchend(r,c,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class Yl{constructor(r){this.singleTap=new il(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,c,p){this.singleTap.touchstart(r,c,p)}touchmove(r,c,p){this.singleTap.touchmove(r,c,p)}touchend(r,c,p){const x=this.singleTap.touchend(r,c,p);if(x){const b=r.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(x)<30;if(b&&M||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class Kl{constructor(){this._zoomIn=new Yl({numTouches:1,numTaps:2}),this._zoomOut=new Yl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,p){this._zoomIn.touchstart(r,c,p),this._zoomOut.touchstart(r,c,p)}touchmove(r,c,p){this._zoomIn.touchmove(r,c,p),this._zoomOut.touchmove(r,c,p)}touchend(r,c,p){const x=this._zoomIn.touchend(r,c,p),b=this._zoomOut.touchend(r,c,p);return x?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(x)},{originalEvent:r})}):b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(b)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Gi={0:1,2:2};class Tl{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const p=ae.mouseButton(r);this._correctButton(r,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(r,c){const p=this._lastPoint;if(p)if(r.preventDefault(),function(x,b){const M=Gi[b];return void 0===x.buttons||(x.buttons&M)!==M}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}mouseupWindow(r){this._lastPoint&&ae.mouseButton(r)===this._eventButton&&(this._moved&&ae.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ho extends Tl{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return 0===c&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class gs extends Tl{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const p=.8*(c.x-r.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(r){r.preventDefault()}}class Qo extends Tl{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const p=-.5*(c.y-r.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(r){r.preventDefault()}}class Jo{constructor(r){this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0)}touchstart(r,c,p){return this._calculateTransform(r,c,p)}touchmove(r,c,p){if(this._active&&!(p.length<this._minTouches))return r.preventDefault(),this._calculateTransform(r,c,p)}touchend(r,c,p){this._calculateTransform(r,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,p){p.length>0&&(this._active=!0);const x=Ks(p,c),b=new u.pointGeometry(0,0),M=new u.pointGeometry(0,0);let z=0;for(const Q in x){const re=x[Q],oe=this._touches[Q];oe&&(b._add(re),M._add(re.sub(oe)),z++,x[Q]=re)}if(this._touches=x,z<this._minTouches||!M.mag())return;const j=M.div(z);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(z),panDelta:j}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class No{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(r){}_move(r,c,p){return{}}touchstart(r,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,p){if(!this._firstTwoTouches)return;r.preventDefault();const[x,b]=this._firstTwoTouches,M=zo(p,c,x),z=zo(p,c,b);if(!M||!z)return;const j=this._aroundCenter?null:M.add(z).div(2);return this._move([M,z],j,r)}touchend(r,c,p){if(!this._firstTwoTouches)return;const[x,b]=this._firstTwoTouches,M=zo(p,c,x),z=zo(p,c,b);M&&z||(this._active&&ae.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zo(f,r,c){for(let p=0;p<f.length;p++)if(f[p].identifier===c)return r[p]}function ya(f,r){return Math.log(f/r)/Math.LN2}class Fs extends No{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(ya(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ya(this._distance,p),pinchAround:c}}}function ea(f,r){return 180*f.angleWith(r)/Math.PI}class va extends No{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const p=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ea(this._vector,p),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,p=ea(r,this._startVector);return Math.abs(p)<c}}function _s(f){return Math.abs(f.y)>Math.abs(f.x)}class Xl extends No{reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(r){this._lastPoints=r,_s(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,p){const x=r[0].sub(this._lastPoints[0]),b=r[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(x,b,p.timeStamp),this._valid)return this._lastPoints=r,this._active=!0,{pitchDelta:(x.y+b.y)/2*-.5}}gestureBeginsVertically(r,c,p){if(void 0!==this._valid)return this._valid;const x=r.mag()>=2,b=c.mag()>=2;if(!x&&!b)return;if(!x||!b)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const M=r.y>0==c.y>0;return _s(r)&&_s(c)&&M}}const La={panStep:100,bearingStep:15,pitchStep:10};class ta{constructor(){const r=La;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,p=0,x=0,b=0,M=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),b=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),b=1);break;case 38:r.shiftKey?x=1:(r.preventDefault(),M=-1);break;case 40:r.shiftKey?x=-1:(r.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:z=>{const j=z.getZoom();z.easeTo({duration:300,easeId:"keyboardHandler",easing:yn,zoom:c?Math.round(j)+c*(r.shiftKey?2:1):j,bearing:z.getBearing()+p*this._bearingStep,pitch:z.getPitch()+x*this._pitchStep,offset:[-b*this._panStep,-M*this._panStep],center:z.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yn(f){return f*(2-f)}const Sl=4.000244140625;class Fc{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=r&&"center"===r.around)}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled())return;let c=r.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=u.exported.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==c&&c%Sl==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=ae.mousePos(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform,c=()=>r._terrainEnabled()?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const j="wheel"===this._type&&Math.abs(this._delta)>Sl?this._wheelZoomRate:this._defaultZoomRate;let Q=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&0!==Q&&(Q=1/Q);const re=c(),oe=Math.pow(2,re),le="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):oe;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(le*Q))),"wheel"===this._type&&(this._startZoom=c(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:c(),x=this._startZoom,b=this._easing;let M,z=!1;if("wheel"===this._type&&x&&b){const j=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),Q=b(j);M=u.number(x,p,Q),j<1?this._frameId||(this._frameId=!0):z=!0}else M=p,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:M-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=u.ease;if(this._prevEase){const p=this._prevEase,x=(u.exported.now()-p.start)/p.duration,b=p.easing(x+.01)-p.easing(x),M=.27/Math.sqrt(b*b+1e-4)*.01,z=Math.sqrt(.0729-M*M);c=u.bezier(M,z,.25,1)}return this._prevEase={start:u.exported.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}}class Bs{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class sl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(r.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lc{constructor(){this._tap=new Yl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(r,c,p){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(r,c,p))}touchmove(r,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=c[0],b=x.y-this._swipePoint.y;return this._swipePoint=x,r.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(r,c,p)}touchend(r,c,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(r,c,p)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Na{constructor(r,c,p){this._el=r,this._mousePan=c,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Dl{constructor(r,c,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ql{constructor(r,c,p,x){this._el=r,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const xa=f=>f.zoom||f.drag||f.pitch||f.rotate;class ol extends u.Event{}class Nc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const p=u.sub([],c,r);this.radius=u.length(p[2]<0?u.div([],p,this.constants):[p[0],p[1],0])}projectRay(r){u.div(r,r,this.constants),u.normalize(r,r),u.mul$2(r,r,this.constants);const c=u.scale([],r,this.radius);if(c[2]>0){const p=u.scale([],[0,0,1],u.dot(c,[0,0,1])),x=u.scale([],u.normalize([],[c[0],c[1],0]),this.radius),b=u.add([],c,u.scale([],u.sub([],u.add([],x,p),c),2));c[0]=b[0],c[1]=b[1]}return c}}function na(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class Al{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wl(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Nc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),u.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[x,b,M]of this._listeners)ae.addEventListener(x,b,x===u.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[r,c,p]of this._listeners)ae.removeEventListener(r,c,r===u.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new $i(c,r));const x=c.boxZoom=new xo(c,r);this._add("boxZoom",x);const b=new Kl,M=new sl;c.doubleClickZoom=new Bs(M,b),this._add("tapZoom",b),this._add("clickZoom",M);const z=new Lc;this._add("tapDragZoom",z);const j=c.touchPitch=new Xl;this._add("touchPitch",j);const Q=new gs(r),re=new Qo(r);c.dragRotate=new Dl(r,Q,re),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",re,["mouseRotate"]);const oe=new ho(r),le=new Jo(r);c.dragPan=new Na(p,oe,le),this._add("mousePan",oe),this._add("touchPan",le,["touchZoom","touchRotate"]);const pe=new va,Ae=new Fs;c.touchZoomRotate=new Ql(p,Ae,pe,z),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",Ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Cl(c));const Ie=c.scrollZoom=new Fc(c,this);this._add("scrollZoom",Ie,["mousePan"]);const qe=c.keyboard=new ta;this._add("keyboard",qe);for(const be of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[be]&&c[be].enable(r[be])}_add(r,c,p){this._handlers.push({handlerName:r,handler:c,allowed:p}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(xa(this._eventsInProgress))||this.isZooming()}_blockedByActive(r,c,p){for(const x in r)if(x!==p&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const p of r)this._el.contains(p.target)&&c.push(p);return c}handleEvent(r,c){this._updatingCamera=!0;const p="renderFrame"===r.type,x=p?void 0:r,b={needsRenderFrame:!1},M={},z={},j=r.touches?this._getMapTouches(r.touches):void 0,Q=j?ae.touchPos(this._el,j):p?void 0:ae.mousePos(this._el,r);for(const{handlerName:le,handler:pe,allowed:Ae}of this._handlers){if(!pe.isEnabled())continue;let Ie;this._blockedByActive(z,Ae,le)?pe.reset():pe[c||r.type]&&(Ie=pe[c||r.type](r,Q,j),this.mergeHandlerResult(b,M,Ie,le,x),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||pe.isActive())&&(z[le]=pe)}const re={};for(const le in this._previousActiveHandlers)z[le]||(re[le]=x);this._previousActiveHandlers=z,(Object.keys(re).length||na(b))&&(this._changes.push([b,M,re]),this._triggerRenderFrame()),(Object.keys(z).length||na(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:oe}=b;oe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],oe(this._map))}mergeHandlerResult(r,c,p,x,b){if(!p)return;u.extend(r,p);const M={handlerName:x,originalEvent:p.originalEvent||b};void 0!==p.zoomDelta&&(c.zoom=M),void 0!==p.panDelta&&(c.drag=M),void 0!==p.pitchDelta&&(c.pitch=M),void 0!==p.bearingDelta&&(c.rotate=M)}_applyChanges(){const r={},c={},p={};for(const[x,b,M]of this._changes)x.panDelta&&(r.panDelta=(r.panDelta||new u.pointGeometry(0,0))._add(x.panDelta)),x.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+x.pitchDelta),void 0!==x.around&&(r.around=x.around),void 0!==x.aroundCoord&&(r.aroundCoord=x.aroundCoord),void 0!==x.pinchAround&&(r.pinchAround=x.pinchAround),x.noInertia&&(r.noInertia=x.noInertia),u.extend(c,b),u.extend(p,M);this._updateMapTransform(r,c,p),this._changes=[]}_updateMapTransform(r,c,p){const x=this._map,b=x.transform,M=Re=>[Re.x,Re.y,Re.z];if((Re=>{const $e=this._eventsInProgress.drag;return $e&&!this._handlersById[$e.handlerName].isActive()})()&&!na(r)){const Re=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",Re!==b.zoom&&this._map._update(!0)}if(!na(r))return this._fireEvents(c,p,!0);let{panDelta:z,zoomDelta:j,bearingDelta:Q,pitchDelta:re,around:oe,aroundCoord:le,pinchAround:pe}=r;void 0!==pe&&(oe=pe),(Re=>c.drag&&!this._eventsInProgress.drag)()&&oe&&(this._dragOrigin=M(b.pointCoordinate3D(oe)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",x._stop(!0),oe=oe||x.transform.centerPoint,Q&&(b.bearing+=Q),re&&(b.pitch+=re),b._updateCameraState();const Ae=[0,0,0];if(z){const Re=b.screenPointToMercatorRay(oe),$e=b.screenPointToMercatorRay(oe.sub(z)),We=this._trackingEllipsoid.projectRay(Re.dir),it=this._trackingEllipsoid.projectRay($e.dir);Ae[0]=it[0]-We[0],Ae[1]=it[1]-We[1]}const Ie=b.zoom,qe=[0,0,0];if(j){const Re=M(le||b.pointCoordinate3D(oe)),$e={dir:u.normalize([],u.sub([],Re,b._camera.position))},We=b.screenPointToMercatorRay(b.centerPoint);if($e.dir[2]<0){const it=u.altitudeFromMercatorZ(Re[2],Re[1]),Fe=b.rayIntersectionCoordinate(b.pointRayIntersection(b.centerPoint,it)),pt=b.zoomDeltaToMovement(M(Fe),j)*(We.dir[2]/$e.dir[2]);u.scale(qe,$e.dir,pt)}else if(b._terrainEnabled()){const it=b.zoomDeltaToMovement(Re,j);u.scale(qe,$e.dir,it)}}const be=u.add(Ae,Ae,qe);b._translateCameraConstrained(be),j&&Math.abs(b.zoom-Ie)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,p,!0)}_fireEvents(r,c,p){const x=xa(this._eventsInProgress),b=xa(r),M={};for(const re in r){const{originalEvent:oe}=r[re];this._eventsInProgress[re]||(M[`${re}start`]=oe),this._eventsInProgress[re]=r[re]}!x&&b&&this._fireEvent("movestart",b.originalEvent);for(const re in M)this._fireEvent(re,M[re]);b&&this._fireEvent("move",b.originalEvent);for(const re in r){const{originalEvent:oe}=r[re];this._fireEvent(re,oe)}const z={};let j;for(const re in this._eventsInProgress){const{handlerName:oe,originalEvent:le}=this._eventsInProgress[re];this._handlersById[oe].isActive()||(delete this._eventsInProgress[re],j=c[oe]||le,z[`${re}end`]=j)}for(const re in z)this._fireEvent(re,z[re]);const Q=xa(this._eventsInProgress);if(p&&(x||b)&&!Q){this._updatingCamera=!0;const re=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),oe=le=>0!==le&&-this._bearingSnap<le&&le<this._bearingSnap;re?(oe(re.bearing||this._map.getBearing())&&(re.bearing=0),this._map.easeTo(re,{originalEvent:j})):(this._map.fire(new u.Event("moveend",{originalEvent:j})),oe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new u.Event(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new ol("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}class za extends u.Evented{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,p){return r=u.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,u.extend({offset:r},c),p)}panTo(r,c,p){return this.easeTo(u.extend({center:r},c),p)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,p){return this.easeTo(u.extend({zoom:r},c),p)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,p){return this.easeTo(u.extend({bearing:r},c),p)}resetNorth(r,c){return this.rotateTo(0,u.extend({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=u.LngLatBounds.convert(r);const p=c&&c.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,c)}_extendCameraOptions(r){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=u.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const p=r.padding;r.padding={top:p,bottom:p,right:p,left:p}}return r.padding=u.extend(c,r.padding),r}_cameraForBoxAndBearing(r,c,p,x){const b=this._extendCameraOptions(x),M=this.transform,z=M.padding,j=M.project(u.LngLat.convert(r)),Q=M.project(u.LngLat.convert(c)),re=j.rotate(-u.degToRad(p)),oe=Q.rotate(-u.degToRad(p)),le=new u.pointGeometry(Math.max(re.x,oe.x),Math.max(re.y,oe.y)),pe=new u.pointGeometry(Math.min(re.x,oe.x),Math.min(re.y,oe.y)),Ae=le.sub(pe),Ie=(M.width-(z.left+z.right+b.padding.left+b.padding.right))/Ae.x,qe=(M.height-(z.top+z.bottom+b.padding.top+b.padding.bottom))/Ae.y;if(qe<0||Ie<0)return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const be=Math.min(M.scaleZoom(M.scale*Math.min(Ie,qe)),b.maxZoom),Re="number"==typeof b.offset.x?new u.pointGeometry(b.offset.x,b.offset.y):u.pointGeometry.convert(b.offset),$e=new u.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(p*Math.PI/180),We=Re.add($e).mult(M.scale/M.zoomScale(be));return{center:M.unproject(j.add(Q).div(2).sub(We)),zoom:be,bearing:p}}_cameraForBox(r,c,p,x,b){const M=this._extendCameraOptions(b);p=p||0,x=x||0,r=u.LngLat.convert(r),c=u.LngLat.convert(c);const z=this.transform.clone();z.padding=M.padding;const j=this.getFreeCameraOptions(),Q=new u.LngLat(.5*(r.lng+c.lng),.5*(r.lat+c.lat)),re=.5*(p+x);if(z._camera.position[2]<u.mercatorZfromAltitude(re,Q.lat))return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");j.lookAtPoint(Q),z.setFreeCameraOptions(j);const oe=u.MercatorCoordinate.fromLngLat(r),le=u.MercatorCoordinate.fromLngLat(c),pe=z.pointRayIntersection(z.centerPoint,re),Ae=[(Ie=z.rayIntersectionCoordinate(pe)).x,Ie.y,Ie.z];var Ie;const qe=z.screenPointToMercatorRay(z.centerPoint);let be,Re=0;do{const $e=Math.floor(z.zoom),We=1<<$e,it=Math.min(We*oe.x,We*le.x),Fe=Math.min(We*oe.y,We*le.y),pt=Math.max(We*oe.x,We*le.x),Rt=Math.max(We*oe.y,We*le.y),Ut=new Ot([it,Fe,p],[pt,Rt,x]),dt=lt.fromInvProjectionMatrix(z.invProjMatrix,z.worldSize,$e);if(2!==Ut.intersects(dt)){be&&(z._camera.position=u.scaleAndAdd([],z._camera.position,qe.dir,-be),z._updateStateFromCamera());break}const At=u.sub([],z._camera.position,Ae);be=.5*u.length(At),z._camera.position=u.scaleAndAdd([],z._camera.position,qe.dir,be);try{z._updateStateFromCamera()}catch(on){return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++Re<10);return{center:z.center,zoom:z.zoom,bearing:z.bearing,pitch:z.pitch}}fitBounds(r,c,p){return this._fitInternal(this.cameraForBounds(r,c),c,p)}_raycastElevationBox(r,c){const p=this.transform.elevation;if(!p)return;const x=new u.pointGeometry(r.x,c.y),b=new u.pointGeometry(c.x,r.y),M=p.pointCoordinate(r);if(!M)return;const z=p.pointCoordinate(c);if(!z)return;const j=p.pointCoordinate(x);if(!j)return;const Q=p.pointCoordinate(b);if(!Q)return;const re=new u.MercatorCoordinate(M[0],M[1]).toLngLat(),oe=new u.MercatorCoordinate(z[0],z[1]).toLngLat(),le=new u.MercatorCoordinate(j[0],j[1]).toLngLat(),pe=new u.MercatorCoordinate(Q[0],Q[1]).toLngLat(),Ae=Math.min(re.lng,Math.min(oe.lng,Math.min(le.lng,pe.lng))),Ie=Math.min(re.lat,Math.min(oe.lat,Math.min(le.lat,pe.lat))),qe=Math.max(re.lng,Math.max(oe.lng,Math.max(le.lng,pe.lng))),be=Math.max(re.lat,Math.max(oe.lat,Math.max(le.lat,pe.lat))),Re=Math.min(M[3],Math.min(z[3],Math.min(j[3],Q[3]))),$e=Math.max(M[3],Math.max(z[3],Math.max(j[3],Q[3])));return{minLngLat:new u.LngLat(Ae,Ie),maxLngLat:new u.LngLat(qe,be),minAltitude:Re,maxAltitude:$e}}fitScreenCoordinates(r,c,p,x,b){let M,z,j,Q;const re=u.pointGeometry.convert(r),oe=u.pointGeometry.convert(c),le=this._raycastElevationBox(re,oe);if(le)M=le.minLngLat,z=le.maxLngLat,j=le.minAltitude,Q=le.maxAltitude;else{if(this.transform.isCornerOffEdge(re,oe))return this;M=this.transform.pointLocation(re),z=this.transform.pointLocation(oe)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(u.pointGeometry.convert(r)),this.transform.pointLocation(u.pointGeometry.convert(c)),p,x):this._cameraForBox(M,z,j,Q,x),x,b)}_fitInternal(r,c,p){return r?(delete(c=u.extend(r,c)).padding,c.linear?this.easeTo(c,p):this.flyTo(c,p)):this}jumpTo(r,c){this.stop();const p=this.transform;let x=!1,b=!1,M=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(x=!0,p.zoom=+r.zoom),void 0!==r.center&&(p.center=u.LngLat.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(b=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(M=!0,p.pitch=+r.pitch),null==r.padding||p.isPaddingEqual(r.padding)||(p.padding=r.padding),this.fire(new u.Event("movestart",c)).fire(new u.Event("move",c)),x&&this.fire(new u.Event("zoomstart",c)).fire(new u.Event("zoom",c)).fire(new u.Event("zoomend",c)),b&&this.fire(new u.Event("rotatestart",c)).fire(new u.Event("rotate",c)).fire(new u.Event("rotateend",c)),M&&this.fire(new u.Event("pitchstart",c)).fire(new u.Event("pitch",c)).fire(new u.Event("pitchend",c)),this.fire(new u.Event("moveend",c))}getFreeCameraOptions(){return this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){this.stop();const p=this.transform,x=p.zoom,b=p.pitch,M=p.bearing;p.setFreeCameraOptions(r);const z=x!==p.zoom,j=b!==p.pitch,Q=M!==p.bearing;return this.fire(new u.Event("movestart",c)).fire(new u.Event("move",c)),z&&this.fire(new u.Event("zoomstart",c)).fire(new u.Event("zoom",c)).fire(new u.Event("zoomend",c)),Q&&this.fire(new u.Event("rotatestart",c)).fire(new u.Event("rotate",c)).fire(new u.Event("rotateend",c)),j&&this.fire(new u.Event("pitchstart",c)).fire(new u.Event("pitch",c)).fire(new u.Event("pitchend",c)),this.fire(new u.Event("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),(!1===(r=u.extend({offset:[0,0],duration:500,easing:u.ease},r)).animate||!r.essential&&u.exported.prefersReducedMotion)&&(r.duration=0);const p=this.transform,x=this.getZoom(),b=this.getBearing(),M=this.getPitch(),z=this.getPadding(),j="zoom"in r?+r.zoom:x,Q="bearing"in r?this._normalizeBearing(r.bearing,b):b,re="pitch"in r?+r.pitch:M,oe="padding"in r?r.padding:p.padding,le=u.pointGeometry.convert(r.offset);let pe=p.centerPoint.add(le);const Ae=p.pointLocation(pe),Ie=u.LngLat.convert(r.center||Ae);this._normalizeCenter(Ie);const qe=p.project(Ae),be=p.project(Ie).sub(qe),Re=p.zoomScale(j-x);let $e,We;r.around&&($e=u.LngLat.convert(r.around),We=p.locationPoint($e));const it={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||j!==x,this._rotating=this._rotating||b!==Q,this._pitching=this._pitching||re!==M,this._padding=!p.isPaddingEqual(oe),this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,it),this._ease(Fe=>{if(this._zooming&&(p.zoom=u.number(x,j,Fe)),this._rotating&&(p.bearing=u.number(b,Q,Fe)),this._pitching&&(p.pitch=u.number(M,re,Fe)),this._padding&&(p.interpolatePadding(z,oe,Fe),pe=p.centerPoint.add(le)),$e)p.setLocationAtPoint($e,We);else{const pt=p.zoomScale(p.zoom-x),Rt=j>x?Math.min(2,Re):Math.max(.5,Re),Ut=Math.pow(Rt,1-Fe),dt=p.unproject(qe.add(be.mult(Fe*Ut)).mult(pt));p.setLocationAtPoint(p.renderWorldCopies?dt.wrap():dt,pe)}this._fireMoveEvents(c)},Fe=>{p.recenterOnTerrain(),this._afterEase(c,Fe)},r),this}_prepareEase(r,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||p.moving||this.fire(new u.Event("movestart",r)),this._zooming&&!p.zooming&&this.fire(new u.Event("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new u.Event("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new u.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new u.Event("move",r)),this._zooming&&this.fire(new u.Event("zoom",r)),this._rotating&&this.fire(new u.Event("rotate",r)),this._pitching&&this.fire(new u.Event("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new u.Event("zoomend",r)),x&&this.fire(new u.Event("rotateend",r)),b&&this.fire(new u.Event("pitchend",r)),this.fire(new u.Event("moveend",r))}flyTo(r,c){if(!r.essential&&u.exported.prefersReducedMotion){const rn=u.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(rn,c)}this.stop(),r=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},r);const p=this.transform,x=this.getZoom(),b=this.getBearing(),M=this.getPitch(),z=this.getPadding(),j="zoom"in r?u.clamp(+r.zoom,p.minZoom,p.maxZoom):x,Q="bearing"in r?this._normalizeBearing(r.bearing,b):b,re="pitch"in r?+r.pitch:M,oe="padding"in r?r.padding:p.padding,le=p.zoomScale(j-x),pe=u.pointGeometry.convert(r.offset);let Ae=p.centerPoint.add(pe);const Ie=p.pointLocation(Ae),qe=u.LngLat.convert(r.center||Ie);this._normalizeCenter(qe);const be=p.project(Ie),Re=p.project(qe).sub(be);let $e=r.curve;const We=Math.max(p.width,p.height),it=We/le,Fe=Re.mag();if("minZoom"in r){const rn=u.clamp(Math.min(r.minZoom,x,j),p.minZoom,p.maxZoom),Dn=We/p.zoomScale(rn-x);$e=Math.sqrt(Dn/Fe*2)}const pt=$e*$e;function Rt(rn){const Dn=(it*it-We*We+(rn?-1:1)*pt*pt*Fe*Fe)/(2*(rn?it:We)*pt*Fe);return Math.log(Math.sqrt(Dn*Dn+1)-Dn)}function Ut(rn){return(Math.exp(rn)-Math.exp(-rn))/2}function dt(rn){return(Math.exp(rn)+Math.exp(-rn))/2}const At=Rt(0);let on=function(rn){return dt(At)/dt(At+$e*rn)},Cn=function(rn){return We*((dt(At)*(Ut(Dn=At+$e*rn)/dt(Dn))-Ut(At))/pt)/Fe;var Dn},vn=(Rt(1)-At)/$e;if(Math.abs(Fe)<1e-6||!isFinite(vn)){if(Math.abs(We-it)<1e-6)return this.easeTo(r,c);const rn=it<We?-1:1;vn=Math.abs(Math.log(it/We))/$e,Cn=function(){return 0},on=function(Dn){return Math.exp(rn*$e*Dn)}}return r.duration="duration"in r?+r.duration:1e3*vn/("screenSpeed"in r?+r.screenSpeed/$e:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=b!==Q,this._pitching=re!==M,this._padding=!p.isPaddingEqual(oe),this._prepareEase(c,!1),this._ease(rn=>{const Dn=rn*vn,Er=1/on(Dn);p.zoom=1===rn?j:x+p.scaleZoom(Er),this._rotating&&(p.bearing=u.number(b,Q,rn)),this._pitching&&(p.pitch=u.number(M,re,rn)),this._padding&&(p.interpolatePadding(z,oe,rn),Ae=p.centerPoint.add(pe));const Qn=1===rn?qe:p.unproject(be.add(Re.mult(Cn(Dn))).mult(Er));p.setLocationAtPoint(p.renderWorldCopies?Qn.wrap():Qn,Ae),p._updateCenterElevation(),this._fireMoveEvents(c)},()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,c)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,c,p){!1===p.animate||0===p.duration?(r(1),c()):(this._easeStart=u.exported.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=u.wrap(r,-180,180);const p=Math.abs(r-c);return Math.abs(r-360-c)<p&&(r-=360),Math.abs(r+360-c)<p&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(!c.renderWorldCopies||c.lngRange)return;const p=r.lng-c.center.lng;r.lng+=p>180?-360:p<-180?360:0}}class Ml{constructor(r={}){this.options=r,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact;return this._map=r,this._container=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ae.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ae.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){ae.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,c){const p=this._map._getUIString(`AttributionControl.${c}`);r.title=p,r.setAttribute("aria-label",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(r){const p=c.reduce((x,b,M)=>(b.value&&(x+=`${b.key}=${b.value}${M<c.length-1?"&":""}`),x),"?");r.href=`${u.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(x=>"string"!=typeof x?"":x)):"string"==typeof this.options.customAttribution&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._sourceCaches;for(const x in c){const b=c[x];if(b.used){const M=b.getSource();M.attribution&&r.indexOf(M.attribution)<0&&r.push(M.attribution)}}r.sort((x,b)=>x.length-b.length),r=r.filter((x,b)=>{for(let M=b+1;M<r.length;M++)if(r[M].indexOf(x)>=0)return!1;return!0});const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ba{constructor(){u.bindAll(["_updateLogo"],this),u.bindAll(["_updateCompact"],this)}onAdd(r){this._map=r,this._container=ae.create("div","mapboxgl-ctrl");const c=ae.create("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ae.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const c in r){const p=r[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Il{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const x of p)if(x.id===r)return void(x.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function al(f,r,c){if(f=new u.LngLat(f.lng,f.lat),r){const p=new u.LngLat(f.lng-360,f.lat),x=new u.LngLat(f.lng+360,f.lat),b=360*Math.ceil(Math.abs(f.lng-c.center.lng)/360),M=c.locationPoint(f).distSqr(r),z=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint(p).distSqr(r)<M&&(z||Math.abs(p.lng-c.center.lng)<b)?f=p:c.locationPoint(x).distSqr(r)<M&&(z||Math.abs(x.lng-c.center.lng)<b)&&(f=x)}for(;Math.abs(f.lng-c.center.lng)>180;){const p=c.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;f.lng>c.center.lng?f.lng-=360:f.lng+=360}return f}const ra={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Jl extends u.Evented{constructor(r,c){if(super(),(r instanceof u.window.HTMLElement||c)&&(r=u.extend({element:r},c)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=u.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=ae.create("div"),this._element.setAttribute("aria-label","Map marker");const x=ae.createNS("http://www.w3.org/2000/svg","svg"),b=41,M=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${b}px`),x.setAttributeNS(null,"width",`${M}px`),x.setAttributeNS(null,"viewBox",`0 0 ${M} ${b}`);const z=ae.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"stroke","none"),z.setAttributeNS(null,"stroke-width","1"),z.setAttributeNS(null,"fill","none"),z.setAttributeNS(null,"fill-rule","evenodd");const j=ae.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"fill-rule","nonzero");const Q=ae.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(3.0, 29.0)"),Q.setAttributeNS(null,"fill","#000000");const re=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const $e of re){const We=ae.createNS("http://www.w3.org/2000/svg","ellipse");We.setAttributeNS(null,"opacity","0.04"),We.setAttributeNS(null,"cx","10.5"),We.setAttributeNS(null,"cy","5.80029008"),We.setAttributeNS(null,"rx",$e.rx),We.setAttributeNS(null,"ry",$e.ry),Q.appendChild(We)}const oe=ae.createNS("http://www.w3.org/2000/svg","g");oe.setAttributeNS(null,"fill",this._color);const le=ae.createNS("http://www.w3.org/2000/svg","path");le.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),oe.appendChild(le);const pe=ae.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"opacity","0.25"),pe.setAttributeNS(null,"fill","#000000");const Ae=ae.createNS("http://www.w3.org/2000/svg","path");Ae.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),pe.appendChild(Ae);const Ie=ae.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ie.setAttributeNS(null,"fill","#FFFFFF");const qe=ae.createNS("http://www.w3.org/2000/svg","g");qe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const be=ae.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#000000"),be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962");const Re=ae.createNS("http://www.w3.org/2000/svg","circle");Re.setAttributeNS(null,"fill","#FFFFFF"),Re.setAttributeNS(null,"cx","5.5"),Re.setAttributeNS(null,"cy","5.5"),Re.setAttributeNS(null,"r","5.4999962"),qe.appendChild(be),qe.appendChild(Re),j.appendChild(Q),j.appendChild(oe),j.appendChild(pe),j.appendChild(Ie),j.appendChild(qe),x.appendChild(j),x.setAttributeNS(null,"height",b*this._scale+"px"),x.setAttributeNS(null,"width",M*this._scale+"px"),this._element.appendChild(x),this._offset=u.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",x=>{x.preventDefault()}),this._element.addEventListener("mousedown",x=>{x.preventDefault()});const p=this._element.classList;for(const x in ra)p.remove(`mapboxgl-marker-anchor-${x}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),ae.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=u.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const c=38.1,p=13.5,x=Math.sqrt(Math.pow(p,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-c],"bottom-left":[x,-1*(c-p+x)],"bottom-right":[-x,-1*(c-p+x)],left:[p,-1*(c-p)],right:[-p,-1*(c-p)]}:this._offset}this._popup=r,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(r){const c=r.code,p=r.charCode||r.keyCode;"Space"!==c&&"Enter"!==c&&32!==p&&13!==p||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?r.remove():r.addTo(this._map),this):this}_evaluateOpacity(){const r=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(r))return void this._clearFadeTimer();const c=this._map.unproject(r);let p=!1;if(this._map.getTerrain()){const b=this._map.getFreeCameraOptions();if(b.position){const M=b.position.toLngLat();p=M.distanceTo(c)<.9*M.distanceTo(this._lngLat)}}const x=(1-this._map._queryFogOpacity(c))*(p?.2:1);this._element.style.opacity=`${x}`,this._popup&&this._popup._setOpacity(`${x}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(r){const c=this._map.transform;return!!r&&r.x>=0&&r.x<c.width&&r.y>=0&&r.y<c.height}_update(r){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=al(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset());let c="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?c=`rotateZ(${this._rotation}deg)`:"map"===this._rotationAlignment&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?p="rotateX(0deg)":"map"===this._pitchAlignment&&(p=`rotateX(${this._map.getPitch()}deg)`),r&&"moveend"!==r.type||(this._pos=this._pos.round()),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&ae.setTransform(this._element,`${ra[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))})}_transformedOffset(){if(!this._defaultMarker)return this._offset;const r=this._map.transform,c=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&c._rotate(r.angle),"map"===this._pitchAlignment&&(c.y*=Math.cos(r._pitch)),c}getOffset(){return this._offset}setOffset(r){return this._offset=u.pointGeometry.convert(r),this._update(),this}_onMove(r){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=r.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=r.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(r){this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=r.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&"auto"!==r?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class bc{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=u.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,p){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+p}}const B={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},{HTMLImageElement:P,HTMLElement:S,ImageBitmap:G}=u.window,ne={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function me(f){f.parentNode&&f.parentNode.removeChild(f)}const ze={showCompass:!0,showZoom:!0,visualizePitch:!1};class et{constructor(r,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new gs({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,p&&(this.mousePitch=new Qo({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ae.addEventListener(c,"mousedown",this.mousedown),ae.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),ae.addEventListener(c,"touchmove",this.touchmove),ae.addEventListener(c,"touchend",this.touchend),ae.addEventListener(c,"touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),ae.disableDrag()}move(r,c){const p=this.map,x=this.mouseRotate.mousemoveWindow(r,c);if(x&&x.bearingDelta&&p.setBearing(p.getBearing()+x.bearingDelta),this.mousePitch){const b=this.mousePitch.mousemoveWindow(r,c);b&&b.pitchDelta&&p.setPitch(p.getPitch()+b.pitchDelta)}}off(){const r=this.element;ae.removeEventListener(r,"mousedown",this.mousedown),ae.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),ae.removeEventListener(r,"touchmove",this.touchmove),ae.removeEventListener(r,"touchend",this.touchend),ae.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){ae.enableDrag(),ae.removeEventListener(u.window,"mousemove",this.mousemove),ae.removeEventListener(u.window,"mouseup",this.mouseup)}mousedown(r){this.down(u.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),ae.mousePos(this.element,r)),ae.addEventListener(u.window,"mousemove",this.mousemove),ae.addEventListener(u.window,"mouseup",this.mouseup)}mousemove(r){this.move(r,ae.mousePos(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=ae.touchPos(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=ae.touchPos(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Nt={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let En,dr=0,Un=!1;const fi={maxWidth:100,unit:"metric"};function kr(f,r,c){const p=c&&c.maxWidth||100,x=f._container.getBoundingClientRect().height/2,b=f.unproject([0,x]),M=f.unproject([p,x]),z=b.distanceTo(M);if(c&&"imperial"===c.unit){const j=3.2808*z;j>5280?Xs(r,p,j/5280,f._getUIString("ScaleControl.Miles"),f):Xs(r,p,j,f._getUIString("ScaleControl.Feet"),f)}else c&&"nautical"===c.unit?Xs(r,p,z/1852,f._getUIString("ScaleControl.NauticalMiles"),f):z>=1e3?Xs(r,p,z/1e3,f._getUIString("ScaleControl.Kilometers"),f):Xs(r,p,z,f._getUIString("ScaleControl.Meters"),f)}function Xs(f,r,c,p,x){const b=function(z){const j=Math.pow(10,`${Math.floor(z)}`.length-1);let Q=z/j;return Q=Q>=10?10:Q>=5?5:Q>=3?3:Q>=2?2:Q>=1?1:function(re){const oe=Math.pow(10,Math.ceil(-Math.log(re)/Math.LN10));return Math.round(re*oe)/oe}(Q),j*Q}(c),M=b/c;x._requestDomTask(()=>{f.style.width=r*M+"px",f.innerHTML=`${b}&nbsp;${p}`})}const Bo={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lr=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),bo={version:u.version,supported:ge,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends za{constructor(f){if(null!=(f=u.extend({},ne,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ka(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new Il,this._domRenderTaskQueue=new Il,this._controls=[],this._markers=[],this._mapId=u.uniqueId(),this._locale=u.extend({},B,f.locale),this._clickTolerance=f.clickTolerance,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new bc(0),this._requestManager=new u.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=u.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof S))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(f.maxBounds&&this.setMaxBounds(f.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Al(this,f),this._hash=f.hash&&new rs("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,u.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.attributionControl&&this.addControl(new Ml({customAttribution:f.customAttribution})),this._logoControl=new ba,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new u.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new u.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(f,r){if(void 0===r&&(r=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[r];return-1!==r.indexOf("bottom")?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(f);return r>-1&&this._controls.splice(r,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){const[r,c]=this._containerDimensions();if(r===this.transform.width&&c===this.transform.height)return this;this._resizeCanvas(r,c),this.transform.resize(r,c),this.painter.resize(Math.ceil(r),Math.ceil(c));const p=!this._moving;return p&&this.fire(new u.Event("movestart",f)).fire(new u.Event("move",f)),this.fire(new u.Event("resize",f)),p&&this.fire(new u.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(u.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint3D(u.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(u.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,r,c){if("mouseenter"===f||"mouseover"===f){let p=!1;return{layer:r,listener:c,delegates:{mousemove:b=>{const M=this.getLayer(r)?this.queryRenderedFeatures(b.point,{layers:[r]}):[];M.length?p||(p=!0,c.call(this,new ms(f,this,b.originalEvent,{features:M}))):p=!1},mouseout:()=>{p=!1}}}}if("mouseleave"===f||"mouseout"===f){let p=!1;return{layer:r,listener:c,delegates:{mousemove:M=>{(this.getLayer(r)?this.queryRenderedFeatures(M.point,{layers:[r]}):[]).length?p=!0:p&&(p=!1,c.call(this,new ms(f,this,M.originalEvent)))},mouseout:M=>{p&&(p=!1,c.call(this,new ms(f,this,M.originalEvent)))}}}}{const p=x=>{const b=this.getLayer(r)?this.queryRenderedFeatures(x.point,{layers:[r]}):[];b.length&&(x.features=b,c.call(this,x),delete x.features)};return{layer:r,listener:c,delegates:{[f]:p}}}}on(f,r,c){if(void 0===c)return super.on(f,r);const p=this._createDelegatedListener(f,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(f,r,c){if(void 0===c)return super.once(f,r);const p=this._createDelegatedListener(f,r,c);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(f,r,c){return void 0===c?super.off(f,r):(this._delegatedListeners&&this._delegatedListeners[f]&&(p=>{const x=this._delegatedListeners[f];for(let b=0;b<x.length;b++){const M=x[b];if(M.layer===r&&M.listener===c){for(const z in M.delegates)this.off(z,M.delegates[z]);return x.splice(b,1),this}}})(),this)}queryRenderedFeatures(f,r){return this.style?(void 0!==r||void 0===f||f instanceof u.pointGeometry||Array.isArray(f)||(r=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(f,r){return this.style.querySourceFeatures(f,r)}queryTerrainElevation(f,r){const c=this.transform.elevation;return c?(r=u.extend({},{exaggerated:!0},r),c.getAtPoint(u.MercatorCoordinate.fromLngLat(f),null,r.exaggerated)):null}setStyle(f,r){return!1!==(r=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(f,r))}_getUIString(f){const r=this._locale[f];if(null==r)throw new Error(`Missing UI string '${f}'`);return r}_updateStyle(f,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new Xi(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,r){if("string"==typeof f){const c=this._requestManager.normalizeStyleURL(f),p=this._requestManager.transformRequest(c,u.ResourceType.Style);u.getJSON(p,(x,b)=>{x?this.fire(new u.ErrorEvent(x)):b&&this._updateDiff(b,r)})}else"object"==typeof f&&this._updateDiff(f,r)}_updateDiff(f,r){try{this.style.setState(f)&&this._update(!0)}catch(c){u.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(f,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.warnOnce("There is no style added to the map.")}addSource(f,r){return this._lazyInitEmptyStyle(),this.style.addSource(f,r),this._update(!0)}isSourceLoaded(f){const r=this.style&&this.style._getSourceCaches(f);if(0!==r.length)return r.every(c=>c.loaded());this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const r in f){const c=f[r]._tiles;for(const p in c){const x=c[p];if("loaded"!==x.state&&"errored"!==x.state)return!1}}return!0}addSourceType(f,r,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,r,c)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,r,{pixelRatio:c=1,sdf:p=!1,stretchX:x,stretchY:b,content:M}={}){if(this._lazyInitEmptyStyle(),r instanceof P||G&&r instanceof G){const{width:z,height:j,data:Q}=u.exported.getImageData(r);this.style.addImage(f,{data:new u.RGBAImage({width:z,height:j},Q),pixelRatio:c,stretchX:x,stretchY:b,content:M,sdf:p,version:0})}else{if(void 0===r.width||void 0===r.height)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:j,data:Q}=r,re=r;this.style.addImage(f,{data:new u.RGBAImage({width:z,height:j},new Uint8Array(Q)),pixelRatio:c,stretchX:x,stretchY:b,content:M,sdf:p,version:0,userImage:re}),re.onAdd&&re.onAdd(this,f)}}}updateImage(f,r){const c=this.style.getImage(f);if(!c)return this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof P||G&&r instanceof G?u.exported.getImageData(r):r,{width:x,height:b,data:M}=p;return void 0===x||void 0===b?this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):x!==c.data.width||b!==c.data.height?this.fire(new u.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(c.data.replace(M,!(r instanceof P||G&&r instanceof G)),void this.style.updateImage(f,c))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,r){u.getImage(this._requestManager.transformRequest(f,u.ResourceType.Image),(c,p)=>{r(c,p instanceof P?u.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(f,r){return this._lazyInitEmptyStyle(),this.style.addLayer(f,r),this._update(!0)}moveLayer(f,r){return this.style.moveLayer(f,r),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,r,c){return this.style.setLayerZoomRange(f,r,c),this._update(!0)}setFilter(f,r,c={}){return this.style.setFilter(f,r,c),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,r,c,p={}){return this.style.setPaintProperty(f,r,c,p),this._update(!0)}getPaintProperty(f,r){return this.style.getPaintProperty(f,r)}setLayoutProperty(f,r,c,p={}){return this.style.setLayoutProperty(f,r,c,p),this._update(!0)}getLayoutProperty(f,r){return this.style.getLayoutProperty(f,r)}setLight(f,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(f),this.transform):0}setFeatureState(f,r){return this.style.setFeatureState(f,r),this._update()}removeFeatureState(f,r){return this.style.removeFeatureState(f,r),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_containerDimensions(){let f=0,r=0;return this._container&&(f=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300),[f,r]}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=ae.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=ae.create("div","mapboxgl-canvas-container",f);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=ae.create("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions();this._resizeCanvas(c[0],c[1]);const p=this._controlContainer=ae.create("div","mapboxgl-control-container",f),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{x[b]=ae.create("div",`mapboxgl-ctrl-${b}`,p)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,r){const c=u.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(f),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${r}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const r=this._markers.indexOf(f);-1!==r&&this._markers.splice(r,1)}_setupPainter(){const f=u.extend({},ge.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);r?(u.storeAuthState(r,!0),this.painter=new xl(r,this.transform),this.on("data",c=>{"source"===c.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(r)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.isMoving()&&this.loaded()?f():this._domRenderTaskQueue.add(f)}_render(f){let r;const c=this.painter.context.extTimerQuery,p=u.exported.now();this.listens("gpu-timing-frame")&&(r=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,r));let x=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;let b=!1;const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,Q=u.exported.now();this.style.zoomHistory.update(j,Q);const re=new u.EvaluationParameters(j,{now:Q,fadeDuration:M,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),oe=re.crossFadingFactor();1===oe&&oe===this._crossFadingFactor||(b=!0,this._crossFadingFactor=oe),this.style.update(re)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const j=u.exported.now()-p;c.endQueryEXT(c.TIME_ELAPSED_EXT,r),setTimeout(()=>{const Q=c.getQueryObjectEXT(r,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(r),this.fire(new u.Event("gpu-timing-frame",{cpuTime:j,gpuTime:Q}))},50)}if(this.listens("gpu-timing-layer")){const j=this.painter.collectGpuTimers();setTimeout(()=>{const Q=this.painter.queryGpuTimers(j);this.fire(new u.Event("gpu-timing-layer",{layerTimes:Q}))},50)}const z=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(z||this._repaint)this.triggerRepaint();else{const j=!this.isMoving()&&this.loaded();if(j&&(x=this._updateAverageElevation(p,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),j&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Q=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:Q})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,r=!1){const c=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((r||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const p=this.transform.averageElevation;let x=this.transform.sampleAverageElevation();isNaN(x)?x=0:this._averageElevationLastSampledAt=f;const b=Math.abs(p-x);if(b>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(x),c(x);this._averageElevation.easeTo(x,f,300)}else if(b>1e-4)return this._averageElevation.jumpTo(x),c(x)}return!!this._averageElevation.isEasing(f)&&c(this._averageElevation.getValue(f))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===u.AUTH_ERR_MSG||401===f.status)){const r=this.painter.context.gl;u.storeAuthState(r,!1),this._logoControl instanceof ba&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function x(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const M=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,M),M}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(x(f),r.canvasCopies.map(x),r.timeStamps)}_canvasPixelComparison(f,r,c){let p=c[1]-c[0];const x=f.length/4;for(let b=0;b<r.length;b++){const M=r[b];let z=0;for(let j=0;j<M.length;j+=4)M[j]===f[j]&&M[j+1]===f[j+1]&&M[j+2]===f[j+2]&&M[j+3]===f[j+3]&&(z+=1);p+=(c[b+2]-c[b+1])*(1-z/x)}return p}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),me(this._canvasContainer),me(this._controlContainer),me(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=u.exported.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,r){u.setCacheLimits(f,r)}get version(){return u.version}},NavigationControl:class{constructor(f){this.options=u.extend({},ze,f),this._container=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),ae.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),ae.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=ae.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),r=f===this._map.getMaxZoom(),c=f===this._map.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new et(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ae.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,r){const c=ae.create("button",f,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(f,r){const c=this._map._getUIString(`NavigationControl.${r}`);f.title=c,f.setAttribute("aria-label",c)}},GeolocateControl:class extends u.Evented{constructor(f){super(),this.options=u.extend({},Nt,f),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=vc(this._updateMarkerRotation,20)}onAdd(f){var r;return this._map=f,this._container=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==En?r(En):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(c=>{En="denied"!==c.state,r(En)}):(En=!!u.window.navigator.geolocation,r(En)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(u.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ae.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,dr=0,Un=!1}_isOutOfMapMaxBounds(f){const r=this._map.getMaxBounds(),c=f.coords;return r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",f)),this._finish()}}_updateCamera(f){const r=new u.LngLat(f.coords.longitude,f.coords.latitude),c=f.coords.accuracy,p=this._map.getBearing(),x=u.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),x,{geolocateSource:!0})}_updateMarker(f){if(f){const r=new u.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._container.getBoundingClientRect().height/2,r=this._map.unproject([0,f]),c=this._map.unproject([100,f]),p=r.distanceTo(c)/100,x=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${x}px`,this._circleElement.style.height=`${x}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&Un)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=ae.create("button","mapboxgl-ctrl-geolocate",this._container),ae.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ae.create("div","mapboxgl-user-location"),this._dotElement.appendChild(ae.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ae.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Jl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ae.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":dr--,Un=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),dr++,dr>1?(f={maximumAge:6e5,timeout:0},Un=!0):(f=this.options.positionOptions,Un=!1),this._geolocationWatchID=u.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else u.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&f()}).catch(console.error):f()}_clearWatch(){u.window.navigator.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ml,ScaleControl:class{constructor(f){this.options=u.extend({},fi,f),u.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){kr(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ae.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,kr(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof u.window.HTMLElement?this._container=f.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=ae.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){ae.remove(this._controlContainer),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=ae.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ae.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(f){super(),this.options=u.extend(Object.create(Bo),f),u.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&ae.remove(this._content),this._container&&(ae.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=u.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(u.window.document.createTextNode(f))}setHTML(f){const r=u.window.document.createDocumentFragment(),c=u.window.document.createElement("body");let p;for(c.innerHTML=f;p=c.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ae.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let r;return this._classList.delete(f)?r=!1:(this._classList.add(f),r=!0),this._container&&this._updateClassList(),r}_createCloseButton(){this.options.closeButton&&(this._closeButton=ae.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const r=this._pos,c=this._container.offsetWidth,p=this._container.offsetHeight;let x;return x=r.y+f.bottom.y<p?["top"]:r.y>this._map.transform.height-p?["bottom"]:[],r.x<c/2?x.push("left"):r.x>this._map.transform.width-c/2&&x.push("right"),0===x.length?"bottom":x.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=ae.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=ae.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=al(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const r=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),c=function(b){if(b||(b=new u.pointGeometry(0,0)),"number"==typeof b){const M=Math.round(Math.sqrt(.5*Math.pow(b,2)));return{center:new u.pointGeometry(0,0),top:new u.pointGeometry(0,b),"top-left":new u.pointGeometry(M,M),"top-right":new u.pointGeometry(-M,M),bottom:new u.pointGeometry(0,-b),"bottom-left":new u.pointGeometry(M,-M),"bottom-right":new u.pointGeometry(-M,-M),left:new u.pointGeometry(b,0),right:new u.pointGeometry(-b,0)}}if(b instanceof u.pointGeometry||Array.isArray(b)){const M=u.pointGeometry.convert(b);return{center:M,top:M,"top-left":M,"top-right":M,bottom:M,"bottom-left":M,"bottom-right":M,left:M,right:M}}return{center:u.pointGeometry.convert(b.center||[0,0]),top:u.pointGeometry.convert(b.top||[0,0]),"top-left":u.pointGeometry.convert(b["top-left"]||[0,0]),"top-right":u.pointGeometry.convert(b["top-right"]||[0,0]),bottom:u.pointGeometry.convert(b.bottom||[0,0]),"bottom-left":u.pointGeometry.convert(b["bottom-left"]||[0,0]),"bottom-right":u.pointGeometry.convert(b["bottom-right"]||[0,0]),left:u.pointGeometry.convert(b.left||[0,0]),right:u.pointGeometry.convert(b.right||[0,0])}}(this.options.offset),p=this._anchor=this._getAnchor(c),x=r.add(c[p]).round();this._map._requestDomTask(()=>{this._container&&p&&ae.setTransform(this._container,`${ra[p]} translate(${x.x}px,${x.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Lr);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:Jl,Style:Xi,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:rl,Evented:u.Evented,config:u.config,prewarm:function(){Gt().acquire(Ze)},clearPrewarmedResources:function(){const f=St;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(Ze),St=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(f){u.config.ACCESS_TOKEN=f},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(f){u.config.API_URL=f},get workerCount(){return ft.workerCount},set workerCount(f){ft.workerCount=f},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){u.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){u.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return bo}),D}()},2533:(Mt,at,te)=>{"use strict";te.d(at,{JX:()=>Gn,LS:()=>Ht,_s:()=>lt});var D=te(639),A=te(8583);function R(ct,tt){if(1&ct){var mt=D.EpF();D.TgZ(0,"a",11),D.NdJ("keyup.enter",function(){return D.CHM(mt),D.oxw(3),D.MAs(1).previous()})("click",function(){return D.CHM(mt),D.oxw(3),D.MAs(1).previous()}),D._uU(1),D.TgZ(2,"span",12),D._uU(3),D.qZA(),D.qZA()}if(2&ct){var gt=D.oxw(3);D.uIk("aria-label",gt.previousLabel+" "+gt.screenReaderPageLabel),D.xp6(1),D.hij(" ",gt.previousLabel," "),D.xp6(2),D.Oqu(gt.screenReaderPageLabel)}}function u(ct,tt){if(1&ct&&(D.TgZ(0,"span"),D._uU(1),D.TgZ(2,"span",12),D._uU(3),D.qZA(),D.qZA()),2&ct){var mt=D.oxw(3);D.xp6(1),D.hij(" ",mt.previousLabel," "),D.xp6(2),D.Oqu(mt.screenReaderPageLabel)}}function ge(ct,tt){if(1&ct&&(D.TgZ(0,"li",8),D.YNc(1,R,4,3,"a",9),D.YNc(2,u,4,2,"span",10),D.qZA()),2&ct){D.oxw(2);var mt=D.MAs(1);D.ekj("disabled",mt.isFirstPage()),D.xp6(1),D.Q6J("ngIf",1<mt.getCurrent()),D.xp6(1),D.Q6J("ngIf",mt.isFirstPage())}}function Se(ct,tt){if(1&ct){var mt=D.EpF();D.TgZ(0,"a",11),D.NdJ("keyup.enter",function(){D.CHM(mt);var bn=D.oxw().$implicit;return D.oxw(2),D.MAs(1).setCurrent(bn.value)})("click",function(){D.CHM(mt);var bn=D.oxw().$implicit;return D.oxw(2),D.MAs(1).setCurrent(bn.value)}),D.TgZ(1,"span",12),D._uU(2),D.qZA(),D.TgZ(3,"span"),D._uU(4),D.ALo(5,"number"),D.qZA(),D.qZA()}if(2&ct){var gt=D.oxw().$implicit,tn=D.oxw(2);D.xp6(2),D.hij("",tn.screenReaderPageLabel," "),D.xp6(2),D.Oqu("..."===gt.label?gt.label:D.xi3(5,2,gt.label,""))}}function Ce(ct,tt){if(1&ct&&(D.ynx(0),D.TgZ(1,"span",12),D._uU(2),D.qZA(),D.TgZ(3,"span"),D._uU(4),D.ALo(5,"number"),D.qZA(),D.BQk()),2&ct){var mt=D.oxw().$implicit,gt=D.oxw(2);D.xp6(2),D.hij("",gt.screenReaderCurrentLabel," "),D.xp6(2),D.Oqu("..."===mt.label?mt.label:D.xi3(5,2,mt.label,""))}}function ce(ct,tt){if(1&ct&&(D.TgZ(0,"li"),D.YNc(1,Se,6,5,"a",9),D.YNc(2,Ce,6,5,"ng-container",10),D.qZA()),2&ct){var mt=tt.$implicit;D.oxw(2);var gt=D.MAs(1);D.ekj("current",gt.getCurrent()===mt.value)("ellipsis","..."===mt.label),D.xp6(1),D.Q6J("ngIf",gt.getCurrent()!==mt.value),D.xp6(1),D.Q6J("ngIf",gt.getCurrent()===mt.value)}}function ae(ct,tt){if(1&ct){var mt=D.EpF();D.TgZ(0,"a",11),D.NdJ("keyup.enter",function(){return D.CHM(mt),D.oxw(3),D.MAs(1).next()})("click",function(){return D.CHM(mt),D.oxw(3),D.MAs(1).next()}),D._uU(1),D.TgZ(2,"span",12),D._uU(3),D.qZA(),D.qZA()}if(2&ct){var gt=D.oxw(3);D.uIk("aria-label",gt.nextLabel+" "+gt.screenReaderPageLabel),D.xp6(1),D.hij(" ",gt.nextLabel," "),D.xp6(2),D.Oqu(gt.screenReaderPageLabel)}}function ve(ct,tt){if(1&ct&&(D.TgZ(0,"span"),D._uU(1),D.TgZ(2,"span",12),D._uU(3),D.qZA(),D.qZA()),2&ct){var mt=D.oxw(3);D.xp6(1),D.hij(" ",mt.nextLabel," "),D.xp6(2),D.Oqu(mt.screenReaderPageLabel)}}function Ue(ct,tt){if(1&ct&&(D.TgZ(0,"li",13),D.YNc(1,ae,4,3,"a",9),D.YNc(2,ve,4,2,"span",10),D.qZA()),2&ct){D.oxw(2);var mt=D.MAs(1);D.ekj("disabled",mt.isLastPage()),D.xp6(1),D.Q6J("ngIf",!mt.isLastPage()),D.xp6(1),D.Q6J("ngIf",mt.isLastPage())}}function Be(ct,tt){if(1&ct&&(D.TgZ(0,"ul",3),D.YNc(1,ge,3,4,"li",4),D.TgZ(2,"li",5),D._uU(3),D.qZA(),D.YNc(4,ce,3,6,"li",6),D.YNc(5,Ue,3,4,"li",7),D.qZA()),2&ct){var mt=D.oxw(),gt=D.MAs(1);D.ekj("responsive",mt.responsive),D.uIk("aria-label",mt.screenReaderPaginationLabel),D.xp6(1),D.Q6J("ngIf",mt.directionLinks),D.xp6(2),D.AsE(" ",gt.getCurrent()," / ",gt.getLastPage()," "),D.xp6(1),D.Q6J("ngForOf",gt.pages)("ngForTrackBy",mt.trackByIndex),D.xp6(1),D.Q6J("ngIf",mt.directionLinks)}}var we=function(){function ct(){this.change=new D.vpe,this.instances={},this.DEFAULT_ID="DEFAULT_PAGINATION_ID"}return ct.prototype.defaultId=function(){return this.DEFAULT_ID},ct.prototype.register=function(tt){return null==tt.id&&(tt.id=this.DEFAULT_ID),this.instances[tt.id]?this.updateInstance(tt):(this.instances[tt.id]=tt,!0)},ct.prototype.updateInstance=function(tt){var mt=!1;for(var gt in this.instances[tt.id])tt[gt]!==this.instances[tt.id][gt]&&(this.instances[tt.id][gt]=tt[gt],mt=!0);return mt},ct.prototype.getCurrentPage=function(tt){if(this.instances[tt])return this.instances[tt].currentPage},ct.prototype.setCurrentPage=function(tt,mt){if(this.instances[tt]){var gt=this.instances[tt];mt<=Math.ceil(gt.totalItems/gt.itemsPerPage)&&1<=mt&&(this.instances[tt].currentPage=mt,this.change.emit(tt))}},ct.prototype.setTotalItems=function(tt,mt){this.instances[tt]&&0<=mt&&(this.instances[tt].totalItems=mt,this.change.emit(tt))},ct.prototype.setItemsPerPage=function(tt,mt){this.instances[tt]&&(this.instances[tt].itemsPerPage=mt,this.change.emit(tt))},ct.prototype.getInstance=function(tt){return void 0===tt&&(tt=this.DEFAULT_ID),this.instances[tt]?this.clone(this.instances[tt]):{}},ct.prototype.clone=function(tt){var mt={};for(var gt in tt)tt.hasOwnProperty(gt)&&(mt[gt]=tt[gt]);return mt},ct.\u0275fac=function(mt){return new(mt||ct)},ct.\u0275prov=D.Yz7({token:ct,factory:function(tt){return ct.\u0275fac(tt)}}),ct}(),Ne=function(ct,tt){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(ct,tt)},ke=Number.MAX_SAFE_INTEGER,lt=function(){function ct(tt){this.service=tt,this.state={}}return ct.prototype.transform=function(tt,mt){if(!(tt instanceof Array)){var gt=mt.id||this.service.defaultId();return this.state[gt]?this.state[gt].slice:tt}var Pn,Or,tn=mt.totalItems&&mt.totalItems!==tt.length,an=this.createInstance(tt,mt),bn=an.id,Jr=an.itemsPerPage,qt=this.service.register(an);if(!tn&&tt instanceof Array){if(this.stateIsIdentical(bn,tt,Pn=(an.currentPage-1)*(Jr=+Jr||ke),Or=Pn+Jr))return this.state[bn].slice;var Ve=tt.slice(Pn,Or);return this.saveState(bn,tt,Ve,Pn,Or),this.service.change.emit(bn),Ve}return qt&&this.service.change.emit(bn),this.saveState(bn,tt,tt,Pn,Or),tt},ct.prototype.createInstance=function(tt,mt){return this.checkConfig(mt),{id:null!=mt.id?mt.id:this.service.defaultId(),itemsPerPage:+mt.itemsPerPage||0,currentPage:+mt.currentPage||1,totalItems:+mt.totalItems||tt.length}},ct.prototype.checkConfig=function(tt){var gt=["itemsPerPage","currentPage"].filter(function(tn){return!(tn in tt)});if(0<gt.length)throw new Error("PaginatePipe: Argument is missing the following required properties: "+gt.join(", "))},ct.prototype.saveState=function(tt,mt,gt,tn,an){this.state[tt]={collection:mt,size:mt.length,slice:gt,start:tn,end:an}},ct.prototype.stateIsIdentical=function(tt,mt,gt,tn){var an=this.state[tt];return!!an&&!(an.size!==mt.length||an.start!==gt||an.end!==tn)&&an.slice.every(function(Pn,Or){return Pn===mt[gt+Or]})},(ct=function(ct,tt,mt,gt){var bn,tn=arguments.length,an=tn<3?tt:null===gt?gt=Object.getOwnPropertyDescriptor(tt,mt):gt;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)an=Reflect.decorate(ct,tt,mt,gt);else for(var Pn=ct.length-1;Pn>=0;Pn--)(bn=ct[Pn])&&(an=(tn<3?bn(an):tn>3?bn(tt,mt,an):bn(tt,mt))||an);return tn>3&&an&&Object.defineProperty(tt,mt,an),an}([Ne("design:paramtypes",[we])],ct)).\u0275fac=function(mt){return new(mt||ct)(D.Y36(we,16))},ct.\u0275pipe=D.Yjl({name:"paginate",type:ct,pure:!1}),ct}(),Me=function(ct,tt,mt,gt){var bn,tn=arguments.length,an=tn<3?tt:null===gt?gt=Object.getOwnPropertyDescriptor(tt,mt):gt;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)an=Reflect.decorate(ct,tt,mt,gt);else for(var Pn=ct.length-1;Pn>=0;Pn--)(bn=ct[Pn])&&(an=(tn<3?bn(an):tn>3?bn(tt,mt,an):bn(tt,mt))||an);return tn>3&&an&&Object.defineProperty(tt,mt,an),an},Ge=function(ct,tt){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(ct,tt)};function Lt(ct){return!!ct&&"false"!==ct}var Ht=function(){function ct(){this.maxSize=7,this.previousLabel="Previous",this.nextLabel="Next",this.screenReaderPaginationLabel="Pagination",this.screenReaderPageLabel="page",this.screenReaderCurrentLabel="You're on page",this.pageChange=new D.vpe,this.pageBoundsCorrection=new D.vpe,this._directionLinks=!0,this._autoHide=!1,this._responsive=!1}return Object.defineProperty(ct.prototype,"directionLinks",{get:function(){return this._directionLinks},set:function(tt){this._directionLinks=Lt(tt)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"autoHide",{get:function(){return this._autoHide},set:function(tt){this._autoHide=Lt(tt)},enumerable:!0,configurable:!0}),Object.defineProperty(ct.prototype,"responsive",{get:function(){return this._responsive},set:function(tt){this._responsive=Lt(tt)},enumerable:!0,configurable:!0}),ct.prototype.trackByIndex=function(tt){return tt},Me([(0,D.IIB)(),Ge("design:type",String)],ct.prototype,"id",void 0),Me([(0,D.IIB)(),Ge("design:type",Number)],ct.prototype,"maxSize",void 0),Me([(0,D.IIB)(),Ge("design:type",Boolean),Ge("design:paramtypes",[Boolean])],ct.prototype,"directionLinks",null),Me([(0,D.IIB)(),Ge("design:type",Boolean),Ge("design:paramtypes",[Boolean])],ct.prototype,"autoHide",null),Me([(0,D.IIB)(),Ge("design:type",Boolean),Ge("design:paramtypes",[Boolean])],ct.prototype,"responsive",null),Me([(0,D.IIB)(),Ge("design:type",String)],ct.prototype,"previousLabel",void 0),Me([(0,D.IIB)(),Ge("design:type",String)],ct.prototype,"nextLabel",void 0),Me([(0,D.IIB)(),Ge("design:type",String)],ct.prototype,"screenReaderPaginationLabel",void 0),Me([(0,D.IIB)(),Ge("design:type",String)],ct.prototype,"screenReaderPageLabel",void 0),Me([(0,D.IIB)(),Ge("design:type",String)],ct.prototype,"screenReaderCurrentLabel",void 0),Me([(0,D.r_U)(),Ge("design:type",D.vpe)],ct.prototype,"pageChange",void 0),Me([(0,D.r_U)(),Ge("design:type",D.vpe)],ct.prototype,"pageBoundsCorrection",void 0),ct.\u0275fac=function(mt){return new(mt||ct)},ct.\u0275cmp=D.Xpm({type:ct,selectors:[["pagination-controls"]],inputs:{maxSize:"maxSize",previousLabel:"previousLabel",nextLabel:"nextLabel",screenReaderPaginationLabel:"screenReaderPaginationLabel",screenReaderPageLabel:"screenReaderPageLabel",screenReaderCurrentLabel:"screenReaderCurrentLabel",directionLinks:"directionLinks",autoHide:"autoHide",responsive:"responsive",id:"id"},outputs:{pageChange:"pageChange",pageBoundsCorrection:"pageBoundsCorrection"},decls:3,vars:3,consts:[[3,"id","maxSize","pageChange","pageBoundsCorrection"],["p","paginationApi"],["class","ngx-pagination",3,"responsive",4,"ngIf"],[1,"ngx-pagination"],["class","pagination-previous",3,"disabled",4,"ngIf"],[1,"small-screen"],[3,"current","ellipsis",4,"ngFor","ngForOf","ngForTrackBy"],["class","pagination-next",3,"disabled",4,"ngIf"],[1,"pagination-previous"],["tabindex","0",3,"keyup.enter","click",4,"ngIf"],[4,"ngIf"],["tabindex","0",3,"keyup.enter","click"],[1,"show-for-sr"],[1,"pagination-next"]],template:function(mt,gt){if(1&mt&&(D.TgZ(0,"pagination-template",0,1),D.NdJ("pageChange",function(bn){return gt.pageChange.emit(bn)})("pageBoundsCorrection",function(bn){return gt.pageBoundsCorrection.emit(bn)}),D.YNc(2,Be,6,9,"ul",2),D.qZA()),2&mt){var tn=D.MAs(1);D.Q6J("id",gt.id)("maxSize",gt.maxSize),D.xp6(2),D.Q6J("ngIf",!(gt.autoHide&&tn.pages.length<=1))}},directives:function(){return[Xt,A.O5,A.sg]},pipes:function(){return[A.JJ]},styles:["\n.ngx-pagination {\n  margin-left: 0;\n  margin-bottom: 1rem; }\n  .ngx-pagination::before, .ngx-pagination::after {\n    content: ' ';\n    display: table; }\n  .ngx-pagination::after {\n    clear: both; }\n  .ngx-pagination li {\n    -moz-user-select: none;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n    margin-right: 0.0625rem;\n    border-radius: 0; }\n  .ngx-pagination li {\n    display: inline-block; }\n  .ngx-pagination a,\n  .ngx-pagination button {\n    color: #0a0a0a; \n    display: block;\n    padding: 0.1875rem 0.625rem;\n    border-radius: 0; }\n    .ngx-pagination a:hover,\n    .ngx-pagination button:hover {\n      background: #e6e6e6; }\n  .ngx-pagination .current {\n    padding: 0.1875rem 0.625rem;\n    background: #2199e8;\n    color: #fefefe;\n    cursor: default; }\n  .ngx-pagination .disabled {\n    padding: 0.1875rem 0.625rem;\n    color: #cacaca;\n    cursor: default; } \n    .ngx-pagination .disabled:hover {\n      background: transparent; }\n  .ngx-pagination a, .ngx-pagination button {\n    cursor: pointer; }\n\n.ngx-pagination .pagination-previous a::before,\n.ngx-pagination .pagination-previous.disabled::before { \n  content: '\xab';\n  display: inline-block;\n  margin-right: 0.5rem; }\n\n.ngx-pagination .pagination-next a::after,\n.ngx-pagination .pagination-next.disabled::after {\n  content: '\xbb';\n  display: inline-block;\n  margin-left: 0.5rem; }\n\n.ngx-pagination .show-for-sr {\n  position: absolute !important;\n  width: 1px;\n  height: 1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0); }\n.ngx-pagination .small-screen {\n  display: none; }\n@media screen and (max-width: 601px) {\n  .ngx-pagination.responsive .small-screen {\n    display: inline-block; } \n  .ngx-pagination.responsive li:not(.small-screen):not(.pagination-previous):not(.pagination-next) {\n    display: none; }\n}\n  "],encapsulation:2,changeDetection:0}),ct}(),zn=function(ct,tt,mt,gt){var bn,tn=arguments.length,an=tn<3?tt:null===gt?gt=Object.getOwnPropertyDescriptor(tt,mt):gt;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)an=Reflect.decorate(ct,tt,mt,gt);else for(var Pn=ct.length-1;Pn>=0;Pn--)(bn=ct[Pn])&&(an=(tn<3?bn(an):tn>3?bn(tt,mt,an):bn(tt,mt))||an);return tn>3&&an&&Object.defineProperty(tt,mt,an),an},gn=function(ct,tt){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(ct,tt)},Xt=function(){function ct(tt,mt){var gt=this;this.service=tt,this.changeDetectorRef=mt,this.maxSize=7,this.pageChange=new D.vpe,this.pageBoundsCorrection=new D.vpe,this.pages=[],this.changeSub=this.service.change.subscribe(function(tn){gt.id===tn&&(gt.updatePageLinks(),gt.changeDetectorRef.markForCheck(),gt.changeDetectorRef.detectChanges())})}return ct.prototype.ngOnInit=function(){void 0===this.id&&(this.id=this.service.defaultId()),this.updatePageLinks()},ct.prototype.ngOnChanges=function(tt){this.updatePageLinks()},ct.prototype.ngOnDestroy=function(){this.changeSub.unsubscribe()},ct.prototype.previous=function(){this.checkValidId(),this.setCurrent(this.getCurrent()-1)},ct.prototype.next=function(){this.checkValidId(),this.setCurrent(this.getCurrent()+1)},ct.prototype.isFirstPage=function(){return 1===this.getCurrent()},ct.prototype.isLastPage=function(){return this.getLastPage()===this.getCurrent()},ct.prototype.setCurrent=function(tt){this.pageChange.emit(tt)},ct.prototype.getCurrent=function(){return this.service.getCurrentPage(this.id)},ct.prototype.getLastPage=function(){var tt=this.service.getInstance(this.id);return tt.totalItems<1?1:Math.ceil(tt.totalItems/tt.itemsPerPage)},ct.prototype.getTotalItems=function(){return this.service.getInstance(this.id).totalItems},ct.prototype.checkValidId=function(){null==this.service.getInstance(this.id).id&&console.warn('PaginationControlsDirective: the specified id "'+this.id+'" does not match any registered PaginationInstance')},ct.prototype.updatePageLinks=function(){var tt=this,mt=this.service.getInstance(this.id),gt=this.outOfBoundCorrection(mt);gt!==mt.currentPage?setTimeout(function(){tt.pageBoundsCorrection.emit(gt),tt.pages=tt.createPageArray(mt.currentPage,mt.itemsPerPage,mt.totalItems,tt.maxSize)}):this.pages=this.createPageArray(mt.currentPage,mt.itemsPerPage,mt.totalItems,this.maxSize)},ct.prototype.outOfBoundCorrection=function(tt){var mt=Math.ceil(tt.totalItems/tt.itemsPerPage);return mt<tt.currentPage&&0<mt?mt:tt.currentPage<1?1:tt.currentPage},ct.prototype.createPageArray=function(tt,mt,gt,tn){tn=+tn;for(var an=[],bn=Math.max(Math.ceil(gt/mt),1),Pn=Math.ceil(tn/2),Or=tt<=Pn,Jr=bn-Pn<tt,qt=!Or&&!Jr,kn=tn<bn,Ve=1;Ve<=bn&&Ve<=tn;){var ln=this.calculatePageNumber(Ve,tt,tn,bn);an.push({label:kn&&(2===Ve&&(qt||Jr)||Ve===tn-1&&(qt||Or))?"...":ln,value:ln}),Ve++}return an},ct.prototype.calculatePageNumber=function(tt,mt,gt,tn){var an=Math.ceil(gt/2);return tt===gt?tn:1===tt?tt:gt<tn?tn-an<mt?tn-gt+tt:an<mt?mt-an+tt:tt:tt},zn([(0,D.IIB)(),gn("design:type",String)],ct.prototype,"id",void 0),zn([(0,D.IIB)(),gn("design:type",Number)],ct.prototype,"maxSize",void 0),zn([(0,D.r_U)(),gn("design:type",D.vpe)],ct.prototype,"pageChange",void 0),zn([(0,D.r_U)(),gn("design:type",D.vpe)],ct.prototype,"pageBoundsCorrection",void 0),(ct=zn([gn("design:paramtypes",[we,D.sBO])],ct)).\u0275fac=function(mt){return new(mt||ct)(D.Y36(we),D.Y36(D.sBO))},ct.\u0275dir=D.lG2({type:ct,selectors:[["pagination-template"],["","pagination-template",""]],inputs:{maxSize:"maxSize",id:"id"},outputs:{pageChange:"pageChange",pageBoundsCorrection:"pageBoundsCorrection"},exportAs:["paginationApi"],features:[D.TTD]}),ct}(),Gn=function(){function ct(){}return ct.\u0275fac=function(mt){return new(mt||ct)},ct.\u0275mod=D.oAB({type:ct}),ct.\u0275inj=D.cJS({providers:[we],imports:[[A.ez]]}),ct}()},9603:(Mt,at)=>{at.encode=function(te){var D="";for(var A in te)te.hasOwnProperty(A)&&(D.length&&(D+="&"),D+=encodeURIComponent(A)+"="+encodeURIComponent(te[A]));return D},at.decode=function(te){for(var D={},A=te.split("&"),R=0,u=A.length;R<u;R++){var ge=A[R].split("=");D[decodeURIComponent(ge[0])]=decodeURIComponent(ge[1])}return D}},4171:Mt=>{var at=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,te=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];Mt.exports=function(u){var ge=u,Se=u.indexOf("["),Ce=u.indexOf("]");-1!=Se&&-1!=Ce&&(u=u.substring(0,Se)+u.substring(Se,Ce).replace(/:/g,";")+u.substring(Ce,u.length));for(var ce=at.exec(u||""),ae={},ve=14;ve--;)ae[te[ve]]=ce[ve]||"";return-1!=Se&&-1!=Ce&&(ae.source=ge,ae.host=ae.host.substring(1,ae.host.length-1).replace(/;/g,":"),ae.authority=ae.authority.replace("[","").replace("]","").replace(/;/g,":"),ae.ipv6uri=!0),ae.pathNames=function(R,u){var Se=u.replace(/\/{2,9}/g,"/").split("/");return("/"==u.substr(0,1)||0===u.length)&&Se.splice(0,1),"/"==u.substr(u.length-1,1)&&Se.splice(Se.length-1,1),Se}(0,ae.path),ae.queryKey=function(R,u){var ge={};return u.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(Se,Ce,ce){Ce&&(ge[Ce]=ce)}),ge}(0,ae.query),ae}},7574:(Mt,at,te)=>{"use strict";te.d(at,{y:()=>Ue});var D=te(7393),R=te(9181),u=te(6490),Se=te(6554),Ce=te(4487);var ve=te(2494);let Ue=(()=>{class we{constructor(Ne){this._isScalar=!1,Ne&&(this._subscribe=Ne)}lift(Ne){const ke=new we;return ke.source=this,ke.operator=Ne,ke}subscribe(Ne,ke,lt){const{operator:Ot}=this,Je=function(we,Oe,Ne){if(we){if(we instanceof D.L)return we;if(we[R.b])return we[R.b]()}return we||Oe||Ne?new D.L(we,Oe,Ne):new D.L(u.c)}(Ne,ke,lt);if(Je.add(Ot?Ot.call(Je,this.source):this.source||ve.v.useDeprecatedSynchronousErrorHandling&&!Je.syncErrorThrowable?this._subscribe(Je):this._trySubscribe(Je)),ve.v.useDeprecatedSynchronousErrorHandling&&Je.syncErrorThrowable&&(Je.syncErrorThrowable=!1,Je.syncErrorThrown))throw Je.syncErrorValue;return Je}_trySubscribe(Ne){try{return this._subscribe(Ne)}catch(ke){ve.v.useDeprecatedSynchronousErrorHandling&&(Ne.syncErrorThrown=!0,Ne.syncErrorValue=ke),function(we){for(;we;){const{closed:Oe,destination:Ne,isStopped:ke}=we;if(Oe||ke)return!1;we=Ne&&Ne instanceof D.L?Ne:null}return!0}(Ne)?Ne.error(ke):console.warn(ke)}}forEach(Ne,ke){return new(ke=Be(ke))((lt,Ot)=>{let Je;Je=this.subscribe(Me=>{try{Ne(Me)}catch(Ge){Ot(Ge),Je&&Je.unsubscribe()}},Ot,lt)})}_subscribe(Ne){const{source:ke}=this;return ke&&ke.subscribe(Ne)}[Se.L](){return this}pipe(...Ne){return 0===Ne.length?this:function(we){return 0===we.length?Ce.y:1===we.length?we[0]:function(Ne){return we.reduce((ke,lt)=>lt(ke),Ne)}}(Ne)(this)}toPromise(Ne){return new(Ne=Be(Ne))((ke,lt)=>{let Ot;this.subscribe(Je=>Ot=Je,Je=>lt(Je),()=>ke(Ot))})}}return we.create=Oe=>new we(Oe),we})();function Be(we){if(we||(we=ve.v.Promise||Promise),!we)throw new Error("no Promise impl found");return we}},6490:(Mt,at,te)=>{"use strict";te.d(at,{c:()=>R});var D=te(2494),A=te(4449);const R={closed:!0,next(u){},error(u){if(D.v.useDeprecatedSynchronousErrorHandling)throw u;(0,A.z)(u)},complete(){}}},7709:(Mt,at,te)=>{"use strict";te.d(at,{xQ:()=>ce,Yc:()=>Ce});var D=te(7574),A=te(7393),R=te(5319),u=te(7971);class ge extends R.w{constructor(Ue,Be){super(),this.subject=Ue,this.subscriber=Be,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const Ue=this.subject,Be=Ue.observers;if(this.subject=null,!Be||0===Be.length||Ue.isStopped||Ue.closed)return;const we=Be.indexOf(this.subscriber);-1!==we&&Be.splice(we,1)}}var Se=te(9181);class Ce extends A.L{constructor(Ue){super(Ue),this.destination=Ue}}let ce=(()=>{class ve extends D.y{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Se.b](){return new Ce(this)}lift(Be){const we=new ae(this,this);return we.operator=Be,we}next(Be){if(this.closed)throw new u.N;if(!this.isStopped){const{observers:we}=this,Oe=we.length,Ne=we.slice();for(let ke=0;ke<Oe;ke++)Ne[ke].next(Be)}}error(Be){if(this.closed)throw new u.N;this.hasError=!0,this.thrownError=Be,this.isStopped=!0;const{observers:we}=this,Oe=we.length,Ne=we.slice();for(let ke=0;ke<Oe;ke++)Ne[ke].error(Be);this.observers.length=0}complete(){if(this.closed)throw new u.N;this.isStopped=!0;const{observers:Be}=this,we=Be.length,Oe=Be.slice();for(let Ne=0;Ne<we;Ne++)Oe[Ne].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(Be){if(this.closed)throw new u.N;return super._trySubscribe(Be)}_subscribe(Be){if(this.closed)throw new u.N;return this.hasError?(Be.error(this.thrownError),R.w.EMPTY):this.isStopped?(Be.complete(),R.w.EMPTY):(this.observers.push(Be),new ge(this,Be))}asObservable(){const Be=new D.y;return Be.source=this,Be}}return ve.create=(Ue,Be)=>new ae(Ue,Be),ve})();class ae extends ce{constructor(Ue,Be){super(),this.destination=Ue,this.source=Be}next(Ue){const{destination:Be}=this;Be&&Be.next&&Be.next(Ue)}error(Ue){const{destination:Be}=this;Be&&Be.error&&this.destination.error(Ue)}complete(){const{destination:Ue}=this;Ue&&Ue.complete&&this.destination.complete()}_subscribe(Ue){const{source:Be}=this;return Be?this.source.subscribe(Ue):R.w.EMPTY}}},7393:(Mt,at,te)=>{"use strict";te.d(at,{L:()=>Ce});var D=te(9105),A=te(6490),R=te(5319),u=te(9181),ge=te(2494),Se=te(4449);class Ce extends R.w{constructor(ve,Ue,Be){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=A.c;break;case 1:if(!ve){this.destination=A.c;break}if("object"==typeof ve){ve instanceof Ce?(this.syncErrorThrowable=ve.syncErrorThrowable,this.destination=ve,ve.add(this)):(this.syncErrorThrowable=!0,this.destination=new ce(this,ve));break}default:this.syncErrorThrowable=!0,this.destination=new ce(this,ve,Ue,Be)}}[u.b](){return this}static create(ve,Ue,Be){const we=new Ce(ve,Ue,Be);return we.syncErrorThrowable=!1,we}next(ve){this.isStopped||this._next(ve)}error(ve){this.isStopped||(this.isStopped=!0,this._error(ve))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(ve){this.destination.next(ve)}_error(ve){this.destination.error(ve),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:ve}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=ve,this}}class ce extends Ce{constructor(ve,Ue,Be,we){super(),this._parentSubscriber=ve;let Oe,Ne=this;(0,D.m)(Ue)?Oe=Ue:Ue&&(Oe=Ue.next,Be=Ue.error,we=Ue.complete,Ue!==A.c&&(Ne=Object.create(Ue),(0,D.m)(Ne.unsubscribe)&&this.add(Ne.unsubscribe.bind(Ne)),Ne.unsubscribe=this.unsubscribe.bind(this))),this._context=Ne,this._next=Oe,this._error=Be,this._complete=we}next(ve){if(!this.isStopped&&this._next){const{_parentSubscriber:Ue}=this;ge.v.useDeprecatedSynchronousErrorHandling&&Ue.syncErrorThrowable?this.__tryOrSetError(Ue,this._next,ve)&&this.unsubscribe():this.__tryOrUnsub(this._next,ve)}}error(ve){if(!this.isStopped){const{_parentSubscriber:Ue}=this,{useDeprecatedSynchronousErrorHandling:Be}=ge.v;if(this._error)Be&&Ue.syncErrorThrowable?(this.__tryOrSetError(Ue,this._error,ve),this.unsubscribe()):(this.__tryOrUnsub(this._error,ve),this.unsubscribe());else if(Ue.syncErrorThrowable)Be?(Ue.syncErrorValue=ve,Ue.syncErrorThrown=!0):(0,Se.z)(ve),this.unsubscribe();else{if(this.unsubscribe(),Be)throw ve;(0,Se.z)(ve)}}}complete(){if(!this.isStopped){const{_parentSubscriber:ve}=this;if(this._complete){const Ue=()=>this._complete.call(this._context);ge.v.useDeprecatedSynchronousErrorHandling&&ve.syncErrorThrowable?(this.__tryOrSetError(ve,Ue),this.unsubscribe()):(this.__tryOrUnsub(Ue),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(ve,Ue){try{ve.call(this._context,Ue)}catch(Be){if(this.unsubscribe(),ge.v.useDeprecatedSynchronousErrorHandling)throw Be;(0,Se.z)(Be)}}__tryOrSetError(ve,Ue,Be){if(!ge.v.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{Ue.call(this._context,Be)}catch(we){return ge.v.useDeprecatedSynchronousErrorHandling?(ve.syncErrorValue=we,ve.syncErrorThrown=!0,!0):((0,Se.z)(we),!0)}return!1}_unsubscribe(){const{_parentSubscriber:ve}=this;this._context=null,this._parentSubscriber=null,ve.unsubscribe()}}},5319:(Mt,at,te)=>{"use strict";te.d(at,{w:()=>Se});var D=te(9796),A=te(1555),R=te(9105);const ge=(()=>{function ce(ae){return Error.call(this),this.message=ae?`${ae.length} errors occurred during unsubscription:\n${ae.map((ve,Ue)=>`${Ue+1}) ${ve.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=ae,this}return ce.prototype=Object.create(Error.prototype),ce})();class Se{constructor(ae){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,ae&&(this._ctorUnsubscribe=!0,this._unsubscribe=ae)}unsubscribe(){let ae;if(this.closed)return;let{_parentOrParents:ve,_ctorUnsubscribe:Ue,_unsubscribe:Be,_subscriptions:we}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,ve instanceof Se)ve.remove(this);else if(null!==ve)for(let Oe=0;Oe<ve.length;++Oe)ve[Oe].remove(this);if((0,R.m)(Be)){Ue&&(this._unsubscribe=void 0);try{Be.call(this)}catch(Oe){ae=Oe instanceof ge?Ce(Oe.errors):[Oe]}}if((0,D.k)(we)){let Oe=-1,Ne=we.length;for(;++Oe<Ne;){const ke=we[Oe];if((0,A.K)(ke))try{ke.unsubscribe()}catch(lt){ae=ae||[],lt instanceof ge?ae=ae.concat(Ce(lt.errors)):ae.push(lt)}}}if(ae)throw new ge(ae)}add(ae){let ve=ae;if(!ae)return Se.EMPTY;switch(typeof ae){case"function":ve=new Se(ae);case"object":if(ve===this||ve.closed||"function"!=typeof ve.unsubscribe)return ve;if(this.closed)return ve.unsubscribe(),ve;if(!(ve instanceof Se)){const we=ve;ve=new Se,ve._subscriptions=[we]}break;default:throw new Error("unrecognized teardown "+ae+" added to Subscription.")}let{_parentOrParents:Ue}=ve;if(null===Ue)ve._parentOrParents=this;else if(Ue instanceof Se){if(Ue===this)return ve;ve._parentOrParents=[Ue,this]}else{if(-1!==Ue.indexOf(this))return ve;Ue.push(this)}const Be=this._subscriptions;return null===Be?this._subscriptions=[ve]:Be.push(ve),ve}remove(ae){const ve=this._subscriptions;if(ve){const Ue=ve.indexOf(ae);-1!==Ue&&ve.splice(Ue,1)}}}var ce;function Ce(ce){return ce.reduce((ae,ve)=>ae.concat(ve instanceof ge?ve.errors:ve),[])}Se.EMPTY=((ce=new Se).closed=!0,ce)},2494:(Mt,at,te)=>{"use strict";te.d(at,{v:()=>A});let D=!1;const A={Promise:void 0,set useDeprecatedSynchronousErrorHandling(R){if(R){const u=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+u.stack)}else D&&console.log("RxJS: Back to a better error behavior. Thank you. <3");D=R},get useDeprecatedSynchronousErrorHandling(){return D}}},5345:(Mt,at,te)=>{"use strict";te.d(at,{IY:()=>u,Ds:()=>Se,ft:()=>ce});var D=te(7393),A=te(7574),R=te(7444);class u extends D.L{constructor(ve){super(),this.parent=ve}_next(ve){this.parent.notifyNext(ve)}_error(ve){this.parent.notifyError(ve),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Se extends D.L{notifyNext(ve){this.destination.next(ve)}notifyError(ve){this.destination.error(ve)}notifyComplete(){this.destination.complete()}}function ce(ae,ve){if(ve.closed)return;if(ae instanceof A.y)return ae.subscribe(ve);let Ue;try{Ue=(0,R.s)(ae)(ve)}catch(Be){ve.error(Be)}return Ue}},2441:(Mt,at,te)=>{"use strict";te.d(at,{c:()=>ge,N:()=>Se});var D=te(7709),A=te(7574),R=te(5319),u=te(1307);class ge extends A.y{constructor(Ue,Be){super(),this.source=Ue,this.subjectFactory=Be,this._refCount=0,this._isComplete=!1}_subscribe(Ue){return this.getSubject().subscribe(Ue)}getSubject(){const Ue=this._subject;return(!Ue||Ue.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let Ue=this._connection;return Ue||(this._isComplete=!1,Ue=this._connection=new R.w,Ue.add(this.source.subscribe(new Ce(this.getSubject(),this))),Ue.closed&&(this._connection=null,Ue=R.w.EMPTY)),Ue}refCount(){return(0,u.x)()(this)}}const Se=(()=>{const ve=ge.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:ve._subscribe},_isComplete:{value:ve._isComplete,writable:!0},getSubject:{value:ve.getSubject},connect:{value:ve.connect},refCount:{value:ve.refCount}}})();class Ce extends D.Yc{constructor(Ue,Be){super(Ue),this.connectable=Be}_error(Ue){this._unsubscribe(),super._error(Ue)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const Ue=this.connectable;if(Ue){this.connectable=null;const Be=Ue._connection;Ue._refCount=0,Ue._subject=null,Ue._connection=null,Be&&Be.unsubscribe()}}}},4402:(Mt,at,te)=>{"use strict";te.d(at,{D:()=>Ne});var D=te(7574),A=te(7444),R=te(5319),u=te(6554),Ce=te(4087),ce=te(377),Ue=te(4072),Be=te(9489);function Ne(ke,lt){return lt?function(ke,lt){if(null!=ke){if(function(ke){return ke&&"function"==typeof ke[u.L]}(ke))return function(ke,lt){return new D.y(Ot=>{const Je=new R.w;return Je.add(lt.schedule(()=>{const Me=ke[u.L]();Je.add(Me.subscribe({next(Ge){Je.add(lt.schedule(()=>Ot.next(Ge)))},error(Ge){Je.add(lt.schedule(()=>Ot.error(Ge)))},complete(){Je.add(lt.schedule(()=>Ot.complete()))}}))})),Je})}(ke,lt);if((0,Ue.t)(ke))return function(ke,lt){return new D.y(Ot=>{const Je=new R.w;return Je.add(lt.schedule(()=>ke.then(Me=>{Je.add(lt.schedule(()=>{Ot.next(Me),Je.add(lt.schedule(()=>Ot.complete()))}))},Me=>{Je.add(lt.schedule(()=>Ot.error(Me)))}))),Je})}(ke,lt);if((0,Be.z)(ke))return(0,Ce.r)(ke,lt);if(function(ke){return ke&&"function"==typeof ke[ce.hZ]}(ke)||"string"==typeof ke)return function(ke,lt){if(!ke)throw new Error("Iterable cannot be null");return new D.y(Ot=>{const Je=new R.w;let Me;return Je.add(()=>{Me&&"function"==typeof Me.return&&Me.return()}),Je.add(lt.schedule(()=>{Me=ke[ce.hZ](),Je.add(lt.schedule(function(){if(Ot.closed)return;let Ge,Lt;try{const Ht=Me.next();Ge=Ht.value,Lt=Ht.done}catch(Ht){return void Ot.error(Ht)}Lt?Ot.complete():(Ot.next(Ge),this.schedule())}))})),Je})}(ke,lt)}throw new TypeError((null!==ke&&typeof ke||ke)+" is not observable")}(ke,lt):ke instanceof D.y?ke:new D.y((0,A.s)(ke))}},6693:(Mt,at,te)=>{"use strict";te.d(at,{n:()=>u});var D=te(7574),A=te(5015),R=te(4087);function u(ge,Se){return Se?(0,R.r)(ge,Se):new D.y((0,A.V)(ge))}},5917:(Mt,at,te)=>{"use strict";te.d(at,{of:()=>u});var D=te(4869),A=te(6693),R=te(4087);function u(...ge){let Se=ge[ge.length-1];return(0,D.K)(Se)?(ge.pop(),(0,R.r)(ge,Se)):(0,A.n)(ge)}},5304:(Mt,at,te)=>{"use strict";te.d(at,{K:()=>A});var D=te(5345);function A(ge){return function(Ce){const ce=new R(ge),ae=Ce.lift(ce);return ce.caught=ae}}class R{constructor(Se){this.selector=Se}call(Se,Ce){return Ce.subscribe(new u(Se,this.selector,this.caught))}}class u extends D.Ds{constructor(Se,Ce,ce){super(Se),this.selector=Ce,this.caught=ce}error(Se){if(!this.isStopped){let Ce;try{Ce=this.selector(Se,this.caught)}catch(ve){return void super.error(ve)}this._unsubscribeAndRecycle();const ce=new D.IY(this);this.add(ce);const ae=(0,D.ft)(Ce,ce);ae!==ce&&this.add(ae)}}}},4612:(Mt,at,te)=>{"use strict";te.d(at,{b:()=>A});var D=te(9773);function A(R,u){return(0,D.zg)(R,u,1)}},5435:(Mt,at,te)=>{"use strict";te.d(at,{h:()=>A});var D=te(7393);function A(ge,Se){return function(ce){return ce.lift(new R(ge,Se))}}class R{constructor(Se,Ce){this.predicate=Se,this.thisArg=Ce}call(Se,Ce){return Ce.subscribe(new u(Se,this.predicate,this.thisArg))}}class u extends D.L{constructor(Se,Ce,ce){super(Se),this.predicate=Ce,this.thisArg=ce,this.count=0}_next(Se){let Ce;try{Ce=this.predicate.call(this.thisArg,Se,this.count++)}catch(ce){return void this.destination.error(ce)}Ce&&this.destination.next(Se)}}},8002:(Mt,at,te)=>{"use strict";te.d(at,{U:()=>A});var D=te(7393);function A(ge,Se){return function(ce){if("function"!=typeof ge)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return ce.lift(new R(ge,Se))}}class R{constructor(Se,Ce){this.project=Se,this.thisArg=Ce}call(Se,Ce){return Ce.subscribe(new u(Se,this.project,this.thisArg))}}class u extends D.L{constructor(Se,Ce,ce){super(Se),this.project=Ce,this.count=0,this.thisArg=ce||this}_next(Se){let Ce;try{Ce=this.project.call(this.thisArg,Se,this.count++)}catch(ce){return void this.destination.error(ce)}this.destination.next(Ce)}}},3282:(Mt,at,te)=>{"use strict";te.d(at,{J:()=>R});var D=te(9773),A=te(4487);function R(u=Number.POSITIVE_INFINITY){return(0,D.zg)(A.y,u)}},9773:(Mt,at,te)=>{"use strict";te.d(at,{zg:()=>u});var D=te(8002),A=te(4402),R=te(5345);function u(ce,ae,ve=Number.POSITIVE_INFINITY){return"function"==typeof ae?Ue=>Ue.pipe(u((Be,we)=>(0,A.D)(ce(Be,we)).pipe((0,D.U)((Oe,Ne)=>ae(Be,Oe,we,Ne))),ve)):("number"==typeof ae&&(ve=ae),Ue=>Ue.lift(new ge(ce,ve)))}class ge{constructor(ae,ve=Number.POSITIVE_INFINITY){this.project=ae,this.concurrent=ve}call(ae,ve){return ve.subscribe(new Se(ae,this.project,this.concurrent))}}class Se extends R.Ds{constructor(ae,ve,Ue=Number.POSITIVE_INFINITY){super(ae),this.project=ve,this.concurrent=Ue,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(ae){this.active<this.concurrent?this._tryNext(ae):this.buffer.push(ae)}_tryNext(ae){let ve;const Ue=this.index++;try{ve=this.project(ae,Ue)}catch(Be){return void this.destination.error(Be)}this.active++,this._innerSub(ve)}_innerSub(ae){const ve=new R.IY(this),Ue=this.destination;Ue.add(ve);const Be=(0,R.ft)(ae,ve);Be!==ve&&Ue.add(Be)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(ae){this.destination.next(ae)}notifyComplete(){const ae=this.buffer;this.active--,ae.length>0?this._next(ae.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},1307:(Mt,at,te)=>{"use strict";te.d(at,{x:()=>A});var D=te(7393);function A(){return function(Se){return Se.lift(new R(Se))}}class R{constructor(Se){this.connectable=Se}call(Se,Ce){const{connectable:ce}=this;ce._refCount++;const ae=new u(Se,ce),ve=Ce.subscribe(ae);return ae.closed||(ae.connection=ce.connect()),ve}}class u extends D.L{constructor(Se,Ce){super(Se),this.connectable=Ce}_unsubscribe(){const{connectable:Se}=this;if(!Se)return void(this.connection=null);this.connectable=null;const Ce=Se._refCount;if(Ce<=0)return void(this.connection=null);if(Se._refCount=Ce-1,Ce>1)return void(this.connection=null);const{connection:ce}=this,ae=Se._connection;this.connection=null,ae&&(!ce||ae===ce)&&ae.unsubscribe()}}},3190:(Mt,at,te)=>{"use strict";te.d(at,{w:()=>u});var D=te(8002),A=te(4402),R=te(5345);function u(Ce,ce){return"function"==typeof ce?ae=>ae.pipe(u((ve,Ue)=>(0,A.D)(Ce(ve,Ue)).pipe((0,D.U)((Be,we)=>ce(ve,Be,Ue,we))))):ae=>ae.lift(new ge(Ce))}class ge{constructor(ce){this.project=ce}call(ce,ae){return ae.subscribe(new Se(ce,this.project))}}class Se extends R.Ds{constructor(ce,ae){super(ce),this.project=ae,this.index=0}_next(ce){let ae;const ve=this.index++;try{ae=this.project(ce,ve)}catch(Ue){return void this.destination.error(Ue)}this._innerSub(ae)}_innerSub(ce){const ae=this.innerSubscription;ae&&ae.unsubscribe();const ve=new R.IY(this),Ue=this.destination;Ue.add(ve),this.innerSubscription=(0,R.ft)(ce,ve),this.innerSubscription!==ve&&Ue.add(this.innerSubscription)}_complete(){const{innerSubscription:ce}=this;(!ce||ce.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(ce){this.destination.next(ce)}}},3342:(Mt,at,te)=>{"use strict";te.d(at,{b:()=>u});var D=te(7393);function A(){}var R=te(9105);function u(Ce,ce,ae){return function(Ue){return Ue.lift(new ge(Ce,ce,ae))}}class ge{constructor(ce,ae,ve){this.nextOrObserver=ce,this.error=ae,this.complete=ve}call(ce,ae){return ae.subscribe(new Se(ce,this.nextOrObserver,this.error,this.complete))}}class Se extends D.L{constructor(ce,ae,ve,Ue){super(ce),this._tapNext=A,this._tapError=A,this._tapComplete=A,this._tapError=ve||A,this._tapComplete=Ue||A,(0,R.m)(ae)?(this._context=this,this._tapNext=ae):ae&&(this._context=ae,this._tapNext=ae.next||A,this._tapError=ae.error||A,this._tapComplete=ae.complete||A)}_next(ce){try{this._tapNext.call(this._context,ce)}catch(ae){return void this.destination.error(ae)}this.destination.next(ce)}_error(ce){try{this._tapError.call(this._context,ce)}catch(ae){return void this.destination.error(ae)}this.destination.error(ce)}_complete(){try{this._tapComplete.call(this._context)}catch(ce){return void this.destination.error(ce)}return this.destination.complete()}}},4087:(Mt,at,te)=>{"use strict";te.d(at,{r:()=>R});var D=te(7574),A=te(5319);function R(u,ge){return new D.y(Se=>{const Ce=new A.w;let ce=0;return Ce.add(ge.schedule(function(){ce!==u.length?(Se.next(u[ce++]),Se.closed||Ce.add(this.schedule())):Se.complete()})),Ce})}},377:(Mt,at,te)=>{"use strict";te.d(at,{hZ:()=>A});const A="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"},6554:(Mt,at,te)=>{"use strict";te.d(at,{L:()=>D});const D="function"==typeof Symbol&&Symbol.observable||"@@observable"},9181:(Mt,at,te)=>{"use strict";te.d(at,{b:()=>D});const D="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()},7971:(Mt,at,te)=>{"use strict";te.d(at,{N:()=>A});const A=(()=>{function R(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return R.prototype=Object.create(Error.prototype),R})()},4449:(Mt,at,te)=>{"use strict";function D(A){setTimeout(()=>{throw A},0)}te.d(at,{z:()=>D})},4487:(Mt,at,te)=>{"use strict";function D(A){return A}te.d(at,{y:()=>D})},9796:(Mt,at,te)=>{"use strict";te.d(at,{k:()=>D});const D=Array.isArray||(A=>A&&"number"==typeof A.length)},9489:(Mt,at,te)=>{"use strict";te.d(at,{z:()=>D});const D=A=>A&&"number"==typeof A.length&&"function"!=typeof A},9105:(Mt,at,te)=>{"use strict";function D(A){return"function"==typeof A}te.d(at,{m:()=>D})},1555:(Mt,at,te)=>{"use strict";function D(A){return null!==A&&"object"==typeof A}te.d(at,{K:()=>D})},4072:(Mt,at,te)=>{"use strict";function D(A){return!!A&&"function"!=typeof A.subscribe&&"function"==typeof A.then}te.d(at,{t:()=>D})},4869:(Mt,at,te)=>{"use strict";function D(A){return A&&"function"==typeof A.schedule}te.d(at,{K:()=>D})},7444:(Mt,at,te)=>{"use strict";te.d(at,{s:()=>Ue});var D=te(5015),A=te(4449),u=te(377),Se=te(6554),ce=te(9489),ae=te(4072),ve=te(1555);const Ue=Be=>{if(Be&&"function"==typeof Be[Se.L])return(Be=>we=>{const Oe=Be[Se.L]();if("function"!=typeof Oe.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return Oe.subscribe(we)})(Be);if((0,ce.z)(Be))return(0,D.V)(Be);if((0,ae.t)(Be))return(Be=>we=>(Be.then(Oe=>{we.closed||(we.next(Oe),we.complete())},Oe=>we.error(Oe)).then(null,A.z),we))(Be);if(Be&&"function"==typeof Be[u.hZ])return(Be=>we=>{const Oe=Be[u.hZ]();for(;;){let Ne;try{Ne=Oe.next()}catch(ke){return we.error(ke),we}if(Ne.done){we.complete();break}if(we.next(Ne.value),we.closed)break}return"function"==typeof Oe.return&&we.add(()=>{Oe.return&&Oe.return()}),we})(Be);{const Oe=`You provided ${(0,ve.K)(Be)?"an invalid object":`'${Be}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(Oe)}}},5015:(Mt,at,te)=>{"use strict";te.d(at,{V:()=>D});const D=A=>R=>{for(let u=0,ge=A.length;u<ge&&!R.closed;u++)R.next(A[u]);R.complete()}},561:function(Mt){var D;D=function(){var te=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function D(Se){return Se.match(te)||[]}function R(Se){return{language:(Se=D(Se))[1]||"",extlang:Se[2]||"",script:Se[3]||"",region:Se[4]||""}}function u(Se,Ce,ce){Object.defineProperty(Se,Ce,{value:ce,enumerable:!0})}function ge(Se,Ce,ce){function ae(ve){return D(ve)[Se]||""}u(ae,"pattern",Ce),u(R,ce,ae)}return ge(1,/^[a-zA-Z]{2,3}$/,"language"),ge(2,/^[a-zA-Z]{3}$/,"extlang"),ge(3,/^[a-zA-Z]{4}$/,"script"),ge(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),u(R,"split",function(Se){return D(Se).filter(function(Ce,ce){return Ce&&ce})}),R},Mt.exports?Mt.exports=D():this.subtag=D()},2462:(Mt,at,te)=>{"use strict";var D=te(2095);Mt.exports=D,"undefined"!=typeof window&&(window.Suggestions=D)},6578:Mt=>{"use strict";var at=function(te){return this.component=te,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,te.el.parentNode.insertBefore(this.wrapper,te.el.nextSibling),this};at.prototype.show=function(){this.element.style.display="block"},at.prototype.hide=function(){this.element.style.display="none"},at.prototype.add=function(te){this.items.push(te)},at.prototype.clear=function(){this.items=[],this.active=0},at.prototype.isEmpty=function(){return!this.items.length},at.prototype.isVisible=function(){return"block"===this.element.style.display},at.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var te=0;te<this.items.length;te++)this.drawItem(this.items[te],this.active===te);this.show()}else this.hide()},at.prototype.drawItem=function(te,D){var A=document.createElement("li"),R=document.createElement("a");D&&(A.className+=" active"),R.innerHTML=te.string,A.appendChild(R),this.element.appendChild(A),A.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),A.addEventListener("mouseup",function(){this.handleMouseUp.call(this,te)}.bind(this))},at.prototype.handleMouseUp=function(te){this.selectingListItem=!1,this.component.value(te.original),this.clear(),this.draw()},at.prototype.move=function(te){this.active=te,this.draw()},at.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},at.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},at.prototype.drawError=function(te){var D=document.createElement("li");D.innerHTML=te,this.element.appendChild(D),this.show()},Mt.exports=at},2095:(Mt,at,te)=>{"use strict";var D=te(166),A=te(6499),R=te(6578),u=function(ge,Se,Ce){return this.options=D({minLength:2,limit:5,filter:!0,hideOnBlur:!0},Ce=Ce||{}),this.el=ge,this.data=Se||[],this.list=new R(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(ce){this.handleKeyUp(ce.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(ce){this.handleKeyDown(ce)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(ce){this.handlePaste(ce)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};u.prototype.handleKeyUp=function(ge){40===ge||38===ge||27===ge||13===ge||9===ge||this.handleInputChange(this.el.value)},u.prototype.handleKeyDown=function(ge){switch(ge.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&ge.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},u.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},u.prototype.handlePaste=function(ge){if(ge.clipboardData)this.handleInputChange(ge.clipboardData.getData("Text"));else{var Se=this;setTimeout(function(){Se.handleInputChange(ge.target.value)},100)}},u.prototype.handleInputChange=function(ge){this.query=this.normalize(ge),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(Se){for(var Ce=0;Ce<Se.length&&(this.list.add(Se[Ce]),Ce!==this.options.limit-1);Ce++);this.list.draw()}.bind(this))},u.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},u.prototype.update=function(ge){this.data=ge,this.handleKeyUp()},u.prototype.clear=function(){this.data=[],this.list.clear()},u.prototype.normalize=function(ge){return ge.toLowerCase()},u.prototype.match=function(ge,Se){return ge.indexOf(Se)>-1},u.prototype.value=function(ge){if(this.selected=ge,this.el.value=this.getItemValue(ge),document.createEvent){var Se=document.createEvent("HTMLEvents");Se.initEvent("change",!0,!1),this.el.dispatchEvent(Se)}else this.el.fireEvent("onchange")},u.prototype.getCandidates=function(ge){var Se={pre:"<strong>",post:"</strong>",extract:function(ce){return this.getItemValue(ce)}.bind(this)};ge(this.options.filter?A.filter(this.query,this.data,Se).map(function(ce){return{original:ce.original,string:this.render(ce.original,ce.string)}}.bind(this)):this.data.map(function(ce){return{original:ce,string:this.render(ce)}}.bind(this)))},u.prototype.getItemValue=function(ge){return ge},u.prototype.render=function(ge,Se){if(Se)return Se;for(var Ce=this.getItemValue(ge.original?ge.original:ge),ce=this.normalize(Ce),ae=ce.lastIndexOf(this.query);ae>-1;){var ve=ae+this.query.length;Ce=Ce.slice(0,ae)+"<strong>"+Ce.slice(ae,ve)+"</strong>"+Ce.slice(ve),ae=ce.slice(0,ae).lastIndexOf(this.query)}return Ce},u.prototype.renderError=function(ge){this.list.drawError(ge)},Mt.exports=u},166:Mt=>{Mt.exports=function(){for(var D={},A=0;A<arguments.length;A++){var R=arguments[A];for(var u in R)at.call(R,u)&&(D[u]=R[u])}return D};var at=Object.prototype.hasOwnProperty},5391:Mt=>{"use strict";var u,at="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),D={},A=0,R=0;function ge(ce){var ae="";do{ae=at[ce%64]+ae,ce=Math.floor(ce/64)}while(ce>0);return ae}function Ce(){var ce=ge(+new Date);return ce!==u?(A=0,u=ce):ce+"."+ge(A++)}for(;R<64;R++)D[at[R]]=R;Ce.encode=ge,Ce.decode=function(ce){var ae=0;for(R=0;R<ce.length;R++)ae=64*ae+D[ce.charAt(R)];return ae},Mt.exports=Ce},2542:(Mt,at,te)=>{"use strict";te.d(at,{e:()=>ce});var D=te(1841),A=te(5917),R=te(3342),u=te(8002),ge=te(5304),Se=te(2340),Ce=te(639);let ce=(()=>{class ae{constructor(Ue){this.http=Ue,this.baseUrl=Se.N.baseUrl}get user(){return Object.assign({},this._user)}register(Ue,Be,we,Oe,Ne,ke){return this.http.post(`${this.baseUrl}api/auth/new`,{email:we,name:Ue,password:Oe,username:Be,userImage:ke,description:Ne}).pipe((0,R.b)(({})=>{}),(0,u.U)(Je=>Je.ok),(0,ge.K)(Je=>(0,A.of)(Je.error.msg)))}login(Ue,Be){return this.http.post(`${this.baseUrl}api/auth`,{email:Ue,password:Be}).pipe((0,R.b)(Ne=>{Ne.ok&&localStorage.setItem("token",Ne.token)}),(0,u.U)(Ne=>Ne.ok),(0,ge.K)(Ne=>(0,A.of)(Ne.error.msg)))}validateToken(){const Ue=`${this.baseUrl}api/auth/renew`,Be=localStorage.getItem("token")||"";if(!Be)return(0,A.of)(!1);const we=(new D.WM).set("x-token",Be);return this.http.get(Ue,{headers:we}).pipe((0,u.U)(Oe=>(localStorage.setItem("token",Oe.token),localStorage.setItem("uid",Oe.uid),this._user={name:Oe.name,uid:Oe.uid,email:Oe.email},Oe.ok)),(0,ge.K)(Oe=>(0,A.of)(!1)))}logout(){let Ue=localStorage.getItem("rffDarkMode");localStorage.clear(),localStorage.setItem("rffDarkMode",Ue),window.location.reload()}}return ae.\u0275fac=function(Ue){return new(Ue||ae)(Ce.LFG(D.eN))},ae.\u0275prov=Ce.Yz7({token:ae,factory:ae.\u0275fac,providedIn:"root"}),ae})()},3932:(Mt,at,te)=>{"use strict";te.r(at),te.d(at,{EstablishmentModule:()=>Jr});var D=te(8583),A=te(1385),R=te(639),u=te(2958),ge=te(2763),Ce=(te(2369),te(2340)),ce=te(1841);let ae=(()=>{class qt{constructor(Ve){this.http=Ve,this.baseUrl=Ce.N.baseUrl}getAllEstablishments(){return this.http.get(`${this.baseUrl}api/establishment/getAllEstablishments`).toPromise()}getAllTags(){return this.http.get(`${this.baseUrl}api/establishment/getAllTags`).toPromise()}getAllEstablishmentsFilter(Ve,zt,ln){return this.http.post(`${this.baseUrl}api/establishment/getAllEstablishmentsFilter`,{tags:{tagsE:Ve,tagsC:zt,tagsD:ln}}).toPromise()}}return qt.\u0275fac=function(Ve){return new(Ve||qt)(R.LFG(ce.eN))},qt.\u0275prov=R.Yz7({token:qt,factory:qt.\u0275fac,providedIn:"root"}),qt})();const ve=function(qt){return{color:qt}};function Ue(qt,kn){if(1&qt){const Ve=R.EpF();R.TgZ(0,"a",7),R.NdJ("click",function(){const Rn=R.CHM(Ve).$implicit;return R.oxw().onSubmit(Rn._id)}),R._uU(1),R.qZA()}if(2&qt){const Ve=kn.$implicit;R.Q6J("id",Ve._id)("ngStyle",R.VKq(3,ve,Ve.color)),R.xp6(1),R.Oqu(Ve.name)}}const Be=function(){return{color:"black"}};let we=(()=>{class qt{constructor(){this.listSelected=[""],this.listResponse=new R.vpe}onSubmit(Ve){var zt,ln,Rn,ir,Vn,ri,Zn,xi;if(null===(ln=null===(zt=document.getElementById(Ve))||void 0===zt?void 0:zt.getAttribute("class"))||void 0===ln?void 0:ln.includes("active")){if("todos"!=Ve){let yr=this.listSelected.indexOf(Ve);this.listSelected.splice(yr,1),null===(Rn=document.getElementById(Ve))||void 0===Rn||Rn.setAttribute("class","dropdown-item"),1==this.listSelected.length&&(null===(ir=document.getElementById(this.type))||void 0===ir||ir.setAttribute("class","dropdown-item all active"))}}else if("todos"==Ve){for(let yr=0;yr<this.listTag.length;yr++)null===(Vn=document.getElementById(this.listTag[yr]._id))||void 0===Vn||Vn.setAttribute("class","dropdown-item");null===(ri=document.getElementById(this.type))||void 0===ri||ri.setAttribute("class","dropdown-item all active"),this.listSelected.splice(1,this.listSelected.length-1)}else console.log(this.listSelected),-1==this.listSelected.indexOf(Ve)&&(null===(Zn=document.getElementById(Ve))||void 0===Zn||Zn.setAttribute("class","dropdown-item active"),null===(xi=document.getElementById(this.type))||void 0===xi||xi.setAttribute("class","dropdown-item all"),this.listSelected.push(Ve));this.listResponse.emit({list:this.listSelected})}ngOnInit(){let Ve=document.getElementsByClassName("all");for(let zt=0;zt<Ve.length;zt++)Ve[zt].setAttribute("class","dropdown-item all active")}}return qt.\u0275fac=function(Ve){return new(Ve||qt)},qt.\u0275cmp=R.Xpm({type:qt,selectors:[["app-filter"]],inputs:{listTag:"listTag",type:"type"},outputs:{listResponse:"listResponse"},decls:9,vars:5,consts:[[1,"filterSeparated"],[1,"btn-group"],["type","button","data-toggle","dropdown","aria-haspopup","true","aria-expanded","false",1,"btn","dropdown-toggle"],[1,"dropdown-menu"],["class","dropdown-item",3,"id","ngStyle","click",4,"ngFor","ngForOf"],[1,"dropdown-divider"],[1,"dropdown-item","all",3,"id","ngStyle","click"],[1,"dropdown-item",3,"id","ngStyle","click"]],template:function(Ve,zt){1&Ve&&(R.TgZ(0,"div",0),R.TgZ(1,"div",1),R.TgZ(2,"button",2),R._uU(3),R.qZA(),R.TgZ(4,"div",3),R.YNc(5,Ue,2,5,"a",4),R._UZ(6,"div",5),R.TgZ(7,"a",6),R.NdJ("click",function(){return zt.onSubmit("todos")}),R._uU(8,"Todos"),R.qZA(),R.qZA(),R.qZA(),R.qZA()),2&Ve&&(R.xp6(3),R.hij(" ",zt.type," "),R.xp6(2),R.Q6J("ngForOf",zt.listTag),R.xp6(2),R.Q6J("id",zt.type)("ngStyle",R.DdM(4,Be)))},directives:[D.sg,D.PC],styles:["button[_ngcontent-%COMP%]{width:100%;font-weight:bold;font-family:var(--main-font);border-radius:1rem 0 0;text-decoration:none;color:var(--main-blue-color);background-color:var(--main-yellow-color)}button[_ngcontent-%COMP%]:hover{color:var(--main-yellow-color);background-color:var(--main-blue-color);text-decoration:none}.dropdown-menu.show[_ngcontent-%COMP%]{background-color:var(--main-yellow-filter);font-family:var(--main-font);font-weight:bold}.dropdown-item[_ngcontent-%COMP%]:hover{cursor:pointer}.dropdown-item[_ngcontent-%COMP%], .dropdown-item[_ngcontent-%COMP%]{filter:brightness(70%)}.dropdown-item.active[_ngcontent-%COMP%], .dropdown-item[_ngcontent-%COMP%]:active{background-color:#c7c7c7;filter:brightness(100%)}@media (max-width: 768px){.btn-group[_ngcontent-%COMP%], .btn-group-vertical[_ngcontent-%COMP%]{position:relative;display:block}button[_ngcontent-%COMP%]{text-align:right}}@media (max-width: 400px){button[_ngcontent-%COMP%]{font-weight:bold;font-size:4vw;font-family:var(--main-font);border-radius:1rem 0 0;text-decoration:none;color:var(--main-blue-color)}}"]}),qt})(),Oe=(()=>{class qt{constructor(Ve){this.http=Ve,this.baseUrl=Ce.N.baseUrl}obtainRatingEstablishment(Ve){return this.http.get(`${this.baseUrl}api/rating/obtainRatingEstablishment/${Ve}`).toPromise()}createRating(Ve,zt,ln,Rn,ir,Vn){return this.http.post(`${this.baseUrl}api/rating/new`,{realfoodRating:Ve,confortRating:ln,priceRating:Rn,comment:zt,establishment:ir,user:Vn}).toPromise()}}return qt.\u0275fac=function(Ve){return new(Ve||qt)(R.LFG(ce.eN))},qt.\u0275prov=R.Yz7({token:qt,factory:qt.\u0275fac,providedIn:"root"}),qt})();var Ne=te(3071),ke=te(665);function lt(qt,kn){if(1&qt&&(R.TgZ(0,"div",82),R._UZ(1,"img",12),R.qZA()),2&qt){const Ve=kn.$implicit;R.xp6(1),R.uIk("src",Ve.url,R.LSH)}}function Ot(qt,kn){1&qt&&(R.TgZ(0,"a",83),R._UZ(1,"span",84),R.qZA())}function Je(qt,kn){1&qt&&(R.TgZ(0,"a",85),R._UZ(1,"span",86),R.qZA())}function Me(qt,kn){1&qt&&(R.TgZ(0,"span"),R._uU(1,"..."),R.qZA())}const Ge=function(qt){return{"background-color":qt}};function Lt(qt,kn){if(1&qt&&(R.TgZ(0,"span",87),R._uU(1),R.qZA()),2&qt){const Ve=kn.$implicit;R.Q6J("ngStyle",R.VKq(2,Ge,Ve.color)),R.xp6(1),R.Oqu(Ve.name)}}function Ht(qt,kn){if(1&qt&&(R.TgZ(0,"span",87),R._uU(1),R.qZA()),2&qt){const Ve=kn.$implicit;R.Q6J("ngStyle",R.VKq(2,Ge,Ve.color)),R.xp6(1),R.Oqu(Ve.name)}}function zn(qt,kn){if(1&qt&&(R.TgZ(0,"span",87),R._uU(1),R.qZA()),2&qt){const Ve=kn.$implicit;R.Q6J("ngStyle",R.VKq(2,Ge,Ve.color)),R.xp6(1),R.Oqu(Ve.name)}}function gn(qt,kn){1&qt&&(R.TgZ(0,"div",88),R._uU(1," 5 / 5 "),R.TgZ(2,"div",89),R._uU(3," (0 valoraciones)"),R.qZA(),R.qZA())}function Xt(qt,kn){if(1&qt&&(R.TgZ(0,"div",88),R._uU(1),R.TgZ(2,"div",89),R._uU(3," (1 valoraci\xf3n)"),R.qZA(),R.qZA()),2&qt){const Ve=R.oxw(2);R.xp6(1),R.hij(" ",Ve.average," / 5 ")}}function In(qt,kn){if(1&qt&&(R.TgZ(0,"div",88),R._uU(1),R.TgZ(2,"div",89),R._uU(3),R.qZA(),R.qZA()),2&qt){const Ve=R.oxw(2);R.xp6(1),R.hij(" ",Ve.average," / 5 "),R.xp6(2),R.hij(" (",Ve.ratingsNumber," valoraciones)")}}function Gn(qt,kn){1&qt&&R._UZ(0,"i",90)}function ct(qt,kn){1&qt&&R._UZ(0,"i",91)}function tt(qt,kn){if(1&qt){const Ve=R.EpF();R.TgZ(0,"div",8),R.TgZ(1,"div",9),R.TgZ(2,"div",10),R.TgZ(3,"div",11),R._UZ(4,"img",12),R.qZA(),R.YNc(5,lt,2,1,"div",13),R.qZA(),R.YNc(6,Ot,2,0,"a",14),R.YNc(7,Je,2,0,"a",15),R.TgZ(8,"div",16),R.NdJ("click",function(){return R.CHM(Ve),R.oxw().emitClose()}),R._UZ(9,"i",17),R.qZA(),R.TgZ(10,"div",18),R.NdJ("click",function(){return R.CHM(Ve),R.oxw().changeView()}),R._uU(11),R.qZA(),R.qZA(),R._UZ(12,"div",19),R.TgZ(13,"div",20),R.TgZ(14,"div",21),R.TgZ(15,"div",22),R.TgZ(16,"div"),R._uU(17),R.YNc(18,Me,2,0,"span",23),R.qZA(),R.qZA(),R.TgZ(19,"div",24),R.YNc(20,Lt,2,4,"span",25),R.YNc(21,Ht,2,4,"span",25),R.YNc(22,zn,2,4,"span",25),R.qZA(),R.TgZ(23,"div",26),R._UZ(24,"span",27),R.YNc(25,gn,4,0,"div",28),R.YNc(26,Xt,4,1,"div",28),R.YNc(27,In,4,2,"div",28),R.qZA(),R.TgZ(28,"div",29),R._UZ(29,"span",30),R.TgZ(30,"div",31),R.TgZ(31,"div"),R._uU(32,"Horario:"),R.qZA(),R.TgZ(33,"div",32),R._uU(34),R.qZA(),R.TgZ(35,"div",32),R._uU(36),R.qZA(),R.qZA(),R.qZA(),R.TgZ(37,"div",33),R._UZ(38,"span",34),R.TgZ(39,"div",31),R.TgZ(40,"div"),R._uU(41,"Direcci\xf3n:"),R.qZA(),R.TgZ(42,"div",32),R._uU(43),R.qZA(),R.qZA(),R.qZA(),R.TgZ(44,"div",35),R.TgZ(45,"div",36),R.NdJ("click",function(){return R.CHM(Ve),R.oxw().setFavorite()}),R.YNc(46,Gn,1,0,"i",37),R.YNc(47,ct,1,0,"i",38),R.TgZ(48,"span",39),R._uU(49,"GUARDAR"),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.TgZ(50,"div",40),R.TgZ(51,"div",41),R._uU(52,"Rellena las calificaciones y env\xeda tu valoraci\xf3n:"),R.qZA(),R.TgZ(53,"form",42,43),R.NdJ("ngSubmit",function(){R.CHM(Ve);const ln=R.MAs(54);return R.oxw().onSubmit(ln)}),R.TgZ(55,"div",44),R._uU(56," Nivel de comida real: "),R.TgZ(57,"p",45),R._UZ(58,"input",46),R.TgZ(59,"label",47),R._uU(60,"\u2605"),R.qZA(),R._UZ(61,"input",48),R.TgZ(62,"label",49),R._uU(63,"\u2605"),R.qZA(),R._UZ(64,"input",50),R.TgZ(65,"label",51),R._uU(66,"\u2605"),R.qZA(),R._UZ(67,"input",52),R.TgZ(68,"label",53),R._uU(69,"\u2605"),R.qZA(),R._UZ(70,"input",54),R.TgZ(71,"label",55),R._uU(72,"\u2605"),R.qZA(),R.qZA(),R.qZA(),R.TgZ(73,"div",56),R._uU(74," Trato recibido: "),R.TgZ(75,"p",45),R._UZ(76,"input",57),R.TgZ(77,"label",58),R._uU(78,"\u2605"),R.qZA(),R._UZ(79,"input",59),R.TgZ(80,"label",60),R._uU(81,"\u2605"),R.qZA(),R._UZ(82,"input",61),R.TgZ(83,"label",62),R._uU(84,"\u2605"),R.qZA(),R._UZ(85,"input",63),R.TgZ(86,"label",64),R._uU(87,"\u2605"),R.qZA(),R._UZ(88,"input",65),R.TgZ(89,"label",66),R._uU(90,"\u2605"),R.qZA(),R.qZA(),R.qZA(),R.TgZ(91,"div",67),R._uU(92," Calidad/precio: "),R.TgZ(93,"p",45),R._UZ(94,"input",68),R.TgZ(95,"label",69),R._uU(96,"\u2605"),R.qZA(),R._UZ(97,"input",70),R.TgZ(98,"label",71),R._uU(99,"\u2605"),R.qZA(),R._UZ(100,"input",72),R.TgZ(101,"label",73),R._uU(102,"\u2605"),R.qZA(),R._UZ(103,"input",74),R.TgZ(104,"label",75),R._uU(105,"\u2605"),R.qZA(),R._UZ(106,"input",76),R.TgZ(107,"label",77),R._uU(108,"\u2605"),R.qZA(),R.qZA(),R.qZA(),R._UZ(109,"textarea",78),R.TgZ(110,"div",79),R.TgZ(111,"button"),R._uU(112,"Enviar"),R.qZA(),R._UZ(113,"button",80),R.qZA(),R.qZA(),R.qZA(),R.TgZ(114,"div",81),R._uU(115," Valoraci\xf3n guardada correctamente "),R.qZA(),R.qZA()}if(2&qt){const Ve=R.oxw();R.xp6(4),R.uIk("src",Ve.establishment.image[0].url,R.LSH),R.xp6(1),R.Q6J("ngForOf",Ve.establishment.image.slice(1,Ve.establishment.image.length)),R.xp6(1),R.Q6J("ngIf",Ve.establishment.image.length>1),R.xp6(1),R.Q6J("ngIf",Ve.establishment.image.length>1),R.xp6(4),R.Oqu(Ve.contentButton),R.xp6(2),R.Q6J("ngClass","Valorar"==Ve.contentButton?"basicInfo":"basicInfo notView"),R.xp6(4),R.Oqu(Ve.establishment.name.substring(0,47)),R.xp6(1),R.Q6J("ngIf",Ve.establishment.name.length>47),R.xp6(2),R.Q6J("ngForOf",Ve.dbTagE),R.xp6(1),R.Q6J("ngForOf",Ve.dbTagC),R.xp6(1),R.Q6J("ngForOf",Ve.dbTagD),R.xp6(3),R.Q6J("ngIf",0===Ve.ratingsNumber),R.xp6(1),R.Q6J("ngIf",1===Ve.ratingsNumber),R.xp6(1),R.Q6J("ngIf",Ve.ratingsNumber>1),R.xp6(7),R.Oqu(Ve.establishment.labour),R.xp6(2),R.Oqu(Ve.establishment.weekend),R.xp6(7),R.Oqu(Ve.establishment.location),R.xp6(3),R.Q6J("ngIf",!Ve.isFavorite),R.xp6(1),R.Q6J("ngIf",Ve.isFavorite),R.xp6(3),R.Q6J("ngClass","Valorar"!=Ve.contentButton?"rating container":"rating notView container"),R.xp6(64),R.Q6J("ngClass",Ve.isSent?"block":"none")}}let mt=(()=>{class qt{constructor(Ve,zt,ln,Rn){this.ratingService=Ve,this.router=zt,this.userService=ln,this.establismentService=Rn,this.close=new R.vpe,this.isSent=!1,this.isFavorite=!1,this.dbTagE=new Array,this.dbTagC=new Array,this.dbTagD=new Array,this.rating1=1,this.rating2=1,this.rating3=1,this.comment=""}get actualUrl(){return this.router.url}get whatsAppUrl(){return"https://api.whatsapp.com/send?text="+this.actualUrl}get twitterUrl(){return"https://twitter.com/intent/tweet?url="+this.actualUrl}get faceBookUrl(){return"https://www.facebook.com/sharer/sharer.php?u="+this.router.url}onSubmit(Ve){Ve.value.estrellas1&&(this.rating1=Ve.value.estrellas1),Ve.value.estrellas2&&(this.rating2=Ve.value.estrellas2),Ve.value.estrellas3&&(this.rating3=Ve.value.estrellas3),Ve.value.comment&&(this.comment=Ve.value.comment);let zt=localStorage.getItem("uid");null==zt?this.router.navigate(["auth/login"]):this.ratingService.createRating(this.rating1,this.comment,this.rating2,this.rating3,this.establishment._id,zt).then(ln=>{var Rn;ln.ok&&(this.obtainRatingEstablishment(),null===(Rn=document.getElementById("buttonReset"))||void 0===Rn||Rn.click(),this.isSent=!0,setTimeout(()=>{this.isSent=!1},3e3))})}obtainRatingEstablishment(){this.ratingService.obtainRatingEstablishment(this.establishment._id).then(Ve=>{this.ratings=Ve.ratings,this.ratingsNumber=this.ratings.length;let zt=0;for(let ln=0;ln<Ve.ratings.length;ln++)zt+=parseInt(Ve.ratings[ln].confortRating+Ve.ratings[ln].priceRating+Ve.ratings[ln].realfoodRating);Ve.ratings.length>0&&(zt=5*zt/(15*Ve.ratings.length)),this.average=Math.round(zt)})}ngOnInit(){this.contentButton="Valorar",this.obtainRatingEstablishment(),this.isEstablishmentFavorite(),this.getTags()}emitClose(){this.close.emit("back")}changeView(){this.contentButton="Valorar"==this.contentButton?"Ver Detalles":"Valorar",console.log(this.contentButton)}isEstablishmentFavorite(){let Ve=localStorage.getItem("uid");null!=Ve&&this.userService.isUserEstablishmentFavorite(Ve,this.establishment._id).subscribe(zt=>{console.log(zt),this.isFavorite=zt.Founded})}setFavorite(){console.log("FAV");let Ve=localStorage.getItem("uid");null==Ve?this.router.navigate(["auth/login"]):this.userService.setUserEstablishmentFavorite(Ve,this.establishment._id).then(zt=>{console.log(zt),this.isFavorite=zt.newValue,this.isFavorite?this.showAlertPostFav():this.showAlertPostNoFav()})}showAlertPostFav(){var Ve=document.querySelector("#alertPostFav");Ve.classList.remove("hiddenAlert"),Ve.classList.add("showAlert"),setTimeout(()=>{Ve.classList.remove("showAlert"),Ve.classList.add("hiddenAlert")},2e3)}showAlertPostNoFav(){var Ve=document.querySelector("#alertPostNoFav");Ve.classList.remove("hiddenAlert"),Ve.classList.add("showAlert"),setTimeout(()=>{Ve.classList.remove("showAlert"),Ve.classList.add("hiddenAlert")},2e3)}getTags(){this.establismentService.getAllTags().then(Ve=>{Ve.dbTagE.length>0&&Ve.dbTagE.forEach(zt=>{this.establishment.type.includes(zt._id)&&this.dbTagE.push(zt)}),Ve.dbTagC.length>0&&Ve.dbTagC.forEach(zt=>{this.establishment.type.includes(zt._id)&&this.dbTagC.push(zt)}),Ve.dbTagD.length>0&&Ve.dbTagD.forEach(zt=>{this.establishment.type.includes(zt._id)&&this.dbTagD.push(zt)})})}}return qt.\u0275fac=function(Ve){return new(Ve||qt)(R.Y36(Oe),R.Y36(A.F0),R.Y36(Ne.K),R.Y36(ae))},qt.\u0275cmp=R.Xpm({type:qt,selectors:[["app-establishment-detail"]],inputs:{establishment:"establishment"},outputs:{close:"close"},decls:13,vars:1,consts:[["class","card-details",4,"ngIf"],["id","alertPostFav","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"hiddenAlert"],[1,"rff-modal-dialog"],[1,"rff-modal-content"],[1,"bi","bi-heart-fill","icon-fav",2,"color","#E9705A"],[1,"alert-text","mt-4",2,"margin","0"],["id","alertPostNoFav","tabindex","-1","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"hiddenAlert"],[1,"bi","bi-trash",2,"font-size","7rem","color","#E9705A"],[1,"card-details"],["id","carouselExampleIndicators","data-interval","false",1,"carousel"],[1,"carousel-inner"],[1,"carousel-item","active"],["alt","",1,"d-block","w-100"],["class","carousel-item",4,"ngFor","ngForOf"],["class","carousel-control-prev","href","#carouselExampleIndicators","role","button","data-slide","prev",4,"ngIf"],["class","carousel-control-next","href","#carouselExampleIndicators","role","button","data-slide","next",4,"ngIf"],[1,"back",3,"click"],[1,"bi","bi-chevron-left"],[1,"rateButton",3,"click"],[1,"botomImg"],[3,"ngClass"],[1,"container"],[1,"name"],[4,"ngIf"],[1,"mx-2"],["class","badge rounded-pill",3,"ngStyle",4,"ngFor","ngForOf"],[1,"star"],["data-icon","bx:bxs-star",1,"iconify",2,"color","#f8c887"],["class","value",4,"ngIf"],[1,"timeTable"],["data-icon","eva:clock-outline",1,"iconify","icon-info"],[1,"result"],[1,"valueDB"],[1,"location"],["data-icon","fluent:location-20-regular",1,"iconify","icon-info"],[1,"post-details-bar","mt-1"],[1,"post-fav",3,"click"],["class","bi bi-heart post-icon",4,"ngIf"],["class","bi bi-heart-fill post-icon",4,"ngIf"],[1,"post-icon-text"],["id","ratingContainer",3,"ngClass"],[1,"marginContainer"],[3,"ngSubmit"],["f","ngForm"],["id","firstRating",1,"ratingValue","marginContainer"],[1,"clasification"],["id","radio11","type","radio","name","estrellas1","ngModel","","value","5"],["for","radio11"],["id","radio21","type","radio","name","estrellas1","ngModel","","value","4"],["for","radio21"],["id","radio31","type","radio","name","estrellas1","ngModel","","value","3"],["for","radio31"],["id","radio41","type","radio","name","estrellas1","ngModel","","value","2"],["for","radio41"],["id","radio51","type","radio","name","estrellas1","ngModel","","value","1"],["for","radio51",1,"first"],[1,"ratingValue","marginContainer"],["id","radio12","type","radio","name","estrellas2","ngModel","","value","5"],["for","radio12"],["id","radio22","type","radio","name","estrellas2","ngModel","","value","4"],["for","radio22"],["id","radio32","type","radio","name","estrellas2","ngModel","","value","3"],["for","radio32"],["id","radio42","type","radio","name","estrellas2","ngModel","","value","2"],["for","radio42"],["id","radio52","type","radio","name","estrellas2","ngModel","","value","1"],["for","radio52",1,"first"],[1,"ratingValue","marginContainer",2,"margin-bottom","15px"],["id","radio13","type","radio","name","estrellas3","ngModel","","value","5"],["for","radio13"],["id","radio23","type","radio","name","estrellas3","ngModel","","value","4"],["for","radio23"],["id","radio33","type","radio","name","estrellas3","ngModel","","value","3"],["for","radio33"],["id","radio43","type","radio","name","estrellas3","ngModel","","value","2"],["for","radio43"],["id","radio53","type","radio","name","estrellas3","ngModel","","value","1"],["for","radio53",1,"first"],["id","textarea","rows","3","name","comment","ngModel","","placeholder","A\xf1ade un comentario (opcional)",1,"form-control","marginContainer"],[1,"buttonSend","marginContainer",2,"display","flex","justify-content","end"],["id","buttonReset","type","reset",2,"display","none"],["id","alert",1,"alert","alert-success",3,"ngClass"],[1,"carousel-item"],["href","#carouselExampleIndicators","role","button","data-slide","prev",1,"carousel-control-prev"],["aria-hidden","true",1,"carousel-control-prev-icon"],["href","#carouselExampleIndicators","role","button","data-slide","next",1,"carousel-control-next"],["aria-hidden","true",1,"carousel-control-next-icon"],[1,"badge","rounded-pill",3,"ngStyle"],[1,"value"],[1,"numberRating"],[1,"bi","bi-heart","post-icon"],[1,"bi","bi-heart-fill","post-icon"]],template:function(Ve,zt){1&Ve&&(R.YNc(0,tt,116,21,"div",0),R.TgZ(1,"div",1),R.TgZ(2,"div",2),R.TgZ(3,"div",3),R._UZ(4,"i",4),R.TgZ(5,"p",5),R._uU(6,"Guardado en favoritos"),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.TgZ(7,"div",6),R.TgZ(8,"div",2),R.TgZ(9,"div",3),R._UZ(10,"i",7),R.TgZ(11,"p",5),R._uU(12,"Eliminado de favoritos"),R.qZA(),R.qZA(),R.qZA(),R.qZA()),2&Ve&&R.Q6J("ngIf",null!=zt.establishment)},directives:[D.O5,D.sg,D.mk,ke._Y,ke.JL,ke.F,ke._,ke.Fj,ke.JJ,ke.On,D.PC],styles:[".rating.notView[_ngcontent-%COMP%]{display:none}.basicInfo.notView[_ngcontent-%COMP%]{display:none}.marginContainer[_ngcontent-%COMP%]{margin-right:15px;margin-left:15px}#ratingContainer[_ngcontent-%COMP%]{padding-top:3vh;font-family:var(--main-font);color:var(--main-font-color)}.card-details[_ngcontent-%COMP%]{width:60vh;height:72vh;z-index:1}.mx-2[_ngcontent-%COMP%]{overflow:auto;max-height:15vh;display:-webkit-box}.icon-info[_ngcontent-%COMP%]{color:var(--main-orange-color)}.iconify[_ngcontent-%COMP%]{width:10%}.result[_ngcontent-%COMP%]{width:90%}.container[_ngcontent-%COMP%]{height:45vh;font-family:var(--main-font);color:var(--main-font-color);padding-bottom:10px;overflow:auto}.back[_ngcontent-%COMP%]{z-index:1;cursor:pointer;display:flex;justify-content:center;align-items:center;background-color:var(--main-green-color);height:4vh;width:20%;position:absolute;bottom:0;border-top-right-radius:1rem}.back[_ngcontent-%COMP%]:hover{color:#f8f1ef;background-color:var(--main-blue-color)}.rateButton[_ngcontent-%COMP%]{z-index:1;font-family:var(--main-font);cursor:pointer;display:flex;justify-content:center;align-items:center;background-color:var(--main-blue-color);border-top-left-radius:1rem;height:4vh;min-width:30%;width:-moz-fit-content;width:fit-content;padding-left:10px;padding-right:10px;position:absolute;bottom:0;right:0;color:#f8f1ef}.rateButton[_ngcontent-%COMP%]:hover{color:var(--main-blue-color);background-color:var(--main-green-color)}.alert[_ngcontent-%COMP%]{position:absolute;right:20px;left:20px;bottom:0;margin-bottom:10px;text-align:center;overflow:inherit}.block[_ngcontent-%COMP%]{display:block}.none[_ngcontent-%COMP%]{display:none}.form-control[_ngcontent-%COMP%]{margin-bottom:10px;background-color:var(--main-background);color:var(--main-font-color);width:-webkit-fill-available;height:8vh;font-size:1.5vh}#carouselExampleIndicators[_ngcontent-%COMP%]{height:25vh}.botomImg[_ngcontent-%COMP%]{width:100%;height:2vh;background-color:var(--main-green-color)}.carousel-inner[_ngcontent-%COMP%]{border-top-right-radius:1rem;height:100%}.carousel-item[_ngcontent-%COMP%]{height:100%}img.d-block[_ngcontent-%COMP%]{height:100%;object-fit:cover}img.icon[_ngcontent-%COMP%]{max-width:2vw;max-height:2vw;margin-right:15px}.containerImg[_ngcontent-%COMP%]{width:3vw}.star[_ngcontent-%COMP%]   .containerImg[_ngcontent-%COMP%]{font-size:4.5vh}.name[_ngcontent-%COMP%]{line-height:2.5vh;display:flex;font-weight:bold;font-size:3vh;justify-content:left;padding-top:3vh;margin-left:15px;margin-right:15px}.post-likes[_ngcontent-%COMP%], .post-fav[_ngcontent-%COMP%], .post-share[_ngcontent-%COMP%]{font-size:2vh;margin-top:5px}.location[_ngcontent-%COMP%]{display:flex;margin-top:2vh;justify-content:left;align-items:flex-start;font-weight:normal;font-size:2.5vh;margin-left:15px;margin-right:15px}.timeTable[_ngcontent-%COMP%]{display:flex;margin-top:2vh;justify-content:left;align-items:flex-start;font-weight:normal;font-size:2.5vh;margin-left:15px;margin-right:15px}.valueDB[_ngcontent-%COMP%]{font-size:2vh;line-height:2.5vh}.star[_ngcontent-%COMP%]{display:flex;margin-top:2vh;justify-content:left;align-items:center;font-weight:normal;font-size:2.5vh;margin-left:15px;margin-right:15px}.value[_ngcontent-%COMP%]{display:flex}.numberRating[_ngcontent-%COMP%]{font-size:2vh;margin-left:10px}.rating[_ngcontent-%COMP%]{overflow:auto;display:block;justify-content:left;align-items:center;font-weight:normal;font-size:2.8vh;padding:1vh 15px;height:45vh}.ratingValue[_ngcontent-%COMP%]{margin-top:1.5vh;font-size:2.5vh;display:flex;align-items:center;justify-content:space-between}form[_ngcontent-%COMP%]{text-align:center}#form[_ngcontent-%COMP%]{width:250px;margin:0 auto;height:50px}#form[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center}#form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:3vw}input[type=radio][_ngcontent-%COMP%]{display:none}label[_ngcontent-%COMP%]{color:gray;cursor:pointer}button[_ngcontent-%COMP%]{font-weight:normal;font-size:1vw;font-weight:bold;border-top-left-radius:1rem;padding:8px;margin-top:5px;margin-bottom:10px;text-decoration:none;color:#363853;background-color:var(--main-orange-color)}button[_ngcontent-%COMP%]:hover{color:#f8f1ef;background-color:#af5646;text-decoration:none}label.first[_ngcontent-%COMP%]{color:var(--main-orange-color)}div.star[_ngcontent-%COMP%]   .containerImg[_ngcontent-%COMP%]{color:var(--main-orange-color)}.clasification[_ngcontent-%COMP%]{direction:rtl;unicode-bidi:bidi-override;font-size:2.5vh;margin:0}label[_ngcontent-%COMP%]:hover, label[_ngcontent-%COMP%]:hover ~ label[_ngcontent-%COMP%]{color:var(--main-orange-color)}input[type=radio][_ngcontent-%COMP%]:checked ~ label[_ngcontent-%COMP%]{color:var(--main-orange-color)}@media (min-width: 576px) and (max-width:700px){.card-details[_ngcontent-%COMP%]{height:72vh;width:65vw}#carouselExampleIndicators[_ngcontent-%COMP%]{height:18vh}.botomImg[_ngcontent-%COMP%]{height:2vh}.container[_ngcontent-%COMP%]{height:39vh}img.icon[_ngcontent-%COMP%]{max-width:3vw;max-height:3vw}.name[_ngcontent-%COMP%]{line-height:3vh;display:flex;font-weight:bold;font-size:3.5vh;justify-content:left;padding-top:3vh;margin-left:15px}.post-likes[_ngcontent-%COMP%], .post-fav[_ngcontent-%COMP%], .post-share[_ngcontent-%COMP%]{font-size:2vh;margin-top:5px}.location[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;font-weight:normal;font-size:2vh;margin-left:15px}.timeTable[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;font-weight:normal;font-size:2vh;margin-left:15px}.valueDB[_ngcontent-%COMP%]{font-size:1.5vh}.rating[_ngcontent-%COMP%]{justify-content:left;align-items:center;font-weight:normal;font-size:2.5vh;padding-left:15px;height:39vh}.ratingValue[_ngcontent-%COMP%]{font-size:2vh}.clasification[_ngcontent-%COMP%]{font-size:2vh}button[_ngcontent-%COMP%]{font-size:1.5vw}.star[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;align-items:center;font-weight:normal;font-size:2vh;margin-left:15px}}@media (min-width:700px) and (max-width:900px){.card-details[_ngcontent-%COMP%]{height:72vh;width:60vw}#carouselExampleIndicators[_ngcontent-%COMP%]{height:20vh}.botomImg[_ngcontent-%COMP%]{height:2vh}.container[_ngcontent-%COMP%]{height:50vh}.name[_ngcontent-%COMP%]{display:flex;font-weight:bold;font-size:3.5vh;line-height:3vh;justify-content:left;padding-top:3vh;margin-left:15px}.post-likes[_ngcontent-%COMP%], .post-fav[_ngcontent-%COMP%], .post-share[_ngcontent-%COMP%]{font-size:2.5vh;margin-top:5px}.location[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;font-weight:normal;font-size:2.5vh;margin-left:15px}.timeTable[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;font-weight:normal;font-size:2.5vh;margin-left:15px}.valueDB[_ngcontent-%COMP%]{font-size:2vh}.rating[_ngcontent-%COMP%]{justify-content:left;align-items:center;font-weight:normal;font-size:2.5vh;padding-left:15px;height:50vh}.ratingValue[_ngcontent-%COMP%]{font-size:2vh}.clasification[_ngcontent-%COMP%]{font-size:2vh}button[_ngcontent-%COMP%]{font-size:1.5vw}.star[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;align-items:center;font-weight:normal;font-size:2.5vh;margin-left:15px}}@media (min-width:900px) and (max-width:1100px){.card-details[_ngcontent-%COMP%]{height:72vh;width:40vw}#carouselExampleIndicators[_ngcontent-%COMP%]{height:20vh}.botomImg[_ngcontent-%COMP%]{height:2vh}.container[_ngcontent-%COMP%]{height:50vh}.name[_ngcontent-%COMP%]{line-height:2.5vh;display:flex;font-weight:bold;font-size:3vh;justify-content:left;padding-top:3vh;margin-left:15px}.post-likes[_ngcontent-%COMP%], .post-fav[_ngcontent-%COMP%], .post-share[_ngcontent-%COMP%]{font-size:2vh;margin-top:5px}.location[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;font-weight:normal;font-size:2vh;margin-left:15px}.timeTable[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;font-weight:normal;font-size:2vh;margin-left:15px}.valueDB[_ngcontent-%COMP%]{font-size:1.5vh}.rating[_ngcontent-%COMP%]{justify-content:left;align-items:center;font-weight:normal;font-size:2.5vh;padding-left:15px;height:50vh}.ratingValue[_ngcontent-%COMP%]{font-size:2vh}.clasification[_ngcontent-%COMP%]{font-size:2vh}button[_ngcontent-%COMP%]{font-size:1.5vw}.star[_ngcontent-%COMP%]{display:flex;margin-top:1.5vh;justify-content:left;align-items:center;font-weight:normal;font-size:2vh;margin-left:15px}}.card-details[_ngcontent-%COMP%]::-webkit-scrollbar{width:7px}.card-details[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:white;border-radius:20px;margin-top:10px;margin-bottom:10px}.card-details[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--main-orange-color);border-radius:20px;margin-top:10px;margin-bottom:10px}.form-control[_ngcontent-%COMP%]::-webkit-scrollbar{width:7px}.form-control[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:white;border-radius:20px;margin-top:10px;margin-bottom:10px}.form-control[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:var(--main-orange-color);border-radius:20px;margin-top:10px;margin-bottom:10px}.alert[_ngcontent-%COMP%]::-webkit-scrollbar{width:1px}.alert[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:rgb(73,107,88);border-radius:20px;margin-top:10px;margin-bottom:10px}.alert[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background-color:#00200a;border-radius:20px;margin-top:10px;margin-bottom:10px}.post-details-bar[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-around;padding:.5rem;border-radius:1rem}.post-likes[_ngcontent-%COMP%], .post-fav[_ngcontent-%COMP%], .post-share[_ngcontent-%COMP%]{cursor:pointer;color:var(--main-orange-color)}.post-likes[_ngcontent-%COMP%]:hover, .post-fav[_ngcontent-%COMP%]:hover, .post-share[_ngcontent-%COMP%]:hover{cursor:pointer;color:#c45e4c}.post-icon[_ngcontent-%COMP%]{font-size:1.2rem;margin-right:.5rem}.post-icon-text[_ngcontent-%COMP%]{font-family:var(--main-font);font-weight:bold}.rff-modal-dialog[_ngcontent-%COMP%]{position:relative;width:auto;margin:.5rem;pointer-events:none}.rff-modal-content[_ngcontent-%COMP%]{position:relative;display:flex;flex-direction:column;align-items:center;width:100%;pointer-events:auto;background-color:var(--main-orange-back);background-clip:padding-box;border:2px solid var(--main-orange-color);border-radius:1rem;padding:2rem;outline:0}.alert-text[_ngcontent-%COMP%]{font-family:var(--main-font);color:var(--main-orange-color);font-weight:bold}.hiddenAlert[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;align-items:center;justify-content:center;visibility:hidden;opacity:1}.showAlert[_ngcontent-%COMP%]{position:fixed;z-index:1;overflow:auto;background-color:#0009;top:0;left:0;right:0;bottom:0;padding-top:10rem;align-items:center;justify-content:center;visibility:visible;opacity:1}.icon-fav[_ngcontent-%COMP%]{font-size:7rem;color:var(--main-orange-color);animation-name:heart;animation-duration:1s;animation-delay:0s;animation-iteration-count:infinite}.badge[_ngcontent-%COMP%]{color:#000;font-weight:bold;font-size:1.5vh;justify-content:left;margin-top:1vw;margin-left:1px;margin-right:1px}@keyframes heart{0%{font-size:7rem}50%{font-size:6rem}to{font-size:7rem}}@media (min-width: 576px){.rff-modal-dialog[_ngcontent-%COMP%]{max-width:300px;margin:1.75rem auto}}@media (max-width: 576px){.card-details[_ngcontent-%COMP%]{width:84vw;height:72vh}.name[_ngcontent-%COMP%]{line-height:2.5vh!important;font-size:3vh!important}.star[_ngcontent-%COMP%]{margin-top:1.5vh;font-size:2vh}.post-likes[_ngcontent-%COMP%], .post-fav[_ngcontent-%COMP%], .post-share[_ngcontent-%COMP%]{font-size:2vh;margin-top:5px}.mx-2[_ngcontent-%COMP%]{margin-top:7px}.timeTable[_ngcontent-%COMP%]{margin-top:1.5vh;font-size:2vh}.valueDB[_ngcontent-%COMP%]{font-size:1.5vh}.location[_ngcontent-%COMP%]{margin-top:1.5vh;font-size:2vh}.post-likes[_ngcontent-%COMP%], .post-fav[_ngcontent-%COMP%], .post-share[_ngcontent-%COMP%]{font-size:1.5vh;margin-top:5px}.post-icon[_ngcontent-%COMP%]{font-size:1.2rem}.iconify[_ngcontent-%COMP%]{font-size:3vh}.rating[_ngcontent-%COMP%]{font-size:2.5vh;line-height:2vh}.ratingValue[_ngcontent-%COMP%]{font-size:2vh;margin-top:.5vh}#firstRating[_ngcontent-%COMP%]{margin-top:1.5vh}.clasification[_ngcontent-%COMP%]{font-size:2vh}button[_ngcontent-%COMP%]{font-size:1.5vh}}.rff-modal-header[_ngcontent-%COMP%]{display:flex;flex-shrink:0;align-items:center;justify-content:space-between;padding:1rem}.modal-title[_ngcontent-%COMP%]{font-family:var(--main-font);font-size:1rem;color:var(--main-orange-color)}.share-apps-list[_ngcontent-%COMP%]{display:flex;justify-content:space-around}.share-app[_ngcontent-%COMP%]{text-align:center;background-color:#eff0ef;border-radius:50%;width:90px;padding:1rem;color:var(--main-orange-color)}.share-app[_ngcontent-%COMP%]:hover{background-color:#31aa70;cursor:pointer;color:#eff0ef}.icon-app[_ngcontent-%COMP%]{font-size:2rem}.app-name[_ngcontent-%COMP%]{font-family:var(--main-font);font-size:.75rem;margin:0}.input-button-url[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;font-family:var(--main-font);background-color:#eff0ef;border:1px solid var(--main-orange-color);border-radius:1rem;padding:.5rem}.modal-input-url[_ngcontent-%COMP%]{border:0;color:var(--main-orange-color);background-color:#eff0ef;width:100%}.modal-button-copy[_ngcontent-%COMP%]{border:0;background:none;color:var(--main-orange-color);font-weight:bold}.hiddenModal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;align-items:center;justify-content:center;visibility:hidden;opacity:0}.showModal[_ngcontent-%COMP%]{position:fixed;z-index:1;width:100%;height:100%;overflow:auto;background-color:#000c;top:0;left:0;right:0;bottom:0;padding-top:10rem;align-items:center;justify-content:center;visibility:visible;opacity:1}"]}),qt})();const gt=["infoEstablishment"];function tn(qt,kn){if(1&qt){const Ve=R.EpF();R.TgZ(0,"app-establishment-detail",7,8),R.NdJ("close",function(ln){return R.CHM(Ve),R.oxw().closeInfo(ln)}),R.qZA()}if(2&qt){const Ve=R.oxw();R.Q6J("establishment",Ve.establishmentSelected)}}function an(qt,kn){1&qt&&(R.TgZ(0,"div"),R.TgZ(1,"div",9),R.TgZ(2,"span",10),R._uU(3,"Loading..."),R.qZA(),R.qZA(),R.qZA())}const Pn=[{path:"",component:(()=>{class qt{constructor(Ve){this.service=Ve,this.establishmentClicked=!1,this.tagRequest1=[],this.tagRequest2=[],this.tagRequest3=[],this.eventsLoaded=!1,this.markers=new Array}filter1(Ve){let zt=[];for(let ln=1;ln<Ve.list.length;ln++)zt.push(Ve.list[ln]);this.tagRequest1=zt,this.getAllEstablishmentsFilter()}filter2(Ve){let zt=[];for(let ln=1;ln<Ve.list.length;ln++)zt.push(Ve.list[ln]);this.tagRequest2=zt,this.getAllEstablishmentsFilter()}filter3(Ve){let zt=[];for(let ln=1;ln<Ve.list.length;ln++)zt.push(Ve.list[ln]);this.tagRequest3=zt,this.getAllEstablishmentsFilter()}getAllEstablishmentsFilter(){this.service.getAllEstablishmentsFilter(this.tagRequest1,this.tagRequest2,this.tagRequest3).then(Ve=>{this.establishments=Ve.dbEstablishment,this.pushMarkers()})}ngOnInit(){this.isCollapsed=!0,this.map=new u.Map({accessToken:Ce.N.mapboxKey,container:"map",style:"mapbox://styles/realfoodiefriends/ckufjvqun7s6q17mwf07oiv2c",center:[-.37739,39.46975],zoom:12});let Ve=new ge({accessToken:Ce.N.mapboxKey,placeholder:"Buscar"});this.map.addControl(Ve,"top-left");let zt=new u.NavigationControl;this.map.addControl(zt,"bottom-right");let ln=new u.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0});this.map.addControl(ln,"bottom-right"),this.obtainEstablishments(),this.eventsLoaded=!0}obtainEstablishments(){this.service.getAllEstablishments().then(Ve=>{this.establishments=Ve.dbEstablishment,this.obtainTags()})}obtainTags(){this.service.getAllTags().then(Ve=>{this.dbTagE=Ve.dbTagE,this.dbTagC=Ve.dbTagC,this.dbTagD=Ve.dbTagD,this.pushMarkers()})}changeFilter(){this.isCollapsed=!this.isCollapsed}pushMarkers(){this.markers&&this.markers.forEach(Ve=>Ve.remove()),this.establishments.forEach(Ve=>{let ln,zt="#FF8A33";for(let Rn=0;Rn<this.dbTagE.length;Rn++)if(-1!=Ve.type.indexOf(this.dbTagE[Rn]._id)){zt=this.dbTagE[Rn].color;break}ln=new u.Marker(this.establishmentClicked&&this.establishmentSelected._id==Ve._id?{color:zt,scale:1.6}:{color:zt,scale:1}),ln.setLngLat([parseFloat(""+Ve.geoposition.longitude),parseFloat(""+Ve.geoposition.latitude)]).addTo(this.map),ln.getElement().addEventListener("click",this.openInfo(Ve)),this.markers.push(ln)})}closeInfo(Ve){("back"==Ve||"mapboxgl-canvas"===Ve.target.className)&&this.infoContainer.clear(),this.pushMarkers(),this.establishmentClicked=!1}openInfo(Ve){return()=>{this.establishmentSelected=Ve,this.establishmentClicked=!0,this.infoContainer.clear(),this.infoContainer.createEmbeddedView(this.template)}}}return qt.\u0275fac=function(Ve){return new(Ve||qt)(R.Y36(ae))},qt.\u0275cmp=R.Xpm({type:qt,selectors:[["app-map"]],viewQuery:function(Ve,zt){if(1&Ve&&(R.Gf(gt,5,R.s_b),R.Gf(R.Rgc,5)),2&Ve){let ln;R.iGM(ln=R.CRH())&&(zt.infoContainer=ln.first),R.iGM(ln=R.CRH())&&(zt.template=ln.first)}},decls:12,vars:7,consts:[[1,"myRow"],["id","first",1,"filter"],[3,"listTag","type","listResponse"],[1,"filter"],["infoEstablishment",""],["id","map",3,"click"],[4,"ngIf"],[1,"info",3,"establishment","close"],["child",""],["role","status",1,"spinner-grow","rff-spinner-loading","mt-4"],[1,"sr-only"]],template:function(Ve,zt){1&Ve&&(R.TgZ(0,"div",0),R.TgZ(1,"div",1),R.TgZ(2,"app-filter",2),R.NdJ("listResponse",function(Rn){return zt.filter1(Rn)}),R.qZA(),R.qZA(),R.TgZ(3,"div",3),R.TgZ(4,"app-filter",2),R.NdJ("listResponse",function(Rn){return zt.filter2(Rn)}),R.qZA(),R.qZA(),R.TgZ(5,"div",3),R.TgZ(6,"app-filter",2),R.NdJ("listResponse",function(Rn){return zt.filter3(Rn)}),R.qZA(),R.qZA(),R.qZA(),R.GkF(7,null,4),R.YNc(9,tn,2,1,"ng-template"),R.TgZ(10,"div",5),R.NdJ("click",function(Rn){return zt.closeInfo(Rn)}),R.qZA(),R.YNc(11,an,4,0,"div",6)),2&Ve&&(R.xp6(2),R.Q6J("listTag",zt.dbTagE)("type","Establecimiento"),R.xp6(2),R.Q6J("listTag",zt.dbTagC)("type","Cocina"),R.xp6(2),R.Q6J("listTag",zt.dbTagD)("type","Dieta Especial"),R.xp6(5),R.Q6J("ngIf",!zt.eventsLoaded))},directives:[we,D.O5,mt],styles:["html[_ngcontent-%COMP%], body[_ngcontent-%COMP%]{height:100%;width:100%;margin:0;padding:0}#map[_ngcontent-%COMP%]{height:82vh;top:9vh;bottom:9vh;right:0;left:0;width:100vw;position:absolute;z-index:0}.rff-spinner-loading[_ngcontent-%COMP%]{color:var(--main-green-color);text-align:center;margin-left:50%}.filter[_ngcontent-%COMP%]{padding-right:10px;margin-top:10px}.filter#first[_ngcontent-%COMP%]{padding-right:10px;margin-top:0}.myRow[_ngcontent-%COMP%]{max-width:50%;display:block;position:absolute;z-index:1;right:0;top:10.5vh;width:auto;text-align:center}.info[_ngcontent-%COMP%]{bottom:10vh;visibility:visible;position:absolute;z-index:1;left:10px;width:auto;background-color:var(--main-green-back);border-top-right-radius:1rem;box-shadow:2px 2px 10px #666}@media screen and (max-width: 640px){button[_ngcontent-%COMP%]{height:45px!important}}.iscollapsed[_ngcontent-%COMP%]{display:none!important}.noCollapsed[_ngcontent-%COMP%]{display:grid!important}button[_ngcontent-%COMP%]{padding-right:25px;text-align:right;width:100%;height:36px;font-weight:bold;font-family:var(--main-font);border-radius:1rem 0 0;text-decoration:none;color:var(--main-blue-color);background-color:var(--main-yellow-color)}button[_ngcontent-%COMP%]:hover{color:var(--main-yellow-color);background-color:var(--main-blue-color);text-decoration:none}@media (min-width:768px){.myRow[_ngcontent-%COMP%]{display:flex;justify-content:right;flex-direction:row;position:absolute;z-index:1;right:0;top:10.5vh;width:100%}.filter[_ngcontent-%COMP%]{margin-top:0}}@media (min-width:840px){.myRow[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:absolute;z-index:1;right:0;top:10.5vh;width:auto}.filter[_ngcontent-%COMP%]{margin-top:0}}@media (min-width:940px){.myRow[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:absolute;z-index:1;right:0;top:10.5vh;width:auto}.filter[_ngcontent-%COMP%]{margin-top:0}}@media (min-width:1100px){.myRow[_ngcontent-%COMP%]{display:flex;flex-direction:row;position:absolute;z-index:1;right:0;top:10.5vh;width:auto}.filter[_ngcontent-%COMP%]{margin-top:0}}"]}),qt})(),children:[{path:"**",redirectTo:"establishment"}]}];let Or=(()=>{class qt{}return qt.\u0275fac=function(Ve){return new(Ve||qt)},qt.\u0275mod=R.oAB({type:qt}),qt.\u0275inj=R.cJS({imports:[[A.Bz.forChild(Pn)],A.Bz]}),qt})(),Jr=(()=>{class qt{}return qt.\u0275fac=function(Ve){return new(Ve||qt)},qt.\u0275mod=R.oAB({type:qt}),qt.\u0275inj=R.cJS({imports:[[D.ez,Or,ke.u5]]}),qt})()},7495:(Mt,at,te)=>{"use strict";te.r(at),te.d(at,{SearchModule:()=>Oe});var D=te(8583),A=te(1385),R=te(639);let u=(()=>{class Ne{constructor(){}ngOnInit(){}}return Ne.\u0275fac=function(lt){return new(lt||Ne)},Ne.\u0275cmp=R.Xpm({type:Ne,selectors:[["app-main"]],decls:2,vars:0,template:function(lt,Ot){1&lt&&(R.TgZ(0,"div"),R._UZ(1,"router-outlet"),R.qZA())},directives:[A.lC],styles:[""]}),Ne})();var ge=te(3071);const Se=["userSearch"];function Ce(Ne,ke){1&Ne&&(R.TgZ(0,"div",13),R.TgZ(1,"p",14),R._uU(2,"No se han encontrado resultados"),R.qZA(),R.qZA())}function ce(Ne,ke){if(1&Ne&&(R.TgZ(0,"div",17),R._UZ(1,"div",18),R.TgZ(2,"div",19),R._UZ(3,"img",20),R.qZA(),R.TgZ(4,"div",21),R.TgZ(5,"p",22),R._uU(6),R.qZA(),R.qZA(),R.qZA()),2&Ne){const lt=R.oxw().$implicit;R.xp6(3),R.uIk("src",lt.userImage,R.LSH),R.xp6(3),R.Oqu(lt.username)}}function ae(Ne,ke){if(1&Ne&&(R.TgZ(0,"a",15),R.YNc(1,ce,7,2,"div",16),R.qZA()),2&Ne){const lt=ke.$implicit;R.MGl("href","user/profile/",lt._id,"",R.LSH),R.xp6(1),R.Q6J("ngIf","ningunoDevuelto"!=lt)}}let ve=(()=>{class Ne{constructor(lt,Ot){this.userService=lt,this.activatedRoute=Ot,this.stringToSearch="",this.usersFiltered=[]}ngOnInit(){this.inputTerm=this.activatedRoute.snapshot.params.id,this.initialText=this.activatedRoute.snapshot.params.id,this.usersFiltered=new Array,this.getAndLoadUsers(),this.hideLoading()}getAndLoadUsers(){this.showLoading(),this.stringToSearch=setTimeout(()=>{this.inputTerm&&this.userService.getUserByTerm(this.inputTerm).subscribe(lt=>{this.usersFiltered=[];for(let Ot=0;Ot<lt.UsersToReturn.length;Ot++)this.usersFiltered.push(lt.UsersToReturn[Ot]);0==this.usersFiltered.length&&(this.usersFiltered=["ningunoDevuelto"]),console.log(this.usersFiltered),this.hideLoading()})},500)}stopGetAndLoadUsers(){clearTimeout(this.stringToSearch)}onKeyUp(lt){this.inputTerm=lt,""!=lt?(this.stopGetAndLoadUsers(),this.getAndLoadUsers()):(this.stopGetAndLoadUsers(),this.usersFiltered=[],this.hideLoading())}showLoading(){document.querySelector(".rff-spinner-loading").style.display="block"}hideLoading(){document.querySelector(".rff-spinner-loading").style.display="none"}}return Ne.\u0275fac=function(lt){return new(lt||Ne)(R.Y36(ge.K),R.Y36(A.gz))},Ne.\u0275cmp=R.Xpm({type:Ne,selectors:[["app-search-user"]],viewQuery:function(lt,Ot){if(1&lt&&R.Gf(Se,5),2&lt){let Je;R.iGM(Je=R.CRH())&&(Ot.userSearch=Je.first)}},decls:17,vars:3,consts:[[1,"container"],[1,"row","py-3"],[1,"col-12"],["list","datalistOptions","id","exampleDataList","type","text","placeholder","Buscar usuario...","autocomplete","off",1,"rff-channel-user-search",3,"value","keyup"],["userSearch",""],[1,"row"],[1,"d-flex","justify-content-center"],["role","status",1,"spinner-grow","rff-spinner-loading","mt-1","text-center"],[1,"sr-only"],[1,"rff-user-list"],["id","divNinguno",4,"ngIf"],[1,"rff-grid","mt-3"],["class","","style","text-decoration : none",3,"href",4,"ngFor","ngForOf"],["id","divNinguno"],[1,"noResult"],[1,"",2,"text-decoration","none",3,"href"],["class","row rff-user-row",4,"ngIf"],[1,"row","rff-user-row"],[1,"col-1","rff-first"],[1,"col-auto"],["alt","",1,""],[1,"col"],[1,"rff-user-card-title"]],template:function(lt,Ot){if(1&lt){const Je=R.EpF();R.TgZ(0,"div",0),R.TgZ(1,"div",1),R.TgZ(2,"div",2),R.TgZ(3,"input",3,4),R.NdJ("keyup",function(){R.CHM(Je);const Ge=R.MAs(4);return Ot.onKeyUp(Ge.value)}),R.qZA(),R.qZA(),R.qZA(),R.TgZ(5,"div",0),R.TgZ(6,"div",5),R.TgZ(7,"div",2),R.TgZ(8,"div",6),R.TgZ(9,"div",7),R.TgZ(10,"span",8),R._uU(11,"Loading..."),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.TgZ(12,"div",2),R.TgZ(13,"div",9),R.YNc(14,Ce,3,0,"div",10),R.TgZ(15,"div",11),R.YNc(16,ae,2,2,"a",12),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA(),R.qZA()}2&lt&&(R.xp6(3),R.s9C("value",Ot.initialText),R.xp6(11),R.Q6J("ngIf",Ot.usersFiltered.length>0&&"ningunoDevuelto"==Ot.usersFiltered[0]),R.xp6(2),R.Q6J("ngForOf",Ot.usersFiltered))},directives:[D.O5,D.sg],styles:[".row[_ngcontent-%COMP%]{align-items:center}.rff-channel-user-search[_ngcontent-%COMP%]{font-family:var(--main-font);border-radius:1rem;padding:.4rem 1rem;border-color:#81d3ab;width:100%;background-color:var(--main-background);color:var(--main-font-color)}.noResult[_ngcontent-%COMP%]{font-family:var(--main-font);font-weight:bold;margin:0;color:var(--main-event-color)}img[_ngcontent-%COMP%]{width:4em!important;height:4em!important;border-radius:100%;object-fit:cover}#divNinguno[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-top:5vh}.rff-user-card-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:bold;color:#212529;margin:0}.rff-first[_ngcontent-%COMP%]{height:100%;background-color:var(--secondary-green-color-search-user)}.rff-user-row[_ngcontent-%COMP%]{margin-top:15px;display:flex;background-color:var(--main-green-back-search-user);height:12vh;border-top-right-radius:1rem;box-shadow:5px 5px 3px #0003}.rff-user-row[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:var(--main-green-color-search-user);transform:translate(-5px,-5px);box-shadow:5px 5px 25px #00000080}.rowCard[_ngcontent-%COMP%]{width:100%;height:100%;margin:0}.rff-grid[_ngcontent-%COMP%]{grid-gap:3rem;gap:3rem}@media (max-width: 560px){.rff-grid[_ngcontent-%COMP%]{display:block}.rff-user-row[_ngcontent-%COMP%]{margin-top:15px;height:12vh}}"]}),Ne})();const Ue=[{path:"",component:u,children:[{path:"searchUsers",component:ve},{path:"searchUsers/:id",component:ve},{path:"**",redirectTo:"searchUsers/:id"}]}];let Be=(()=>{class Ne{}return Ne.\u0275fac=function(lt){return new(lt||Ne)},Ne.\u0275mod=R.oAB({type:Ne}),Ne.\u0275inj=R.cJS({imports:[[A.Bz.forChild(Ue)],A.Bz]}),Ne})();var we=te(665);let Oe=(()=>{class Ne{}return Ne.\u0275fac=function(lt){return new(lt||Ne)},Ne.\u0275mod=R.oAB({type:Ne}),Ne.\u0275inj=R.cJS({imports:[[Be,D.ez,we.u5]]}),Ne})()},3667:(Mt,at,te)=>{"use strict";te.d(at,{a:()=>lr});var D={};te.r(D),te.d(D,{Decoder:()=>Fr,Encoder:()=>jr,PacketType:()=>xn,protocol:()=>_n});var A=te(4171),u=te(4966);const ge="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")();function Se(K){const k=K.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!k||u))return new XMLHttpRequest}catch(N){}if(!k)try{return new(ge[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(N){}}function Ce(K,...k){return k.reduce((N,H)=>(K.hasOwnProperty(H)&&(N[H]=K[H]),N),{})}const ce=setTimeout,ae=clearTimeout;function ve(K,k){k.useNativeTimers?(K.setTimeoutFn=ce.bind(ge),K.clearTimeoutFn=ae.bind(ge)):(K.setTimeoutFn=setTimeout.bind(ge),K.clearTimeoutFn=clearTimeout.bind(ge))}var Ue=te(8573);const Be=Object.create(null);Be.open="0",Be.close="1",Be.ping="2",Be.pong="3",Be.message="4",Be.upgrade="5",Be.noop="6";const we=Object.create(null);Object.keys(Be).forEach(K=>{we[Be[K]]=K});const Oe={type:"error",data:"parser error"},Ne="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),ke="function"==typeof ArrayBuffer,Je=(K,k)=>{const N=new FileReader;return N.onload=function(){const H=N.result.split(",")[1];k("b"+H)},N.readAsDataURL(K)},Me=({type:K,data:k},N,H)=>Ne&&k instanceof Blob?N?H(k):Je(k,H):ke&&(k instanceof ArrayBuffer||(K=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(K):K&&K.buffer instanceof ArrayBuffer)(k))?N?H(k):Je(new Blob([k]),H):H(Be[K]+(k||""));for(var Ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Lt="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ht=0;Ht<Ge.length;Ht++)Lt[Ge.charCodeAt(Ht)]=Ht;const Xt="function"==typeof ArrayBuffer,Gn=(K,k)=>{if(Xt){const N=function(K){var H,Pe,Qe,st,Ze,k=.75*K.length,N=K.length,de=0;"="===K[K.length-1]&&(k--,"="===K[K.length-2]&&k--);var ft=new ArrayBuffer(k),St=new Uint8Array(ft);for(H=0;H<N;H+=4)Pe=Lt[K.charCodeAt(H)],Qe=Lt[K.charCodeAt(H+1)],st=Lt[K.charCodeAt(H+2)],Ze=Lt[K.charCodeAt(H+3)],St[de++]=Pe<<2|Qe>>4,St[de++]=(15&Qe)<<4|st>>2,St[de++]=(3&st)<<6|63&Ze;return ft}(K);return ct(N,k)}return{base64:!0,data:K}},ct=(K,k)=>{switch(k){case"blob":return K instanceof ArrayBuffer?new Blob([K]):K;case"arraybuffer":default:return K}},tt=(K,k)=>{if("string"!=typeof K)return{type:"message",data:ct(K,k)};const N=K.charAt(0);return"b"===N?{type:"message",data:Gn(K.substring(1),k)}:we[N]?K.length>1?{type:we[N],data:K.substring(1)}:{type:we[N]}:Oe},mt=String.fromCharCode(30);class bn extends Ue.Q{constructor(k){super(),this.writable=!1,ve(this,k),this.opts=k,this.query=k.query,this.readyState="",this.socket=k.socket}onError(k,N){const H=new Error(k);return H.type="TransportError",H.description=N,super.emit("error",H),this}open(){return("closed"===this.readyState||""===this.readyState)&&(this.readyState="opening",this.doOpen()),this}close(){return("opening"===this.readyState||"open"===this.readyState)&&(this.doClose(),this.onClose()),this}send(k){"open"===this.readyState&&this.write(k)}onOpen(){this.readyState="open",this.writable=!0,super.emit("open")}onData(k){const N=tt(k,this.socket.binaryType);this.onPacket(N)}onPacket(k){super.emit("packet",k)}onClose(){this.readyState="closed",super.emit("close")}}var Pn=te(5391),Or=te(9603);class Jr extends bn{constructor(){super(...arguments),this.polling=!1}get name(){return"polling"}doOpen(){this.poll()}pause(k){this.readyState="pausing";const N=()=>{this.readyState="paused",k()};if(this.polling||!this.writable){let H=0;this.polling&&(H++,this.once("pollComplete",function(){--H||N()})),this.writable||(H++,this.once("drain",function(){--H||N()}))}else N()}poll(){this.polling=!0,this.doPoll(),this.emit("poll")}onData(k){((K,k)=>{const N=K.split(mt),H=[];for(let de=0;de<N.length;de++){const Pe=tt(N[de],k);if(H.push(Pe),"error"===Pe.type)break}return H})(k,this.socket.binaryType).forEach(H=>{if("opening"===this.readyState&&"open"===H.type&&this.onOpen(),"close"===H.type)return this.onClose(),!1;this.onPacket(H)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const k=()=>{this.write([{type:"close"}])};"open"===this.readyState?k():this.once("open",k)}write(k){this.writable=!1,((K,k)=>{const N=K.length,H=new Array(N);let de=0;K.forEach((Pe,Qe)=>{Me(Pe,!1,st=>{H[Qe]=st,++de===N&&k(H.join(mt))})})})(k,N=>{this.doWrite(N,()=>{this.writable=!0,this.emit("drain")})})}uri(){let k=this.query||{};const N=this.opts.secure?"https":"http";let H="";!1!==this.opts.timestampRequests&&(k[this.opts.timestampParam]=Pn()),!this.supportsBinary&&!k.sid&&(k.b64=1),this.opts.port&&("https"===N&&443!==Number(this.opts.port)||"http"===N&&80!==Number(this.opts.port))&&(H=":"+this.opts.port);const de=Or.encode(k);return N+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+H+this.opts.path+(de.length?"?"+de:"")}}function qt(){}const kn=null!=new Se({xdomain:!1}).responseType;let zt=(()=>{class K extends Ue.Q{constructor(N,H){super(),ve(this,H),this.opts=H,this.method=H.method||"GET",this.uri=N,this.async=!1!==H.async,this.data=void 0!==H.data?H.data:null,this.create()}create(){const N=Ce(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");N.xdomain=!!this.opts.xd,N.xscheme=!!this.opts.xs;const H=this.xhr=new Se(N);try{H.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){H.setDisableHeaderCheck&&H.setDisableHeaderCheck(!0);for(let de in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(de)&&H.setRequestHeader(de,this.opts.extraHeaders[de])}}catch(de){}if("POST"===this.method)try{H.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(de){}try{H.setRequestHeader("Accept","*/*")}catch(de){}"withCredentials"in H&&(H.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(H.timeout=this.opts.requestTimeout),H.onreadystatechange=()=>{4===H.readyState&&(200===H.status||1223===H.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof H.status?H.status:0)},0))},H.send(this.data)}catch(de){return void this.setTimeoutFn(()=>{this.onError(de)},0)}"undefined"!=typeof document&&(this.index=K.requestsCount++,K.requests[this.index]=this)}onSuccess(){this.emit("success"),this.cleanup()}onData(N){this.emit("data",N),this.onSuccess()}onError(N){this.emit("error",N),this.cleanup(!0)}cleanup(N){if(null!=this.xhr){if(this.xhr.onreadystatechange=qt,N)try{this.xhr.abort()}catch(H){}"undefined"!=typeof document&&delete K.requests[this.index],this.xhr=null}}onLoad(){const N=this.xhr.responseText;null!==N&&this.onData(N)}abort(){this.cleanup()}}return K.requestsCount=0,K.requests={},K})();function ln(){for(let K in zt.requests)zt.requests.hasOwnProperty(K)&&zt.requests[K].abort()}"undefined"!=typeof document&&("function"==typeof attachEvent?attachEvent("onunload",ln):"function"==typeof addEventListener&&addEventListener("onpagehide"in ge?"pagehide":"unload",ln,!1));const Rn="function"==typeof Promise&&"function"==typeof Promise.resolve?k=>Promise.resolve().then(k):(k,N)=>N(k,0),ir=ge.WebSocket||ge.MozWebSocket,Zn="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class xi extends bn{constructor(k){super(k),this.supportsBinary=!k.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const k=this.uri(),N=this.opts.protocols,H=Zn?{}:Ce(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(H.headers=this.opts.extraHeaders);try{this.ws=Zn?new ir(k,N,H):N?new ir(k,N):new ir(k)}catch(de){return this.emit("error",de)}this.ws.binaryType=this.socket.binaryType||"arraybuffer",this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=this.onClose.bind(this),this.ws.onmessage=k=>this.onData(k.data),this.ws.onerror=k=>this.onError("websocket error",k)}write(k){this.writable=!1;for(let N=0;N<k.length;N++){const de=N===k.length-1;Me(k[N],this.supportsBinary,Pe=>{try{this.ws.send(Pe)}catch(st){}de&&Rn(()=>{this.writable=!0,this.emit("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let k=this.query||{};const N=this.opts.secure?"wss":"ws";let H="";this.opts.port&&("wss"===N&&443!==Number(this.opts.port)||"ws"===N&&80!==Number(this.opts.port))&&(H=":"+this.opts.port),this.opts.timestampRequests&&(k[this.opts.timestampParam]=Pn()),this.supportsBinary||(k.b64=1);const de=Or.encode(k);return N+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+H+this.opts.path+(de.length?"?"+de:"")}check(){return!(!ir||"__initialize"in ir&&this.name===xi.prototype.name)}}const yr={websocket:xi,polling:class extends Jr{constructor(k){if(super(k),"undefined"!=typeof location){const H="https:"===location.protocol;let de=location.port;de||(de=H?"443":"80"),this.xd="undefined"!=typeof location&&k.hostname!==location.hostname||de!==k.port,this.xs=k.secure!==H}this.supportsBinary=kn&&!(k&&k.forceBase64)}request(k={}){return Object.assign(k,{xd:this.xd,xs:this.xs},this.opts),new zt(this.uri(),k)}doWrite(k,N){const H=this.request({method:"POST",data:k});H.on("success",N),H.on("error",de=>{this.onError("xhr post error",de)})}doPoll(){const k=this.request();k.on("data",this.onData.bind(this)),k.on("error",N=>{this.onError("xhr poll error",N)}),this.pollXhr=k}}};let Vi=(()=>{class K extends Ue.Q{constructor(N,H={}){super(),N&&"object"==typeof N&&(H=N,N=null),N?(N=A(N),H.hostname=N.host,H.secure="https"===N.protocol||"wss"===N.protocol,H.port=N.port,N.query&&(H.query=N.query)):H.host&&(H.hostname=A(H.host).host),ve(this,H),this.secure=null!=H.secure?H.secure:"undefined"!=typeof location&&"https:"===location.protocol,H.hostname&&!H.port&&(H.port=this.secure?"443":"80"),this.hostname=H.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=H.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=H.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},H),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"==typeof this.opts.query&&(this.opts.query=Or.decode(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&addEventListener("beforeunload",()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},!1),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close")},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(N){const H=function(K){const k={};for(let N in K)K.hasOwnProperty(N)&&(k[N]=K[N]);return k}(this.opts.query);H.EIO=4,H.transport=N,this.id&&(H.sid=this.id);const de=Object.assign({},this.opts.transportOptions[N],this.opts,{query:H,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new yr[N](de)}open(){let N;if(this.opts.rememberUpgrade&&K.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))N="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);N=this.transports[0]}this.readyState="opening";try{N=this.createTransport(N)}catch(H){return this.transports.shift(),void this.open()}N.open(),this.setTransport(N)}setTransport(N){this.transport&&this.transport.removeAllListeners(),this.transport=N,N.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",()=>{this.onClose("transport close")})}probe(N){let H=this.createTransport(N),de=!1;K.priorWebsocketSuccess=!1;const Pe=()=>{de||(H.send([{type:"ping",data:"probe"}]),H.once("packet",Pt=>{if(!de)if("pong"===Pt.type&&"probe"===Pt.data){if(this.upgrading=!0,this.emitReserved("upgrading",H),!H)return;K.priorWebsocketSuccess="websocket"===H.name,this.transport.pause(()=>{de||"closed"!==this.readyState&&(Gt(),this.setTransport(H),H.send([{type:"upgrade"}]),this.emitReserved("upgrade",H),H=null,this.upgrading=!1,this.flush())})}else{const sn=new Error("probe error");sn.transport=H.name,this.emitReserved("upgradeError",sn)}}))};function Qe(){de||(de=!0,Gt(),H.close(),H=null)}const st=Pt=>{const sn=new Error("probe error: "+Pt);sn.transport=H.name,Qe(),this.emitReserved("upgradeError",sn)};function Ze(){st("transport closed")}function ft(){st("socket closed")}function St(Pt){H&&Pt.name!==H.name&&Qe()}const Gt=()=>{H.removeListener("open",Pe),H.removeListener("error",st),H.removeListener("close",Ze),this.off("close",ft),this.off("upgrading",St)};H.once("open",Pe),H.once("error",st),H.once("close",Ze),this.once("close",ft),this.once("upgrading",St),H.open()}onOpen(){if(this.readyState="open",K.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let N=0;const H=this.upgrades.length;for(;N<H;N++)this.probe(this.upgrades[N])}}onPacket(N){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",N),this.emitReserved("heartbeat"),N.type){case"open":this.onHandshake(JSON.parse(N.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const H=new Error("server error");H.code=N.data,this.onError(H);break;case"message":this.emitReserved("data",N.data),this.emitReserved("message",N.data)}}onHandshake(N){this.emitReserved("handshake",N),this.id=N.sid,this.transport.query.sid=N.sid,this.upgrades=this.filterUpgrades(N.upgrades),this.pingInterval=N.pingInterval,this.pingTimeout=N.pingTimeout,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emitReserved("flush"))}write(N,H,de){return this.sendPacket("message",N,H,de),this}send(N,H,de){return this.sendPacket("message",N,H,de),this}sendPacket(N,H,de,Pe){if("function"==typeof H&&(Pe=H,H=void 0),"function"==typeof de&&(Pe=de,de=null),"closing"===this.readyState||"closed"===this.readyState)return;(de=de||{}).compress=!1!==de.compress;const Qe={type:N,data:H,options:de};this.emitReserved("packetCreate",Qe),this.writeBuffer.push(Qe),Pe&&this.once("flush",Pe),this.flush()}close(){const N=()=>{this.onClose("forced close"),this.transport.close()},H=()=>{this.off("upgrade",H),this.off("upgradeError",H),N()},de=()=>{this.once("upgrade",H),this.once("upgradeError",H)};return("opening"===this.readyState||"open"===this.readyState)&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?de():N()}):this.upgrading?de():N()),this}onError(N){K.priorWebsocketSuccess=!1,this.emitReserved("error",N),this.onClose("transport error",N)}onClose(N,H){("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&removeEventListener("offline",this.offlineEventListener,!1),this.readyState="closed",this.id=null,this.emitReserved("close",N,H),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(N){const H=[];let de=0;const Pe=N.length;for(;de<Pe;de++)~this.transports.indexOf(N[de])&&H.push(N[de]);return H}}return K.protocol=4,K})();const as="function"==typeof ArrayBuffer,ls=Object.prototype.toString,Ui="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===ls.call(Blob),Tt="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===ls.call(File);function rt(K){return as&&(K instanceof ArrayBuffer||(K=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(K):K.buffer instanceof ArrayBuffer)(K))||Ui&&K instanceof Blob||Tt&&K instanceof File}function nt(K,k){if(!K||"object"!=typeof K)return!1;if(Array.isArray(K)){for(let N=0,H=K.length;N<H;N++)if(nt(K[N]))return!0;return!1}if(rt(K))return!0;if(K.toJSON&&"function"==typeof K.toJSON&&1===arguments.length)return nt(K.toJSON(),!0);for(const N in K)if(Object.prototype.hasOwnProperty.call(K,N)&&nt(K[N]))return!0;return!1}function Wt(K){const k=[],H=K;return H.data=_t(K.data,k),H.attachments=k.length,{packet:H,buffers:k}}function _t(K,k){if(!K)return K;if(rt(K)){const N={_placeholder:!0,num:k.length};return k.push(K),N}if(Array.isArray(K)){const N=new Array(K.length);for(let H=0;H<K.length;H++)N[H]=_t(K[H],k);return N}if("object"==typeof K&&!(K instanceof Date)){const N={};for(const H in K)K.hasOwnProperty(H)&&(N[H]=_t(K[H],k));return N}return K}function hn(K,k){return K.data=mn(K.data,k),K.attachments=void 0,K}function mn(K,k){if(!K)return K;if(K&&K._placeholder)return k[K.num];if(Array.isArray(K))for(let N=0;N<K.length;N++)K[N]=mn(K[N],k);else if("object"==typeof K)for(const N in K)K.hasOwnProperty(N)&&(K[N]=mn(K[N],k));return K}const _n=5;var xn=(()=>{return(K=xn||(xn={}))[K.CONNECT=0]="CONNECT",K[K.DISCONNECT=1]="DISCONNECT",K[K.EVENT=2]="EVENT",K[K.ACK=3]="ACK",K[K.CONNECT_ERROR=4]="CONNECT_ERROR",K[K.BINARY_EVENT=5]="BINARY_EVENT",K[K.BINARY_ACK=6]="BINARY_ACK",xn;var K})();class jr{encode(k){return k.type!==xn.EVENT&&k.type!==xn.ACK||!nt(k)?[this.encodeAsString(k)]:(k.type=k.type===xn.EVENT?xn.BINARY_EVENT:xn.BINARY_ACK,this.encodeAsBinary(k))}encodeAsString(k){let N=""+k.type;return(k.type===xn.BINARY_EVENT||k.type===xn.BINARY_ACK)&&(N+=k.attachments+"-"),k.nsp&&"/"!==k.nsp&&(N+=k.nsp+","),null!=k.id&&(N+=k.id),null!=k.data&&(N+=JSON.stringify(k.data)),N}encodeAsBinary(k){const N=Wt(k),H=this.encodeAsString(N.packet),de=N.buffers;return de.unshift(H),de}}class Fr extends Ue.Q{constructor(){super()}add(k){let N;if("string"==typeof k)N=this.decodeString(k),N.type===xn.BINARY_EVENT||N.type===xn.BINARY_ACK?(this.reconstructor=new Wr(N),0===N.attachments&&super.emitReserved("decoded",N)):super.emitReserved("decoded",N);else{if(!rt(k)&&!k.base64)throw new Error("Unknown type: "+k);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");N=this.reconstructor.takeBinaryData(k),N&&(this.reconstructor=null,super.emitReserved("decoded",N))}}decodeString(k){let N=0;const H={type:Number(k.charAt(0))};if(void 0===xn[H.type])throw new Error("unknown packet type "+H.type);if(H.type===xn.BINARY_EVENT||H.type===xn.BINARY_ACK){const Pe=N+1;for(;"-"!==k.charAt(++N)&&N!=k.length;);const Qe=k.substring(Pe,N);if(Qe!=Number(Qe)||"-"!==k.charAt(N))throw new Error("Illegal attachments");H.attachments=Number(Qe)}if("/"===k.charAt(N+1)){const Pe=N+1;for(;++N&&","!==k.charAt(N)&&N!==k.length;);H.nsp=k.substring(Pe,N)}else H.nsp="/";const de=k.charAt(N+1);if(""!==de&&Number(de)==de){const Pe=N+1;for(;++N;){const Qe=k.charAt(N);if(null==Qe||Number(Qe)!=Qe){--N;break}if(N===k.length)break}H.id=Number(k.substring(Pe,N+1))}if(k.charAt(++N)){const Pe=function(K){try{return JSON.parse(K)}catch(k){return!1}}(k.substr(N));if(!Fr.isPayloadValid(H.type,Pe))throw new Error("invalid payload");H.data=Pe}return H}static isPayloadValid(k,N){switch(k){case xn.CONNECT:return"object"==typeof N;case xn.DISCONNECT:return void 0===N;case xn.CONNECT_ERROR:return"string"==typeof N||"object"==typeof N;case xn.EVENT:case xn.BINARY_EVENT:return Array.isArray(N)&&N.length>0;case xn.ACK:case xn.BINARY_ACK:return Array.isArray(N)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Wr{constructor(k){this.packet=k,this.buffers=[],this.reconPack=k}takeBinaryData(k){if(this.buffers.push(k),this.buffers.length===this.reconPack.attachments){const N=hn(this.reconPack,this.buffers);return this.finishedReconstruction(),N}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function jn(K,k,N){return K.on(k,N),function(){K.off(k,N)}}const wn=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class mi extends Ue.Q{constructor(k,N,H){super(),this.connected=!1,this.disconnected=!0,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=k,this.nsp=N,H&&H.auth&&(this.auth=H.auth),this.io._autoConnect&&this.open()}subEvents(){if(this.subs)return;const k=this.io;this.subs=[jn(k,"open",this.onopen.bind(this)),jn(k,"packet",this.onpacket.bind(this)),jn(k,"error",this.onerror.bind(this)),jn(k,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...k){return k.unshift("message"),this.emit.apply(this,k),this}emit(k,...N){if(wn.hasOwnProperty(k))throw new Error('"'+k+'" is a reserved event name');N.unshift(k);const H={type:xn.EVENT,data:N,options:{}};return H.options.compress=!1!==this.flags.compress,"function"==typeof N[N.length-1]&&(this.acks[this.ids]=N.pop(),H.id=this.ids++),this.flags.volatile&&(!(this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable)||!this.connected)||(this.connected?this.packet(H):this.sendBuffer.push(H)),this.flags={},this}packet(k){k.nsp=this.nsp,this.io._packet(k)}onopen(){"function"==typeof this.auth?this.auth(k=>{this.packet({type:xn.CONNECT,data:k})}):this.packet({type:xn.CONNECT,data:this.auth})}onerror(k){this.connected||this.emitReserved("connect_error",k)}onclose(k){this.connected=!1,this.disconnected=!0,delete this.id,this.emitReserved("disconnect",k)}onpacket(k){if(k.nsp===this.nsp)switch(k.type){case xn.CONNECT:k.data&&k.data.sid?this.onconnect(k.data.sid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case xn.EVENT:case xn.BINARY_EVENT:this.onevent(k);break;case xn.ACK:case xn.BINARY_ACK:this.onack(k);break;case xn.DISCONNECT:this.ondisconnect();break;case xn.CONNECT_ERROR:const H=new Error(k.data.message);H.data=k.data.data,this.emitReserved("connect_error",H)}}onevent(k){const N=k.data||[];null!=k.id&&N.push(this.ack(k.id)),this.connected?this.emitEvent(N):this.receiveBuffer.push(Object.freeze(N))}emitEvent(k){if(this._anyListeners&&this._anyListeners.length){const N=this._anyListeners.slice();for(const H of N)H.apply(this,k)}super.emit.apply(this,k)}ack(k){const N=this;let H=!1;return function(...de){H||(H=!0,N.packet({type:xn.ACK,id:k,data:de}))}}onack(k){const N=this.acks[k.id];"function"==typeof N&&(N.apply(this,k.data),delete this.acks[k.id])}onconnect(k){this.id=k,this.connected=!0,this.disconnected=!1,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach(k=>this.emitEvent(k)),this.receiveBuffer=[],this.sendBuffer.forEach(k=>this.packet(k)),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(k=>k()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:xn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(k){return this.flags.compress=k,this}get volatile(){return this.flags.volatile=!0,this}onAny(k){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(k),this}prependAny(k){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(k),this}offAny(k){if(!this._anyListeners)return this;if(k){const N=this._anyListeners;for(let H=0;H<N.length;H++)if(k===N[H])return N.splice(H,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}}var ar=te(7591);class Yr extends Ue.Q{constructor(k,N){var H;super(),this.nsps={},this.subs=[],k&&"object"==typeof k&&(N=k,k=void 0),(N=N||{}).path=N.path||"/socket.io",this.opts=N,ve(this,N),this.reconnection(!1!==N.reconnection),this.reconnectionAttempts(N.reconnectionAttempts||1/0),this.reconnectionDelay(N.reconnectionDelay||1e3),this.reconnectionDelayMax(N.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(H=N.randomizationFactor)&&void 0!==H?H:.5),this.backoff=new ar({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==N.timeout?2e4:N.timeout),this._readyState="closed",this.uri=k;const de=N.parser||D;this.encoder=new de.Encoder,this.decoder=new de.Decoder,this._autoConnect=!1!==N.autoConnect,this._autoConnect&&this.open()}reconnection(k){return arguments.length?(this._reconnection=!!k,this):this._reconnection}reconnectionAttempts(k){return void 0===k?this._reconnectionAttempts:(this._reconnectionAttempts=k,this)}reconnectionDelay(k){var N;return void 0===k?this._reconnectionDelay:(this._reconnectionDelay=k,null===(N=this.backoff)||void 0===N||N.setMin(k),this)}randomizationFactor(k){var N;return void 0===k?this._randomizationFactor:(this._randomizationFactor=k,null===(N=this.backoff)||void 0===N||N.setJitter(k),this)}reconnectionDelayMax(k){var N;return void 0===k?this._reconnectionDelayMax:(this._reconnectionDelayMax=k,null===(N=this.backoff)||void 0===N||N.setMax(k),this)}timeout(k){return arguments.length?(this._timeout=k,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(k){if(~this._readyState.indexOf("open"))return this;this.engine=new Vi(this.uri,this.opts);const N=this.engine,H=this;this._readyState="opening",this.skipReconnect=!1;const de=jn(N,"open",function(){H.onopen(),k&&k()}),Pe=jn(N,"error",Qe=>{H.cleanup(),H._readyState="closed",this.emitReserved("error",Qe),k?k(Qe):H.maybeReconnectOnOpen()});if(!1!==this._timeout){const Qe=this._timeout;0===Qe&&de();const st=this.setTimeoutFn(()=>{de(),N.close(),N.emit("error",new Error("timeout"))},Qe);this.opts.autoUnref&&st.unref(),this.subs.push(function(){clearTimeout(st)})}return this.subs.push(de),this.subs.push(Pe),this}connect(k){return this.open(k)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const k=this.engine;this.subs.push(jn(k,"ping",this.onping.bind(this)),jn(k,"data",this.ondata.bind(this)),jn(k,"error",this.onerror.bind(this)),jn(k,"close",this.onclose.bind(this)),jn(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(k){this.decoder.add(k)}ondecoded(k){this.emitReserved("packet",k)}onerror(k){this.emitReserved("error",k)}socket(k,N){let H=this.nsps[k];return H||(H=new mi(this,k,N),this.nsps[k]=H),H}_destroy(k){const N=Object.keys(this.nsps);for(const H of N)if(this.nsps[H].active)return;this._close()}_packet(k){const N=this.encoder.encode(k);for(let H=0;H<N.length;H++)this.engine.write(N[H],k.options)}cleanup(){this.subs.forEach(k=>k()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,"opening"===this._readyState&&this.cleanup(),this.backoff.reset(),this._readyState="closed",this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(k){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",k),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const k=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const N=this.backoff.duration();this._reconnecting=!0;const H=this.setTimeoutFn(()=>{k.skipReconnect||(this.emitReserved("reconnect_attempt",k.backoff.attempts),!k.skipReconnect&&k.open(de=>{de?(k._reconnecting=!1,k.reconnect(),this.emitReserved("reconnect_error",de)):k.onreconnect()}))},N);this.opts.autoUnref&&H.unref(),this.subs.push(function(){clearTimeout(H)})}}onreconnect(){const k=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",k)}}const Gr={};function vr(K,k){"object"==typeof K&&(k=K,K=void 0);const N=function(K,k="",N){let H=K;N=N||"undefined"!=typeof location&&location,null==K&&(K=N.protocol+"//"+N.host),"string"==typeof K&&("/"===K.charAt(0)&&(K="/"===K.charAt(1)?N.protocol+K:N.host+K),/^(https?|wss?):\/\//.test(K)||(K=void 0!==N?N.protocol+"//"+K:"https://"+K),H=A(K)),H.port||(/^(http|ws)$/.test(H.protocol)?H.port="80":/^(http|ws)s$/.test(H.protocol)&&(H.port="443")),H.path=H.path||"/";const Pe=-1!==H.host.indexOf(":")?"["+H.host+"]":H.host;return H.id=H.protocol+"://"+Pe+":"+H.port+k,H.href=H.protocol+"://"+Pe+(N&&N.port===H.port?"":":"+H.port),H}(K,(k=k||{}).path||"/socket.io"),H=N.source,de=N.id;let Ze;return k.forceNew||k["force new connection"]||!1===k.multiplex||Gr[de]&&N.path in Gr[de].nsps?Ze=new Yr(H,k):(Gr[de]||(Gr[de]=new Yr(H,k)),Ze=Gr[de]),N.query&&!k.query&&(k.query=N.queryKey),Ze.socket(N.path,k)}Object.assign(vr,{Manager:Yr,Socket:mi,io:vr,connect:vr});var cs=te(2340),ro=te(7574),qi=te(639);let lr=(()=>{class K{constructor(){this.baseUrl=cs.N.baseUrl,this.socket=vr(this.baseUrl)}listen(N){return new ro.y(H=>{this.socket.on(N,de=>{H.next(de)})})}emit(N,H){this.socket.emit(N,H)}}return K.\u0275fac=function(N){return new(N||K)},K.\u0275prov=qi.Yz7({token:K,factory:K.\u0275fac,providedIn:"root"}),K})()},3071:(Mt,at,te)=>{"use strict";te.d(at,{K:()=>u});var D=te(2340),A=te(639),R=te(1841);let u=(()=>{class ge{constructor(Ce){this.http=Ce,this.baseUrl=D.N.baseUrl}getUserById(Ce){return this.http.get(`${this.baseUrl}api/user/obtainUserById/${Ce}`)}getUserEventsById(Ce){return this.http.get(`${this.baseUrl}api/user/obtainUserEventsById/${Ce}`)}getUserEventsSubscribedById(Ce){return this.http.get(`${this.baseUrl}api/user/obtainUserEventsSubscribedById/${Ce}`)}getUserEstablishmentsFavById(Ce){return this.http.get(`${this.baseUrl}api/user/getAllUserFavEstablishment/${Ce}`)}getUserPostsById(Ce){return this.http.get(`${this.baseUrl}api/user/obtainUserPostsById/${Ce}`)}getUserPostsFavById(Ce){return this.http.get(`${this.baseUrl}api/user/getAllUserFavPost/${Ce}`)}getUserByTerm(Ce){return this.http.get(`${this.baseUrl}api/user/getUserByTerm/${Ce}`)}setUserPostFavorite(Ce,ce){return this.http.post(`${this.baseUrl}api/user/setPostFavorite`,{user:Ce,postFavorite:ce}).toPromise()}isUserPostFavorite(Ce,ce){return this.http.post(`${this.baseUrl}api/user/userHasThisPostFav`,{UserId:Ce,PostId:ce})}followUser(Ce,ce){return this.http.put(`${this.baseUrl}api/user/followUser`,{activeUserId:Ce,profileUserId:ce}).toPromise()}isFollowingUser(Ce,ce){return console.log(`${this.baseUrl}api/user/isFollowingUser/?${Ce}&${ce}`),this.http.get(`${this.baseUrl}api/user/isFollowingUser/?${Ce}&${ce}`).toPromise()}setUserEstablishmentFavorite(Ce,ce){return this.http.post(`${this.baseUrl}api/user/setEstablishmentFavorite`,{user:Ce,establishmentFavorite:ce}).toPromise()}isUserEstablishmentFavorite(Ce,ce){return this.http.post(`${this.baseUrl}api/user/userHasThisEstablishmentFav`,{UserId:Ce,EstablishmentId:ce})}}return ge.\u0275fac=function(Ce){return new(Ce||ge)(A.LFG(R.eN))},ge.\u0275prov=A.Yz7({token:ge,factory:ge.\u0275fac,providedIn:"root"}),ge})()},2340:(Mt,at,te)=>{"use strict";te.d(at,{N:()=>D});const D={production:!0,baseUrl:"http://localhost:3000/",mapboxKey:"pk.eyJ1IjoicmVhbGZvb2RpZWZyaWVuZHMiLCJhIjoiY2t1ZmpzbnhjMDBnODJvbm1sZ3hiOTdtNCJ9.1ykcyYDYHd4_SFS3xkP39Q"}},4206:(Mt,at,te)=>{"use strict";var D=te(8583),A=te(639);class R extends D.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class u extends R{static makeCurrent(){(0,D.HT)(new u)}onAndCancel(y,v,I){return y.addEventListener(v,I,!1),()=>{y.removeEventListener(v,I,!1)}}dispatchEvent(y,v){y.dispatchEvent(v)}remove(y){y.parentNode&&y.parentNode.removeChild(y)}createElement(y,v){return(v=v||this.getDefaultDocument()).createElement(y)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(y){return y.nodeType===Node.ELEMENT_NODE}isShadowRoot(y){return y instanceof DocumentFragment}getGlobalEventTarget(y,v){return"window"===v?window:"document"===v?y:"body"===v?y.body:null}getBaseHref(y){const v=(ge=ge||document.querySelector("base"),ge?ge.getAttribute("href"):null);return null==v?null:function(L){Ce=Ce||document.createElement("a"),Ce.setAttribute("href",L);const y=Ce.pathname;return"/"===y.charAt(0)?y:`/${y}`}(v)}resetBaseElement(){ge=null}getUserAgent(){return window.navigator.userAgent}getCookie(y){return(0,D.Mx)(document.cookie,y)}}let Ce,ge=null;const ae=new A.OlP("TRANSITION_ID"),Ue=[{provide:A.ip1,useFactory:function(L,y,v){return()=>{v.get(A.CZH).donePromise.then(()=>{const I=(0,D.q)(),X=y.querySelectorAll(`style[ng-transition="${L}"]`);for(let fe=0;fe<X.length;fe++)I.remove(X[fe])})}},deps:[ae,D.K0,A.zs3],multi:!0}];class Be{static init(){(0,A.VLi)(new Be)}addToWindow(y){A.dqk.getAngularTestability=(I,X=!0)=>{const fe=y.findTestabilityInTree(I,X);if(null==fe)throw new Error("Could not find testability for element.");return fe},A.dqk.getAllAngularTestabilities=()=>y.getAllTestabilities(),A.dqk.getAllAngularRootElements=()=>y.getAllRootElements(),A.dqk.frameworkStabilizers||(A.dqk.frameworkStabilizers=[]),A.dqk.frameworkStabilizers.push(I=>{const X=A.dqk.getAllAngularTestabilities();let fe=X.length,Te=!1;const je=function(vt){Te=Te||vt,fe--,0==fe&&I(Te)};X.forEach(function(vt){vt.whenStable(je)})})}findTestabilityInTree(y,v,I){if(null==v)return null;const X=y.getTestability(v);return null!=X?X:I?(0,D.q)().isShadowRoot(v)?this.findTestabilityInTree(y,v.host,!0):this.findTestabilityInTree(y,v.parentElement,!0):null}}let we=(()=>{class L{build(){return new XMLHttpRequest}}return L.\u0275fac=function(v){return new(v||L)},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();const ct=new A.OlP("EventManagerPlugins");let tt=(()=>{class L{constructor(v,I){this._zone=I,this._eventNameToPlugin=new Map,v.forEach(X=>X.manager=this),this._plugins=v.slice().reverse()}addEventListener(v,I,X){return this._findPluginFor(I).addEventListener(v,I,X)}addGlobalEventListener(v,I,X){return this._findPluginFor(I).addGlobalEventListener(v,I,X)}getZone(){return this._zone}_findPluginFor(v){const I=this._eventNameToPlugin.get(v);if(I)return I;const X=this._plugins;for(let fe=0;fe<X.length;fe++){const Te=X[fe];if(Te.supports(v))return this._eventNameToPlugin.set(v,Te),Te}throw new Error(`No event manager plugin found for event ${v}`)}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(ct),A.LFG(A.R0b))},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();class mt{constructor(y){this._doc=y}addGlobalEventListener(y,v,I){const X=(0,D.q)().getGlobalEventTarget(this._doc,y);if(!X)throw new Error(`Unsupported event target ${X} for event ${v}`);return this.addEventListener(X,v,I)}}let gt=(()=>{class L{constructor(){this._stylesSet=new Set}addStyles(v){const I=new Set;v.forEach(X=>{this._stylesSet.has(X)||(this._stylesSet.add(X),I.add(X))}),this.onStylesAdded(I)}onStylesAdded(v){}getAllStyles(){return Array.from(this._stylesSet)}}return L.\u0275fac=function(v){return new(v||L)},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})(),tn=(()=>{class L extends gt{constructor(v){super(),this._doc=v,this._hostNodes=new Map,this._hostNodes.set(v.head,[])}_addStylesToHost(v,I,X){v.forEach(fe=>{const Te=this._doc.createElement("style");Te.textContent=fe,X.push(I.appendChild(Te))})}addHost(v){const I=[];this._addStylesToHost(this._stylesSet,v,I),this._hostNodes.set(v,I)}removeHost(v){const I=this._hostNodes.get(v);I&&I.forEach(an),this._hostNodes.delete(v)}onStylesAdded(v){this._hostNodes.forEach((I,X)=>{this._addStylesToHost(v,X,I)})}ngOnDestroy(){this._hostNodes.forEach(v=>v.forEach(an))}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(D.K0))},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();function an(L){(0,D.q)().remove(L)}const bn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Pn=/%COMP%/g;function ln(L,y,v){for(let I=0;I<y.length;I++){let X=y[I];Array.isArray(X)?ln(L,X,v):(X=X.replace(Pn,L),v.push(X))}return v}function Rn(L){return y=>{if("__ngUnwrap__"===y)return L;!1===L(y)&&(y.preventDefault(),y.returnValue=!1)}}let Vn=(()=>{class L{constructor(v,I,X){this.eventManager=v,this.sharedStylesHost=I,this.appId=X,this.rendererByCompId=new Map,this.defaultRenderer=new ri(v)}createRenderer(v,I){if(!v||!I)return this.defaultRenderer;switch(I.encapsulation){case A.ifc.Emulated:{let X=this.rendererByCompId.get(I.id);return X||(X=new Vi(this.eventManager,this.sharedStylesHost,I,this.appId),this.rendererByCompId.set(I.id,X)),X.applyToHost(v),X}case 1:case A.ifc.ShadowDom:return new zr(this.eventManager,this.sharedStylesHost,v,I);default:if(!this.rendererByCompId.has(I.id)){const X=ln(I.id,I.styles,[]);this.sharedStylesHost.addStyles(X),this.rendererByCompId.set(I.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(tt),A.LFG(tn),A.LFG(A.AFp))},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();class ri{constructor(y){this.eventManager=y,this.data=Object.create(null)}destroy(){}createElement(y,v){return v?document.createElementNS(bn[v]||v,y):document.createElement(y)}createComment(y){return document.createComment(y)}createText(y){return document.createTextNode(y)}appendChild(y,v){y.appendChild(v)}insertBefore(y,v,I){y&&y.insertBefore(v,I)}removeChild(y,v){y&&y.removeChild(v)}selectRootElement(y,v){let I="string"==typeof y?document.querySelector(y):y;if(!I)throw new Error(`The selector "${y}" did not match any elements`);return v||(I.textContent=""),I}parentNode(y){return y.parentNode}nextSibling(y){return y.nextSibling}setAttribute(y,v,I,X){if(X){v=X+":"+v;const fe=bn[X];fe?y.setAttributeNS(fe,v,I):y.setAttribute(v,I)}else y.setAttribute(v,I)}removeAttribute(y,v,I){if(I){const X=bn[I];X?y.removeAttributeNS(X,v):y.removeAttribute(`${I}:${v}`)}else y.removeAttribute(v)}addClass(y,v){y.classList.add(v)}removeClass(y,v){y.classList.remove(v)}setStyle(y,v,I,X){X&(A.JOm.DashCase|A.JOm.Important)?y.style.setProperty(v,I,X&A.JOm.Important?"important":""):y.style[v]=I}removeStyle(y,v,I){I&A.JOm.DashCase?y.style.removeProperty(v):y.style[v]=""}setProperty(y,v,I){y[v]=I}setValue(y,v){y.nodeValue=v}listen(y,v,I){return"string"==typeof y?this.eventManager.addGlobalEventListener(y,v,Rn(I)):this.eventManager.addEventListener(y,v,Rn(I))}}class Vi extends ri{constructor(y,v,I,X){super(y),this.component=I;const fe=ln(X+"-"+I.id,I.styles,[]);v.addStyles(fe),this.contentAttr="_ngcontent-%COMP%".replace(Pn,X+"-"+I.id),this.hostAttr="_nghost-%COMP%".replace(Pn,X+"-"+I.id)}applyToHost(y){super.setAttribute(y,this.hostAttr,"")}createElement(y,v){const I=super.createElement(y,v);return super.setAttribute(I,this.contentAttr,""),I}}class zr extends ri{constructor(y,v,I,X){super(y),this.sharedStylesHost=v,this.hostEl=I,this.shadowRoot=I.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const fe=ln(X.id,X.styles,[]);for(let Te=0;Te<fe.length;Te++){const je=document.createElement("style");je.textContent=fe[Te],this.shadowRoot.appendChild(je)}}nodeOrShadowRoot(y){return y===this.hostEl?this.shadowRoot:y}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(y,v){return super.appendChild(this.nodeOrShadowRoot(y),v)}insertBefore(y,v,I){return super.insertBefore(this.nodeOrShadowRoot(y),v,I)}removeChild(y,v){return super.removeChild(this.nodeOrShadowRoot(y),v)}parentNode(y){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(y)))}}let $r=(()=>{class L extends mt{constructor(v){super(v)}supports(v){return!0}addEventListener(v,I,X){return v.addEventListener(I,X,!1),()=>this.removeEventListener(v,I,X)}removeEventListener(v,I,X){return v.removeEventListener(I,X)}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(D.K0))},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();const hn=["alt","control","meta","shift"],_n={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},xn={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},jn={alt:L=>L.altKey,control:L=>L.ctrlKey,meta:L=>L.metaKey,shift:L=>L.shiftKey};let wn=(()=>{class L extends mt{constructor(v){super(v)}supports(v){return null!=L.parseEventName(v)}addEventListener(v,I,X){const fe=L.parseEventName(I),Te=L.eventCallback(fe.fullKey,X,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,D.q)().onAndCancel(v,fe.domEventName,Te))}static parseEventName(v){const I=v.toLowerCase().split("."),X=I.shift();if(0===I.length||"keydown"!==X&&"keyup"!==X)return null;const fe=L._normalizeKey(I.pop());let Te="";if(hn.forEach(vt=>{const Ft=I.indexOf(vt);Ft>-1&&(I.splice(Ft,1),Te+=vt+".")}),Te+=fe,0!=I.length||0===fe.length)return null;const je={};return je.domEventName=X,je.fullKey=Te,je}static getEventFullKey(v){let I="",X=function(L){let y=L.key;if(null==y){if(y=L.keyIdentifier,null==y)return"Unidentified";y.startsWith("U+")&&(y=String.fromCharCode(parseInt(y.substring(2),16)),3===L.location&&xn.hasOwnProperty(y)&&(y=xn[y]))}return _n[y]||y}(v);return X=X.toLowerCase()," "===X?X="space":"."===X&&(X="dot"),hn.forEach(fe=>{fe!=X&&jn[fe](v)&&(I+=fe+".")}),I+=X,I}static eventCallback(v,I,X){return fe=>{L.getEventFullKey(fe)===v&&X.runGuarded(()=>I(fe))}}static _normalizeKey(v){switch(v){case"esc":return"escape";default:return v}}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(D.K0))},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();const H=(0,A.eFA)(A._c5,"browser",[{provide:A.Lbi,useValue:D.bD},{provide:A.g9A,useValue:function(){u.makeCurrent(),Be.init()},multi:!0},{provide:D.K0,useFactory:function(){return(0,A.RDi)(document),document},deps:[]}]),de=[[],{provide:A.zSh,useValue:"root"},{provide:A.qLn,useFactory:function(){return new A.qLn},deps:[]},{provide:ct,useClass:$r,multi:!0,deps:[D.K0,A.R0b,A.Lbi]},{provide:ct,useClass:wn,multi:!0,deps:[D.K0]},[],{provide:Vn,useClass:Vn,deps:[tt,tn,A.AFp]},{provide:A.FYo,useExisting:Vn},{provide:gt,useExisting:tn},{provide:tn,useClass:tn,deps:[D.K0]},{provide:A.dDg,useClass:A.dDg,deps:[A.R0b]},{provide:tt,useClass:tt,deps:[ct,A.R0b]},{provide:D.JF,useClass:we,deps:[]},[]];let Pe=(()=>{class L{constructor(v){if(v)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(v){return{ngModule:L,providers:[{provide:A.AFp,useValue:v.appId},{provide:ae,useExisting:A.AFp},Ue]}}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(L,12))},L.\u0275mod=A.oAB({type:L}),L.\u0275inj=A.cJS({providers:de,imports:[D.ez,A.hGG]}),L})();"undefined"!=typeof window&&window;var mr=te(1841),On=te(1385);const Zr=[{path:"",redirectTo:"home",pathMatch:"full"},{path:"home",loadChildren:()=>te.e(321).then(te.bind(te,7321)).then(L=>L.HomeModule)},{path:"establishment",loadChildren:()=>Promise.resolve().then(te.bind(te,3932)).then(L=>L.EstablishmentModule)},{path:"auth",loadChildren:()=>Promise.all([te.e(592),te.e(728)]).then(te.bind(te,4728)).then(L=>L.AuthModule)},{path:"events",loadChildren:()=>Promise.all([te.e(592),te.e(672)]).then(te.bind(te,7672)).then(L=>L.EventsModule)},{path:"channels",loadChildren:()=>Promise.all([te.e(953),te.e(592),te.e(471)]).then(te.bind(te,9471)).then(L=>L.ChannelsModule)},{path:"posts",loadChildren:()=>te.e(953).then(te.bind(te,1953)).then(L=>L.PostsModule)},{path:"chat",loadChildren:()=>Promise.all([te.e(592),te.e(376)]).then(te.bind(te,1376)).then(L=>L.ChatModule)},{path:"user",loadChildren:()=>te.e(257).then(te.bind(te,4257)).then(L=>L.UserModule)},{path:"search",loadChildren:()=>Promise.resolve().then(te.bind(te,7495)).then(L=>L.SearchModule)},{path:"**",redirectTo:"home"}];let zs=(()=>{class L{}return L.\u0275fac=function(v){return new(v||L)},L.\u0275mod=A.oAB({type:L}),L.\u0275inj=A.cJS({imports:[[On.Bz.forRoot(Zr,{useHash:!1})],On.Bz]}),L})();class Br{}const xr="*";function ws(L,y=null){return{type:2,steps:L,options:y}}function Ti(L){return{type:6,styles:L,offset:null}}function si(L){Promise.resolve(null).then(L)}class Oi{constructor(y=0,v=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=y+v}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(y=>y()),this._onDoneFns=[])}onStart(y){this._onStartFns.push(y)}onDone(y){this._onDoneFns.push(y)}onDestroy(y){this._onDestroyFns.push(y)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){si(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(y=>y()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(y=>y()),this._onDestroyFns=[])}reset(){this._started=!1}setPosition(y){this._position=this.totalTime?y*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(y){const v="start"==y?this._onStartFns:this._onDoneFns;v.forEach(I=>I()),v.length=0}}class Yi{constructor(y){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=y;let v=0,I=0,X=0;const fe=this.players.length;0==fe?si(()=>this._onFinish()):this.players.forEach(Te=>{Te.onDone(()=>{++v==fe&&this._onFinish()}),Te.onDestroy(()=>{++I==fe&&this._onDestroy()}),Te.onStart(()=>{++X==fe&&this._onStart()})}),this.totalTime=this.players.reduce((Te,je)=>Math.max(Te,je.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(y=>y()),this._onDoneFns=[])}init(){this.players.forEach(y=>y.init())}onStart(y){this._onStartFns.push(y)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(y=>y()),this._onStartFns=[])}onDone(y){this._onDoneFns.push(y)}onDestroy(y){this._onDestroyFns.push(y)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(y=>y.play())}pause(){this.players.forEach(y=>y.pause())}restart(){this.players.forEach(y=>y.restart())}finish(){this._onFinish(),this.players.forEach(y=>y.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(y=>y.destroy()),this._onDestroyFns.forEach(y=>y()),this._onDestroyFns=[])}reset(){this.players.forEach(y=>y.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(y){const v=y*this.totalTime;this.players.forEach(I=>{const X=I.totalTime?Math.min(1,v/I.totalTime):1;I.setPosition(X)})}getPosition(){const y=this.players.reduce((v,I)=>null===v||I.totalTime>v.totalTime?I:v,null);return null!=y?y.getPosition():0}beforeDestroy(){this.players.forEach(y=>{y.beforeDestroy&&y.beforeDestroy()})}triggerCallback(y){const v="start"==y?this._onStartFns:this._onDoneFns;v.forEach(I=>I()),v.length=0}}function Ar(){return"undefined"!=typeof window&&void 0!==window.document}function es(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function Hr(L){switch(L.length){case 0:return new Oi;case 1:return L[0];default:return new Yi(L)}}function Fi(L,y,v,I,X={},fe={}){const Te=[],je=[];let vt=-1,Ft=null;if(I.forEach(un=>{const Fn=un.offset,or=Fn==vt,Ir=or&&Ft||{};Object.keys(un).forEach(rr=>{let cr=rr,Cr=un[rr];if("offset"!==rr)switch(cr=y.normalizePropertyName(cr,Te),Cr){case"!":Cr=X[rr];break;case xr:Cr=fe[rr];break;default:Cr=y.normalizeStyleValue(rr,cr,Cr,Te)}Ir[cr]=Cr}),or||je.push(Ir),Ft=Ir,vt=Fn}),Te.length){const un="\n - ";throw new Error(`Unable to animate due to the following errors:${un}${Te.join(un)}`)}return je}function Ki(L,y,v,I){switch(y){case"start":L.onStart(()=>I(v&&Li(v,"start",L)));break;case"done":L.onDone(()=>I(v&&Li(v,"done",L)));break;case"destroy":L.onDestroy(()=>I(v&&Li(v,"destroy",L)))}}function Li(L,y,v){const I=v.totalTime,fe=Hs(L.element,L.triggerName,L.fromState,L.toState,y||L.phaseName,null==I?L.totalTime:I,!!v.disabled),Te=L._data;return null!=Te&&(fe._data=Te),fe}function Hs(L,y,v,I,X="",fe=0,Te){return{element:L,triggerName:y,fromState:v,toState:I,phaseName:X,totalTime:fe,disabled:!!Te}}function qr(L,y,v){let I;return L instanceof Map?(I=L.get(y),I||L.set(y,I=v)):(I=L[y],I||(I=L[y]=v)),I}function ts(L){const y=L.indexOf(":");return[L.substring(1,y),L.substr(y+1)]}let Ni=(L,y)=>!1,Ao=(L,y)=>!1,ua=(L,y,v)=>[];const ha=es();(ha||"undefined"!=typeof Element)&&(Ni=Ar()?(L,y)=>{for(;y&&y!==document.documentElement;){if(y===L)return!0;y=y.parentNode||y.host}return!1}:(L,y)=>L.contains(y),Ao=(()=>{if(ha||Element.prototype.matches)return(L,y)=>L.matches(y);{const L=Element.prototype,y=L.matchesSelector||L.mozMatchesSelector||L.msMatchesSelector||L.oMatchesSelector||L.webkitMatchesSelector;return y?(v,I)=>y.apply(v,[I]):Ao}})(),ua=(L,y,v)=>{let I=[];if(v){const X=L.querySelectorAll(y);for(let fe=0;fe<X.length;fe++)I.push(X[fe])}else{const X=L.querySelector(y);X&&I.push(X)}return I});let ds=null,ml=!1;function io(L){ds||(ds=("undefined"!=typeof document?document.body:null)||{},ml=!!ds.style&&"WebkitAppearance"in ds.style);let y=!0;return ds.style&&!function(L){return"ebkit"==L.substring(1,6)}(L)&&(y=L in ds.style,!y&&ml&&(y="Webkit"+L.charAt(0).toUpperCase()+L.substr(1)in ds.style)),y}const go=Ao,Xi=Ni,Yo=ua;function Mo(L){const y={};return Object.keys(L).forEach(v=>{const I=v.replace(/([a-z])([A-Z])/g,"$1-$2");y[I]=L[v]}),y}let Ws=(()=>{class L{validateStyleProperty(v){return io(v)}matchesElement(v,I){return go(v,I)}containsElement(v,I){return Xi(v,I)}query(v,I,X){return Yo(v,I,X)}computeStyle(v,I,X){return X||""}animate(v,I,X,fe,Te,je=[],vt){return new Oi(X,fe)}}return L.\u0275fac=function(v){return new(v||L)},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})(),Di=(()=>{class L{}return L.NOOP=new Ws,L})();const hr="ng-enter",Cs="ng-leave",Rs="ng-trigger",gr=".ng-trigger",oo="ng-animating",Ys=".ng-animating";function Ts(L){if("number"==typeof L)return L;const y=L.match(/^(-?[\.\d]+)(m?s)/);return!y||y.length<2?0:pa(parseFloat(y[1]),y[2])}function pa(L,y){switch(y){case"s":return 1e3*L;default:return L}}function ao(L,y,v){return L.hasOwnProperty("duration")?L:function(L,y,v){let X,fe=0,Te="";if("string"==typeof L){const je=L.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===je)return y.push(`The provided timing value "${L}" is invalid.`),{duration:0,delay:0,easing:""};X=pa(parseFloat(je[1]),je[2]);const vt=je[3];null!=vt&&(fe=pa(parseFloat(vt),je[4]));const Ft=je[5];Ft&&(Te=Ft)}else X=L;if(!v){let je=!1,vt=y.length;X<0&&(y.push("Duration values below 0 are not allowed for this animation step."),je=!0),fe<0&&(y.push("Delay values below 0 are not allowed for this animation step."),je=!0),je&&y.splice(vt,0,`The provided timing value "${L}" is invalid.`)}return{duration:X,delay:fe,easing:Te}}(L,y,v)}function he(L,y={}){return Object.keys(L).forEach(v=>{y[v]=L[v]}),y}function _e(L,y,v={}){if(y)for(let I in L)v[I]=L[I];else he(L,v);return v}function Xe(L,y,v){return v?y+":"+v+";":""}function Dt(L){let y="";for(let v=0;v<L.style.length;v++){const I=L.style.item(v);y+=Xe(0,I,L.style.getPropertyValue(I))}for(const v in L.style)L.style.hasOwnProperty(v)&&!v.startsWith("_")&&(y+=Xe(0,oi(v),L.style[v]));L.setAttribute("style",y)}function jt(L,y,v){L.style&&(Object.keys(y).forEach(I=>{const X=Ai(I);v&&!v.hasOwnProperty(I)&&(v[I]=L.style[X]),L.style[X]=y[I]}),es()&&Dt(L))}function q(L,y){L.style&&(Object.keys(y).forEach(v=>{const I=Ai(v);L.style[I]=""}),es()&&Dt(L))}function $(L){return Array.isArray(L)?1==L.length?L[0]:ws(L):L}const ue=new RegExp("{{\\s*(.+?)\\s*}}","g");function yt(L){let y=[];if("string"==typeof L){let v;for(;v=ue.exec(L);)y.push(v[1]);ue.lastIndex=0}return y}function Qt(L,y,v){const I=L.toString(),X=I.replace(ue,(fe,Te)=>{let je=y[Te];return y.hasOwnProperty(Te)||(v.push(`Please provide a value for the animation param ${Te}`),je=""),je.toString()});return X==I?L:X}function Mn(L){const y=[];let v=L.next();for(;!v.done;)y.push(v.value),v=L.next();return y}const Vr=/-+([a-z0-9])/g;function Ai(L){return L.replace(Vr,(...y)=>y[1].toUpperCase())}function oi(L){return L.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function fs(L,y){return 0===L||0===y}function ps(L,y,v){const I=Object.keys(v);if(I.length&&y.length){let fe=y[0],Te=[];if(I.forEach(je=>{fe.hasOwnProperty(je)||Te.push(je),fe[je]=v[je]}),Te.length)for(var X=1;X<y.length;X++){let je=y[X];Te.forEach(function(vt){je[vt]=Mi(L,vt)})}}return y}function Mr(L,y,v){switch(y.type){case 7:return L.visitTrigger(y,v);case 0:return L.visitState(y,v);case 1:return L.visitTransition(y,v);case 2:return L.visitSequence(y,v);case 3:return L.visitGroup(y,v);case 4:return L.visitAnimate(y,v);case 5:return L.visitKeyframes(y,v);case 6:return L.visitStyle(y,v);case 8:return L.visitReference(y,v);case 9:return L.visitAnimateChild(y,v);case 10:return L.visitAnimateRef(y,v);case 11:return L.visitQuery(y,v);case 12:return L.visitStagger(y,v);default:throw new Error(`Unable to resolve animation metadata node #${y.type}`)}}function Mi(L,y){return window.getComputedStyle(L)[y]}function Po(L,y){const v=[];return"string"==typeof L?L.split(/\s*,\s*/).forEach(I=>function(L,y,v){if(":"==L[0]){const vt=function(L,y){switch(L){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(v,I)=>parseFloat(I)>parseFloat(v);case":decrement":return(v,I)=>parseFloat(I)<parseFloat(v);default:return y.push(`The transition alias value "${L}" is not supported`),"* => *"}}(L,v);if("function"==typeof vt)return void y.push(vt);L=vt}const I=L.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==I||I.length<4)return v.push(`The provided transition expression "${L}" is not supported`),y;const X=I[1],fe=I[2],Te=I[3];y.push(nr(X,Te));"<"==fe[0]&&!("*"==X&&"*"==Te)&&y.push(nr(Te,X))}(I,v,y)):v.push(L),v}const ko=new Set(["true","1"]),Qa=new Set(["false","0"]);function nr(L,y){const v=ko.has(L)||Qa.has(L),I=ko.has(y)||Qa.has(y);return(X,fe)=>{let Te="*"==L||L==X,je="*"==y||y==fe;return!Te&&v&&"boolean"==typeof X&&(Te=X?ko.has(L):Qa.has(L)),!je&&I&&"boolean"==typeof fe&&(je=fe?ko.has(y):Qa.has(y)),Te&&je}}const kc=new RegExp("s*:selfs*,?","g");function Gl(L,y,v){return new yl(L).build(y,v)}class yl{constructor(y){this._driver=y}build(y,v){const I=new Jt(v);return this._resetContextStyleTimingState(I),Mr(this,$(y),I)}_resetContextStyleTimingState(y){y.currentQuerySelector="",y.collectedStyles={},y.collectedStyles[""]={},y.currentTime=0}visitTrigger(y,v){let I=v.queryCount=0,X=v.depCount=0;const fe=[],Te=[];return"@"==y.name.charAt(0)&&v.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),y.definitions.forEach(je=>{if(this._resetContextStyleTimingState(v),0==je.type){const vt=je,Ft=vt.name;Ft.toString().split(/\s*,\s*/).forEach(un=>{vt.name=un,fe.push(this.visitState(vt,v))}),vt.name=Ft}else if(1==je.type){const vt=this.visitTransition(je,v);I+=vt.queryCount,X+=vt.depCount,Te.push(vt)}else v.errors.push("only state() and transition() definitions can sit inside of a trigger()")}),{type:7,name:y.name,states:fe,transitions:Te,queryCount:I,depCount:X,options:null}}visitState(y,v){const I=this.visitStyle(y.styles,v),X=y.options&&y.options.params||null;if(I.containsDynamicStyles){const fe=new Set,Te=X||{};if(I.styles.forEach(je=>{if(Ma(je)){const vt=je;Object.keys(vt).forEach(Ft=>{yt(vt[Ft]).forEach(un=>{Te.hasOwnProperty(un)||fe.add(un)})})}}),fe.size){const je=Mn(fe.values());v.errors.push(`state("${y.name}", ...) must define default values for all the following style substitutions: ${je.join(", ")}`)}}return{type:0,name:y.name,style:I,options:X?{params:X}:null}}visitTransition(y,v){v.queryCount=0,v.depCount=0;const I=Mr(this,$(y.animation),v);return{type:1,matchers:Po(y.expr,v.errors),animation:I,queryCount:v.queryCount,depCount:v.depCount,options:Oo(y.options)}}visitSequence(y,v){return{type:2,steps:y.steps.map(I=>Mr(this,I,v)),options:Oo(y.options)}}visitGroup(y,v){const I=v.currentTime;let X=0;const fe=y.steps.map(Te=>{v.currentTime=I;const je=Mr(this,Te,v);return X=Math.max(X,v.currentTime),je});return v.currentTime=X,{type:3,steps:fe,options:Oo(y.options)}}visitAnimate(y,v){const I=function(L,y){let v=null;if(L.hasOwnProperty("duration"))v=L;else if("number"==typeof L)return ks(ao(L,y).duration,0,"");const I=L;if(I.split(/\s+/).some(fe=>"{"==fe.charAt(0)&&"{"==fe.charAt(1))){const fe=ks(0,0,"");return fe.dynamic=!0,fe.strValue=I,fe}return v=v||ao(I,y),ks(v.duration,v.delay,v.easing)}(y.timings,v.errors);v.currentAnimateTimings=I;let X,fe=y.styles?y.styles:Ti({});if(5==fe.type)X=this.visitKeyframes(fe,v);else{let Te=y.styles,je=!1;if(!Te){je=!0;const Ft={};I.easing&&(Ft.easing=I.easing),Te=Ti(Ft)}v.currentTime+=I.duration+I.delay;const vt=this.visitStyle(Te,v);vt.isEmptyStep=je,X=vt}return v.currentAnimateTimings=null,{type:4,timings:I,style:X,options:null}}visitStyle(y,v){const I=this._makeStyleAst(y,v);return this._validateStyleAst(I,v),I}_makeStyleAst(y,v){const I=[];Array.isArray(y.styles)?y.styles.forEach(Te=>{"string"==typeof Te?Te==xr?I.push(Te):v.errors.push(`The provided style string value ${Te} is not allowed.`):I.push(Te)}):I.push(y.styles);let X=!1,fe=null;return I.forEach(Te=>{if(Ma(Te)){const je=Te,vt=je.easing;if(vt&&(fe=vt,delete je.easing),!X)for(let Ft in je)if(je[Ft].toString().indexOf("{{")>=0){X=!0;break}}}),{type:6,styles:I,easing:fe,offset:y.offset,containsDynamicStyles:X,options:null}}_validateStyleAst(y,v){const I=v.currentAnimateTimings;let X=v.currentTime,fe=v.currentTime;I&&fe>0&&(fe-=I.duration+I.delay),y.styles.forEach(Te=>{"string"!=typeof Te&&Object.keys(Te).forEach(je=>{if(!this._driver.validateStyleProperty(je))return void v.errors.push(`The provided animation property "${je}" is not a supported CSS property for animations`);const vt=v.collectedStyles[v.currentQuerySelector],Ft=vt[je];let un=!0;Ft&&(fe!=X&&fe>=Ft.startTime&&X<=Ft.endTime&&(v.errors.push(`The CSS property "${je}" that exists between the times of "${Ft.startTime}ms" and "${Ft.endTime}ms" is also being animated in a parallel animation between the times of "${fe}ms" and "${X}ms"`),un=!1),fe=Ft.startTime),un&&(vt[je]={startTime:fe,endTime:X}),v.options&&function(L,y,v){const I=y.params||{},X=yt(L);X.length&&X.forEach(fe=>{I.hasOwnProperty(fe)||v.push(`Unable to resolve the local animation param ${fe} in the given list of values`)})}(Te[je],v.options,v.errors)})})}visitKeyframes(y,v){const I={type:5,styles:[],options:null};if(!v.currentAnimateTimings)return v.errors.push("keyframes() must be placed inside of a call to animate()"),I;let fe=0;const Te=[];let je=!1,vt=!1,Ft=0;const un=y.steps.map(Pi=>{const vi=this._makeStyleAst(Pi,v);let fo=null!=vi.offset?vi.offset:function(L){if("string"==typeof L)return null;let y=null;if(Array.isArray(L))L.forEach(v=>{if(Ma(v)&&v.hasOwnProperty("offset")){const I=v;y=parseFloat(I.offset),delete I.offset}});else if(Ma(L)&&L.hasOwnProperty("offset")){const v=L;y=parseFloat(v.offset),delete v.offset}return y}(vi.styles),Ls=0;return null!=fo&&(fe++,Ls=vi.offset=fo),vt=vt||Ls<0||Ls>1,je=je||Ls<Ft,Ft=Ls,Te.push(Ls),vi});vt&&v.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),je&&v.errors.push("Please ensure that all keyframe offsets are in order");const Fn=y.steps.length;let or=0;fe>0&&fe<Fn?v.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==fe&&(or=1/(Fn-1));const Ir=Fn-1,rr=v.currentTime,cr=v.currentAnimateTimings,Cr=cr.duration;return un.forEach((Pi,vi)=>{const fo=or>0?vi==Ir?1:or*vi:Te[vi],Ls=fo*Cr;v.currentTime=rr+cr.delay+Ls,cr.duration=Ls,this._validateStyleAst(Pi,v),Pi.offset=fo,I.styles.push(Pi)}),I}visitReference(y,v){return{type:8,animation:Mr(this,$(y.animation),v),options:Oo(y.options)}}visitAnimateChild(y,v){return v.depCount++,{type:9,options:Oo(y.options)}}visitAnimateRef(y,v){return{type:10,animation:this.visitReference(y.animation,v),options:Oo(y.options)}}visitQuery(y,v){const I=v.currentQuerySelector,X=y.options||{};v.queryCount++,v.currentQuery=y;const[fe,Te]=function(L){const y=!!L.split(/\s*,\s*/).find(v=>":self"==v);return y&&(L=L.replace(kc,"")),[L=L.replace(/@\*/g,gr).replace(/@\w+/g,v=>gr+"-"+v.substr(1)).replace(/:animating/g,Ys),y]}(y.selector);v.currentQuerySelector=I.length?I+" "+fe:fe,qr(v.collectedStyles,v.currentQuerySelector,{});const je=Mr(this,$(y.animation),v);return v.currentQuery=null,v.currentQuerySelector=I,{type:11,selector:fe,limit:X.limit||0,optional:!!X.optional,includeSelf:Te,animation:je,originalSelector:y.selector,options:Oo(y.options)}}visitStagger(y,v){v.currentQuery||v.errors.push("stagger() can only be used inside of query()");const I="full"===y.timings?{duration:0,delay:0,easing:"full"}:ao(y.timings,v.errors,!0);return{type:12,animation:Mr(this,$(y.animation),v),timings:I,options:null}}}class Jt{constructor(y){this.errors=y,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null}}function Ma(L){return!Array.isArray(L)&&"object"==typeof L}function Oo(L){return L?(L=he(L)).params&&(L.params=function(L){return L?he(L):null}(L.params)):L={},L}function ks(L,y,v){return{duration:L,delay:y,easing:v}}function ns(L,y,v,I,X,fe,Te=null,je=!1){return{type:1,element:L,keyframes:y,preStyleProps:v,postStyleProps:I,duration:X,delay:fe,totalTime:X+fe,easing:Te,subTimeline:je}}class Fo{constructor(){this._map=new Map}consume(y){let v=this._map.get(y);return v?this._map.delete(y):v=[],v}append(y,v){let I=this._map.get(y);I||this._map.set(y,I=[]),I.push(...v)}has(y){return this._map.has(y)}clear(){this._map.clear()}}const Zl=new RegExp(":enter","g"),vl=new RegExp(":leave","g");function _i(L,y,v,I,X,fe={},Te={},je,vt,Ft=[]){return(new yo).buildKeyframes(L,y,v,I,X,fe,Te,je,vt,Ft)}class yo{buildKeyframes(y,v,I,X,fe,Te,je,vt,Ft,un=[]){Ft=Ft||new Fo;const Fn=new Ss(y,v,Ft,X,fe,un,[]);Fn.options=vt,Fn.currentTimeline.setStyles([Te],null,Fn.errors,vt),Mr(this,I,Fn);const or=Fn.timelines.filter(Ir=>Ir.containsAnimation());if(or.length&&Object.keys(je).length){const Ir=or[or.length-1];Ir.allowOnlyTimelineStyles()||Ir.setStyles([je],null,Fn.errors,vt)}return or.length?or.map(Ir=>Ir.buildKeyframes()):[ns(v,[],[],[],0,0,"",!1)]}visitTrigger(y,v){}visitState(y,v){}visitTransition(y,v){}visitAnimateChild(y,v){const I=v.subInstructions.consume(v.element);if(I){const X=v.createSubContext(y.options),fe=v.currentTimeline.currentTime,Te=this._visitSubInstructions(I,X,X.options);fe!=Te&&v.transformIntoNewTimeline(Te)}v.previousNode=y}visitAnimateRef(y,v){const I=v.createSubContext(y.options);I.transformIntoNewTimeline(),this.visitReference(y.animation,I),v.transformIntoNewTimeline(I.currentTimeline.currentTime),v.previousNode=y}_visitSubInstructions(y,v,I){let fe=v.currentTimeline.currentTime;const Te=null!=I.duration?Ts(I.duration):null,je=null!=I.delay?Ts(I.delay):null;return 0!==Te&&y.forEach(vt=>{const Ft=v.appendInstructionToTimeline(vt,Te,je);fe=Math.max(fe,Ft.duration+Ft.delay)}),fe}visitReference(y,v){v.updateOptions(y.options,!0),Mr(this,y.animation,v),v.previousNode=y}visitSequence(y,v){const I=v.subContextCount;let X=v;const fe=y.options;if(fe&&(fe.params||fe.delay)&&(X=v.createSubContext(fe),X.transformIntoNewTimeline(),null!=fe.delay)){6==X.previousNode.type&&(X.currentTimeline.snapshotCurrentStyles(),X.previousNode=el);const Te=Ts(fe.delay);X.delayNextStep(Te)}y.steps.length&&(y.steps.forEach(Te=>Mr(this,Te,X)),X.currentTimeline.applyStylesToKeyframe(),X.subContextCount>I&&X.transformIntoNewTimeline()),v.previousNode=y}visitGroup(y,v){const I=[];let X=v.currentTimeline.currentTime;const fe=y.options&&y.options.delay?Ts(y.options.delay):0;y.steps.forEach(Te=>{const je=v.createSubContext(y.options);fe&&je.delayNextStep(fe),Mr(this,Te,je),X=Math.max(X,je.currentTimeline.currentTime),I.push(je.currentTimeline)}),I.forEach(Te=>v.currentTimeline.mergeTimelineCollectedStyles(Te)),v.transformIntoNewTimeline(X),v.previousNode=y}_visitTiming(y,v){if(y.dynamic){const I=y.strValue;return ao(v.params?Qt(I,v.params,v.errors):I,v.errors)}return{duration:y.duration,delay:y.delay,easing:y.easing}}visitAnimate(y,v){const I=v.currentAnimateTimings=this._visitTiming(y.timings,v),X=v.currentTimeline;I.delay&&(v.incrementTime(I.delay),X.snapshotCurrentStyles());const fe=y.style;5==fe.type?this.visitKeyframes(fe,v):(v.incrementTime(I.duration),this.visitStyle(fe,v),X.applyStylesToKeyframe()),v.currentAnimateTimings=null,v.previousNode=y}visitStyle(y,v){const I=v.currentTimeline,X=v.currentAnimateTimings;!X&&I.getCurrentStyleProperties().length&&I.forwardFrame();const fe=X&&X.easing||y.easing;y.isEmptyStep?I.applyEmptyStep(fe):I.setStyles(y.styles,fe,v.errors,v.options),v.previousNode=y}visitKeyframes(y,v){const I=v.currentAnimateTimings,X=v.currentTimeline.duration,fe=I.duration,je=v.createSubContext().currentTimeline;je.easing=I.easing,y.styles.forEach(vt=>{je.forwardTime((vt.offset||0)*fe),je.setStyles(vt.styles,vt.easing,v.errors,v.options),je.applyStylesToKeyframe()}),v.currentTimeline.mergeTimelineCollectedStyles(je),v.transformIntoNewTimeline(X+fe),v.previousNode=y}visitQuery(y,v){const I=v.currentTimeline.currentTime,X=y.options||{},fe=X.delay?Ts(X.delay):0;fe&&(6===v.previousNode.type||0==I&&v.currentTimeline.getCurrentStyleProperties().length)&&(v.currentTimeline.snapshotCurrentStyles(),v.previousNode=el);let Te=I;const je=v.invokeQuery(y.selector,y.originalSelector,y.limit,y.includeSelf,!!X.optional,v.errors);v.currentQueryTotal=je.length;let vt=null;je.forEach((Ft,un)=>{v.currentQueryIndex=un;const Fn=v.createSubContext(y.options,Ft);fe&&Fn.delayNextStep(fe),Ft===v.element&&(vt=Fn.currentTimeline),Mr(this,y.animation,Fn),Fn.currentTimeline.applyStylesToKeyframe(),Te=Math.max(Te,Fn.currentTimeline.currentTime)}),v.currentQueryIndex=0,v.currentQueryTotal=0,v.transformIntoNewTimeline(Te),vt&&(v.currentTimeline.mergeTimelineCollectedStyles(vt),v.currentTimeline.snapshotCurrentStyles()),v.previousNode=y}visitStagger(y,v){const I=v.parentContext,X=v.currentTimeline,fe=y.timings,Te=Math.abs(fe.duration),je=Te*(v.currentQueryTotal-1);let vt=Te*v.currentQueryIndex;switch(fe.duration<0?"reverse":fe.easing){case"reverse":vt=je-vt;break;case"full":vt=I.currentStaggerTime}const un=v.currentTimeline;vt&&un.delayNextStep(vt);const Fn=un.currentTime;Mr(this,y.animation,v),v.previousNode=y,I.currentStaggerTime=X.currentTime-Fn+(X.startTime-I.currentTimeline.startTime)}}const el={};class Ss{constructor(y,v,I,X,fe,Te,je,vt){this._driver=y,this.element=v,this.subInstructions=I,this._enterClassName=X,this._leaveClassName=fe,this.errors=Te,this.timelines=je,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=el,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=vt||new co(this._driver,v,0),je.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(y,v){if(!y)return;const I=y;let X=this.options;null!=I.duration&&(X.duration=Ts(I.duration)),null!=I.delay&&(X.delay=Ts(I.delay));const fe=I.params;if(fe){let Te=X.params;Te||(Te=this.options.params={}),Object.keys(fe).forEach(je=>{(!v||!Te.hasOwnProperty(je))&&(Te[je]=Qt(fe[je],Te,this.errors))})}}_copyOptions(){const y={};if(this.options){const v=this.options.params;if(v){const I=y.params={};Object.keys(v).forEach(X=>{I[X]=v[X]})}}return y}createSubContext(y=null,v,I){const X=v||this.element,fe=new Ss(this._driver,X,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(X,I||0));return fe.previousNode=this.previousNode,fe.currentAnimateTimings=this.currentAnimateTimings,fe.options=this._copyOptions(),fe.updateOptions(y),fe.currentQueryIndex=this.currentQueryIndex,fe.currentQueryTotal=this.currentQueryTotal,fe.parentContext=this,this.subContextCount++,fe}transformIntoNewTimeline(y){return this.previousNode=el,this.currentTimeline=this.currentTimeline.fork(this.element,y),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(y,v,I){const X={duration:null!=v?v:y.duration,delay:this.currentTimeline.currentTime+(null!=I?I:0)+y.delay,easing:""},fe=new _c(this._driver,y.element,y.keyframes,y.preStyleProps,y.postStyleProps,X,y.stretchStartingKeyframe);return this.timelines.push(fe),X}incrementTime(y){this.currentTimeline.forwardTime(this.currentTimeline.duration+y)}delayNextStep(y){y>0&&this.currentTimeline.delayNextStep(y)}invokeQuery(y,v,I,X,fe,Te){let je=[];if(X&&je.push(this.element),y.length>0){y=(y=y.replace(Zl,"."+this._enterClassName)).replace(vl,"."+this._leaveClassName);let Ft=this._driver.query(this.element,y,1!=I);0!==I&&(Ft=I<0?Ft.slice(Ft.length+I,Ft.length):Ft.slice(0,I)),je.push(...Ft)}return!fe&&0==je.length&&Te.push(`\`query("${v}")\` returned zero elements. (Use \`query("${v}", { optional: true })\` if you wish to allow this.)`),je}}class co{constructor(y,v,I,X){this._driver=y,this.element=v,this.startTime=I,this._elementTimelineStylesLookup=X,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(v),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(v,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}getCurrentStyleProperties(){return Object.keys(this._currentKeyframe)}get currentTime(){return this.startTime+this.duration}delayNextStep(y){const v=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||v?(this.forwardTime(this.currentTime+y),v&&this.snapshotCurrentStyles()):this.startTime+=y}fork(y,v){return this.applyStylesToKeyframe(),new co(this._driver,y,v||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(y){this.applyStylesToKeyframe(),this.duration=y,this._loadKeyframe()}_updateStyle(y,v){this._localTimelineStyles[y]=v,this._globalTimelineStyles[y]=v,this._styleSummary[y]={time:this.currentTime,value:v}}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(y){y&&(this._previousKeyframe.easing=y),Object.keys(this._globalTimelineStyles).forEach(v=>{this._backFill[v]=this._globalTimelineStyles[v]||xr,this._currentKeyframe[v]=xr}),this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(y,v,I,X){v&&(this._previousKeyframe.easing=v);const fe=X&&X.params||{},Te=function(L,y){const v={};let I;return L.forEach(X=>{"*"===X?(I=I||Object.keys(y),I.forEach(fe=>{v[fe]=xr})):_e(X,!1,v)}),v}(y,this._globalTimelineStyles);Object.keys(Te).forEach(je=>{const vt=Qt(Te[je],fe,I);this._pendingStyles[je]=vt,this._localTimelineStyles.hasOwnProperty(je)||(this._backFill[je]=this._globalTimelineStyles.hasOwnProperty(je)?this._globalTimelineStyles[je]:xr),this._updateStyle(je,vt)})}applyStylesToKeyframe(){const y=this._pendingStyles,v=Object.keys(y);0!=v.length&&(this._pendingStyles={},v.forEach(I=>{this._currentKeyframe[I]=y[I]}),Object.keys(this._localTimelineStyles).forEach(I=>{this._currentKeyframe.hasOwnProperty(I)||(this._currentKeyframe[I]=this._localTimelineStyles[I])}))}snapshotCurrentStyles(){Object.keys(this._localTimelineStyles).forEach(y=>{const v=this._localTimelineStyles[y];this._pendingStyles[y]=v,this._updateStyle(y,v)})}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const y=[];for(let v in this._currentKeyframe)y.push(v);return y}mergeTimelineCollectedStyles(y){Object.keys(y._styleSummary).forEach(v=>{const I=this._styleSummary[v],X=y._styleSummary[v];(!I||X.time>I.time)&&this._updateStyle(v,X.value)})}buildKeyframes(){this.applyStylesToKeyframe();const y=new Set,v=new Set,I=1===this._keyframes.size&&0===this.duration;let X=[];this._keyframes.forEach((je,vt)=>{const Ft=_e(je,!0);Object.keys(Ft).forEach(un=>{const Fn=Ft[un];"!"==Fn?y.add(un):Fn==xr&&v.add(un)}),I||(Ft.offset=vt/this.duration),X.push(Ft)});const fe=y.size?Mn(y.values()):[],Te=v.size?Mn(v.values()):[];if(I){const je=X[0],vt=he(je);je.offset=0,vt.offset=1,X=[je,vt]}return ns(this.element,X,fe,Te,this.duration,this.startTime,this.easing,!1)}}class _c extends co{constructor(y,v,I,X,fe,Te,je=!1){super(y,v,Te.delay),this.keyframes=I,this.preStyleProps=X,this.postStyleProps=fe,this._stretchStartingKeyframe=je,this.timings={duration:Te.duration,delay:Te.delay,easing:Te.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let y=this.keyframes,{delay:v,duration:I,easing:X}=this.timings;if(this._stretchStartingKeyframe&&v){const fe=[],Te=I+v,je=v/Te,vt=_e(y[0],!1);vt.offset=0,fe.push(vt);const Ft=_e(y[0],!1);Ft.offset=tl(je),fe.push(Ft);const un=y.length-1;for(let Fn=1;Fn<=un;Fn++){let or=_e(y[Fn],!1);or.offset=tl((v+or.offset*I)/Te),fe.push(or)}I=Te,v=0,X="",y=fe}return ns(this.element,y,this.preStyleProps,this.postStyleProps,I,v,X,!0)}}function tl(L,y=3){const v=Math.pow(10,y-1);return Math.round(L*v)/v}class uo{}class xl extends uo{normalizePropertyName(y,v){return Ai(y)}normalizeStyleValue(y,v,I,X){let fe="";const Te=I.toString().trim();if(Ds[v]&&0!==I&&"0"!==I)if("number"==typeof I)fe="px";else{const je=I.match(/^[+-]?[\d\.]+([a-z]*)$/);je&&0==je[1].length&&X.push(`Please provide a CSS unit value for ${y}:${I}`)}return Te+fe}}const Ds=(()=>function(L){const y={};return L.forEach(v=>y[v]=!0),y}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(",")))();function _a(L,y,v,I,X,fe,Te,je,vt,Ft,un,Fn,or){return{type:0,element:L,triggerName:y,isRemovalTransition:X,fromState:v,fromStyles:fe,toState:I,toStyles:Te,timelines:je,queriedElements:vt,preStyleProps:Ft,postStyleProps:un,totalTime:Fn,errors:or}}const nl={};class Lo{constructor(y,v,I){this._triggerName=y,this.ast=v,this._stateStyles=I}match(y,v,I,X){return function(L,y,v,I,X){return L.some(fe=>fe(y,v,I,X))}(this.ast.matchers,y,v,I,X)}buildStyles(y,v,I){const X=this._stateStyles["*"],fe=this._stateStyles[y],Te=X?X.buildStyles(v,I):{};return fe?fe.buildStyles(v,I):Te}build(y,v,I,X,fe,Te,je,vt,Ft,un){const Fn=[],or=this.ast.options&&this.ast.options.params||nl,rr=this.buildStyles(I,je&&je.params||nl,Fn),cr=vt&&vt.params||nl,Cr=this.buildStyles(X,cr,Fn),Pi=new Set,vi=new Map,fo=new Map,Ls="void"===X,ec={params:Object.assign(Object.assign({},or),cr)},ia=un?[]:_i(y,v,this.ast.animation,fe,Te,rr,Cr,ec,Ft,Fn);let eo=0;if(ia.forEach(sa=>{eo=Math.max(sa.duration+sa.delay,eo)}),Fn.length)return _a(v,this._triggerName,I,X,Ls,rr,Cr,[],[],vi,fo,eo,Fn);ia.forEach(sa=>{const Vo=sa.element,Rl=qr(vi,Vo,{});sa.preStyleProps.forEach(tc=>Rl[tc]=!0);const zc=qr(fo,Vo,{});sa.postStyleProps.forEach(tc=>zc[tc]=!0),Vo!==v&&Pi.add(Vo)});const Pl=Mn(Pi.values());return _a(v,this._triggerName,I,X,Ls,rr,Cr,ia,Pl,vi,fo,eo)}}class rl{constructor(y,v,I){this.styles=y,this.defaultParams=v,this.normalizer=I}buildStyles(y,v){const I={},X=he(this.defaultParams);return Object.keys(y).forEach(fe=>{const Te=y[fe];null!=Te&&(X[fe]=Te)}),this.styles.styles.forEach(fe=>{if("string"!=typeof fe){const Te=fe;Object.keys(Te).forEach(je=>{let vt=Te[je];vt.length>1&&(vt=Qt(vt,X,v));const Ft=this.normalizer.normalizePropertyName(je,v);vt=this.normalizer.normalizeStyleValue(je,Ft,vt,v),I[Ft]=vt})}}),I}}class ka{constructor(y,v,I){this.name=y,this.ast=v,this._normalizer=I,this.transitionFactories=[],this.states={},v.states.forEach(X=>{this.states[X.name]=new rl(X.style,X.options&&X.options.params||{},I)}),rs(this.states,"true","1"),rs(this.states,"false","0"),v.transitions.forEach(X=>{this.transitionFactories.push(new Lo(y,X,this.states))}),this.fallbackTransition=function(L,y,v){return new Lo(L,{type:1,animation:{type:2,steps:[],options:null},matchers:[(Te,je)=>!0],options:null,queryCount:0,depCount:0},y)}(y,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(y,v,I,X){return this.transitionFactories.find(Te=>Te.match(y,v,I,X))||null}matchStyles(y,v,I){return this.fallbackTransition.buildStyles(y,v,I)}}function rs(L,y,v){L.hasOwnProperty(y)?L.hasOwnProperty(v)||(L[v]=L[y]):L.hasOwnProperty(v)&&(L[y]=L[v])}const Os=new Fo;class bi{constructor(y,v,I){this.bodyNode=y,this._driver=v,this._normalizer=I,this._animations={},this._playersById={},this.players=[]}register(y,v){const I=[],X=Gl(this._driver,v,I);if(I.length)throw new Error(`Unable to build the animation due to the following errors: ${I.join("\n")}`);this._animations[y]=X}_buildPlayer(y,v,I){const X=y.element,fe=Fi(0,this._normalizer,0,y.keyframes,v,I);return this._driver.animate(X,fe,y.duration,y.delay,y.easing,[],!0)}create(y,v,I={}){const X=[],fe=this._animations[y];let Te;const je=new Map;if(fe?(Te=_i(this._driver,v,fe,hr,Cs,{},{},I,Os,X),Te.forEach(un=>{const Fn=qr(je,un.element,{});un.postStyleProps.forEach(or=>Fn[or]=null)})):(X.push("The requested animation doesn't exist or has already been destroyed"),Te=[]),X.length)throw new Error(`Unable to create the animation due to the following errors: ${X.join("\n")}`);je.forEach((un,Fn)=>{Object.keys(un).forEach(or=>{un[or]=this._driver.computeStyle(Fn,or,xr)})});const Ft=Hr(Te.map(un=>{const Fn=je.get(un.element);return this._buildPlayer(un,{},Fn)}));return this._playersById[y]=Ft,Ft.onDestroy(()=>this.destroy(y)),this.players.push(Ft),Ft}destroy(y){const v=this._getPlayer(y);v.destroy(),delete this._playersById[y];const I=this.players.indexOf(v);I>=0&&this.players.splice(I,1)}_getPlayer(y){const v=this._playersById[y];if(!v)throw new Error(`Unable to find the timeline player referenced by ${y}`);return v}listen(y,v,I,X){const fe=Hs(v,"","","");return Ki(this._getPlayer(y),I,fe,X),()=>{}}command(y,v,I,X){if("register"==I)return void this.register(y,X[0]);if("create"==I)return void this.create(y,v,X[0]||{});const fe=this._getPlayer(y);switch(I){case"play":fe.play();break;case"pause":fe.pause();break;case"reset":fe.reset();break;case"restart":fe.restart();break;case"finish":fe.finish();break;case"init":fe.init();break;case"setPosition":fe.setPosition(parseFloat(X[0]));break;case"destroy":this.destroy(y)}}}const xc="ng-animate-queued",wl="ng-animate-disabled",Wl=".ng-animate-disabled",ms=[],Xo={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Fa={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},$i="__ng_removed";class Cl{constructor(y,v=""){this.namespaceId=v;const I=y&&y.hasOwnProperty("value");if(this.value=null!=(L=I?y.value:y)?L:null,I){const fe=he(y);delete fe.value,this.options=fe}else this.options={};var L;this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(y){const v=y.params;if(v){const I=this.options.params;Object.keys(v).forEach(X=>{null==I[X]&&(I[X]=v[X])})}}}const xo="void",Ks=new Cl(xo);class il{constructor(y,v,I){this.id=y,this.hostElement=v,this._engine=I,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+y,Fs(v,this._hostClassName)}listen(y,v,I,X){if(!this._triggers.hasOwnProperty(v))throw new Error(`Unable to listen on the animation trigger event "${I}" because the animation trigger "${v}" doesn't exist!`);if(null==I||0==I.length)throw new Error(`Unable to listen on the animation trigger "${v}" because the provided event is undefined!`);if("start"!=(L=I)&&"done"!=L)throw new Error(`The provided animation trigger event "${I}" for the animation trigger "${v}" is not supported!`);var L;const fe=qr(this._elementListeners,y,[]),Te={name:v,phase:I,callback:X};fe.push(Te);const je=qr(this._engine.statesByElement,y,{});return je.hasOwnProperty(v)||(Fs(y,Rs),Fs(y,Rs+"-"+v),je[v]=Ks),()=>{this._engine.afterFlush(()=>{const vt=fe.indexOf(Te);vt>=0&&fe.splice(vt,1),this._triggers[v]||delete je[v]})}}register(y,v){return!this._triggers[y]&&(this._triggers[y]=v,!0)}_getTrigger(y){const v=this._triggers[y];if(!v)throw new Error(`The provided animation trigger "${y}" has not been registered!`);return v}trigger(y,v,I,X=!0){const fe=this._getTrigger(v),Te=new Kl(this.id,v,y);let je=this._engine.statesByElement.get(y);je||(Fs(y,Rs),Fs(y,Rs+"-"+v),this._engine.statesByElement.set(y,je={}));let vt=je[v];const Ft=new Cl(I,this.id);if(!(I&&I.hasOwnProperty("value"))&&vt&&Ft.absorbOptions(vt.options),je[v]=Ft,vt||(vt=Ks),Ft.value!==xo&&vt.value===Ft.value){if(!function(L,y){const v=Object.keys(L),I=Object.keys(y);if(v.length!=I.length)return!1;for(let X=0;X<v.length;X++){const fe=v[X];if(!y.hasOwnProperty(fe)||L[fe]!==y[fe])return!1}return!0}(vt.params,Ft.params)){const cr=[],Cr=fe.matchStyles(vt.value,vt.params,cr),Pi=fe.matchStyles(Ft.value,Ft.params,cr);cr.length?this._engine.reportError(cr):this._engine.afterFlush(()=>{q(y,Cr),jt(y,Pi)})}return}const or=qr(this._engine.playersByElement,y,[]);or.forEach(cr=>{cr.namespaceId==this.id&&cr.triggerName==v&&cr.queued&&cr.destroy()});let Ir=fe.matchTransition(vt.value,Ft.value,y,Ft.params),rr=!1;if(!Ir){if(!X)return;Ir=fe.fallbackTransition,rr=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:y,triggerName:v,transition:Ir,fromState:vt,toState:Ft,player:Te,isFallbackTransition:rr}),rr||(Fs(y,xc),Te.onStart(()=>{ea(y,xc)})),Te.onDone(()=>{let cr=this.players.indexOf(Te);cr>=0&&this.players.splice(cr,1);const Cr=this._engine.playersByElement.get(y);if(Cr){let Pi=Cr.indexOf(Te);Pi>=0&&Cr.splice(Pi,1)}}),this.players.push(Te),or.push(Te),Te}deregister(y){delete this._triggers[y],this._engine.statesByElement.forEach((v,I)=>{delete v[y]}),this._elementListeners.forEach((v,I)=>{this._elementListeners.set(I,v.filter(X=>X.name!=y))})}clearElementCache(y){this._engine.statesByElement.delete(y),this._elementListeners.delete(y);const v=this._engine.playersByElement.get(y);v&&(v.forEach(I=>I.destroy()),this._engine.playersByElement.delete(y))}_signalRemovalForInnerTriggers(y,v){const I=this._engine.driver.query(y,gr,!0);I.forEach(X=>{if(X[$i])return;const fe=this._engine.fetchNamespacesByElement(X);fe.size?fe.forEach(Te=>Te.triggerLeaveAnimation(X,v,!1,!0)):this.clearElementCache(X)}),this._engine.afterFlushAnimationsDone(()=>I.forEach(X=>this.clearElementCache(X)))}triggerLeaveAnimation(y,v,I,X){const fe=this._engine.statesByElement.get(y);if(fe){const Te=[];if(Object.keys(fe).forEach(je=>{if(this._triggers[je]){const vt=this.trigger(y,je,xo,X);vt&&Te.push(vt)}}),Te.length)return this._engine.markElementAsRemoved(this.id,y,!0,v),I&&Hr(Te).onDone(()=>this._engine.processLeaveNode(y)),!0}return!1}prepareLeaveAnimationListeners(y){const v=this._elementListeners.get(y),I=this._engine.statesByElement.get(y);if(v&&I){const X=new Set;v.forEach(fe=>{const Te=fe.name;if(X.has(Te))return;X.add(Te);const vt=this._triggers[Te].fallbackTransition,Ft=I[Te]||Ks,un=new Cl(xo),Fn=new Kl(this.id,Te,y);this._engine.totalQueuedPlayers++,this._queue.push({element:y,triggerName:Te,transition:vt,fromState:Ft,toState:un,player:Fn,isFallbackTransition:!0})})}}removeNode(y,v){const I=this._engine;if(y.childElementCount&&this._signalRemovalForInnerTriggers(y,v),this.triggerLeaveAnimation(y,v,!0))return;let X=!1;if(I.totalAnimations){const fe=I.players.length?I.playersByQueriedElement.get(y):[];if(fe&&fe.length)X=!0;else{let Te=y;for(;Te=Te.parentNode;)if(I.statesByElement.get(Te)){X=!0;break}}}if(this.prepareLeaveAnimationListeners(y),X)I.markElementAsRemoved(this.id,y,!1,v);else{const fe=y[$i];(!fe||fe===Xo)&&(I.afterFlush(()=>this.clearElementCache(y)),I.destroyInnerAnimations(y),I._onRemovalComplete(y,v))}}insertNode(y,v){Fs(y,this._hostClassName)}drainQueuedTransitions(y){const v=[];return this._queue.forEach(I=>{const X=I.player;if(X.destroyed)return;const fe=I.element,Te=this._elementListeners.get(fe);Te&&Te.forEach(je=>{if(je.name==I.triggerName){const vt=Hs(fe,I.triggerName,I.fromState.value,I.toState.value);vt._data=y,Ki(I.player,je.phase,vt,je.callback)}}),X.markedForDestroy?this._engine.afterFlush(()=>{X.destroy()}):v.push(I)}),this._queue=[],v.sort((I,X)=>{const fe=I.transition.ast.depCount,Te=X.transition.ast.depCount;return 0==fe||0==Te?fe-Te:this._engine.driver.containsElement(I.element,X.element)?1:-1})}destroy(y){this.players.forEach(v=>v.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,y)}elementContainsData(y){let v=!1;return this._elementListeners.has(y)&&(v=!0),v=!!this._queue.find(I=>I.element===y)||v,v}}class Yl{constructor(y,v,I){this.bodyNode=y,this.driver=v,this._normalizer=I,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(X,fe)=>{}}_onRemovalComplete(y,v){this.onRemovalComplete(y,v)}get queuedPlayers(){const y=[];return this._namespaceList.forEach(v=>{v.players.forEach(I=>{I.queued&&y.push(I)})}),y}createNamespace(y,v){const I=new il(y,v,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,v)?this._balanceNamespaceList(I,v):(this.newHostElements.set(v,I),this.collectEnterElement(v)),this._namespaceLookup[y]=I}_balanceNamespaceList(y,v){const I=this._namespaceList.length-1;if(I>=0){let X=!1;for(let fe=I;fe>=0;fe--)if(this.driver.containsElement(this._namespaceList[fe].hostElement,v)){this._namespaceList.splice(fe+1,0,y),X=!0;break}X||this._namespaceList.splice(0,0,y)}else this._namespaceList.push(y);return this.namespacesByHostElement.set(v,y),y}register(y,v){let I=this._namespaceLookup[y];return I||(I=this.createNamespace(y,v)),I}registerTrigger(y,v,I){let X=this._namespaceLookup[y];X&&X.register(v,I)&&this.totalAnimations++}destroy(y,v){if(!y)return;const I=this._fetchNamespace(y);this.afterFlush(()=>{this.namespacesByHostElement.delete(I.hostElement),delete this._namespaceLookup[y];const X=this._namespaceList.indexOf(I);X>=0&&this._namespaceList.splice(X,1)}),this.afterFlushAnimationsDone(()=>I.destroy(v))}_fetchNamespace(y){return this._namespaceLookup[y]}fetchNamespacesByElement(y){const v=new Set,I=this.statesByElement.get(y);if(I){const X=Object.keys(I);for(let fe=0;fe<X.length;fe++){const Te=I[X[fe]].namespaceId;if(Te){const je=this._fetchNamespace(Te);je&&v.add(je)}}}return v}trigger(y,v,I,X){if(ho(v)){const fe=this._fetchNamespace(y);if(fe)return fe.trigger(v,I,X),!0}return!1}insertNode(y,v,I,X){if(!ho(v))return;const fe=v[$i];if(fe&&fe.setForRemoval){fe.setForRemoval=!1,fe.setForMove=!0;const Te=this.collectedLeaveElements.indexOf(v);Te>=0&&this.collectedLeaveElements.splice(Te,1)}if(y){const Te=this._fetchNamespace(y);Te&&Te.insertNode(v,I)}X&&this.collectEnterElement(v)}collectEnterElement(y){this.collectedEnterElements.push(y)}markElementAsDisabled(y,v){v?this.disabledNodes.has(y)||(this.disabledNodes.add(y),Fs(y,wl)):this.disabledNodes.has(y)&&(this.disabledNodes.delete(y),ea(y,wl))}removeNode(y,v,I,X){if(ho(v)){const fe=y?this._fetchNamespace(y):null;if(fe?fe.removeNode(v,X):this.markElementAsRemoved(y,v,!1,X),I){const Te=this.namespacesByHostElement.get(v);Te&&Te.id!==y&&Te.removeNode(v,X)}}else this._onRemovalComplete(v,X)}markElementAsRemoved(y,v,I,X){this.collectedLeaveElements.push(v),v[$i]={namespaceId:y,setForRemoval:X,hasAnimation:I,removedBeforeQueried:!1}}listen(y,v,I,X,fe){return ho(v)?this._fetchNamespace(y).listen(v,I,X,fe):()=>{}}_buildInstruction(y,v,I,X,fe){return y.transition.build(this.driver,y.element,y.fromState.value,y.toState.value,I,X,y.fromState.options,y.toState.options,v,fe)}destroyInnerAnimations(y){let v=this.driver.query(y,gr,!0);v.forEach(I=>this.destroyActiveAnimationsForElement(I)),0!=this.playersByQueriedElement.size&&(v=this.driver.query(y,Ys,!0),v.forEach(I=>this.finishActiveQueriedAnimationOnElement(I)))}destroyActiveAnimationsForElement(y){const v=this.playersByElement.get(y);v&&v.forEach(I=>{I.queued?I.markedForDestroy=!0:I.destroy()})}finishActiveQueriedAnimationOnElement(y){const v=this.playersByQueriedElement.get(y);v&&v.forEach(I=>I.finish())}whenRenderingDone(){return new Promise(y=>{if(this.players.length)return Hr(this.players).onDone(()=>y());y()})}processLeaveNode(y){const v=y[$i];if(v&&v.setForRemoval){if(y[$i]=Xo,v.namespaceId){this.destroyInnerAnimations(y);const I=this._fetchNamespace(v.namespaceId);I&&I.clearElementCache(y)}this._onRemovalComplete(y,v.setForRemoval)}this.driver.matchesElement(y,Wl)&&this.markElementAsDisabled(y,!1),this.driver.query(y,Wl,!0).forEach(I=>{this.markElementAsDisabled(I,!1)})}flush(y=-1){let v=[];if(this.newHostElements.size&&(this.newHostElements.forEach((I,X)=>this._balanceNamespaceList(I,X)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let I=0;I<this.collectedEnterElements.length;I++)Fs(this.collectedEnterElements[I],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const I=[];try{v=this._flushAnimations(I,y)}finally{for(let X=0;X<I.length;X++)I[X]()}}else for(let I=0;I<this.collectedLeaveElements.length;I++)this.processLeaveNode(this.collectedLeaveElements[I]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(I=>I()),this._flushFns=[],this._whenQuietFns.length){const I=this._whenQuietFns;this._whenQuietFns=[],v.length?Hr(v).onDone(()=>{I.forEach(X=>X())}):I.forEach(X=>X())}}reportError(y){throw new Error(`Unable to process animations due to the following failed trigger transitions\n ${y.join("\n")}`)}_flushAnimations(y,v){const I=new Fo,X=[],fe=new Map,Te=[],je=new Map,vt=new Map,Ft=new Map,un=new Set;this.disabledNodes.forEach(Ln=>{un.add(Ln);const Kn=this.driver.query(Ln,".ng-animate-queued",!0);for(let br=0;br<Kn.length;br++)un.add(Kn[br])});const Fn=this.bodyNode,or=Array.from(this.statesByElement.keys()),Ir=No(or,this.collectedEnterElements),rr=new Map;let cr=0;Ir.forEach((Ln,Kn)=>{const br=hr+cr++;rr.set(Kn,br),Ln.forEach(Kr=>Fs(Kr,br))});const Cr=[],Pi=new Set,vi=new Set;for(let Ln=0;Ln<this.collectedLeaveElements.length;Ln++){const Kn=this.collectedLeaveElements[Ln],br=Kn[$i];br&&br.setForRemoval&&(Cr.push(Kn),Pi.add(Kn),br.hasAnimation?this.driver.query(Kn,".ng-star-inserted",!0).forEach(Kr=>Pi.add(Kr)):vi.add(Kn))}const fo=new Map,Ls=No(or,Array.from(Pi));Ls.forEach((Ln,Kn)=>{const br=Cs+cr++;fo.set(Kn,br),Ln.forEach(Kr=>Fs(Kr,br))}),y.push(()=>{Ir.forEach((Ln,Kn)=>{const br=rr.get(Kn);Ln.forEach(Kr=>ea(Kr,br))}),Ls.forEach((Ln,Kn)=>{const br=fo.get(Kn);Ln.forEach(Kr=>ea(Kr,br))}),Cr.forEach(Ln=>{this.processLeaveNode(Ln)})});const ec=[],ia=[];for(let Ln=this._namespaceList.length-1;Ln>=0;Ln--)this._namespaceList[Ln].drainQueuedTransitions(v).forEach(br=>{const Kr=br.player,ys=br.element;if(ec.push(Kr),this.collectedEnterElements.length){const As=ys[$i];if(As&&As.setForMove)return void Kr.destroy()}const Uo=!Fn||!this.driver.containsElement(Fn,ys),ss=fo.get(ys),oa=rr.get(ys),pi=this._buildInstruction(br,I,oa,ss,Uo);if(pi.errors&&pi.errors.length)ia.push(pi);else{if(Uo)return Kr.onStart(()=>q(ys,pi.fromStyles)),Kr.onDestroy(()=>jt(ys,pi.toStyles)),void X.push(Kr);if(br.isFallbackTransition)return Kr.onStart(()=>q(ys,pi.fromStyles)),Kr.onDestroy(()=>jt(ys,pi.toStyles)),void X.push(Kr);pi.timelines.forEach(As=>As.stretchStartingKeyframe=!0),I.append(ys,pi.timelines),Te.push({instruction:pi,player:Kr,element:ys}),pi.queriedElements.forEach(As=>qr(je,As,[]).push(Kr)),pi.preStyleProps.forEach((As,wo)=>{const Ua=Object.keys(As);if(Ua.length){let nc=vt.get(wo);nc||vt.set(wo,nc=new Set),Ua.forEach(gu=>nc.add(gu))}}),pi.postStyleProps.forEach((As,wo)=>{const Ua=Object.keys(As);let nc=Ft.get(wo);nc||Ft.set(wo,nc=new Set),Ua.forEach(gu=>nc.add(gu))})}});if(ia.length){const Ln=[];ia.forEach(Kn=>{Ln.push(`@${Kn.triggerName} has failed due to:\n`),Kn.errors.forEach(br=>Ln.push(`- ${br}\n`))}),ec.forEach(Kn=>Kn.destroy()),this.reportError(Ln)}const eo=new Map,Pl=new Map;Te.forEach(Ln=>{const Kn=Ln.element;I.has(Kn)&&(Pl.set(Kn,Kn),this._beforeAnimationBuild(Ln.player.namespaceId,Ln.instruction,eo))}),X.forEach(Ln=>{const Kn=Ln.element;this._getPreviousPlayers(Kn,!1,Ln.namespaceId,Ln.triggerName,null).forEach(Kr=>{qr(eo,Kn,[]).push(Kr),Kr.destroy()})});const sa=Cr.filter(Ln=>ta(Ln,vt,Ft)),Vo=new Map;Jo(Vo,this.driver,vi,Ft,xr).forEach(Ln=>{ta(Ln,vt,Ft)&&sa.push(Ln)});const zc=new Map;Ir.forEach((Ln,Kn)=>{Jo(zc,this.driver,new Set(Ln),vt,"!")}),sa.forEach(Ln=>{const Kn=Vo.get(Ln),br=zc.get(Ln);Vo.set(Ln,Object.assign(Object.assign({},Kn),br))});const tc=[],Bc=[],kl={};Te.forEach(Ln=>{const{element:Kn,player:br,instruction:Kr}=Ln;if(I.has(Kn)){if(un.has(Kn))return br.onDestroy(()=>jt(Kn,Kr.toStyles)),br.disabled=!0,br.overrideTotalTime(Kr.totalTime),void X.push(br);let ys=kl;if(Pl.size>1){let ss=Kn;const oa=[];for(;ss=ss.parentNode;){const pi=Pl.get(ss);if(pi){ys=pi;break}oa.push(ss)}oa.forEach(pi=>Pl.set(pi,ys))}const Uo=this._buildAnimation(br.namespaceId,Kr,eo,fe,zc,Vo);if(br.setRealPlayer(Uo),ys===kl)tc.push(br);else{const ss=this.playersByElement.get(ys);ss&&ss.length&&(br.parentPlayer=Hr(ss)),X.push(br)}}else q(Kn,Kr.fromStyles),br.onDestroy(()=>jt(Kn,Kr.toStyles)),Bc.push(br),un.has(Kn)&&X.push(br)}),Bc.forEach(Ln=>{const Kn=fe.get(Ln.element);if(Kn&&Kn.length){const br=Hr(Kn);Ln.setRealPlayer(br)}}),X.forEach(Ln=>{Ln.parentPlayer?Ln.syncPlayerEvents(Ln.parentPlayer):Ln.destroy()});for(let Ln=0;Ln<Cr.length;Ln++){const Kn=Cr[Ln],br=Kn[$i];if(ea(Kn,Cs),br&&br.hasAnimation)continue;let Kr=[];if(je.size){let Uo=je.get(Kn);Uo&&Uo.length&&Kr.push(...Uo);let ss=this.driver.query(Kn,Ys,!0);for(let oa=0;oa<ss.length;oa++){let pi=je.get(ss[oa]);pi&&pi.length&&Kr.push(...pi)}}const ys=Kr.filter(Uo=>!Uo.destroyed);ys.length?va(this,Kn,ys):this.processLeaveNode(Kn)}return Cr.length=0,tc.forEach(Ln=>{this.players.push(Ln),Ln.onDone(()=>{Ln.destroy();const Kn=this.players.indexOf(Ln);this.players.splice(Kn,1)}),Ln.play()}),tc}elementContainsData(y,v){let I=!1;const X=v[$i];return X&&X.setForRemoval&&(I=!0),this.playersByElement.has(v)&&(I=!0),this.playersByQueriedElement.has(v)&&(I=!0),this.statesByElement.has(v)&&(I=!0),this._fetchNamespace(y).elementContainsData(v)||I}afterFlush(y){this._flushFns.push(y)}afterFlushAnimationsDone(y){this._whenQuietFns.push(y)}_getPreviousPlayers(y,v,I,X,fe){let Te=[];if(v){const je=this.playersByQueriedElement.get(y);je&&(Te=je)}else{const je=this.playersByElement.get(y);if(je){const vt=!fe||fe==xo;je.forEach(Ft=>{Ft.queued||!vt&&Ft.triggerName!=X||Te.push(Ft)})}}return(I||X)&&(Te=Te.filter(je=>!(I&&I!=je.namespaceId||X&&X!=je.triggerName))),Te}_beforeAnimationBuild(y,v,I){const fe=v.element,Te=v.isRemovalTransition?void 0:y,je=v.isRemovalTransition?void 0:v.triggerName;for(const vt of v.timelines){const Ft=vt.element,un=Ft!==fe,Fn=qr(I,Ft,[]);this._getPreviousPlayers(Ft,un,Te,je,v.toState).forEach(Ir=>{const rr=Ir.getRealPlayer();rr.beforeDestroy&&rr.beforeDestroy(),Ir.destroy(),Fn.push(Ir)})}q(fe,v.fromStyles)}_buildAnimation(y,v,I,X,fe,Te){const je=v.triggerName,vt=v.element,Ft=[],un=new Set,Fn=new Set,or=v.timelines.map(rr=>{const cr=rr.element;un.add(cr);const Cr=cr[$i];if(Cr&&Cr.removedBeforeQueried)return new Oi(rr.duration,rr.delay);const Pi=cr!==vt,vi=function(L){const y=[];return Xl(L,y),y}((I.get(cr)||ms).map(eo=>eo.getRealPlayer())).filter(eo=>!!eo.element&&eo.element===cr),fo=fe.get(cr),Ls=Te.get(cr),ec=Fi(0,this._normalizer,0,rr.keyframes,fo,Ls),ia=this._buildPlayer(rr,ec,vi);if(rr.subTimeline&&X&&Fn.add(cr),Pi){const eo=new Kl(y,je,cr);eo.setRealPlayer(ia),Ft.push(eo)}return ia});Ft.forEach(rr=>{qr(this.playersByQueriedElement,rr.element,[]).push(rr),rr.onDone(()=>function(L,y,v){let I;if(L instanceof Map){if(I=L.get(y),I){if(I.length){const X=I.indexOf(v);I.splice(X,1)}0==I.length&&L.delete(y)}}else if(I=L[y],I){if(I.length){const X=I.indexOf(v);I.splice(X,1)}0==I.length&&delete L[y]}return I}(this.playersByQueriedElement,rr.element,rr))}),un.forEach(rr=>Fs(rr,oo));const Ir=Hr(or);return Ir.onDestroy(()=>{un.forEach(rr=>ea(rr,oo)),jt(vt,v.toStyles)}),Fn.forEach(rr=>{qr(X,rr,[]).push(Ir)}),Ir}_buildPlayer(y,v,I){return v.length>0?this.driver.animate(y.element,v,y.duration,y.delay,y.easing,I):new Oi(y.duration,y.delay)}}class Kl{constructor(y,v,I){this.namespaceId=y,this.triggerName=v,this.element=I,this._player=new Oi,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(y){this._containsRealPlayer||(this._player=y,Object.keys(this._queuedCallbacks).forEach(v=>{this._queuedCallbacks[v].forEach(I=>Ki(y,v,void 0,I))}),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(y.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(y){this.totalTime=y}syncPlayerEvents(y){const v=this._player;v.triggerCallback&&y.onStart(()=>v.triggerCallback("start")),y.onDone(()=>this.finish()),y.onDestroy(()=>this.destroy())}_queueEvent(y,v){qr(this._queuedCallbacks,y,[]).push(v)}onDone(y){this.queued&&this._queueEvent("done",y),this._player.onDone(y)}onStart(y){this.queued&&this._queueEvent("start",y),this._player.onStart(y)}onDestroy(y){this.queued&&this._queueEvent("destroy",y),this._player.onDestroy(y)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(y){this.queued||this._player.setPosition(y)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(y){const v=this._player;v.triggerCallback&&v.triggerCallback(y)}}function ho(L){return L&&1===L.nodeType}function Qo(L,y){const v=L.style.display;return L.style.display=null!=y?y:"none",v}function Jo(L,y,v,I,X){const fe=[];v.forEach(vt=>fe.push(Qo(vt)));const Te=[];I.forEach((vt,Ft)=>{const un={};vt.forEach(Fn=>{const or=un[Fn]=y.computeStyle(Ft,Fn,X);(!or||0==or.length)&&(Ft[$i]=Fa,Te.push(Ft))}),L.set(Ft,un)});let je=0;return v.forEach(vt=>Qo(vt,fe[je++])),Te}function No(L,y){const v=new Map;if(L.forEach(je=>v.set(je,[])),0==y.length)return v;const X=new Set(y),fe=new Map;function Te(je){if(!je)return 1;let vt=fe.get(je);if(vt)return vt;const Ft=je.parentNode;return vt=v.has(Ft)?Ft:X.has(Ft)?1:Te(Ft),fe.set(je,vt),vt}return y.forEach(je=>{const vt=Te(je);1!==vt&&v.get(vt).push(je)}),v}const zo="$$classes";function Fs(L,y){if(L.classList)L.classList.add(y);else{let v=L[zo];v||(v=L[zo]={}),v[y]=!0}}function ea(L,y){if(L.classList)L.classList.remove(y);else{let v=L[zo];v&&delete v[y]}}function va(L,y,v){Hr(v).onDone(()=>L.processLeaveNode(y))}function Xl(L,y){for(let v=0;v<L.length;v++){const I=L[v];I instanceof Yi?Xl(I.players,y):y.push(I)}}function ta(L,y,v){const I=v.get(L);if(!I)return!1;let X=y.get(L);return X?I.forEach(fe=>X.add(fe)):y.set(L,I),v.delete(L),!0}class yn{constructor(y,v,I){this.bodyNode=y,this._driver=v,this._normalizer=I,this._triggerCache={},this.onRemovalComplete=(X,fe)=>{},this._transitionEngine=new Yl(y,v,I),this._timelineEngine=new bi(y,v,I),this._transitionEngine.onRemovalComplete=(X,fe)=>this.onRemovalComplete(X,fe)}registerTrigger(y,v,I,X,fe){const Te=y+"-"+X;let je=this._triggerCache[Te];if(!je){const vt=[],Ft=Gl(this._driver,fe,vt);if(vt.length)throw new Error(`The animation trigger "${X}" has failed to build due to the following errors:\n - ${vt.join("\n - ")}`);je=function(L,y,v){return new ka(L,y,v)}(X,Ft,this._normalizer),this._triggerCache[Te]=je}this._transitionEngine.registerTrigger(v,X,je)}register(y,v){this._transitionEngine.register(y,v)}destroy(y,v){this._transitionEngine.destroy(y,v)}onInsert(y,v,I,X){this._transitionEngine.insertNode(y,v,I,X)}onRemove(y,v,I,X){this._transitionEngine.removeNode(y,v,X||!1,I)}disableAnimations(y,v){this._transitionEngine.markElementAsDisabled(y,v)}process(y,v,I,X){if("@"==I.charAt(0)){const[fe,Te]=ts(I);this._timelineEngine.command(fe,v,Te,X)}else this._transitionEngine.trigger(y,v,I,X)}listen(y,v,I,X,fe){if("@"==I.charAt(0)){const[Te,je]=ts(I);return this._timelineEngine.listen(Te,v,je,fe)}return this._transitionEngine.listen(y,v,I,X,fe)}flush(y=-1){this._transitionEngine.flush(y)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}function Sl(L,y){let v=null,I=null;return Array.isArray(y)&&y.length?(v=Bs(y[0]),y.length>1&&(I=Bs(y[y.length-1]))):y&&(v=Bs(y)),v||I?new Fc(L,v,I):null}let Fc=(()=>{class L{constructor(v,I,X){this._element=v,this._startStyles=I,this._endStyles=X,this._state=0;let fe=L.initialStylesByElement.get(v);fe||L.initialStylesByElement.set(v,fe={}),this._initialStyles=fe}start(){this._state<1&&(this._startStyles&&jt(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(jt(this._element,this._initialStyles),this._endStyles&&(jt(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(L.initialStylesByElement.delete(this._element),this._startStyles&&(q(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(q(this._element,this._endStyles),this._endStyles=null),jt(this._element,this._initialStyles),this._state=3)}}return L.initialStylesByElement=new WeakMap,L})();function Bs(L){let y=null;const v=Object.keys(L);for(let I=0;I<v.length;I++){const X=v[I];sl(X)&&(y=y||{},y[X]=L[X])}return y}function sl(L){return"display"===L||"position"===L}const Na="animation",Dl="animationend";class xa{constructor(y,v,I,X,fe,Te,je){this._element=y,this._name=v,this._duration=I,this._delay=X,this._easing=fe,this._fillMode=Te,this._onDoneFn=je,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=vt=>this._handleCallback(vt)}apply(){(function(L,y){const v=Il(L,"").trim();let I=0;v.length&&(function(L,y){let v=0;for(let I=0;I<L.length;I++)","===L.charAt(I)&&v++;return v}(v)+1,y=`${v}, ${y}`),ba(L,"",y)})(this._element,`${this._duration}ms ${this._easing} ${this._delay}ms 1 normal ${this._fillMode} ${this._name}`),Ml(this._element,this._eventFn,!1),this._startTime=Date.now()}pause(){ol(this._element,this._name,"paused")}resume(){ol(this._element,this._name,"running")}setPosition(y){const v=Al(this._element,this._name);this._position=y*this._duration,ba(this._element,"Delay",`-${this._position}ms`,v)}getPosition(){return this._position}_handleCallback(y){const v=y._ngTestManualTimestamp||Date.now(),I=1e3*parseFloat(y.elapsedTime.toFixed(3));y.animationName==this._name&&Math.max(v-this._startTime,0)>=this._delay&&I>=this._duration&&this.finish()}finish(){this._finished||(this._finished=!0,this._onDoneFn(),Ml(this._element,this._eventFn,!0))}destroy(){this._destroyed||(this._destroyed=!0,this.finish(),function(L,y){const I=Il(L,"").split(","),X=za(I,y);X>=0&&(I.splice(X,1),ba(L,"",I.join(",")))}(this._element,this._name))}}function ol(L,y,v){ba(L,"PlayState",v,Al(L,y))}function Al(L,y){const v=Il(L,"");return v.indexOf(",")>0?za(v.split(","),y):za([v],y)}function za(L,y){for(let v=0;v<L.length;v++)if(L[v].indexOf(y)>=0)return v;return-1}function Ml(L,y,v){v?L.removeEventListener(Dl,y):L.addEventListener(Dl,y)}function ba(L,y,v,I){const X=Na+y;if(null!=I){const fe=L.style[X];if(fe.length){const Te=fe.split(",");Te[I]=v,v=Te.join(",")}}L.style[X]=v}function Il(L,y){return L.style[Na+y]||""}class bc{constructor(y,v,I,X,fe,Te,je,vt){this.element=y,this.keyframes=v,this.animationName=I,this._duration=X,this._delay=fe,this._finalStyles=je,this._specialStyles=vt,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this.currentSnapshot={},this._state=0,this.easing=Te||"linear",this.totalTime=X+fe,this._buildStyler()}onStart(y){this._onStartFns.push(y)}onDone(y){this._onDoneFns.push(y)}onDestroy(y){this._onDestroyFns.push(y)}destroy(){this.init(),!(this._state>=4)&&(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(y=>y()),this._onDestroyFns=[])}_flushDoneFns(){this._onDoneFns.forEach(y=>y()),this._onDoneFns=[]}_flushStartFns(){this._onStartFns.forEach(y=>y()),this._onStartFns=[]}finish(){this.init(),!(this._state>=3)&&(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}setPosition(y){this._styler.setPosition(y)}getPosition(){return this._styler.getPosition()}hasStarted(){return this._state>=2}init(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}play(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}pause(){this.init(),this._styler.pause()}restart(){this.reset(),this.play()}reset(){this._state=0,this._styler.destroy(),this._buildStyler(),this._styler.apply()}_buildStyler(){this._styler=new xa(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",()=>this.finish())}triggerCallback(y){const v="start"==y?this._onStartFns:this._onDoneFns;v.forEach(I=>I()),v.length=0}beforeDestroy(){this.init();const y={};if(this.hasStarted()){const v=this._state>=3;Object.keys(this._finalStyles).forEach(I=>{"offset"!=I&&(y[I]=v?this._finalStyles[I]:Mi(this.element,I))})}this.currentSnapshot=y}}class B extends Oi{constructor(y,v){super(),this.element=y,this._startingStyles={},this.__initialized=!1,this._styles=Mo(v)}init(){this.__initialized||!this._startingStyles||(this.__initialized=!0,Object.keys(this._styles).forEach(y=>{this._startingStyles[y]=this.element.style[y]}),super.init())}play(){!this._startingStyles||(this.init(),Object.keys(this._styles).forEach(y=>this.element.style.setProperty(y,this._styles[y])),super.play())}destroy(){!this._startingStyles||(Object.keys(this._startingStyles).forEach(y=>{const v=this._startingStyles[y];v?this.element.style.setProperty(y,v):this.element.style.removeProperty(y)}),this._startingStyles=null,super.destroy())}}class G{constructor(){this._count=0}validateStyleProperty(y){return io(y)}matchesElement(y,v){return go(y,v)}containsElement(y,v){return Xi(y,v)}query(y,v,I){return Yo(y,v,I)}computeStyle(y,v,I){return window.getComputedStyle(y)[v]}buildKeyframeElement(y,v,I){I=I.map(je=>Mo(je));let X=`@keyframes ${v} {\n`,fe="";I.forEach(je=>{fe=" ";const vt=parseFloat(je.offset);X+=`${fe}${100*vt}% {\n`,fe+=" ",Object.keys(je).forEach(Ft=>{const un=je[Ft];switch(Ft){case"offset":return;case"easing":return void(un&&(X+=`${fe}animation-timing-function: ${un};\n`));default:return void(X+=`${fe}${Ft}: ${un};\n`)}}),X+=`${fe}}\n`}),X+="}\n";const Te=document.createElement("style");return Te.textContent=X,Te}animate(y,v,I,X,fe,Te=[],je){const vt=Te.filter(Cr=>Cr instanceof bc),Ft={};fs(I,X)&&vt.forEach(Cr=>{let Pi=Cr.currentSnapshot;Object.keys(Pi).forEach(vi=>Ft[vi]=Pi[vi])});const un=function(L){let y={};return L&&(Array.isArray(L)?L:[L]).forEach(I=>{Object.keys(I).forEach(X=>{"offset"==X||"easing"==X||(y[X]=I[X])})}),y}(v=ps(y,v,Ft));if(0==I)return new B(y,un);const Fn="gen_css_kf_"+this._count++,or=this.buildKeyframeElement(y,Fn,v);(function(L){var y;const v=null===(y=L.getRootNode)||void 0===y?void 0:y.call(L);return"undefined"!=typeof ShadowRoot&&v instanceof ShadowRoot?v:document.head})(y).appendChild(or);const rr=Sl(y,v),cr=new bc(y,v,Fn,I,X,fe,un,rr);return cr.onDestroy(()=>{var L;(L=or).parentNode.removeChild(L)}),cr}}class En{constructor(y,v,I,X){this.element=y,this.keyframes=v,this.options=I,this._specialStyles=X,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=I.duration,this._delay=I.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(y=>y()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const y=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,y,this.options),this._finalKeyframe=y.length?y[y.length-1]:{},this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_triggerWebAnimation(y,v,I){return y.animate(v,I)}onStart(y){this._onStartFns.push(y)}onDone(y){this._onDoneFns.push(y)}onDestroy(y){this._onDestroyFns.push(y)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(y=>y()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(y=>y()),this._onDestroyFns=[])}setPosition(y){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=y*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const y={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach(v=>{"offset"!=v&&(y[v]=this._finished?this._finalKeyframe[v]:Mi(this.element,v))}),this.currentSnapshot=y}triggerCallback(y){const v="start"==y?this._onStartFns:this._onDoneFns;v.forEach(I=>I()),v.length=0}}class dr{constructor(){this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(fi().toString()),this._cssKeyframesDriver=new G}validateStyleProperty(y){return io(y)}matchesElement(y,v){return go(y,v)}containsElement(y,v){return Xi(y,v)}query(y,v,I){return Yo(y,v,I)}computeStyle(y,v,I){return window.getComputedStyle(y)[v]}overrideWebAnimationsSupport(y){this._isNativeImpl=y}animate(y,v,I,X,fe,Te=[],je){if(!je&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(y,v,I,X,fe,Te);const un={duration:I,delay:X,fill:0==X?"both":"forwards"};fe&&(un.easing=fe);const Fn={},or=Te.filter(rr=>rr instanceof En);fs(I,X)&&or.forEach(rr=>{let cr=rr.currentSnapshot;Object.keys(cr).forEach(Cr=>Fn[Cr]=cr[Cr])});const Ir=Sl(y,v=ps(y,v=v.map(rr=>_e(rr,!1)),Fn));return new En(y,v,un,Ir)}}function fi(){return Ar()&&Element.prototype.animate||{}}let kr=(()=>{class L extends Br{constructor(v,I){super(),this._nextAnimationId=0,this._renderer=v.createRenderer(I.body,{id:"0",encapsulation:A.ifc.None,styles:[],data:{animation:[]}})}build(v){const I=this._nextAnimationId.toString();this._nextAnimationId++;const X=Array.isArray(v)?ws(v):v;return Lr(this._renderer,null,I,"register",[X]),new Xs(I,this._renderer)}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(A.FYo),A.LFG(D.K0))},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();class Xs extends class{}{constructor(y,v){super(),this._id=y,this._renderer=v}create(y,v){return new Bo(this._id,y,v||{},this._renderer)}}class Bo{constructor(y,v,I,X){this.id=y,this.element=v,this._renderer=X,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",I)}_listen(y,v){return this._renderer.listen(this.element,`@@${this.id}:${y}`,v)}_command(y,...v){return Lr(this._renderer,this.element,this.id,y,v)}onDone(y){this._listen("done",y)}onStart(y){this._listen("start",y)}onDestroy(y){this._listen("destroy",y)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(y){this._command("setPosition",y)}getPosition(){var y,v;return null!==(v=null===(y=this._renderer.engine.players[+this.id])||void 0===y?void 0:y.getPosition())&&void 0!==v?v:0}}function Lr(L,y,v,I,X){return L.setProperty(y,`@@${v}:${I}`,X)}const f="@.disabled";let r=(()=>{class L{constructor(v,I,X){this.delegate=v,this.engine=I,this._zone=X,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),I.onRemovalComplete=(fe,Te)=>{Te&&Te.parentNode(fe)&&Te.removeChild(fe.parentNode,fe)}}createRenderer(v,I){const fe=this.delegate.createRenderer(v,I);if(!(v&&I&&I.data&&I.data.animation)){let un=this._rendererCache.get(fe);return un||(un=new c("",fe,this.engine),this._rendererCache.set(fe,un)),un}const Te=I.id,je=I.id+"-"+this._currentId;this._currentId++,this.engine.register(je,v);const vt=un=>{Array.isArray(un)?un.forEach(vt):this.engine.registerTrigger(Te,je,v,un.name,un)};return I.data.animation.forEach(vt),new p(this,je,fe,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(v,I,X){v>=0&&v<this._microtaskId?this._zone.run(()=>I(X)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(fe=>{const[Te,je]=fe;Te(je)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([I,X]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(A.FYo),A.LFG(yn),A.LFG(A.R0b))},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();class c{constructor(y,v,I){this.namespaceId=y,this.delegate=v,this.engine=I,this.destroyNode=this.delegate.destroyNode?X=>v.destroyNode(X):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}createElement(y,v){return this.delegate.createElement(y,v)}createComment(y){return this.delegate.createComment(y)}createText(y){return this.delegate.createText(y)}appendChild(y,v){this.delegate.appendChild(y,v),this.engine.onInsert(this.namespaceId,v,y,!1)}insertBefore(y,v,I,X=!0){this.delegate.insertBefore(y,v,I),this.engine.onInsert(this.namespaceId,v,y,X)}removeChild(y,v,I){this.engine.onRemove(this.namespaceId,v,this.delegate,I)}selectRootElement(y,v){return this.delegate.selectRootElement(y,v)}parentNode(y){return this.delegate.parentNode(y)}nextSibling(y){return this.delegate.nextSibling(y)}setAttribute(y,v,I,X){this.delegate.setAttribute(y,v,I,X)}removeAttribute(y,v,I){this.delegate.removeAttribute(y,v,I)}addClass(y,v){this.delegate.addClass(y,v)}removeClass(y,v){this.delegate.removeClass(y,v)}setStyle(y,v,I,X){this.delegate.setStyle(y,v,I,X)}removeStyle(y,v,I){this.delegate.removeStyle(y,v,I)}setProperty(y,v,I){"@"==v.charAt(0)&&v==f?this.disableAnimations(y,!!I):this.delegate.setProperty(y,v,I)}setValue(y,v){this.delegate.setValue(y,v)}listen(y,v,I){return this.delegate.listen(y,v,I)}disableAnimations(y,v){this.engine.disableAnimations(y,v)}}class p extends c{constructor(y,v,I,X){super(v,I,X),this.factory=y,this.namespaceId=v}setProperty(y,v,I){"@"==v.charAt(0)?"."==v.charAt(1)&&v==f?this.disableAnimations(y,I=void 0===I||!!I):this.engine.process(this.namespaceId,y,v.substr(1),I):this.delegate.setProperty(y,v,I)}listen(y,v,I){if("@"==v.charAt(0)){const X=function(L){switch(L){case"body":return document.body;case"document":return document;case"window":return window;default:return L}}(y);let fe=v.substr(1),Te="";return"@"!=fe.charAt(0)&&([fe,Te]=function(L){const y=L.indexOf(".");return[L.substring(0,y),L.substr(y+1)]}(fe)),this.engine.listen(this.namespaceId,X,fe,Te,je=>{this.factory.scheduleListenerCallback(je._data||-1,I,je)})}return this.delegate.listen(y,v,I)}}let M=(()=>{class L extends yn{constructor(v,I,X){super(v.body,I,X)}ngOnDestroy(){this.flush()}}return L.\u0275fac=function(v){return new(v||L)(A.LFG(D.K0),A.LFG(Di),A.LFG(uo))},L.\u0275prov=A.Yz7({token:L,factory:L.\u0275fac}),L})();const re=new A.OlP("AnimationModuleType"),oe=[{provide:Br,useClass:kr},{provide:uo,useFactory:function(){return new xl}},{provide:yn,useClass:M},{provide:A.FYo,useFactory:function(L,y,v){return new r(L,y,v)},deps:[Vn,yn,A.R0b]}],le=[{provide:Di,useFactory:function(){return"function"==typeof fi()?new dr:new G}},{provide:re,useValue:"BrowserAnimations"},...oe],pe=[{provide:Di,useClass:Ws},{provide:re,useValue:"NoopAnimations"},...oe];let Ae=(()=>{class L{static withConfig(v){return{ngModule:L,providers:v.disableAnimations?pe:le}}}return L.\u0275fac=function(v){return new(v||L)},L.\u0275mod=A.oAB({type:L}),L.\u0275inj=A.cJS({providers:le,imports:[Pe]}),L})();const qe=[];let be=(()=>{class L{}return L.\u0275fac=function(v){return new(v||L)},L.\u0275mod=A.oAB({type:L}),L.\u0275inj=A.cJS({imports:[[On.Bz.forChild(qe)],On.Bz]}),L})();var Re=te(7495);let $e=(()=>{class L{}return L.\u0275fac=function(v){return new(v||L)},L.\u0275mod=A.oAB({type:L}),L.\u0275inj=A.cJS({imports:[[D.ez,be,Re.SearchModule]]}),L})();var We=te(3932),it=te(665),Fe=te(2533),pt=te(3667),Rt=te(2542),Ut=te(3071);const dt=["userSearch"];function At(L,y){1&L&&(A.TgZ(0,"div",10),A.TgZ(1,"p",11),A._uU(2,"No se han encontrado resultados"),A.qZA(),A.qZA())}function on(L,y){if(1&L&&(A.TgZ(0,"div",12),A._UZ(1,"div",13),A.TgZ(2,"div",14),A._UZ(3,"img",15),A.qZA(),A.TgZ(4,"div",16),A.TgZ(5,"p",17),A._uU(6),A.qZA(),A.qZA(),A.qZA()),2&L){const v=A.oxw().$implicit;A.xp6(3),A.uIk("src",v.userImage,A.LSH),A.xp6(3),A.Oqu(v.username)}}const Cn=function(L){return{"pointer-events":L}};function vn(L,y){if(1&L&&(A.TgZ(0,"a",7),A.YNc(1,At,3,0,"div",8),A.YNc(2,on,7,2,"div",9),A.qZA()),2&L){const v=y.$implicit,I=A.oxw();A.MGl("href","user/profile/",v._id,"",A.LSH),A.Q6J("ngStyle",A.VKq(4,Cn,I.usersFiltered.length>0&&"ninguno"==I.usersFiltered[0]?"none":"all")),A.xp6(1),A.Q6J("ngIf","ninguno"==v),A.xp6(1),A.Q6J("ngIf","ninguno"!=v)}}function rn(L,y){if(1&L&&(A.TgZ(0,"div",18),A._UZ(1,"hr",19),A.TgZ(2,"a",20),A._uU(3,"Mostrar m\xe1s resultados"),A.qZA(),A.qZA()),2&L){const v=A.oxw();A.xp6(2),A.MGl("href","/search/searchUsers/",v.inputTerm,"",A.LSH)}}const Dn=function(L){return{"border-bottom":L}};let Er=(()=>{class L{constructor(v){this.userService=v,this.inputTerm="",this.stringToSearch="",this.usersFiltered=[]}ngOnInit(){}usersFilteredListUpdate(){""!=this.inputTerm&&null!=this.inputTerm?this.stringToSearch=setTimeout(()=>{this.userService.getUserByTerm(this.inputTerm).subscribe(v=>{this.usersFiltered=[];for(let I=0;I<Math.min(v.UsersToReturn.length,4);I++)this.usersFiltered.push(v.UsersToReturn[I]);0==this.usersFiltered.length&&(this.usersFiltered=["ninguno"])})},500):this.usersFiltered=[]}myStopFilter(){clearTimeout(this.stringToSearch)}onKeyUp(v){this.inputTerm=v,this.myStopFilter(),this.usersFilteredListUpdate()}}return L.\u0275fac=function(v){return new(v||L)(A.Y36(Ut.K))},L.\u0275cmp=A.Xpm({type:L,selectors:[["app-user-search-bar"]],viewQuery:function(v,I){if(1&v&&A.Gf(dt,5),2&v){let X;A.iGM(X=A.CRH())&&(I.userSearch=X.first)}},decls:7,vars:5,consts:[[1,"dropdown","mt-2"],["id","search",1,"dropdown-item"],["list","datalistOptions","id","exampleDataList","type","text","placeholder","Buscar usuario...","autocomplete","off",1,"rff-channel-user-search",3,"keyup"],["userSearch",""],[1,"content",3,"ngStyle"],["class","dropdown-item",3,"ngStyle","href",4,"ngFor","ngForOf"],["id","more","class","col",4,"ngIf"],[1,"dropdown-item",3,"ngStyle","href"],["id","divNinguno",4,"ngIf"],["class","row rff-user-row",4,"ngIf"],["id","divNinguno"],[1,"noResult"],[1,"row","rff-user-row"],[1,"col-1","rff-first"],[1,"col-2"],["alt","",1,"d-block","w-100"],[1,"col-8"],[1,"rff-user-card-title"],["id","more",1,"col"],[1,"dropdown-divider"],[1,"btn","d-grid","gap-2","rff-more-results-button","mb-1",3,"href"]],template:function(v,I){if(1&v){const X=A.EpF();A.TgZ(0,"div",0),A.TgZ(1,"div",1),A.TgZ(2,"input",2,3),A.NdJ("keyup",function(){A.CHM(X);const Te=A.MAs(3);return I.onKeyUp(Te.value)}),A.qZA(),A.qZA(),A.TgZ(4,"div",4),A.YNc(5,vn,3,6,"a",5),A.YNc(6,rn,4,1,"div",6),A.qZA(),A.qZA()}2&v&&(A.xp6(4),A.Q6J("ngStyle",A.VKq(3,Dn,I.usersFiltered.length>0&&"ninguno"==I.usersFiltered[0]?"2px solid var(--main-event-color)":"0")),A.xp6(1),A.Q6J("ngForOf",I.usersFiltered),A.xp6(1),A.Q6J("ngIf",I.usersFiltered.length>0&&"ninguno"!=I.usersFiltered[0]))},directives:[D.PC,D.sg,D.O5],styles:[".rff-channel-user-search[_ngcontent-%COMP%]{font-family:var(--main-font);border-radius:1rem;padding:0 1rem;border-color:#81d3ab;width:100%;height:75%;background-color:var(--main-background);color:var(--main-font-color)}.row[_ngcontent-%COMP%]{align-items:center}.dropdown[_ngcontent-%COMP%]{width:20rem;position:absolute;z-index:99;height:7vh}.dropdown-menu.show[_ngcontent-%COMP%]{width:20rem;background:transparent;border:0;margin-top:0}.content[_ngcontent-%COMP%]{border-right:2px solid var(--main-event-color);border-left:2px solid var(--main-event-color);border-radius:2vh;background-color:var(--main-background)}#search[_ngcontent-%COMP%]{background:transparent;height:100%}#more[_ngcontent-%COMP%]{min-height:6vh;border-bottom:2px solid var(--main-event-color);border-radius:2vh}a.dropdown-item[_ngcontent-%COMP%]   .noResult[_ngcontent-%COMP%]{font-family:var(--main-font);color:var(--main-event-color);font-weight:bold;margin:0}img[_ngcontent-%COMP%]{border-radius:100%;width:3em!important;height:3em!important;object-fit:cover}#divNinguno[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:5vh}p[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis}a.dropdown-item[_ngcontent-%COMP%]:-webkit-any-link{background:transparent}.rff-search-button[_ngcontent-%COMP%]{border:none;font-size:1rem;font-family:var(--main-font);transition:.3s ease;border-radius:1rem;width:100%;font-weight:bold}.rff-more-results-button[_ngcontent-%COMP%]{background-color:var(--main-green-color);font-family:#f8f1ef;border-radius:1rem;font-weight:bold}.rff-more-results-button[_ngcontent-%COMP%]:hover{background-color:var(--secondary-green-color-search-user);color:var(--main-white-font-color);cursor:pointer}.rff-user-card-title[_ngcontent-%COMP%]{font-size:1rem;font-weight:bold;margin:0}.card-body[_ngcontent-%COMP%]{height:10vh}.rff-first[_ngcontent-%COMP%]{height:100%;background-color:var(--secondary-green-color-search-user)}.rff-user-row[_ngcontent-%COMP%]{margin-top:15px;display:flex;background-color:var(--main-green-back-search-user);height:10vh;border-top-right-radius:1rem}.rff-user-row[_ngcontent-%COMP%]:hover{cursor:pointer;background-color:var(--main-green-color-search-user)}.rowCard[_ngcontent-%COMP%]{width:100%;height:100%;margin:0}"]}),L})();function Qn(L,y){if(1&L&&(A.TgZ(0,"li",15),A._UZ(1,"span",32),A.TgZ(2,"a",33),A._uU(3,"Agenda"),A.qZA(),A.qZA()),2&L){const v=A.oxw();A.xp6(2),A.Q6J("ngClass","scheduler"==v.itemSelected?"nav-link selected":"nav-link")}}function zi(L,y){if(1&L&&(A.TgZ(0,"li",15),A._UZ(1,"span",34),A.TgZ(2,"a",35),A._uU(3,"Mensajes"),A.qZA(),A.qZA()),2&L){const v=A.oxw();A.xp6(2),A.Q6J("ngClass","chat"==v.itemSelected?"nav-link selected":"nav-link")}}function wi(L,y){if(1&L&&(A.TgZ(0,"li",15),A._UZ(1,"span",36),A.TgZ(2,"a",37),A._uU(3,"Mi Perfil"),A.qZA(),A.qZA()),2&L){const v=A.oxw();A.xp6(2),A.MGl("href","/user/profile/",v.rffUser._id,"",A.LSH),A.Q6J("ngClass","user"==v.itemSelected?"nav-link selected":"nav-link")}}function _r(L,y){if(1&L){const v=A.EpF();A.TgZ(0,"li",38),A.TgZ(1,"a",39),A.NdJ("click",function(){return A.CHM(v),A.oxw().logout()}),A._uU(2,"Cerrar Sesi\xf3n"),A.qZA(),A.qZA()}}function fr(L,y){if(1&L&&(A.TgZ(0,"li",38),A.TgZ(1,"a",40),A._uU(2,"Iniciar Sesi\xf3n"),A.qZA(),A.qZA()),2&L){const v=A.oxw();A.xp6(1),A.Q6J("ngClass","auth"==v.itemSelected?"nav-link selected":"nav-link")}}function yi(L,y){if(1&L){const v=A.EpF();A.TgZ(0,"div",41),A.TgZ(1,"a",42),A._UZ(2,"img",43),A.qZA(),A.TgZ(3,"ul",44),A.TgZ(4,"li",45),A._UZ(5,"span",46),A.TgZ(6,"a",47),A._uU(7,"Agenda"),A.qZA(),A.qZA(),A.TgZ(8,"li",45),A._UZ(9,"span",48),A.TgZ(10,"a",49),A._uU(11,"Mensajes"),A.qZA(),A.qZA(),A.TgZ(12,"li",45),A._UZ(13,"span",50),A.TgZ(14,"a",37),A._uU(15,"Mi Perfil"),A.qZA(),A.qZA(),A.TgZ(16,"li"),A._UZ(17,"hr",51),A.qZA(),A.TgZ(18,"li",45),A.TgZ(19,"a",52),A.NdJ("click",function(){return A.CHM(v),A.oxw().logout()}),A._uU(20,"Cerrar Sesi\xf3n"),A.qZA(),A.qZA(),A.qZA(),A.qZA()}if(2&L){const v=A.oxw();A.xp6(2),A.s9C("src",v.rffUser.userImage,A.LSH),A.xp6(4),A.Q6J("ngClass","scheduler"==v.itemSelected?"dropdown-item selected":"dropdown-item"),A.xp6(4),A.Q6J("ngClass","chat"==v.itemSelected?"dropdown-item selected":"dropdown-item"),A.xp6(4),A.MGl("href","/user/profile/",v.rffUser._id,"",A.LSH),A.Q6J("ngClass","user"==v.itemSelected?"dropdown-item selected":"dropdown-item")}}function Qs(L,y){if(1&L&&(A.TgZ(0,"div",28),A.TgZ(1,"ul",53),A.TgZ(2,"li",12),A.TgZ(3,"a",54),A._uU(4,"Iniciar Sesi\xf3n"),A.qZA(),A.qZA(),A.qZA(),A.qZA()),2&L){const v=A.oxw();A.xp6(3),A.Q6J("ngClass","auth"==v.itemSelected?"dropdown-item selected":"dropdown-item")}}let Ba=(()=>{class L{constructor(v,I,X,fe,Te){this.router=v,this.authService=I,this.userService=X,this.location=fe,this.route=Te,this.isLoged=!1,this.routeUrl="",this.isDark=!1,this.user={name:"",email:"",uid:""},this.rffUser={name:"",username:"",email:"",_id:"",userImage:""},this.uid=""}ngOnInit(){this.obtainUser(),this.loadTheme(),this.router.events.subscribe(v=>{v instanceof On.Av&&(this.routeUrl=v.urlAfterRedirects,this.changeColor(this.routeUrl,"observable"))})}ngAfterViewInit(){}changeColor(v,I){v.includes("/establishment")?(this.itemSelected="establishment",console.log(I+": "+this.itemSelected)):v.includes("/home")||"/"===v?(this.itemSelected="home",console.log(I+": "+this.itemSelected)):v.includes("/search")?(this.itemSelected="search",console.log(I+": "+this.itemSelected)):v.includes("/scheduler")?this.itemSelected="scheduler":v.includes("/events")?(this.itemSelected="events",console.log(I+": "+this.itemSelected)):v.includes("/channels")||v.includes("/posts")?(this.itemSelected="channels",console.log(I+": "+this.itemSelected)):v.includes("/chat")?(this.itemSelected="chat",console.log(I+": "+this.itemSelected)):v.includes("/auth")?(this.itemSelected="auth",console.log(I+": "+this.itemSelected)):v.includes("/user")&&v.includes(localStorage.getItem("uid"))&&(this.itemSelected="user",console.log(I+": "+this.itemSelected))}obtainUser(){this.authService.validateToken().subscribe(v=>{v?(this.rffUser._id=this.authService.user.uid,this.isLoged=!0,this.userService.getUserById(this.rffUser._id).subscribe(I=>{this.rffUser=I.dbUser})):this.isLoged=!1,console.log(this.rffUser)})}logout(){this.authService.logout(),this.router.navigateByUrl("/home")}changeTheme(){const v=document.querySelector("body");this.isDark="true"!==localStorage.getItem("rffDarkMode"),null==v||v.classList.toggle("dark-Mode"),this.storeTheme(v.classList.contains("dark-Mode"))}loadTheme(){const v=document.querySelector("body"),I=localStorage.getItem("rffDarkMode");I?"true"==I&&(null==v||v.classList.add("dark-Mode"),this.isDark=!0):(this.isDark=!1,this.storeTheme(!1))}storeTheme(v){localStorage.setItem("rffDarkMode",v.toString())}}return L.\u0275fac=function(v){return new(v||L)(A.Y36(On.F0),A.Y36(Rt.e),A.Y36(Ut.K),A.Y36(D.Ye),A.Y36(On.gz))},L.\u0275cmp=A.Xpm({type:L,selectors:[["app-header"]],decls:45,vars:14,consts:[["id","header",1,"header"],[1,"navbar","navbar-expand-lg","navbar-light","bg-lignt"],["href","home",1,"navbar-brand","ps-3"],[1,"logoLetter"],[1,"letter"],[1,"navbar-toggler","moonCollapse","ml-auto"],[1,"nav-item"],["id","moon2",1,"dark-mode-icon",3,"click"],[3,"ngClass"],["type","button","data-toggle","collapse","data-target","#navbarSupportedContent","aria-controls","navbarSupportedContent","aria-expanded","false","aria-label","Toggle navigation",1,"navbar-toggler","lines","collapsed"],["id","navbarSupportedContent",1,"collapse","navbar-collapse","contentDisplay"],[1,"navbar-nav","me-lg-auto","list"],[1,"nav-item","itemToggle"],["data-icon","bx:bx-home-heart",1,"iconify","whenCollapsed"],["id","home","href","/",3,"ngClass"],[1,"nav-item","itemToggle","whenCollapsed"],["data-icon","cil:search",1,"iconify","whenCollapsed"],["id","search","href","/search/searchUsers/",3,"ngClass"],["data-icon","ion:restaurant-outline",1,"iconify","whenCollapsed"],["id","establishment","href","/establishment",3,"ngClass"],["data-icon","fluent:text-bullet-list-square-edit-20-regular",1,"iconify","whenCollapsed"],["id","events","href","/events",3,"ngClass"],["data-icon","heroicons-outline:user-group",1,"iconify","whenCollapsed"],["id","channels","href","/channels",3,"ngClass"],["class","nav-item itemToggle whenCollapsed",4,"ngIf"],[1,"divisor","whenCollapsed"],["class","nav-item itemToggle toggleClose whenCollapsed",4,"ngIf"],[1,"nav-item","search","whenNoCollapsed"],[1,"nav-item","whenNoCollapsed"],["id","moon",1,"dark-mode-icon",3,"click"],["class","dropdown text-end ps-3 whenNoCollapsed",4,"ngIf"],["class","nav-item whenNoCollapsed",4,"ngIf"],["data-icon","bi:calendar-event",1,"iconify","whenCollapsed"],["id","scheduler","href","/events/scheduler",3,"ngClass"],["data-icon","akar-icons:chat-bubble",1,"iconify","whenCollapsed"],["id","message","href","/chat",3,"ngClass"],["data-icon","akar-icons:person",1,"iconify","whenCollapsed"],[3,"ngClass","href"],[1,"nav-item","itemToggle","toggleClose","whenCollapsed"],[1,"nav-link",3,"click"],["id","login","href","/auth",1,"nav-link",3,"ngClass"],[1,"dropdown","text-end","ps-3","whenNoCollapsed"],["href","#","id","dropdownUser1","data-bs-toggle","dropdown","aria-expanded","false",1,"d-block","link-dark","text-decoration-none","dropdown-toggle"],["alt","usuario","width","32","height","32",1,"rounded-circle",3,"src"],["id","drop","aria-labelledby","dropdownUser1",1,"dropdown-menu","dropdown-menu-end","text-small","navbar-var"],[1,"liDrop"],["data-icon","bi:calendar-event",1,"iconify","iconDrop"],["href","/events/scheduler",3,"ngClass"],["data-icon","akar-icons:chat-bubble",1,"iconify","iconDrop"],["href","/chat",3,"ngClass"],["data-icon","akar-icons:person",1,"iconify","iconDrop"],[1,"dropdown-divider"],[1,"dropdown-item",3,"click"],[1,"navbar-nav"],["id","logins","href","/auth",3,"ngClass"]],template:function(v,I){1&v&&(A.TgZ(0,"header",0),A.TgZ(1,"nav",1),A.TgZ(2,"a",2),A._UZ(3,"img",3),A._UZ(4,"img",4),A.qZA(),A.TgZ(5,"div",5),A.TgZ(6,"div",6),A.TgZ(7,"a",7),A.NdJ("click",function(){return I.changeTheme()}),A._UZ(8,"i",8),A.qZA(),A.qZA(),A.qZA(),A._UZ(9,"button",9),A.TgZ(10,"div",10),A.TgZ(11,"ul",11),A.TgZ(12,"li",12),A._UZ(13,"span",13),A.TgZ(14,"a",14),A._uU(15,"Inicio"),A.qZA(),A.qZA(),A.TgZ(16,"li",15),A._UZ(17,"span",16),A.TgZ(18,"a",17),A._uU(19,"Buscar Usuario"),A.qZA(),A.qZA(),A.TgZ(20,"li",12),A._UZ(21,"span",18),A.TgZ(22,"a",19),A._uU(23,"Establecimientos"),A.qZA(),A.qZA(),A.TgZ(24,"li",12),A._UZ(25,"span",20),A.TgZ(26,"a",21),A._uU(27,"Eventos"),A.qZA(),A.qZA(),A.TgZ(28,"li",12),A._UZ(29,"span",22),A.TgZ(30,"a",23),A._uU(31,"Canales"),A.qZA(),A.qZA(),A.YNc(32,Qn,4,1,"li",24),A.YNc(33,zi,4,1,"li",24),A.YNc(34,wi,4,2,"li",24),A._UZ(35,"hr",25),A.YNc(36,_r,3,0,"li",26),A.YNc(37,fr,3,1,"li",26),A.TgZ(38,"li",27),A._UZ(39,"app-user-search-bar"),A.qZA(),A.TgZ(40,"li",28),A.TgZ(41,"a",29),A.NdJ("click",function(){return I.changeTheme()}),A._UZ(42,"i",8),A.qZA(),A.qZA(),A.qZA(),A.YNc(43,yi,21,5,"div",30),A.YNc(44,Qs,5,1,"div",31),A.qZA(),A.qZA(),A.qZA()),2&v&&(A.xp6(8),A.Q6J("ngClass",I.isDark?"bi bi-moon-fill":"bi bi-moon"),A.xp6(6),A.Q6J("ngClass","home"==I.itemSelected?"nav-link selected":"nav-link"),A.xp6(4),A.Q6J("ngClass","search"==I.itemSelected?"nav-link selected":"nav-link"),A.xp6(4),A.Q6J("ngClass","establishment"==I.itemSelected?"nav-link selected":"nav-link"),A.xp6(4),A.Q6J("ngClass","events"==I.itemSelected?"nav-link selected":"nav-link"),A.xp6(4),A.Q6J("ngClass","channels"==I.itemSelected?"nav-link selected":"nav-link"),A.xp6(2),A.Q6J("ngIf",I.isLoged),A.xp6(1),A.Q6J("ngIf",I.isLoged),A.xp6(1),A.Q6J("ngIf",I.isLoged),A.xp6(2),A.Q6J("ngIf",I.isLoged),A.xp6(1),A.Q6J("ngIf",!I.isLoged),A.xp6(5),A.Q6J("ngClass",I.isDark?"bi bi-moon-fill":"bi bi-moon"),A.xp6(1),A.Q6J("ngIf",I.isLoged),A.xp6(1),A.Q6J("ngIf",!I.isLoged))},directives:[D.mk,D.O5,Er],styles:[".navbar[_ngcontent-%COMP%]{position:absolute;top:0;height:9vh;width:100vw;background-color:var(--main-header-color);box-shadow:2px 2px 5px #0003;z-index:3;font-family:var(--main-font);font-weight:bold}.logoLetter[_ngcontent-%COMP%], .letter[_ngcontent-%COMP%]{height:5vh}.logoLetter[_ngcontent-%COMP%]{content:var(--url-logoLetter-header)}.letter[_ngcontent-%COMP%]{content:var(--url-letter-header)}.divisor[_ngcontent-%COMP%]{height:.5vh;width:100%}@media (max-width: 576px){.divisor[_ngcontent-%COMP%]{margin:20px!important}.itemToggle[_ngcontent-%COMP%]{margin-top:20px!important}.contentDisplay[_ngcontent-%COMP%]{width:80vw!important;font-size:5vw!important}.iconify[_ngcontent-%COMP%]{font-size:6vw!important;height:100%!important;margin-right:15px!important}}@media (max-width: 992px){.divisor[_ngcontent-%COMP%]{margin:35px}.itemToggle[_ngcontent-%COMP%]{margin-top:35px}.navbar-nav[_ngcontent-%COMP%]{margin:0 auto;width:-moz-fit-content;width:fit-content}li[_ngcontent-%COMP%]{display:flex;width:100%}.logoLetter[_ngcontent-%COMP%]{display:none}.whenCollapsed[_ngcontent-%COMP%]{display:flex!important}.whenNoCollapsed[_ngcontent-%COMP%]{display:none!important}.list[_ngcontent-%COMP%]{min-height:89vh!important;height:auto!important}.contentDisplay[_ngcontent-%COMP%]{box-shadow:2px 2px 5px #0003;opacity:95%;position:absolute;top:9vh;right:0px;z-index:2;background-color:var(--main-header-color);width:45vw;font-size:3vw}}@media (min-width: 992px){.letter[_ngcontent-%COMP%]{display:none}}.nav-item.itemToggle[_ngcontent-%COMP%]{align-items:center}.navbar-toggler.lines.collapsed[_ngcontent-%COMP%]{background:url(https://api.iconify.design/akar-icons/three-line-horizontal.svg?color=black) no-repeat center center / contain;content:url(https://api.iconify.design/akar-icons/three-line-horizontal.svg?color=black);width:3rem;height:100%;border:0}.navbar-toggler.lines[_ngcontent-%COMP%]{background:url(https://api.iconify.design/akar-icons/three-line-horizontal.svg?color=%2360ac91) no-repeat center center / contain;content:url(https://api.iconify.design/akar-icons/three-line-horizontal.svg?color=%2360ac91);width:3rem;height:100%;border:0}.navbar-toggler.lines[_ngcontent-%COMP%]:focus{outline:none;box-shadow:none}.liDrop[_ngcontent-%COMP%]{display:flex;margin-top:10px;height:5vh;align-items:center}.toggleClose[_ngcontent-%COMP%]{margin:0!important;justify-content:center!important}#drop[_ngcontent-%COMP%]{padding:10px 20px!important;box-shadow:2px 2px 5px #0003;background-color:var(--main-header-color);border:0}.dropdown-toggle[_ngcontent-%COMP%]:after{color:var(--main-font-color)}.iconify.whenCollapsed[_ngcontent-%COMP%]{font-size:3.5vw;height:100%;margin-right:15px;color:var(--main-font-color)}.iconDrop[_ngcontent-%COMP%]{font-size:3vw;height:100%;margin-right:10px;color:var(--main-font-color)}.dropdown-item.selected[_ngcontent-%COMP%]{color:#60ac91}.dropdown-item.selected[_ngcontent-%COMP%]:hover{color:#60ac91}.dropdown-item[_ngcontent-%COMP%]{font-family:var(--main-font);z-index:2;font-weight:bold;cursor:pointer;color:var(--main-header-not-selected);transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.dropdown-item[_ngcontent-%COMP%]:hover{color:var(--main-font-color);background-color:transparent}.navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link.selected[_ngcontent-%COMP%]{color:#60ac91}.navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link.selected[_ngcontent-%COMP%]:hover{color:#60ac91}.navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{color:var(--main-header-not-selected);transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.navbar-light[_ngcontent-%COMP%]   .navbar-nav[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]:hover{color:var(--main-font-color);background-color:transparent}.rounded-circle[_ngcontent-%COMP%]{border:3px solid var(--main-yellow-color)}.dark-mode-icon[_ngcontent-%COMP%]{font-size:1.7rem}.dark-mode-icon#moon2[_ngcontent-%COMP%]{font-size:2rem;margin-right:10px}.bi.bi-moon-fill[_ngcontent-%COMP%]{color:var(--main-green-color)}.bi.bi-moon[_ngcontent-%COMP%]{color:var(--main-header-not-selected);transition:color .15s ease-in-out,background-color .15s ease-in-out,border-color .15s ease-in-out}.bi.bi-moon[_ngcontent-%COMP%]:hover{color:var(--main-font-color);background-color:transparent}.whenCollapsed[_ngcontent-%COMP%]{display:none}.whenNoCollapsed[_ngcontent-%COMP%]{display:block}.moonCollapse[_ngcontent-%COMP%]{border:0;padding:0}.dark-mode-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.search[_ngcontent-%COMP%]{width:20rem;height:100%}.navbar-nav[_ngcontent-%COMP%]{height:7vh;align-items:center}"]}),L})(),is=(()=>{class L{constructor(){}ngOnInit(){}}return L.\u0275fac=function(v){return new(v||L)},L.\u0275cmp=A.Xpm({type:L,selectors:[["app-footer"]],decls:11,vars:0,consts:[["id","footer"],[1,"container"],[1,"row"],["id","name",1,"col-6","col-sm-5","col-md-4","col-md-4"],["id","contact",1,"col-6","col-sm-7","col-md-8","col-lg-8"],["id","mail",1,"bi","bi-envelope"]],template:function(v,I){1&v&&(A.TgZ(0,"footer",0),A.TgZ(1,"div",1),A.TgZ(2,"div",2),A.TgZ(3,"div",3),A.TgZ(4,"h1"),A._uU(5,"\xa9 2021 RealFoodieFriends"),A.qZA(),A.qZA(),A.TgZ(6,"div",4),A.TgZ(7,"h1"),A._uU(8,"contacto: \xa0\xa0"),A._UZ(9,"i",5),A._uU(10,"\xa0\xa0realfoodiefriendsupv@gmail.com"),A.qZA(),A.qZA(),A.qZA(),A.qZA(),A.qZA())},styles:["footer[_ngcontent-%COMP%]{height:9vh;overflow:hidden;width:100vw;bottom:0;color:var(--secondary-green-color);background-color:var(--main-background-green);position:relative}.row[_ngcontent-%COMP%]{align-items:center;height:100%}.container[_ngcontent-%COMP%]{height:9vh}h1[_ngcontent-%COMP%]{font-size:1rem;font-family:var(--main-font);margin:0}#name[_ngcontent-%COMP%]{text-align:left}#contact[_ngcontent-%COMP%]{text-align:right}@media (max-width: 576px){h1[_ngcontent-%COMP%]{font-size:10px}#mail[_ngcontent-%COMP%]{display:none}}"]}),L})(),Vs=(()=>{class L{constructor(){this.title="RealFoodieFriends",this.userExists=!1}ngOnInit(){}}return L.\u0275fac=function(v){return new(v||L)},L.\u0275cmp=A.Xpm({type:L,selectors:[["app-root"]],features:[A._Bn([pt.a])],decls:6,vars:0,consts:[["id","router"]],template:function(v,I){1&v&&(A.TgZ(0,"div"),A._UZ(1,"app-header"),A.qZA(),A.TgZ(2,"div",0),A._UZ(3,"router-outlet"),A.qZA(),A.TgZ(4,"div"),A._UZ(5,"app-footer"),A.qZA())},directives:[Ba,On.lC,is],styles:[""]}),L})();var Js=te(441);(0,D.qS)(te.n(Js)());let ai=(()=>{class L{}return L.\u0275fac=function(v){return new(v||L)},L.\u0275mod=A.oAB({type:L,bootstrap:[Vs]}),L.\u0275inj=A.cJS({providers:[{provide:A.soG,useValue:"es"}],imports:[[Pe,zs,Ae,mr.JF,$e,We.EstablishmentModule,$e,it.u5,Fe.JX]]}),L})();te(2340).N.production&&(0,A.G48)(),H().bootstrapModule(ai).catch(L=>console.error(L))},2369:Mt=>{"use strict";Mt.exports='/* Basics */\n.mapboxgl-ctrl-geocoder,\n.mapboxgl-ctrl-geocoder *,\n.mapboxgl-ctrl-geocoder *:after,\n.mapboxgl-ctrl-geocoder *:before {\n  box-sizing: border-box;\n}\n.mapboxgl-ctrl-geocoder {\n  font-size: 18px;\n  line-height: 24px;\n  font-family: "Open Sans", "Helvetica Neue", Arial, Helvetica, sans-serif;\n  position: relative;\n  background-color: #fff;\n  width: 100%;\n  min-width: 240px;\n  z-index: 1;\n  border-radius: 4px;\n  transition: width .25s, min-width .25s;\n}\n.mapboxgl-ctrl-geocoder--input {\n  font: inherit;\n  width: 100%;\n  border: 0;\n  background-color: transparent;\n  margin: 0;\n  height: 50px;\n  color: #404040; /* fallback */\n  color: rgba(0, 0, 0, 0.75);\n  padding: 6px 45px;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;\n}\n.mapboxgl-ctrl-geocoder--input::-ms-clear {\n  display: none; /* hide input clear button in IE */\n}\n.mapboxgl-ctrl-geocoder--input:focus {\n  color: #404040; /* fallback */\n  color: rgba(0, 0, 0, 0.75);\n  outline: 0;\n  box-shadow: none;\n  outline: thin dotted;\n}\n.mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--pin-right > * {\n  z-index: 2;\n  position: absolute;\n  right: 8px;\n  top: 7px;\n  display: none;\n}\n.mapboxgl-ctrl-geocoder,\n.mapboxgl-ctrl-geocoder .suggestions {\n  box-shadow: 0 0 10px 2px rgba(0,0,0,.1);\n}\n/* Collapsed */\n.mapboxgl-ctrl-geocoder.mapboxgl-ctrl-geocoder--collapsed {\n  width: 50px;\n  min-width: 50px;\n  transition: width .25s, min-width .25s;\n}\n/* Suggestions */\n.mapboxgl-ctrl-geocoder .suggestions {\n  background-color: #fff;\n  border-radius: 4px;\n  left: 0;\n  list-style: none;\n  margin: 0;\n  padding: 0;\n  position: absolute;\n  width: 100%;\n  top: 110%; /* fallback */\n  top: calc(100% + 6px);\n  z-index: 1000;\n  overflow: hidden;\n  font-size: 15px;\n}\n.mapboxgl-ctrl-bottom-left .suggestions,\n.mapboxgl-ctrl-bottom-right .suggestions {\n  top: auto;\n  bottom: 100%;\n}\n.mapboxgl-ctrl-geocoder .suggestions > li > a {\n  cursor: default;\n  display: block;\n  padding: 6px 12px;\n  color: #404040;\n}\n.mapboxgl-ctrl-geocoder .suggestions > .active > a,\n.mapboxgl-ctrl-geocoder .suggestions > li > a:hover {\n  color: #404040;\n  background-color: #f3f3f3;\n  text-decoration: none;\n  cursor: pointer;\n}\n.mapboxgl-ctrl-geocoder--suggestion-title {\n  font-weight: bold;\n}\n.mapboxgl-ctrl-geocoder--suggestion-title,\n.mapboxgl-ctrl-geocoder--suggestion-address {\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n/* Icons */\n.mapboxgl-ctrl-geocoder--icon {\n  display: inline-block;\n  vertical-align: middle;\n  speak: none;\n  fill: #757575;\n  top: 15px;\n}\n.mapboxgl-ctrl-geocoder--icon-search {\n  position: absolute;\n  top: 13px;\n  left: 12px;\n  width: 23px;\n  height: 23px;\n}\n.mapboxgl-ctrl-geocoder--button {\n  padding: 0;\n  margin: 0;\n  border: none;\n  cursor: pointer;\n  background: #fff;\n  line-height: 1;\n}\n.mapboxgl-ctrl-geocoder--icon-close {\n  width: 20px;\n  height: 20px;\n  margin-top: 8px;\n  margin-right: 3px;\n}\n.mapboxgl-ctrl-geocoder--button:hover .mapboxgl-ctrl-geocoder--icon-close {\n  fill: #909090;\n}\n.mapboxgl-ctrl-geocoder--icon-loading {\n  width: 26px;\n  height: 26px;\n  margin-top: 5px;\n  margin-right: 0px;\n  animation: rotate 0.8s infinite cubic-bezier(0.45, 0.05, 0.55, 0.95);\n}\n/* Animation */\n@keyframes rotate {\n  from {\n    transform: rotate(0);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n/* Media queries*/\n@media screen and (min-width: 640px) {\n\n  .mapboxgl-ctrl-geocoder.mapboxgl-ctrl-geocoder--collapsed {\n    width: 36px;\n    min-width: 36px;\n  }\n\n  .mapboxgl-ctrl-geocoder {\n    width: 33.3333%;\n    font-size: 15px;\n    line-height: 20px;\n    max-width: 360px;\n  }\n  .mapboxgl-ctrl-geocoder .suggestions {\n    font-size: 13px;\n  }\n\n  .mapboxgl-ctrl-geocoder--icon {\n    top: 8px;\n  }\n\n  .mapboxgl-ctrl-geocoder--icon-close {\n    width: 16px;\n    height: 16px;\n    margin-top: 3px;\n    margin-right: 0;\n  }\n\n  .mapboxgl-ctrl-geocoder--icon-search {\n    left: 7px;\n    width: 20px;\n    height: 20px;\n  }\n\n  .mapboxgl-ctrl-geocoder--input {\n    height: 36px;\n    padding: 6px 35px;\n  }\n\n  .mapboxgl-ctrl-geocoder--icon-loading {\n    width: 26px;\n    height: 26px;\n    margin-top: -2px;\n    margin-right: -5px;\n  }\n\n  .mapbox-gl-geocoder--error{\n    color:#909090;\n    padding: 6px 12px;\n    font-size: 16px;\n    text-align: center\n  }\n\n}\n'}},Mt=>{Mt(Mt.s=4206)}]);